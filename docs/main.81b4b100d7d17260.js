(self.webpackChunkActilogic=self.webpackChunkActilogic||[]).push([[179],{89:(Bt,Vt,Xe)=>{"use strict";var lt=Xe(494),we=Xe(703),h="\n  ",U={};function Y(ze){var Q=Array.isArray(ze);return function(J){var re=ie(U.plainArray,J);if(re)return re;if(Q&&J.length!==ze.length)return"an array with "+ze.length+" items";for(var Ie=0;Ie<J.length;Ie++)if(re=ie(Q?ze[Ie]:ze,J[Ie]))return[Ie].concat(re)}}function ie(ze,Q){if(null!=Q||ze.hasOwnProperty("__required")){var Ee=ze(Q);if(Ee)return Array.isArray(Ee)?Ee:[Ee]}}function $(ze,Q){var Ee=ze.length,Ae=ze[Ee-1],J=ze.slice(0,Ee-1);return 0===J.length&&(J=["value"]),Q=we(Q,{path:J}),"function"==typeof Ae?Ae(Q):ce(Q,function W(ze){return"must be "+function ge(ze){return/^an? /.test(ze)?ze:/^[aeiou]/i.test(ze)?"an "+ze:/^[a-z]/i.test(ze)?"a "+ze:ze}(ze)+"."}(Ae))}function K(ze){return ze.length<2?ze[0]:2===ze.length?ze.join(" or "):ze.slice(0,-1).join(", ")+", or "+ze.slice(-1)}function ce(ze,Q){return(ue(ze.path)?"Item at position ":"")+ze.path.join(".")+" "+Q}function ue(ze){return"number"==typeof ze[ze.length-1]||"number"==typeof ze[0]}U.assert=function(ze,Q){return Q=Q||{},function(Ee){var Ae=ie(ze,Ee);if(Ae){var J=$(Ae,Q);throw Q.apiName&&(J=Q.apiName+": "+J),new Error(J)}}},U.shape=function(Q){var Ee=function Ce(ze){return Object.keys(ze||{}).map(function(Q){return{key:Q,value:ze[Q]}})}(Q);return function(J){var re=ie(U.plainObject,J);if(re)return re;for(var Ie,He=[],it=0;it<Ee.length;it++)(re=ie(Ee[it].value,J[Ie=Ee[it].key]))&&He.push([Ie].concat(re));return He.length<2?He[0]:function(gt){He=He.map(function(Et){return"- "+Et[0]+": "+$(Et,gt).split("\n").join(h)});var kt=gt.path.join(".");return"The following properties"+("value"===kt?"":" of "+kt)+" have invalid values:"+h+He.join(h)}}},U.strictShape=function(Q){var Ee=U.shape(Q);return function(J){var re=Ee(J);if(re)return re;var Ie=Object.keys(J).reduce(function(Be,He){return void 0===Q[He]&&Be.push(He),Be},[]);return 0!==Ie.length?function(){return"The following keys are invalid: "+Ie.join(", ")}:void 0}},U.arrayOf=function(Q){return Y(Q)},U.tuple=function(){var Q=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return Y(Q)},U.required=function(Q){function Ee(Ae){return null==Ae?function(J){return ce(J,ue(J.path)?"cannot be undefined/null.":"is required.")}:Q.apply(this,arguments)}return Ee.__required=!0,Ee},U.oneOfType=function(){var Q=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(Ae){var J=Q.map(function(re){return ie(re,Ae)}).filter(Boolean);if(J.length===Q.length)return J.every(function(re){return 1===re.length&&"string"==typeof re[0]})?K(J.map(function(re){return re[0]})):J.reduce(function(re,Ie){return Ie.length>re.length?Ie:re})}},U.equal=function(Q){return function(Ae){if(Ae!==Q)return JSON.stringify(Q)}},U.oneOf=function(){var Q=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),Ee=Q.map(function(Ae){return U.equal(Ae)});return U.oneOfType.apply(this,Ee)},U.range=function(Q){var Ee=Q[0],Ae=Q[1];return function(re){if(ie(U.number,re)||re<Ee||re>Ae)return"number between "+Ee+" & "+Ae+" (inclusive)"}},U.any=function(){},U.boolean=function(Q){if("boolean"!=typeof Q)return"boolean"},U.number=function(Q){if("number"!=typeof Q)return"number"},U.plainArray=function(Q){if(!Array.isArray(Q))return"array"},U.plainObject=function(Q){if(!lt(Q))return"object"},U.string=function(Q){if("string"!=typeof Q)return"string"},U.func=function(Q){if("function"!=typeof Q)return"function"},U.validate=ie,U.processMessage=$,Bt.exports=U},518:Bt=>{Bt.exports=function we(de,h,U){function Y(K,W){if(!h[K]){if(!de[K]){if(ie)return ie(K,!0);var ce=new Error("Cannot find module '"+K+"'");throw ce.code="MODULE_NOT_FOUND",ce}var ue=h[K]={exports:{}};de[K][0].call(ue.exports,function(Ce){return Y(de[K][1][Ce]||Ce)},ue,ue.exports,we,de,h,U)}return h[K].exports}for(var ie=void 0,$=0;$<U.length;$++)Y(U[$]);return Y}({1:[function(we,de,h){"use strict";var U={};function Y(K){return Math.floor(Math.abs(K)+.5)*(K>=0?1:-1)}function ie(K,W,ge){var ce=(K=Y(K*ge))-(W=Y(W*ge));ce<<=1,K-W<0&&(ce=~ce);for(var ue="";ce>=32;)ue+=String.fromCharCode(63+(32|31&ce)),ce>>=5;return ue+String.fromCharCode(ce+63)}function $(K){for(var W=[],ge=0;ge<K.length;ge++){var ce=K[ge].slice();W.push([ce[1],ce[0]])}return W}U.decode=function(K,W){for(var Ae,ge=0,ce=0,ue=0,Ce=[],ze=0,Q=0,Ee=null,re=Math.pow(10,Number.isInteger(W)?W:5);ge<K.length;){Ee=null,ze=0,Q=0;do{Q|=(31&(Ee=K.charCodeAt(ge++)-63))<<ze,ze+=5}while(Ee>=32);Ae=1&Q?~(Q>>1):Q>>1,ze=Q=0;do{Q|=(31&(Ee=K.charCodeAt(ge++)-63))<<ze,ze+=5}while(Ee>=32);Ce.push([(ce+=Ae)/re,(ue+=1&Q?~(Q>>1):Q>>1)/re])}return Ce},U.encode=function(K,W){if(!K.length)return"";for(var ge=Math.pow(10,Number.isInteger(W)?W:5),ce=ie(K[0][0],0,ge)+ie(K[0][1],0,ge),ue=1;ue<K.length;ue++){var Ce=K[ue],ze=K[ue-1];ce+=ie(Ce[0],ze[0],ge),ce+=ie(Ce[1],ze[1],ge)}return ce},U.fromGeoJSON=function(K,W){if(K&&"Feature"===K.type&&(K=K.geometry),!K||"LineString"!==K.type)throw new Error("Input must be a GeoJSON LineString");return U.encode($(K.coordinates),W)},U.toGeoJSON=function(K,W){return{type:"LineString",coordinates:$(U.decode(K,W))}},"object"==typeof de&&de.exports&&(de.exports=U)},{}],2:[function(we,de,h){"use strict";var U=we("is-obj"),Y=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;function $(ge){if(null==ge)throw new TypeError("Sources cannot be null or undefined");return Object(ge)}function K(ge,ce,ue){var Ce=ce[ue];if(null!=Ce){if(Y.call(ge,ue)&&null==ge[ue])throw new TypeError("Cannot convert undefined or null to object ("+ue+")");ge[ue]=Y.call(ge,ue)&&U(Ce)?W(Object(ge[ue]),ce[ue]):Ce}}function W(ge,ce){if(ge===ce)return ge;for(var ue in ce=Object(ce))Y.call(ce,ue)&&K(ge,ce,ue);if(Object.getOwnPropertySymbols)for(var Ce=Object.getOwnPropertySymbols(ce),ze=0;ze<Ce.length;ze++)ie.call(ce,Ce[ze])&&K(ge,ce,Ce[ze]);return ge}de.exports=function(ce){ce=$(ce);for(var ue=1;ue<arguments.length;ue++)W(ce,arguments[ue]);return ce}},{"is-obj":5}],3:[function(we,de,h){function U(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function Y(W){return"function"==typeof W}function $(W){return"object"==typeof W&&null!==W}function K(W){return void 0===W}de.exports=U,U.EventEmitter=U,U.prototype._events=void 0,U.prototype._maxListeners=void 0,U.defaultMaxListeners=10,U.prototype.setMaxListeners=function(W){if(!function ie(W){return"number"==typeof W}(W)||W<0||isNaN(W))throw TypeError("n must be a positive number");return this._maxListeners=W,this},U.prototype.emit=function(W){var ge,ce,ue,Ce,ze,Q;if(this._events||(this._events={}),"error"===W&&(!this._events.error||$(this._events.error)&&!this._events.error.length)){if((ge=arguments[1])instanceof Error)throw ge;var Ee=new Error('Uncaught, unspecified "error" event. ('+ge+")");throw Ee.context=ge,Ee}if(K(ce=this._events[W]))return!1;if(Y(ce))switch(arguments.length){case 1:ce.call(this);break;case 2:ce.call(this,arguments[1]);break;case 3:ce.call(this,arguments[1],arguments[2]);break;default:Ce=Array.prototype.slice.call(arguments,1),ce.apply(this,Ce)}else if($(ce))for(Ce=Array.prototype.slice.call(arguments,1),ue=(Q=ce.slice()).length,ze=0;ze<ue;ze++)Q[ze].apply(this,Ce);return!0},U.prototype.on=U.prototype.addListener=function(W,ge){var ce;if(!Y(ge))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",W,Y(ge.listener)?ge.listener:ge),this._events[W]?$(this._events[W])?this._events[W].push(ge):this._events[W]=[this._events[W],ge]:this._events[W]=ge,$(this._events[W])&&!this._events[W].warned&&(ce=K(this._maxListeners)?U.defaultMaxListeners:this._maxListeners)&&ce>0&&this._events[W].length>ce&&(this._events[W].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[W].length),"function"==typeof console.trace&&console.trace()),this},U.prototype.once=function(W,ge){if(!Y(ge))throw TypeError("listener must be a function");var ce=!1;function ue(){this.removeListener(W,ue),ce||(ce=!0,ge.apply(this,arguments))}return ue.listener=ge,this.on(W,ue),this},U.prototype.removeListener=function(W,ge){var ce,ue,Ce,ze;if(!Y(ge))throw TypeError("listener must be a function");if(!this._events||!this._events[W])return this;if(Ce=(ce=this._events[W]).length,ue=-1,ce===ge||Y(ce.listener)&&ce.listener===ge)delete this._events[W],this._events.removeListener&&this.emit("removeListener",W,ge);else if($(ce)){for(ze=Ce;ze-- >0;)if(ce[ze]===ge||ce[ze].listener&&ce[ze].listener===ge){ue=ze;break}if(ue<0)return this;1===ce.length?(ce.length=0,delete this._events[W]):ce.splice(ue,1),this._events.removeListener&&this.emit("removeListener",W,ge)}return this},U.prototype.removeAllListeners=function(W){var ge,ce;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[W]&&delete this._events[W],this;if(0===arguments.length){for(ge in this._events)"removeListener"!==ge&&this.removeAllListeners(ge);return this.removeAllListeners("removeListener"),this._events={},this}if(Y(ce=this._events[W]))this.removeListener(W,ce);else if(ce)for(;ce.length;)this.removeListener(W,ce[ce.length-1]);return delete this._events[W],this},U.prototype.listeners=function(W){return this._events&&this._events[W]?Y(this._events[W])?[this._events[W]]:this._events[W].slice():[]},U.prototype.listenerCount=function(W){if(this._events){var ge=this._events[W];if(Y(ge))return 1;if(ge)return ge.length}return 0},U.listenerCount=function(W,ge){return W.listenerCount(ge)}},{}],4:[function(we,de,h){!function(){var Y={};void 0!==h?de.exports=Y:this.fuzzy=Y,Y.simpleFilter=function(ie,$){return $.filter(function(K){return Y.test(ie,K)})},Y.test=function(ie,$){return null!==Y.match(ie,$)},Y.match=function(ie,$,K){var Ae,W=0,ge=[],ce=$.length,ue=0,Ce=0,ze=(K=K||{}).pre||"",Q=K.post||"",Ee=K.caseSensitive&&$||$.toLowerCase();ie=K.caseSensitive&&ie||ie.toLowerCase();for(var J=0;J<ce;J++)Ae=$[J],Ee[J]===ie[W]?(Ae=ze+Ae+Q,W+=1,Ce+=1+Ce):Ce=0,ue+=Ce,ge[ge.length]=Ae;return W===ie.length?(ue=Ee===ie?1/0:ue,{rendered:ge.join(""),score:ue}):null},Y.filter=function(ie,$,K){return $&&0!==$.length?"string"!=typeof ie?$:(K=K||{},$.reduce(function(W,ge,ce,ue){var Ce=ge;K.extract&&(Ce=K.extract(ge));var ze=Y.match(ie,Ce,K);return null!=ze&&(W[W.length]={string:ze.rendered,score:ze.score,index:ce,original:ge}),W},[]).sort(function(W,ge){return ge.score-W.score||W.index-ge.index})):[]}}()},{}],5:[function(we,de,h){"use strict";de.exports=function(U){var Y=typeof U;return null!==U&&("object"===Y||"function"===Y)}},{}],6:[function(we,de,h){de.exports=/<%=([\s\S]+?)%>/g},{}],7:[function(we,de,h){(function(U){var K=/^\s+|\s+$/g,W=/^[-+]0x[0-9a-f]+$/i,ge=/^0b[01]+$/i,ce=/^0o[0-7]+$/i,ue=parseInt,ze="object"==typeof self&&self&&self.Object===Object&&self,Q="object"==typeof U&&U&&U.Object===Object&&U||ze||Function("return this")(),Ae=Object.prototype.toString,J=Math.max,re=Math.min,Ie=function(){return Q.Date.now()};function He(_t){var Et=typeof _t;return!!_t&&("object"==Et||"function"==Et)}function kt(_t){if("number"==typeof _t)return _t;if(function gt(_t){return"symbol"==typeof _t||function it(_t){return!!_t&&"object"==typeof _t}(_t)&&"[object Symbol]"==Ae.call(_t)}(_t))return NaN;if(He(_t)){var Et="function"==typeof _t.valueOf?_t.valueOf():_t;_t=He(Et)?Et+"":Et}if("string"!=typeof _t)return 0===_t?_t:+_t;_t=_t.replace(K,"");var Lt=ge.test(_t);return Lt||ce.test(_t)?ue(_t.slice(2),Lt?2:8):W.test(_t)?NaN:+_t}de.exports=function Be(_t,Et,Lt){var ut,rt,un,Cn,an,Ln,hn=0,Bn=!1,sr=!1,Rt=!0;if("function"!=typeof _t)throw new TypeError("Expected a function");function kn(tr){var xn=ut,ar=rt;return ut=rt=void 0,hn=tr,Cn=_t.apply(ar,xn)}function nt(tr){return hn=tr,an=setTimeout(pn,Et),Bn?kn(tr):Cn}function Gt(tr){var xn=tr-Ln;return void 0===Ln||xn>=Et||xn<0||sr&&tr-hn>=un}function pn(){var tr=Ie();if(Gt(tr))return bt(tr);an=setTimeout(pn,function Ct(tr){var Un=Et-(tr-Ln);return sr?re(Un,un-(tr-hn)):Un}(tr))}function bt(tr){return an=void 0,Rt&&ut?kn(tr):(ut=rt=void 0,Cn)}function dr(){var tr=Ie(),xn=Gt(tr);if(ut=arguments,rt=this,Ln=tr,xn){if(void 0===an)return nt(Ln);if(sr)return an=setTimeout(pn,Et),kn(Ln)}return void 0===an&&(an=setTimeout(pn,Et)),Cn}return Et=kt(Et)||0,He(Lt)&&(Bn=!!Lt.leading,un=(sr="maxWait"in Lt)?J(kt(Lt.maxWait)||0,Et):un,Rt="trailing"in Lt?!!Lt.trailing:Rt),dr.cancel=function Rn(){void 0!==an&&clearTimeout(an),hn=0,ut=Ln=rt=an=void 0},dr.flush=function Hr(){return void 0===an?Cn:bt(Ie())},dr}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(we,de,h){(function(U){var ie="__lodash_hash_undefined__",W=9007199254740991,ge="[object Arguments]",ce="[object Array]",Ce="[object Boolean]",ze="[object Date]",Q="[object Error]",Ee="[object Function]",J="[object Map]",re="[object Number]",Be="[object Object]",He="[object Promise]",gt="[object RegExp]",kt="[object Set]",_t="[object String]",Et="[object Symbol]",ut="[object WeakMap]",rt="[object ArrayBuffer]",un="[object DataView]",Gt=/^\[object .+?Constructor\]$/,pn=/^(?:0|[1-9]\d*)$/,bt={};bt["[object Float32Array]"]=bt["[object Float64Array]"]=bt["[object Int8Array]"]=bt["[object Int16Array]"]=bt["[object Int32Array]"]=bt["[object Uint8Array]"]=bt["[object Uint8ClampedArray]"]=bt["[object Uint16Array]"]=bt["[object Uint32Array]"]=!0,bt[ge]=bt[ce]=bt[rt]=bt[Ce]=bt[un]=bt[ze]=bt[Q]=bt[Ee]=bt[J]=bt[re]=bt[Be]=bt[gt]=bt[kt]=bt[_t]=bt[ut]=!1;var Rn="object"==typeof U&&U&&U.Object===Object&&U,Hr="object"==typeof self&&self&&self.Object===Object&&self,dr=Rn||Hr||Function("return this")(),tr="object"==typeof h&&h&&!h.nodeType&&h,xn=tr&&"object"==typeof de&&de&&!de.nodeType&&de,ar=xn&&xn.exports===tr,Un=ar&&Rn.process,ki=function(){try{return Un&&Un.binding&&Un.binding("util")}catch(pe){}}(),Wr=ki&&ki.isTypedArray;function Br(pe,Ne){for(var dt=-1,Qt=null==pe?0:pe.length;++dt<Qt;)if(Ne(pe[dt],dt,pe))return!0;return!1}function Zo(pe,Ne){return pe.has(Ne)}function Ri(pe){var Ne=-1,dt=Array(pe.size);return pe.forEach(function(Qt,fr){dt[++Ne]=[fr,Qt]}),dt}function Wo(pe){var Ne=-1,dt=Array(pe.size);return pe.forEach(function(Qt){dt[++Ne]=Qt}),dt}var pe,us=Array.prototype,hs=Object.prototype,Rs=dr["__core-js_shared__"],Ys=Function.prototype.toString,wi=hs.hasOwnProperty,Js=(pe=/[^.]+$/.exec(Rs&&Rs.keys&&Rs.keys.IE_PROTO||""))?"Symbol(src)_1."+pe:"",Oi=hs.toString,Os=RegExp("^"+Ys.call(wi).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ei=ar?dr.Buffer:void 0,Xr=dr.Symbol,Qn=dr.Uint8Array,ao=hs.propertyIsEnumerable,nr=us.splice,Ui=Xr?Xr.toStringTag:void 0,Xo=Object.getOwnPropertySymbols,ne=Ei?Ei.isBuffer:void 0,N=function so(pe,Ne){return function(dt){return pe(Ne(dt))}}(Object.keys,Object),j=Nn(dr,"DataView"),oe=Nn(dr,"Map"),se=Nn(dr,"Promise"),De=Nn(dr,"Set"),Me=Nn(dr,"WeakMap"),Oe=Nn(Object,"create"),ke=yr(j),je=yr(oe),st=yr(se),It=yr(De),ot=yr(Me),on=Xr?Xr.prototype:void 0,Kt=on?on.valueOf:void 0;function Yt(pe){var Ne=-1,dt=null==pe?0:pe.length;for(this.clear();++Ne<dt;){var Qt=pe[Ne];this.set(Qt[0],Qt[1])}}function Fn(pe){var Ne=-1,dt=null==pe?0:pe.length;for(this.clear();++Ne<dt;){var Qt=pe[Ne];this.set(Qt[0],Qt[1])}}function Ci(pe){var Ne=-1,dt=null==pe?0:pe.length;for(this.clear();++Ne<dt;){var Qt=pe[Ne];this.set(Qt[0],Qt[1])}}function hi(pe){var Ne=-1,dt=null==pe?0:pe.length;for(this.__data__=new Ci;++Ne<dt;)this.add(pe[Ne])}function Yi(pe){var Ne=this.__data__=new Fn(pe);this.size=Ne.size}function wn(pe,Ne){var dt=Mr(pe),Qt=!dt&&bo(pe),fr=!dt&&!Qt&&ci(pe),An=!dt&&!Qt&&!fr&&yn(pe),Pt=dt||Qt||fr||An,ir=Pt?function oo(pe,Ne){for(var dt=-1,Qt=Array(pe);++dt<pe;)Qt[dt]=Ne(dt);return Qt}(pe.length,String):[],yi=ir.length;for(var lr in pe)(Ne||wi.call(pe,lr))&&(!Pt||!("length"==lr||fr&&("offset"==lr||"parent"==lr)||An&&("buffer"==lr||"byteLength"==lr||"byteOffset"==lr)||Ze(lr,yi)))&&ir.push(lr);return ir}function Oo(pe,Ne){for(var dt=pe.length;dt--;)if(Cr(pe[dt][0],Ne))return dt;return-1}function Pr(pe){return null==pe?void 0===pe?"[object Undefined]":"[object Null]":Ui&&Ui in Object(pe)?function sc(pe){var Ne=wi.call(pe,Ui),dt=pe[Ui];try{pe[Ui]=void 0;var Qt=!0}catch(An){}var fr=Oi.call(pe);return Qt&&(Ne?pe[Ui]=dt:delete pe[Ui]),fr}(pe):function Yr(pe){return Oi.call(pe)}(pe)}function gi(pe){return Yo(pe)&&Pr(pe)==ge}function Lo(pe,Ne,dt,Qt,fr){return pe===Ne||(null==pe||null==Ne||!Yo(pe)&&!Yo(Ne)?pe!=pe&&Ne!=Ne:function wr(pe,Ne,dt,Qt,fr,An){var Pt=Mr(pe),ir=Mr(Ne),yi=Pt?ce:Se(pe),lr=ir?ce:Se(Ne),Ft=(yi=yi==ge?Be:yi)==Be,Dn=(lr=lr==ge?Be:lr)==Be,qn=yi==lr;if(qn&&ci(pe)){if(!ci(Ne))return!1;Pt=!0,Ft=!1}if(qn&&!Ft)return An||(An=new Yi),Pt||yn(pe)?Li(pe,Ne,dt,Qt,fr,An):function co(pe,Ne,dt,Qt,fr,An,Pt){switch(dt){case un:if(pe.byteLength!=Ne.byteLength||pe.byteOffset!=Ne.byteOffset)return!1;pe=pe.buffer,Ne=Ne.buffer;case rt:return!(pe.byteLength!=Ne.byteLength||!An(new Qn(pe),new Qn(Ne)));case Ce:case ze:case re:return Cr(+pe,+Ne);case Q:return pe.name==Ne.name&&pe.message==Ne.message;case gt:case _t:return pe==Ne+"";case J:var ir=Ri;case kt:if(ir||(ir=Wo),pe.size!=Ne.size&&!(1&Qt))return!1;var lr=Pt.get(pe);if(lr)return lr==Ne;Qt|=2,Pt.set(pe,Ne);var Ft=Li(ir(pe),ir(Ne),Qt,fr,An,Pt);return Pt.delete(pe),Ft;case Et:if(Kt)return Kt.call(pe)==Kt.call(Ne)}return!1}(pe,Ne,yi,dt,Qt,fr,An);if(!(1&dt)){var Ur=Ft&&wi.call(pe,"__wrapped__"),di=Dn&&wi.call(Ne,"__wrapped__");if(Ur||di){var Ir=Ur?pe.value():pe,ri=di?Ne.value():Ne;return An||(An=new Yi),fr(Ir,ri,dt,Qt,An)}}return!!qn&&(An||(An=new Yi),function Fs(pe,Ne,dt,Qt,fr,An){var Pt=1&dt,ir=ms(pe),yi=ir.length;if(yi!=ms(Ne).length&&!Pt)return!1;for(var Dn=yi;Dn--;){var qn=ir[Dn];if(!(Pt?qn in Ne:wi.call(Ne,qn)))return!1}var Ur=An.get(pe);if(Ur&&An.get(Ne))return Ur==Ne;var di=!0;An.set(pe,Ne),An.set(Ne,pe);for(var Ir=Pt;++Dn<yi;){var ri=pe[qn=ir[Dn]],gr=Ne[qn];if(Qt)var Bs=Pt?Qt(gr,ri,qn,Ne,pe,An):Qt(ri,gr,qn,pe,Ne,An);if(!(void 0===Bs?ri===gr||fr(ri,gr,dt,Qt,An):Bs)){di=!1;break}Ir||(Ir="constructor"==qn)}if(di&&!Ir){var wo=pe.constructor,On=Ne.constructor;wo!=On&&"constructor"in pe&&"constructor"in Ne&&!("function"==typeof wo&&wo instanceof wo&&"function"==typeof On&&On instanceof On)&&(di=!1)}return An.delete(pe),An.delete(Ne),di}(pe,Ne,dt,Qt,fr,An))}(pe,Ne,dt,Qt,Lo,fr))}function oi(pe){return!(!zs(pe)||function Pn(pe){return!!Js&&Js in pe}(pe))&&(Ns(pe)?Os:Gt).test(yr(pe))}function _i(pe){if(!function Yn(pe){var Ne=pe&&pe.constructor;return pe===("function"==typeof Ne&&Ne.prototype||hs)}(pe))return N(pe);var Ne=[];for(var dt in Object(pe))wi.call(pe,dt)&&"constructor"!=dt&&Ne.push(dt);return Ne}function Li(pe,Ne,dt,Qt,fr,An){var Pt=1&dt,ir=pe.length,yi=Ne.length;if(ir!=yi&&!(Pt&&yi>ir))return!1;var lr=An.get(pe);if(lr&&An.get(Ne))return lr==Ne;var Ft=-1,Dn=!0,qn=2&dt?new hi:void 0;for(An.set(pe,Ne),An.set(Ne,pe);++Ft<ir;){var Ur=pe[Ft],di=Ne[Ft];if(Qt)var Ir=Pt?Qt(di,Ur,Ft,Ne,pe,An):Qt(Ur,di,Ft,pe,Ne,An);if(void 0!==Ir){if(Ir)continue;Dn=!1;break}if(qn){if(!Br(Ne,function(ri,gr){if(!Zo(qn,gr)&&(Ur===ri||fr(Ur,ri,dt,Qt,An)))return qn.push(gr)})){Dn=!1;break}}else if(Ur!==di&&!fr(Ur,di,dt,Qt,An)){Dn=!1;break}}return An.delete(pe),An.delete(Ne),Dn}function ms(pe){return function Kr(pe,Ne,dt){var Qt=Ne(pe);return Mr(pe)?Qt:function ko(pe,Ne){for(var dt=-1,Qt=Ne.length,fr=pe.length;++dt<Qt;)pe[fr+dt]=Ne[dt];return pe}(Qt,dt(pe))}(pe,Vr,ac)}function Ha(pe,Ne){var dt=pe.__data__;return function yt(pe){var Ne=typeof pe;return"string"==Ne||"number"==Ne||"symbol"==Ne||"boolean"==Ne?"__proto__"!==pe:null===pe}(Ne)?dt["string"==typeof Ne?"string":"hash"]:dt.map}function Nn(pe,Ne){var dt=function mi(pe,Ne){return null==pe?void 0:pe[Ne]}(pe,Ne);return oi(dt)?dt:void 0}Yt.prototype.clear=function rn(){this.__data__=Oe?Oe(null):{},this.size=0},Yt.prototype.delete=function $e(pe){var Ne=this.has(pe)&&delete this.__data__[pe];return this.size-=Ne?1:0,Ne},Yt.prototype.get=function rr(pe){var Ne=this.__data__;if(Oe){var dt=Ne[pe];return dt===ie?void 0:dt}return wi.call(Ne,pe)?Ne[pe]:void 0},Yt.prototype.has=function Ht(pe){var Ne=this.__data__;return Oe?void 0!==Ne[pe]:wi.call(Ne,pe)},Yt.prototype.set=function Kn(pe,Ne){var dt=this.__data__;return this.size+=this.has(pe)?0:1,dt[pe]=Oe&&void 0===Ne?ie:Ne,this},Fn.prototype.clear=function ds(){this.__data__=[],this.size=0},Fn.prototype.delete=function Ro(pe){var Ne=this.__data__,dt=Oo(Ne,pe);return!(dt<0||(dt==Ne.length-1?Ne.pop():nr.call(Ne,dt,1),--this.size,0))},Fn.prototype.get=function At(pe){var Ne=this.__data__,dt=Oo(Ne,pe);return dt<0?void 0:Ne[dt][1]},Fn.prototype.has=function mn(pe){return Oo(this.__data__,pe)>-1},Fn.prototype.set=function nn(pe,Ne){var dt=this.__data__,Qt=Oo(dt,pe);return Qt<0?(++this.size,dt.push([pe,Ne])):dt[Qt][1]=Ne,this},Ci.prototype.clear=function fs(){this.size=0,this.__data__={hash:new Yt,map:new(oe||Fn),string:new Yt}},Ci.prototype.delete=function Vn(pe){var Ne=Ha(this,pe).delete(pe);return this.size-=Ne?1:0,Ne},Ci.prototype.get=function gn(pe){return Ha(this,pe).get(pe)},Ci.prototype.has=function ps(pe){return Ha(this,pe).has(pe)},Ci.prototype.set=function mr(pe,Ne){var dt=Ha(this,pe),Qt=dt.size;return dt.set(pe,Ne),this.size+=dt.size==Qt?0:1,this},hi.prototype.add=hi.prototype.push=function Sr(pe){return this.__data__.set(pe,ie),this},hi.prototype.has=function oc(pe){return this.__data__.has(pe)},Yi.prototype.clear=function Qs(){this.__data__=new Fn,this.size=0},Yi.prototype.delete=function lo(pe){var Ne=this.__data__,dt=Ne.delete(pe);return this.size=Ne.size,dt},Yi.prototype.get=function Ls(pe){return this.__data__.get(pe)},Yi.prototype.has=function ea(pe){return this.__data__.has(pe)},Yi.prototype.set=function Wn(pe,Ne){var dt=this.__data__;if(dt instanceof Fn){var Qt=dt.__data__;if(!oe||Qt.length<199)return Qt.push([pe,Ne]),this.size=++dt.size,this;dt=this.__data__=new Ci(Qt)}return dt.set(pe,Ne),this.size=dt.size,this};var ac=Xo?function(pe){return null==pe?[]:(pe=Object(pe),function Vi(pe,Ne){for(var dt=-1,Qt=null==pe?0:pe.length,fr=0,An=[];++dt<Qt;){var Pt=pe[dt];Ne(Pt,dt,pe)&&(An[fr++]=Pt)}return An}(Xo(pe),function(Ne){return ao.call(pe,Ne)}))}:function vr(){return[]},Se=Pr;function Ze(pe,Ne){return!!(Ne=null==Ne?W:Ne)&&("number"==typeof pe||pn.test(pe))&&pe>-1&&pe%1==0&&pe<Ne}function yr(pe){if(null!=pe){try{return Ys.call(pe)}catch(Ne){}try{return pe+""}catch(Ne){}}return""}function Cr(pe,Ne){return pe===Ne||pe!=pe&&Ne!=Ne}(j&&Se(new j(new ArrayBuffer(1)))!=un||oe&&Se(new oe)!=J||se&&Se(se.resolve())!=He||De&&Se(new De)!=kt||Me&&Se(new Me)!=ut)&&(Se=function(pe){var Ne=Pr(pe),dt=Ne==Be?pe.constructor:void 0,Qt=dt?yr(dt):"";if(Qt)switch(Qt){case ke:return un;case je:return J;case st:return He;case It:return kt;case ot:return ut}return Ne});var bo=gi(function(){return arguments}())?gi:function(pe){return Yo(pe)&&wi.call(pe,"callee")&&!ao.call(pe,"callee")},Mr=Array.isArray;var ci=ne||function ji(){return!1};function Ns(pe){if(!zs(pe))return!1;var Ne=Pr(pe);return Ne==Ee||"[object GeneratorFunction]"==Ne||"[object AsyncFunction]"==Ne||"[object Proxy]"==Ne}function qr(pe){return"number"==typeof pe&&pe>-1&&pe%1==0&&pe<=W}function zs(pe){var Ne=typeof pe;return null!=pe&&("object"==Ne||"function"==Ne)}function Yo(pe){return null!=pe&&"object"==typeof pe}var yn=Wr?function Ki(pe){return function(Ne){return pe(Ne)}}(Wr):function Ko(pe){return Yo(pe)&&qr(pe.length)&&!!bt[Pr(pe)]};function Vr(pe){return function Sl(pe){return null!=pe&&qr(pe.length)&&!Ns(pe)}(pe)?wn(pe):_i(pe)}de.exports=function Ml(pe,Ne){return Lo(pe,Ne)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(we,de,h){(function(U){var Y=we("lodash._reinterpolate"),ie=we("lodash.templatesettings"),ge=9007199254740991,ce="[object Arguments]",Ae="[object Error]",J="[object Function]",it="[object Object]",Lt="[object Symbol]",Gt=/\b__p \+= '';/g,pn=/\b(__p \+=) '' \+/g,bt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Hr=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,dr=/^\[object .+?Constructor\]$/,tr=/^(?:0|[1-9]\d*)$/,xn=/($^)/,ar=/['\n\r\u2028\u2029\\]/g,Un={};Un["[object Float32Array]"]=Un["[object Float64Array]"]=Un["[object Int8Array]"]=Un["[object Int16Array]"]=Un["[object Int32Array]"]=Un["[object Uint8Array]"]=Un["[object Uint8ClampedArray]"]=Un["[object Uint16Array]"]=Un["[object Uint32Array]"]=!0,Un[ce]=Un["[object Array]"]=Un["[object ArrayBuffer]"]=Un["[object Boolean]"]=Un["[object DataView]"]=Un["[object Date]"]=Un[Ae]=Un[J]=Un["[object Map]"]=Un["[object Number]"]=Un[it]=Un["[object RegExp]"]=Un["[object Set]"]=Un["[object String]"]=Un["[object WeakMap]"]=!1;var ki={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Wr="object"==typeof U&&U&&U.Object===Object&&U,Vi="object"==typeof self&&self&&self.Object===Object&&self,ko=Wr||Vi||Function("return this")(),Br="object"==typeof h&&h&&!h.nodeType&&h,oo=Br&&"object"==typeof de&&de&&!de.nodeType&&de,Ki=oo&&oo.exports===Br,Zo=Ki&&Wr.process,mi=function(){try{return oo&&oo.require&&oo.require("util").types||Zo&&Zo.binding&&Zo.binding("util")}catch(Ze){}}(),Ri=mi&&mi.isTypedArray;function so(Se,Ze,yt){switch(yt.length){case 0:return Se.call(Ze);case 1:return Se.call(Ze,yt[0]);case 2:return Se.call(Ze,yt[0],yt[1]);case 3:return Se.call(Ze,yt[0],yt[1],yt[2])}return Se.apply(Ze,yt)}function Wo(Se,Ze){for(var yt=-1,Pn=null==Se?0:Se.length,Yn=Array(Pn);++yt<Pn;)Yn[yt]=Ze(Se[yt],yt,Se);return Yn}function Rs(Se){return"\\"+ki[Se]}function wi(Se,Ze){return function(yt){return Se(Ze(yt))}}var Se,Oi=Object.prototype,Os=ko["__core-js_shared__"],Ei=Function.prototype.toString,Xr=Oi.hasOwnProperty,Qn=(Se=/[^.]+$/.exec(Os&&Os.keys&&Os.keys.IE_PROTO||""))?"Symbol(src)_1."+Se:"",ao=Oi.toString,nr=Ei.call(Object),Ui=RegExp("^"+Ei.call(Xr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Xo=Ki?ko.Buffer:void 0,ne=ko.Symbol,N=wi(Object.getPrototypeOf,Object),j=Oi.propertyIsEnumerable,oe=ne?ne.toStringTag:void 0,se=function(){try{var Se=function nn(Se,Ze){var yt=function Ys(Se,Ze){return null==Se?void 0:Se[Ze]}(Se,Ze);return function rn(Se){return!(!gi(Se)||function gn(Se){return!!Qn&&Qn in Se}(Se))&&(Kr(Se)?Ui:dr).test(function Qs(Se){if(null!=Se){try{return Ei.call(Se)}catch(Ze){}try{return Se+""}catch(Ze){}}return""}(Se))}(yt)?yt:void 0}(Object,"defineProperty");return Se({},"",{}),Se}catch(Ze){}}(),De=Xo?Xo.isBuffer:void 0,Me=wi(Object.keys,Object),Oe=Math.max,ke=Date.now,je=ne?ne.prototype:void 0,st=je?je.toString:void 0;function It(Se,Ze){var yt=ea(Se),Pn=!yt&&Ls(Se),Yn=!yt&&!Pn&&wn(Se),Yr=!yt&&!Pn&&!Yn&&Ko(Se),yr=yt||Pn||Yn||Yr,Cr=yr?function us(Se,Ze){for(var yt=-1,Pn=Array(Se);++yt<Se;)Pn[yt]=Ze(yt);return Pn}(Se.length,String):[],bo=Cr.length;for(var Mr in Se)(Ze||Xr.call(Se,Mr))&&(!yr||!("length"==Mr||Yn&&("offset"==Mr||"parent"==Mr)||Yr&&("buffer"==Mr||"byteLength"==Mr||"byteOffset"==Mr)||fs(Mr,bo)))&&Cr.push(Mr);return Cr}function ot(Se,Ze,yt){var Pn=Se[Ze];(!Xr.call(Se,Ze)||!lo(Pn,yt)||void 0===yt&&!(Ze in Se))&&on(Se,Ze,yt)}function on(Se,Ze,yt){"__proto__"==Ze&&se?se(Se,Ze,{configurable:!0,enumerable:!0,value:yt,writable:!0}):Se[Ze]=yt}function Kt(Se){return null==Se?void 0===Se?"[object Undefined]":"[object Null]":oe&&oe in Object(Se)?function Ci(Se){var Ze=Xr.call(Se,oe),yt=Se[oe];try{Se[oe]=void 0;var Pn=!0}catch(Yr){}var Yn=ao.call(Se);return Pn&&(Ze?Se[oe]=yt:delete Se[oe]),Yn}(Se):function hi(Se){return ao.call(Se)}(Se)}function Yt(Se){return Lo(Se)&&Kt(Se)==ce}function Ht(Se){if(!gi(Se))return function mr(Se){var Ze=[];if(null!=Se)for(var yt in Object(Se))Ze.push(yt);return Ze}(Se);var Ze=ps(Se),yt=[];for(var Pn in Se)"constructor"==Pn&&(Ze||!Xr.call(Se,Pn))||yt.push(Pn);return yt}function Kn(Se,Ze){return oc(function Sr(Se,Ze,yt){return Ze=Oe(void 0===Ze?Se.length-1:Ze,0),function(){for(var Pn=arguments,Yn=-1,Yr=Oe(Pn.length-Ze,0),yr=Array(Yr);++Yn<Yr;)yr[Yn]=Pn[Ze+Yn];Yn=-1;for(var Cr=Array(Ze+1);++Yn<Ze;)Cr[Yn]=Pn[Yn];return Cr[Ze]=yt(yr),so(Se,this,Cr)}}(Se,Ze,sc),Se+"")}var Fn=se?function(Se,Ze){return se(Se,"toString",{configurable:!0,enumerable:!1,value:Nn(Ze),writable:!0})}:sc;function ds(Se){if("string"==typeof Se)return Se;if(ea(Se))return Wo(Se,ds)+"";if(function oi(Se){return"symbol"==typeof Se||Lo(Se)&&Kt(Se)==Lt}(Se))return st?st.call(Se):"";var Ze=Se+"";return"0"==Ze&&1/Se==-Infinity?"-0":Ze}function mn(Se,Ze,yt,Pn){return void 0===Se||lo(Se,Oi[yt])&&!Xr.call(Pn,yt)?Ze:Se}function fs(Se,Ze){var yt=typeof Se;return!!(Ze=null==Ze?ge:Ze)&&("number"==yt||"symbol"!=yt&&tr.test(Se))&&Se>-1&&Se%1==0&&Se<Ze}function Vn(Se,Ze,yt){if(!gi(yt))return!1;var Pn=typeof Ze;return!!("number"==Pn?Wn(yt)&&fs(Ze,yt.length):"string"==Pn&&Ze in yt)&&lo(yt[Ze],Se)}function ps(Se){var Ze=Se&&Se.constructor;return Se===("function"==typeof Ze&&Ze.prototype||Oi)}var oc=function Yi(Se){var Ze=0,yt=0;return function(){var Pn=ke(),Yn=16-(Pn-yt);if(yt=Pn,Yn>0){if(++Ze>=800)return arguments[0]}else Ze=0;return Se.apply(void 0,arguments)}}(Fn);function lo(Se,Ze){return Se===Ze||Se!=Se&&Ze!=Ze}var Ls=Yt(function(){return arguments}())?Yt:function(Se){return Lo(Se)&&Xr.call(Se,"callee")&&!j.call(Se,"callee")},ea=Array.isArray;function Wn(Se){return null!=Se&&Pr(Se.length)&&!Kr(Se)}var wn=De||function ac(){return!1};function Oo(Se){if(!Lo(Se))return!1;var Ze=Kt(Se);return Ze==Ae||"[object DOMException]"==Ze||"string"==typeof Se.message&&"string"==typeof Se.name&&!function wr(Se){if(!Lo(Se)||Kt(Se)!=it)return!1;var Ze=N(Se);if(null===Ze)return!0;var yt=Xr.call(Ze,"constructor")&&Ze.constructor;return"function"==typeof yt&&yt instanceof yt&&Ei.call(yt)==nr}(Se)}function Kr(Se){if(!gi(Se))return!1;var Ze=Kt(Se);return Ze==J||"[object GeneratorFunction]"==Ze||"[object AsyncFunction]"==Ze||"[object Proxy]"==Ze}function Pr(Se){return"number"==typeof Se&&Se>-1&&Se%1==0&&Se<=ge}function gi(Se){var Ze=typeof Se;return null!=Se&&("object"==Ze||"function"==Ze)}function Lo(Se){return null!=Se&&"object"==typeof Se}var Ko=Ri?function ks(Se){return function(Ze){return Se(Ze)}}(Ri):function $e(Se){return Lo(Se)&&Pr(Se.length)&&!!Un[Kt(Se)]};var Li=function At(Se){return Kn(function(Ze,yt){var Pn=-1,Yn=yt.length,Yr=Yn>1?yt[Yn-1]:void 0,yr=Yn>2?yt[2]:void 0;for(Yr=Se.length>3&&"function"==typeof Yr?(Yn--,Yr):void 0,yr&&Vn(yt[0],yt[1],yr)&&(Yr=Yn<3?void 0:Yr,Yn=1),Ze=Object(Ze);++Pn<Yn;){var Cr=yt[Pn];Cr&&Se(Ze,Cr,Pn,Yr)}return Ze})}(function(Se,Ze,yt,Pn){!function Ro(Se,Ze,yt,Pn){var Yn=!yt;yt||(yt={});for(var Yr=-1,yr=Ze.length;++Yr<yr;){var Cr=Ze[Yr],bo=Pn?Pn(yt[Cr],Se[Cr],Cr,yt,Se):void 0;void 0===bo&&(bo=Se[Cr]),Yn?on(yt,Cr,bo):ot(yt,Cr,bo)}return yt}(Ze,function Fs(Se){return Wn(Se)?It(Se,!0):Ht(Se)}(Ze),Se,Pn)});function co(Se){return Wn(Se)?It(Se):function rr(Se){if(!ps(Se))return Me(Se);var Ze=[];for(var yt in Object(Se))Xr.call(Se,yt)&&"constructor"!=yt&&Ze.push(yt);return Ze}(Se)}var Ha=Kn(function(Se,Ze){try{return so(Se,void 0,Ze)}catch(yt){return Oo(yt)?yt:new Error(yt)}});function Nn(Se){return function(){return Se}}function sc(Se){return Se}de.exports=function ms(Se,Ze,yt){var Pn=ie.imports._.templateSettings||ie;yt&&Vn(Se,Ze,yt)&&(Ze=void 0),Se=function _i(Se){return null==Se?"":ds(Se)}(Se),Ze=Li({},Ze,Pn,mn);var Cr,bo,Yn=Li({},Ze.imports,Pn.imports,mn),Yr=co(Yn),yr=function hs(Se,Ze){return Wo(Ze,function(yt){return Se[yt]})}(Yn,Yr),Mr=0,Sl=Ze.interpolate||xn,ci="__p += '",Ml=RegExp((Ze.escape||xn).source+"|"+Sl.source+"|"+(Sl===Y?Hr:xn).source+"|"+(Ze.evaluate||xn).source+"|$","g"),Ns=Xr.call(Ze,"sourceURL")?"//# sourceURL="+(Ze.sourceURL+"").replace(/[\r\n]/g," ")+"\n":"";Se.replace(Ml,function(Yo,yn,Vr,vr,ji,pe){return Vr||(Vr=vr),ci+=Se.slice(Mr,pe).replace(ar,Rs),yn&&(Cr=!0,ci+="' +\n__e("+yn+") +\n'"),ji&&(bo=!0,ci+="';\n"+ji+";\n__p += '"),Vr&&(ci+="' +\n((__t = ("+Vr+")) == null ? '' : __t) +\n'"),Mr=pe+Yo.length,Yo}),ci+="';\n";var qr=Xr.call(Ze,"variable")&&Ze.variable;qr||(ci="with (obj) {\n"+ci+"\n}\n"),ci=(bo?ci.replace(Gt,""):ci).replace(pn,"$1").replace(bt,"$1;"),ci="function("+(qr||"obj")+") {\n"+(qr?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(Cr?", __e = _.escape":"")+(bo?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+ci+"return __p\n}";var zs=Ha(function(){return Function(Yr,Ns+"return "+ci).apply(void 0,yr)});if(zs.source=ci,Oo(zs))throw zs;return zs}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"lodash._reinterpolate":6,"lodash.templatesettings":10}],10:[function(we,de,h){(function(U){var Y=we("lodash._reinterpolate"),K="[object Symbol]",ge=/[&<>"']/g,ce=RegExp(ge.source),Ee="object"==typeof self&&self&&self.Object===Object&&self,Ae="object"==typeof U&&U&&U.Object===Object&&U||Ee||Function("return this")();var Ie=function re(Rt){return function(kn){return null==Rt?void 0:Rt[kn]}}({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}),Be=Object.prototype,He=Be.hasOwnProperty,it=Be.toString,gt=Ae.Symbol,kt=gt?gt.toStringTag:void 0,_t=gt?gt.prototype:void 0,Et=_t?_t.toString:void 0;function ut(Rt){return null==Rt?void 0===Rt?"[object Undefined]":"[object Null]":kt&&kt in Object(Rt)?function un(Rt){var kn=He.call(Rt,kt),nt=Rt[kt];try{Rt[kt]=void 0;var Ct=!0}catch(pn){}var Gt=it.call(Rt);return Ct&&(kn?Rt[kt]=nt:delete Rt[kt]),Gt}(Rt):function Cn(Rt){return it.call(Rt)}(Rt)}function rt(Rt){if("string"==typeof Rt)return Rt;if(an(Rt))return function J(Rt,kn){for(var nt=-1,Ct=null==Rt?0:Rt.length,Gt=Array(Ct);++nt<Ct;)Gt[nt]=kn(Rt[nt],nt,Rt);return Gt}(Rt,rt)+"";if(function hn(Rt){return"symbol"==typeof Rt||function Ln(Rt){return null!=Rt&&"object"==typeof Rt}(Rt)&&ut(Rt)==K}(Rt))return Et?Et.call(Rt):"";var kn=Rt+"";return"0"==kn&&1/Rt==-Infinity?"-0":kn}var an=Array.isArray;de.exports={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:Y,variable:"",imports:{_:{escape:function sr(Rt){return(Rt=function Bn(Rt){return null==Rt?"":rt(Rt)}(Rt))&&ce.test(Rt)?Rt.replace(ge,Ie):Rt}}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"lodash._reinterpolate":6}],11:[function(we,de,h){var U=we("./_root");de.exports=U.Symbol},{"./_root":18}],12:[function(we,de,h){var U=we("./_Symbol"),Y=we("./_getRawTag"),ie=we("./_objectToString"),W=U?U.toStringTag:void 0;de.exports=function ge(ce){return null==ce?void 0===ce?"[object Undefined]":"[object Null]":W&&W in Object(ce)?Y(ce):ie(ce)}},{"./_Symbol":11,"./_getRawTag":15,"./_objectToString":16}],13:[function(we,de,h){(function(U){de.exports="object"==typeof U&&U&&U.Object===Object&&U}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(we,de,h){var Y=we("./_overArg")(Object.getPrototypeOf,Object);de.exports=Y},{"./_overArg":17}],15:[function(we,de,h){var U=we("./_Symbol"),Y=Object.prototype,ie=Y.hasOwnProperty,$=Y.toString,K=U?U.toStringTag:void 0;de.exports=function W(ge){var ce=ie.call(ge,K),ue=ge[K];try{ge[K]=void 0;var Ce=!0}catch(Q){}var ze=$.call(ge);return Ce&&(ce?ge[K]=ue:delete ge[K]),ze}},{"./_Symbol":11}],16:[function(we,de,h){var Y=Object.prototype.toString;de.exports=function ie($){return Y.call($)}},{}],17:[function(we,de,h){de.exports=function U(Y,ie){return function($){return Y(ie($))}}},{}],18:[function(we,de,h){var U=we("./_freeGlobal"),Y="object"==typeof self&&self&&self.Object===Object&&self,ie=U||Y||Function("return this")();de.exports=ie},{"./_freeGlobal":13}],19:[function(we,de,h){de.exports=function U(Y){return null!=Y&&"object"==typeof Y}},{}],20:[function(we,de,h){var U=we("./_baseGetTag"),Y=we("./_getPrototype"),ie=we("./isObjectLike"),ge=Function.prototype.toString,ce=Object.prototype.hasOwnProperty,ue=ge.call(Object);de.exports=function Ce(ze){if(!ie(ze)||"[object Object]"!=U(ze))return!1;var Q=Y(ze);if(null===Q)return!0;var Ee=ce.call(Q,"constructor")&&Q.constructor;return"function"==typeof Ee&&Ee instanceof Ee&&ge.call(Ee)==ue}},{"./_baseGetTag":12,"./_getPrototype":14,"./isObjectLike":19}],21:[function(we,de,h){var Y,ie,U=de.exports={};function $(){throw new Error("setTimeout has not been defined")}function K(){throw new Error("clearTimeout has not been defined")}function W(re){if(Y===setTimeout)return setTimeout(re,0);if((Y===$||!Y)&&setTimeout)return Y=setTimeout,setTimeout(re,0);try{return Y(re,0)}catch(Ie){try{return Y.call(null,re,0)}catch(Be){return Y.call(this,re,0)}}}!function(){try{Y="function"==typeof setTimeout?setTimeout:$}catch(re){Y=$}try{ie="function"==typeof clearTimeout?clearTimeout:K}catch(re){ie=K}}();var Ce,ce=[],ue=!1,ze=-1;function Q(){!ue||!Ce||(ue=!1,Ce.length?ce=Ce.concat(ce):ze=-1,ce.length&&Ee())}function Ee(){if(!ue){var re=W(Q);ue=!0;for(var Ie=ce.length;Ie;){for(Ce=ce,ce=[];++ze<Ie;)Ce&&Ce[ze].run();ze=-1,Ie=ce.length}Ce=null,ue=!1,function ge(re){if(ie===clearTimeout)return clearTimeout(re);if((ie===K||!ie)&&clearTimeout)return ie=clearTimeout,clearTimeout(re);try{return ie(re)}catch(Ie){try{return ie.call(null,re)}catch(Be){return ie.call(this,re)}}}(re)}}function Ae(re,Ie){this.fun=re,this.array=Ie}function J(){}U.nextTick=function(re){var Ie=new Array(arguments.length-1);if(arguments.length>1)for(var Be=1;Be<arguments.length;Be++)Ie[Be-1]=arguments[Be];ce.push(new Ae(re,Ie)),1===ce.length&&!ue&&W(Ee)},Ae.prototype.run=function(){this.fun.apply(null,this.array)},U.title="browser",U.browser=!0,U.env={},U.argv=[],U.version="",U.versions={},U.on=J,U.addListener=J,U.once=J,U.off=J,U.removeListener=J,U.removeAllListeners=J,U.emit=J,U.prependListener=J,U.prependOnceListener=J,U.listeners=function(re){return[]},U.binding=function(re){throw new Error("process.binding is not supported")},U.cwd=function(){return"/"},U.chdir=function(re){throw new Error("process.chdir is not supported")},U.umask=function(){return 0}},{}],22:[function(we,de,h){"use strict";function U(ie){return function($){var K=$.dispatch,W=$.getState;return function(ge){return function(ce){return"function"==typeof ce?ce(K,W,ie):ge(ce)}}}}h.__esModule=!0;var Y=U();Y.withExtraArgument=U,h.default=Y},{}],23:[function(we,de,h){"use strict";h.__esModule=!0;var U=Object.assign||function(W){for(var ge=1;ge<arguments.length;ge++){var ce=arguments[ge];for(var ue in ce)Object.prototype.hasOwnProperty.call(ce,ue)&&(W[ue]=ce[ue])}return W};h.default=function K(){for(var W=arguments.length,ge=Array(W),ce=0;ce<W;ce++)ge[ce]=arguments[ce];return function(ue){return function(Ce,ze,Q){var J,Ee=ue(Ce,ze,Q),Ae=Ee.dispatch,re={getState:Ee.getState,dispatch:function(Be){return Ae(Be)}};return J=ge.map(function(Ie){return Ie(re)}),Ae=ie.default.apply(void 0,J)(Ee.dispatch),U({},Ee,{dispatch:Ae})}}};var ie=function $(W){return W&&W.__esModule?W:{default:W}}(we("./compose"))},{"./compose":26}],24:[function(we,de,h){"use strict";function U(ie,$){return function(){return $(ie.apply(void 0,arguments))}}h.__esModule=!0,h.default=function Y(ie,$){if("function"==typeof ie)return U(ie,$);if("object"!=typeof ie||null===ie)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===ie?"null":typeof ie)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var K=Object.keys(ie),W={},ge=0;ge<K.length;ge++){var ce=K[ge],ue=ie[ce];"function"==typeof ue&&(W[ce]=U(ue,$))}return W}},{}],25:[function(we,de,h){(function(U){"use strict";h.__esModule=!0,h.default=function ze(Q){for(var Ee=Object.keys(Q),Ae={},J=0;J<Ee.length;J++){var re=Ee[J];"production"!==U.env.NODE_ENV&&void 0===Q[re]&&(0,W.default)('No reducer provided for key "'+re+'"'),"function"==typeof Q[re]&&(Ae[re]=Q[re])}var Ie=Object.keys(Ae),Be=void 0;"production"!==U.env.NODE_ENV&&(Be={});var He=void 0;try{!function Ce(Q){Object.keys(Q).forEach(function(Ee){var Ae=Q[Ee];if(void 0===Ae(void 0,{type:Y.ActionTypes.INIT}))throw new Error('Reducer "'+Ee+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===Ae(void 0,{type:"@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".")}))throw new Error('Reducer "'+Ee+"\" returned undefined when probed with a random type. Don't try to handle "+Y.ActionTypes.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')})}(Ae)}catch(it){He=it}return function(){var gt=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},kt=arguments[1];if(He)throw He;if("production"!==U.env.NODE_ENV){var _t=ue(gt,Ae,kt,Be);_t&&(0,W.default)(_t)}for(var Et=!1,Lt={},ut=0;ut<Ie.length;ut++){var rt=Ie[ut],Cn=gt[rt],an=(0,Ae[rt])(Cn,kt);if(void 0===an){var Ln=ce(rt,kt);throw new Error(Ln)}Lt[rt]=an,Et=Et||an!==Cn}return Et?Lt:gt}};var Y=we("./createStore"),$=ge(we("lodash/isPlainObject")),W=ge(we("./utils/warning"));function ge(Q){return Q&&Q.__esModule?Q:{default:Q}}function ce(Q,Ee){var Ae=Ee&&Ee.type;return"Given action "+(Ae&&'"'+Ae.toString()+'"'||"an action")+', reducer "'+Q+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function ue(Q,Ee,Ae,J){var re=Object.keys(Ee),Ie=Ae&&Ae.type===Y.ActionTypes.INIT?"preloadedState argument passed to createStore":"previous state received by the reducer";if(0===re.length)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";if(!(0,$.default)(Q))return"The "+Ie+' has unexpected type of "'+{}.toString.call(Q).match(/\s([a-z|A-Z]+)/)[1]+'". Expected argument to be an object with the following keys: "'+re.join('", "')+'"';var Be=Object.keys(Q).filter(function(He){return!Ee.hasOwnProperty(He)&&!J[He]});return Be.forEach(function(He){J[He]=!0}),Be.length>0?"Unexpected "+(Be.length>1?"keys":"key")+' "'+Be.join('", "')+'" found in '+Ie+'. Expected to find one of the known reducer keys instead: "'+re.join('", "')+'". Unexpected keys will be ignored.':void 0}}).call(this,we("_process"))},{"./createStore":27,"./utils/warning":29,_process:21,"lodash/isPlainObject":20}],26:[function(we,de,h){"use strict";h.__esModule=!0,h.default=function U(){for(var Y=arguments.length,ie=Array(Y),$=0;$<Y;$++)ie[$]=arguments[$];return 0===ie.length?function(K){return K}:1===ie.length?ie[0]:ie.reduce(function(K,W){return function(){return K(W.apply(void 0,arguments))}})}},{}],27:[function(we,de,h){"use strict";h.__esModule=!0,h.ActionTypes=void 0,h.default=function ge(ce,ue,Ce){var ze;if("function"==typeof ue&&void 0===Ce&&(Ce=ue,ue=void 0),void 0!==Ce){if("function"!=typeof Ce)throw new Error("Expected the enhancer to be a function.");return Ce(ge)(ce,ue)}if("function"!=typeof ce)throw new Error("Expected the reducer to be a function.");var Q=ce,Ee=ue,Ae=[],J=Ae,re=!1;function Ie(){J===Ae&&(J=Ae.slice())}function Be(){return Ee}function He(_t){if("function"!=typeof _t)throw new Error("Expected listener to be a function.");var Et=!0;return Ie(),J.push(_t),function(){if(Et){Et=!1,Ie();var ut=J.indexOf(_t);J.splice(ut,1)}}}function it(_t){if(!(0,Y.default)(_t))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===_t.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(re)throw new Error("Reducers may not dispatch actions.");try{re=!0,Ee=Q(Ee,_t)}finally{re=!1}for(var Et=Ae=J,Lt=0;Lt<Et.length;Lt++)(0,Et[Lt])();return _t}return it({type:W.INIT}),(ze={dispatch:it,subscribe:He,getState:Be,replaceReducer:function gt(_t){if("function"!=typeof _t)throw new Error("Expected the nextReducer to be a function.");Q=_t,it({type:W.INIT})}})[$.default]=function kt(){var _t,Et=He;return(_t={subscribe:function(ut){if("object"!=typeof ut)throw new TypeError("Expected the observer to be an object.");function rt(){ut.next&&ut.next(Be())}return rt(),{unsubscribe:Et(rt)}}})[$.default]=function(){return this},_t},ze};var Y=K(we("lodash/isPlainObject")),$=K(we("symbol-observable"));function K(ce){return ce&&ce.__esModule?ce:{default:ce}}var W=h.ActionTypes={INIT:"@@redux/INIT"}},{"lodash/isPlainObject":20,"symbol-observable":33}],28:[function(we,de,h){(function(U){"use strict";h.__esModule=!0,h.compose=h.applyMiddleware=h.bindActionCreators=h.combineReducers=h.createStore=void 0;var ie=Ae(we("./createStore")),K=Ae(we("./combineReducers")),ge=Ae(we("./bindActionCreators")),ue=Ae(we("./applyMiddleware")),ze=Ae(we("./compose")),Ee=Ae(we("./utils/warning"));function Ae(re){return re&&re.__esModule?re:{default:re}}function J(){}"production"!==U.env.NODE_ENV&&"string"==typeof J.name&&"isCrushed"!==J.name&&(0,Ee.default)("You are currently using minified code outside of NODE_ENV === 'production'. This means that you are running a slower development build of Redux. You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify or DefinePlugin for webpack (http://stackoverflow.com/questions/30030031) to ensure you have the correct code for your production build."),h.createStore=ie.default,h.combineReducers=K.default,h.bindActionCreators=ge.default,h.applyMiddleware=ue.default,h.compose=ze.default}).call(this,we("_process"))},{"./applyMiddleware":23,"./bindActionCreators":24,"./combineReducers":25,"./compose":26,"./createStore":27,"./utils/warning":29,_process:21}],29:[function(we,de,h){"use strict";h.__esModule=!0,h.default=function U(Y){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(Y);try{throw new Error(Y)}catch(ie){}}},{}],30:[function(we,de,h){"use strict";var U=we("./src/suggestions");window.Suggestions=de.exports=U},{"./src/suggestions":32}],31:[function(we,de,h){var U=function(Y){return this.component=Y,this.items=[],this.active=0,this.element=document.createElement("ul"),this.element.className="suggestions",this.selectingListItem=!1,Y.el.parentNode.insertBefore(this.element,Y.el.nextSibling),this};U.prototype.show=function(){this.element.style.display="block"},U.prototype.hide=function(){this.element.style.display="none"},U.prototype.add=function(Y){this.items.push(Y)},U.prototype.clear=function(){this.items=[],this.active=0},U.prototype.isEmpty=function(){return!this.items.length},U.prototype.draw=function(){if(this.element.innerHTML="",0!==this.items.length){for(var Y=0;Y<this.items.length;Y++)this.drawItem(this.items[Y],this.active===Y);this.show()}else this.hide()},U.prototype.drawItem=function(Y,ie){var $=document.createElement("li"),K=document.createElement("a");ie&&($.className+=" active"),K.innerHTML=Y.string,$.appendChild(K),this.element.appendChild($),$.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),$.addEventListener("mouseup",function(){this.handleMouseUp.call(this,Y)}.bind(this))},U.prototype.handleMouseUp=function(Y){this.selectingListItem=!1,this.component.value(Y.original),this.clear(),this.draw()},U.prototype.move=function(Y){this.active=Y,this.draw()},U.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},U.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},de.exports=U},{}],32:[function(we,de,h){"use strict";var U=we("xtend"),Y=we("fuzzy"),ie=we("./list"),$=function(K,W,ge){return this.options=U({minLength:2,limit:5,filter:!0},ge=ge||{}),this.el=K,this.data=W||[],this.list=new ie(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(ce){this.handleKeyUp(ce.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(ce){this.handleKeyDown(ce)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(ce){this.handlePaste(ce)}.bind(this)),this};$.prototype.handleKeyUp=function(K){40===K||38===K||27===K||13===K||9===K||this.handleInputChange(this.el.value)},$.prototype.handleKeyDown=function(K){switch(K.keyCode){case 13:case 9:K.preventDefault(),this.list.isEmpty()||(this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},$.prototype.handleBlur=function(){this.list.selectingListItem||this.list.hide()},$.prototype.handlePaste=function(K){if(K.clipboardData)this.handleInputChange(K.clipboardData.getData("Text"));else{var W=this;setTimeout(function(){W.handleInputChange(K.target.value)},100)}},$.prototype.handleInputChange=function(K){this.query=this.normalize(K),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(W){for(var ge=0;ge<W.length&&(this.list.add(W[ge]),ge!==this.options.limit-1);ge++);this.list.draw()}.bind(this))},$.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},$.prototype.update=function(K){this.data=K,this.handleKeyUp()},$.prototype.clear=function(){this.data=[],this.list.clear()},$.prototype.normalize=function(K){return K.toLowerCase()},$.prototype.match=function(K,W){return K.indexOf(W)>-1},$.prototype.value=function(K){if(this.selected=K,this.el.value=this.getItemValue(K),document.createEvent){var W=document.createEvent("HTMLEvents");W.initEvent("change",!0,!1),this.el.dispatchEvent(W)}else this.el.fireEvent("onchange")},$.prototype.getCandidates=function(K){var W={pre:"<strong>",post:"</strong>",extract:function(ce){return this.getItemValue(ce)}.bind(this)};K(this.options.filter?Y.filter(this.query,this.data,W):this.data.map(function(ce){for(var ue=this.getItemValue(ce),Ce=this.normalize(ue),ze=Ce.lastIndexOf(this.query);ze>-1;){var Q=ze+this.query.length;ue=ue.slice(0,ze)+"<strong>"+ue.slice(ze,Q)+"</strong>"+ue.slice(Q),ze=Ce.slice(0,ze).lastIndexOf(this.query)}return{original:ce,string:ue}}.bind(this)))},$.prototype.getItemValue=function(K){return K},de.exports=$},{"./list":31,fuzzy:4,xtend:37}],33:[function(we,de,h){(function(U){"use strict";Object.defineProperty(h,"__esModule",{value:!0});var K,ie=function $(ge){return ge&&ge.__esModule?ge:{default:ge}}(we("./ponyfill.js"));K="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==U?U:void 0!==de?de:Function("return this")();var W=(0,ie.default)(K);h.default=W}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./ponyfill.js":34}],34:[function(we,de,h){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.default=function U(Y){var ie,$=Y.Symbol;return"function"==typeof $?$.observable?ie=$.observable:(ie=$("observable"),$.observable=ie):ie="@@observable",ie}},{}],35:[function(we,de,h){var U=we("turf-meta").coordEach;de.exports=function(Y){var ie=[1/0,1/0,-1/0,-1/0];return U(Y,function($){ie[0]>$[0]&&(ie[0]=$[0]),ie[1]>$[1]&&(ie[1]=$[1]),ie[2]<$[0]&&(ie[2]=$[0]),ie[3]<$[1]&&(ie[3]=$[1])}),ie}},{"turf-meta":36}],36:[function(we,de,h){function U(K,W,ge){var ce,ue,Ce,ze,Q,Ee,Ae,J,Ie,re=0,Be="FeatureCollection"===K.type,He="Feature"===K.type,it=Be?K.features.length:1;for(ce=0;ce<it;ce++)for(Ee=(Ie="GeometryCollection"===(J=Be?K.features[ce].geometry:He?K.geometry:K).type)?J.geometries.length:1,ze=0;ze<Ee;ze++)if(Ae=(Q=Ie?J.geometries[ze]:J).coordinates,re=!ge||"Polygon"!==Q.type&&"MultiPolygon"!==Q.type?0:1,"Point"===Q.type)W(Ae);else if("LineString"===Q.type||"MultiPoint"===Q.type)for(ue=0;ue<Ae.length;ue++)W(Ae[ue]);else if("Polygon"===Q.type||"MultiLineString"===Q.type)for(ue=0;ue<Ae.length;ue++)for(Ce=0;Ce<Ae[ue].length-re;Ce++)W(Ae[ue][Ce]);else{if("MultiPolygon"!==Q.type)throw new Error("Unknown Geometry Type");for(ue=0;ue<Ae.length;ue++)for(Ce=0;Ce<Ae[ue].length;Ce++)for(l=0;l<Ae[ue][Ce].length-re;l++)W(Ae[ue][Ce][l])}}function ie(K,W){var ge;switch(K.type){case"FeatureCollection":for(features=K.features,ge=0;ge<K.features.length;ge++)W(K.features[ge].properties);break;case"Feature":W(K.properties)}}de.exports.coordEach=U,de.exports.coordReduce=function Y(K,W,ge,ce){return U(K,function(ue){ge=W(ge,ue)},ce),ge},de.exports.propEach=ie,de.exports.propReduce=function $(K,W,ge){return ie(K,function(ce){ge=W(ge,ce)}),ge}},{}],37:[function(we,de,h){de.exports=function Y(){for(var ie={},$=0;$<arguments.length;$++){var K=arguments[$];for(var W in K)U.call(K,W)&&(ie[W]=K[W])}return ie};var U=Object.prototype.hasOwnProperty},{}],38:[function(we,de,h){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.queryOrigin=function Ie(nt){return{type:Y.ORIGIN_QUERY,query:nt}},h.queryDestination=function Be(nt){return{type:Y.DESTINATION_QUERY,query:nt}},h.queryOriginCoordinates=He,h.queryDestinationCoordinates=it,h.clearOrigin=function gt(){return function(nt){nt({type:Y.ORIGIN_CLEAR}),nt(kn("clear",{type:"origin"})),nt(re(null))}},h.clearDestination=function kt(){return function(nt){nt({type:Y.DESTINATION_CLEAR}),nt(kn("clear",{type:"destination"})),nt(re(null))}},h.setOptions=function _t(nt){return{type:Y.SET_OPTIONS,options:nt}},h.hoverMarker=function Et(nt){return function(Ct){Ct(function Q(nt){return{type:Y.HOVER_MARKER,hoverMarker:nt}}(nt?$.default.createPoint(nt,{id:"hover"}):{}))}},h.setRouteIndex=Lt,h.createOrigin=ut,h.createDestination=rt,h.setProfile=function un(nt){return function(Ct,Gt){var pn=Gt(),bt=pn.origin,Rn=pn.destination;Ct({type:Y.DIRECTIONS_PROFILE,profile:nt}),Ct(kn("profile",{profile:nt})),bt.geometry&&Rn.geometry&&Ct(Ee())}},h.reverse=function Cn(){return function(nt,Ct){var Gt=Ct();Gt.destination.geometry&&nt(ce(Gt.destination.geometry.coordinates)),Gt.origin.geometry&&nt(ue(Gt.origin.geometry.coordinates)),Gt.origin.geometry&&Gt.destination.geometry&&nt(Ee());for(var pn=document.getElementsByClassName("suggestions"),bt=0;bt<pn.length;bt++)pn[bt].style.visibility="hidden"}},h.setOriginFromCoordinates=function an(nt){return function(Ct){if($.default.validCoords(nt)||(nt=[$.default.wrap(nt[0]),$.default.wrap(nt[1])]),isNaN(nt[0])&&isNaN(nt[1]))return Ct(re(new Error("Coordinates are not valid")));Ct(He(nt)),Ct(ut(nt))}},h.setDestinationFromCoordinates=function Ln(nt){return function(Ct){if($.default.validCoords(nt)||(nt=[$.default.wrap(nt[0]),$.default.wrap(nt[1])]),isNaN(nt[0])&&isNaN(nt[1]))return Ct(re(new Error("Coordinates are not valid")));Ct(rt(nt)),Ct(it(nt))}},h.addWaypoint=function hn(nt,Ct){return function(Gt,pn){var bt=pn(),Rn=bt.destination,Hr=bt.waypoints;Hr.splice(nt,0,J(Ct)),Gt(ze(Hr)),Rn.geometry&&Gt(Ee())}},h.setWaypoint=function Bn(nt,Ct){return function(Gt,pn){var bt=pn(),Rn=bt.destination,Hr=bt.waypoints;Hr[nt]=J(Ct),Gt(ze(Hr)),Rn.geometry&&Gt(Ee())}},h.removeWaypoint=function sr(nt){return function(Ct,Gt){var pn=Gt(),bt=pn.destination,Rn=pn.waypoints;Ct(ze(Rn=Rn.filter(function(Hr){return!$.default.coordinateMatch(Hr,nt)}))),bt.geometry&&Ct(Ee())}},h.eventSubscribe=function Rt(nt,Ct){return function(Gt,pn){var Rn=pn().events;return Rn[nt]=Rn[nt]||[],Rn[nt].push(Ct),{type:Y.EVENTS,events:Rn}}},h.eventEmit=kn;var Y=function W(nt){if(nt&&nt.__esModule)return nt;var Ct={};if(null!=nt)for(var Gt in nt)Object.prototype.hasOwnProperty.call(nt,Gt)&&(Ct[Gt]=nt[Gt]);return Ct.default=nt,Ct}(we("../constants/action_types")),$=function K(nt){return nt&&nt.__esModule?nt:{default:nt}}(we("../utils"));var ge=new XMLHttpRequest;function ce(nt){return function(Ct){var Gt=$.default.createPoint(nt,{id:"origin","marker-symbol":"A"});Ct({type:Y.ORIGIN,origin:Gt}),Ct(kn("origin",{feature:Gt}))}}function ue(nt){return function(Ct){var Gt=$.default.createPoint(nt,{id:"destination","marker-symbol":"B"});Ct({type:Y.DESTINATION,destination:Gt}),Ct(kn("destination",{feature:Gt}))}}function Ce(nt){return function(Ct){Ct({type:Y.DIRECTIONS,directions:nt}),Ct(kn("route",{route:nt}))}}function ze(nt){return{type:Y.WAYPOINTS,waypoints:nt}}function Ee(){return function(nt,Ct){var Gt=Ct(),pn=Gt.api,bt=Gt.accessToken,Rn=Gt.routeIndex,Hr=Gt.profile,dr=Gt.alternatives,tr=Gt.congestion,xn=Gt.destination,ar=Gt.language,Un=Gt.exclude;if(xn&&xn.geometry){var ki=function Ae(nt){var Ct=nt(),pn=Ct.destination,bt=Ct.waypoints,Rn=[];return Rn.push(Ct.origin.geometry.coordinates.join(",")),Rn.push(";"),bt.length&&bt.forEach(function(Hr){Rn.push(Hr.geometry.coordinates.join(",")),Rn.push(";")}),Rn.push(pn.geometry.coordinates.join(",")),encodeURIComponent(Rn.join(""))}(Ct),Wr=[];Wr.push("geometries=polyline"),dr&&Wr.push("alternatives=true"),tr&&Wr.push("annotations=congestion"),Wr.push("steps=true"),Wr.push("overview=full"),ar&&Wr.push("language="+ar),Un&&Wr.push("exclude="+Un),bt&&Wr.push("access_token="+bt),ge.abort(),ge.open("GET",""+pn+Hr+"/"+ki+".json?"+Wr.join("&"),!0),ge.onload=function(){if(!(ge.status>=200&&ge.status<400))return nt(Ce([])),nt(re(JSON.parse(ge.responseText).message));var Vi=JSON.parse(ge.responseText);if(Vi.error)return nt(Ce([])),nt(re(Vi.error));nt(re(null)),Vi.routes[Rn]||nt(Lt(0)),nt(Ce(Vi.routes)),nt(ce(Vi.waypoints[0].location)),nt(ue(Vi.waypoints[Vi.waypoints.length-1].location))},ge.onerror=function(){return nt(Ce([])),nt(re(JSON.parse(ge.responseText).message))},ge.send()}}}function J(nt){var Ct={id:"waypoint"};return Object.assign(nt,{properties:nt.properties?Object.assign(nt.properties,Ct):Ct})}function re(nt){return function(Ct){Ct({type:"ERROR",error:nt}),nt&&Ct(kn("error",{error:nt}))}}function He(nt){return{type:Y.ORIGIN_FROM_COORDINATES,coordinates:nt}}function it(nt){return{type:Y.DESTINATION_FROM_COORDINATES,coordinates:nt}}function Lt(nt){return{type:Y.ROUTE_INDEX,routeIndex:nt}}function ut(nt){return function(Ct,Gt){var bt=Gt().destination;Ct(ce(nt)),bt.geometry&&Ct(Ee())}}function rt(nt){return function(Ct,Gt){var bt=Gt().origin;Ct(ue(nt)),bt.geometry&&Ct(Ee())}}function kn(nt,Ct){var Gt=this;return function(pn,bt){var Hr=bt().events;if(!Hr[nt])return{type:Y.EVENTS,events:Hr};for(var dr=Hr[nt].slice(),tr=0;tr<dr.length;tr++)dr[tr].call(Gt,Ct)}}},{"../constants/action_types":39,"../utils":47}],39:[function(we,de,h){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.DESTINATION="DESTINATION",h.DESTINATION_CLEAR="DESTINATION_CLEAR",h.DESTINATION_QUERY="DESTINATION_QUERY",h.DESTINATION_FROM_COORDINATES="DESTINATION_FROM_COORDINATES",h.DIRECTIONS="DIRECTIONS",h.DIRECTIONS_PROFILE="DIRECTIONS_PROFILE",h.EVENTS="EVENTS",h.ERROR="ERROR",h.HOVER_MARKER="HOVER_MARKER",h.ORIGIN="ORIGIN",h.ORIGIN_CLEAR="ORIGIN_CLEAR",h.ORIGIN_QUERY="ORIGIN_QUERY",h.ORIGIN_FROM_COORDINATES="ORIGIN_FROM_COORDINATES",h.ROUTE_INDEX="ROUTE_INDEX",h.SET_OPTIONS="SET_OPTIONS",h.WAYPOINTS="WAYPOINTS"},{}],40:[function(we,de,h){"use strict";Object.defineProperty(h,"__esModule",{value:!0});var U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(Ee){return typeof Ee}:function(Ee){return Ee&&"function"==typeof Symbol&&Ee.constructor===Symbol&&Ee!==Symbol.prototype?"symbol":typeof Ee},Y=function(){function Ee(Ae,J){for(var re=0;re<J.length;re++){var Ie=J[re];Ie.enumerable=Ie.enumerable||!1,Ie.configurable=!0,"value"in Ie&&(Ie.writable=!0),Object.defineProperty(Ae,Ie.key,Ie)}}return function(Ae,J,re){return J&&Ee(Ae.prototype,J),re&&Ee(Ae,re),Ae}}(),$=Ce(we("suggestions")),W=Ce(we("lodash.debounce")),ge=we("events"),ue=Ce(we("../utils"));function Ce(Ee){return Ee&&Ee.__esModule?Ee:{default:Ee}}var Q=function(){function Ee(Ae){(function ze(Ee,Ae){if(!(Ee instanceof Ae))throw new TypeError("Cannot call a class as a function")})(this,Ee),this._ev=new ge.EventEmitter,this.options=Ae,this.api=Ae&&Ae.api||"https://api.mapbox.com/geocoding/v5/mapbox.places/"}return Y(Ee,[{key:"onAdd",value:function(J){this._map=J,this.request=new XMLHttpRequest;var re=document.createElement("div");re.className="mapboxgl-ctrl-geocoder";var Ie=document.createElement("span");Ie.className="geocoder-icon geocoder-icon-search";var Be=this._inputEl=document.createElement("input");Be.type="text",Be.placeholder=this.options.placeholder,Be.addEventListener("keydown",(0,W.default)(function(kt){if(!kt.target.value)return this._clearEl.classList.remove("active");kt.metaKey||-1!==[9,27,37,39,13,38,40].indexOf(kt.keyCode)||this._queryFromInput(kt.target.value)}.bind(this)),200),Be.addEventListener("change",function(kt){kt.target.value&&this._clearEl.classList.add("active");var _t=this._typeahead.selected;if(_t){if(this.options.flyTo)if(_t.bbox&&_t.context&&_t.context.length<=3||_t.bbox&&!_t.context){var Et=_t.bbox;J.fitBounds([[Et[0],Et[1]],[Et[2],Et[3]]])}else J.flyTo({center:_t.center,zoom:this.options.zoom});this._input=_t,this.fire("result",{result:_t})}}.bind(this));var He=document.createElement("div");He.classList.add("geocoder-pin-right");var it=this._clearEl=document.createElement("button");it.className="geocoder-icon geocoder-icon-close",it.addEventListener("click",this._clear.bind(this));var gt=this._loadingEl=document.createElement("span");return gt.className="geocoder-icon geocoder-icon-loading",He.appendChild(it),He.appendChild(gt),re.appendChild(Ie),re.appendChild(Be),re.appendChild(He),this.options.container&&(this.options.position=!1),this._typeahead=new $.default(Be,[],{filter:!1}),this._typeahead.getItemValue=function(kt){return kt.place_name},re}},{key:"_geocode",value:function(J,re){this._loadingEl.classList.add("active"),this.fire("loading");var Ie=this.options,Be=["placeholder","zoom","flyTo","accessToken"],He=Object.keys(this.options).filter(function(gt){return-1===Be.indexOf(gt)}).map(function(gt){return gt+"="+Ie[gt]}),it=this.options.accessToken?this.options.accessToken:mapboxgl.accessToken;He.push("access_token="+it),this.request.abort(),this.request.open("GET",this.api+encodeURIComponent(J.trim())+".json?"+He.join("&"),!0),this.request.onload=function(){if(this._loadingEl.classList.remove("active"),this.request.status>=200&&this.request.status<400){var gt=JSON.parse(this.request.responseText);return gt.features.length?this._clearEl.classList.add("active"):(this._clearEl.classList.remove("active"),this._typeahead.selected=null),this.fire("results",{results:gt.features}),this._typeahead.update(gt.features),re(gt.features)}this.fire("error",{error:JSON.parse(this.request.responseText).message})}.bind(this),this.request.onerror=function(){this._loadingEl.classList.remove("active"),this.fire("error",{error:JSON.parse(this.request.responseText).message})}.bind(this),this.request.send()}},{key:"_queryFromInput",value:function(J){(J=J.trim())||this._clear(),J.length>2&&this._geocode(J,function(re){this._results=re}.bind(this))}},{key:"_change",value:function(){var J=document.createEvent("HTMLEvents");J.initEvent("change",!0,!1),this._inputEl.dispatchEvent(J)}},{key:"_query",value:function(J){!J||("object"===(void 0===J?"undefined":U(J))&&J.length&&(J=[ue.default.wrap(J[0]),ue.default.wrap(J[1])].join()),this._geocode(J,function(re){if(re.length){var Ie=re[0];this._results=re,this._typeahead.selected=Ie,this._inputEl.value=Ie.place_name,this._change()}}.bind(this)))}},{key:"_setInput",value:function(J){!J||("object"===(void 0===J?"undefined":U(J))&&J.length&&(J=[ue.default.roundWithOriginalPrecision(ue.default.wrap(J[0]),J[0]),ue.default.roundWithOriginalPrecision(ue.default.wrap(J[1]),J[1])].join()),this._inputEl.value=J,this._input=null,this._typeahead.selected=null,this._typeahead.clear(),this._change())}},{key:"_clear",value:function(){this._input=null,this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._change(),this._inputEl.focus(),this._clearEl.classList.remove("active"),this.fire("clear")}},{key:"getResult",value:function(){return this._input}},{key:"query",value:function(J){return this._query(J),this}},{key:"setInput",value:function(J){return this._setInput(J),this}},{key:"on",value:function(J,re){return this._ev.on(J,re),this._ev.on("error",function(Ie){console.log(Ie)}),this}},{key:"fire",value:function(J,re){return this._ev.emit(J,re),this}},{key:"off",value:function(J,re){return this._ev.removeListener(J,re),this}}]),Ee}();h.default=Q},{"../utils":47,events:3,"lodash.debounce":7,suggestions:30}],41:[function(we,de,h){"use strict";Object.defineProperty(h,"__esModule",{value:!0});var U=function(){function Ae(J,re){for(var Ie=0;Ie<re.length;Ie++){var Be=re[Ie];Be.enumerable=Be.enumerable||!1,Be.configurable=!0,"value"in Be&&(Be.writable=!0),Object.defineProperty(J,Be.key,Be)}}return function(J,re,Ie){return re&&Ae(J.prototype,re),Ie&&Ae(J,Ie),J}}(),ie=Ce(we("./geocoder")),K=Ce(we("lodash.template")),ge=Ce(we("lodash.isequal")),ue=Ce(we("turf-extent"));function Ce(Ae){return Ae&&Ae.__esModule?Ae:{default:Ae}}var Q=(0,K.default)("<div class='mapbox-directions-component mapbox-directions-inputs'>\n  <div class='mapbox-directions-component-keyline'>\n    <div class='mapbox-directions-origin'>\n      <label class='mapbox-form-label'>\n        <span class='directions-icon directions-icon-depart'></span>\n      </label>\n      <div id='mapbox-directions-origin-input'></div>\n    </div>\n\n    <button\n      class='directions-icon directions-icon-reverse directions-reverse js-reverse-inputs'\n      title='Reverse origin &amp; destination'>\n    </button>\n\n    <div class='mapbox-directions-destination'>\n      <label class='mapbox-form-label'>\n        <span class='directions-icon directions-icon-arrive'></span>\n      </label>\n      <div id='mapbox-directions-destination-input'></div>\n    </div>\n  </div>\n\n  <% if (controls.profileSwitcher) { %>\n  <div class='mapbox-directions-profile mapbox-directions-component-keyline mapbox-directions-clearfix'><input\n      id='mapbox-directions-profile-driving-traffic'\n      type='radio'\n      name='profile'\n      value='mapbox/driving-traffic'\n      <% if (profile === 'mapbox/driving-traffic') { %>checked<% } %>\n    />\n    <label for='mapbox-directions-profile-driving-traffic'>Traffic</label>\n    <input\n      id='mapbox-directions-profile-driving'\n      type='radio'\n      name='profile'\n      value='mapbox/driving'\n      <% if (profile === 'mapbox/driving') { %>checked<% } %>\n    />\n    <label for='mapbox-directions-profile-driving'>Driving</label>\n    <input\n      id='mapbox-directions-profile-walking'\n      type='radio'\n      name='profile'\n      value='mapbox/walking'\n      <% if (profile === 'mapbox/walking') { %>checked<% } %>\n    />\n    <label for='mapbox-directions-profile-walking'>Walking</label>\n    <input\n      id='mapbox-directions-profile-cycling'\n      type='radio'\n      name='profile'\n      value='mapbox/cycling'\n      <% if (profile === 'mapbox/cycling') { %>checked<% } %>\n    />\n    <label for='mapbox-directions-profile-cycling'>Cycling</label>\n  </div>\n  <% } %>\n</div>\n"),Ee=function(){function Ae(J,re,Ie,Be){!function ze(Ae,J){if(!(Ae instanceof J))throw new TypeError("Cannot call a class as a function")}(this,Ae);var He=re.getState();J.innerHTML=Q({originQuery:He.originQuery,destinationQuery:He.destinationQuery,profile:He.profile,controls:He.controls}),this.container=J,this.actions=Ie,this.store=re,this._map=Be,this.onAdd(),this.render()}return U(Ae,[{key:"animateToCoordinates",value:function(re,Ie){var Be=this.store.getState(),He=Be.origin,it=Be.destination,gt=Be.routePadding;if(He.geometry&&it.geometry&&!(0,ge.default)(He.geometry,it.geometry)){var kt=(0,ue.default)({type:"FeatureCollection",features:[He,it]});this._map.fitBounds([[kt[0],kt[1]],[kt[2],kt[3]]],{padding:gt})}else this._map.flyTo({center:Ie})}},{key:"onAdd",value:function(){var re=this,Ie=this.actions,Be=Ie.clearOrigin,He=Ie.clearDestination,it=Ie.createOrigin,gt=Ie.createDestination,kt=Ie.setProfile,_t=Ie.reverse,Et=this.store.getState(),Lt=Et.geocoder,ut=Et.accessToken,rt=Et.flyTo,Cn=Et.placeholderDestination,an=Et.zoom;this.originInput=new ie.default(Object.assign({},{accessToken:ut},Lt,{flyTo:rt,placeholder:Et.placeholderOrigin,zoom:an}));var Ln=this.originInput.onAdd(this._map);this.container.querySelector("#mapbox-directions-origin-input").appendChild(Ln),this.destinationInput=new ie.default(Object.assign({},{accessToken:ut},Lt,{flyTo:rt,placeholder:Cn,zoom:an}));var Bn=this.destinationInput.onAdd(this._map);this.container.querySelector("#mapbox-directions-destination-input").appendChild(Bn),this.originInput.on("result",function(Rt){var kn=Rt.result.center;it(kn),re.animateToCoordinates("origin",kn)}),this.originInput.on("clear",Be),this.destinationInput.on("result",function(Rt){var kn=Rt.result.center;gt(kn),re.animateToCoordinates("destination",kn)}),this.destinationInput.on("clear",He);var sr=this.container.querySelectorAll('input[type="radio"]');Array.prototype.forEach.call(sr,function(Rt){Rt.addEventListener("change",function(){kt(Rt.value)})}),this.container.querySelector(".js-reverse-inputs").addEventListener("click",function(){var Rt=re.store.getState(),kn=Rt.origin,nt=Rt.destination;kn&&re.actions.queryDestination(kn.geometry.coordinates),nt&&re.actions.queryOrigin(nt.geometry.coordinates),_t()})}},{key:"render",value:function(){var re=this;this.store.subscribe(function(){var Ie=re.store.getState(),Be=Ie.originQuery,He=Ie.destinationQuery,it=Ie.originQueryCoordinates,gt=Ie.destinationQueryCoordinates;Be&&(re.originInput.query(Be),re.actions.queryOrigin(null)),He&&(re.destinationInput.query(He),re.actions.queryDestination(null)),it&&(re.originInput.setInput(it),re.animateToCoordinates("origin",it),re.actions.queryOriginCoordinates(null)),gt&&(re.destinationInput.setInput(gt),re.animateToCoordinates("destination",gt),re.actions.queryDestinationCoordinates(null))})}}]),Ae}();h.default=Ee},{"./geocoder":40,"lodash.isequal":8,"lodash.template":9,"turf-extent":35}],42:[function(we,de,h){"use strict";Object.defineProperty(h,"__esModule",{value:!0});var U=function(){function Ee(Ae,J){for(var re=0;re<J.length;re++){var Ie=J[re];Ie.enumerable=Ie.enumerable||!1,Ie.configurable=!0,"value"in Ie&&(Ie.writable=!0),Object.defineProperty(Ae,Ie.key,Ie)}}return function(Ae,J,re){return J&&Ee(Ae.prototype,J),re&&Ee(Ae,re),Ae}}(),ie=ce(we("../utils")),K=ce(we("lodash.template")),ge=ce(we("lodash.isequal"));function ce(Ee){return Ee&&Ee.__esModule?Ee:{default:Ee}}var Ce=(0,K.default)("<div class='directions-control directions-control-directions'>\n  <div class='mapbox-directions-component mapbox-directions-route-summary<% if (routes > 1) { %> mapbox-directions-multiple<% } %>'>\n    <% if (routes > 1) { %>\n    <div class='mapbox-directions-routes mapbox-directions-clearfix'>\n      <% for (var i = 0; i < routes; i++) { %>\n        <input type='radio' name='routes' id='<%= i %>' <% if (i === routeIndex) { %>checked<% } %>>\n        <label for='<%= i %>' class='mapbox-directions-route'><%= i + 1 %></label>\n      <% } %>\n    </div>\n    <% } %>\n    <h1><%- duration %></h1>\n    <span><%- distance %></span>\n  </div>\n\n  <div class='mapbox-directions-instructions'>\n    <div class='mapbox-directions-instructions-wrapper'>\n      <ol class='mapbox-directions-steps'>\n        <% steps.forEach(function(step) { %>\n          <%\n            var distance = step.distance ? format(step.distance) : false;\n            var icon = step.maneuver.modifier ? step.maneuver.modifier.replace(/\\s+/g, '-').toLowerCase() : step.maneuver.type.replace(/\\s+/g, '-').toLowerCase();\n\n            if (step.maneuver.type === 'arrive' || step.maneuver.type === 'depart') {\n              icon = step.maneuver.type;\n            }\n\n            if (step.maneuver.type === 'roundabout' || step.maneuver.type === 'rotary') {\n              icon= 'roundabout';\n            }\n\n            var lng = step.maneuver.location[0];\n            var lat = step.maneuver.location[1];\n          %>\n          <li\n            data-lat='<%= lat %>'\n            data-lng='<%= lng %>'\n            class='mapbox-directions-step'>\n            <span class='directions-icon directions-icon-<%= icon %>'></span>\n            <div class='mapbox-directions-step-maneuver'>\n              <%= step.maneuver.instruction %>\n            </div>\n            <% if (distance) { %>\n              <div class='mapbox-directions-step-distance'>\n                <%= distance %>\n              </div>\n            <% } %>\n          </li>\n        <% }); %>\n      </ol>\n    </div>\n  </div>\n</div>\n"),ze=(0,K.default)("<div class='directions-control directions-control-directions'>\n  <div class='mapbox-directions-error'>\n    <%= error %>\n  </div>\n</div>\n"),Q=function(){function Ee(Ae,J,re,Ie){(function ue(Ee,Ae){if(!(Ee instanceof Ae))throw new TypeError("Cannot call a class as a function")})(this,Ee),this.container=Ae,this.actions=re,this.store=J,this._map=Ie,this.directions={},this.render()}return U(Ee,[{key:"render",value:function(){var J=this;this.store.subscribe(function(){var re=J.actions,Ie=re.hoverMarker,Be=re.setRouteIndex,He=J.store.getState(),it=He.routeIndex,gt=He.unit,kt=He.directions,_t=He.error,Et=He.compile,Lt=!(0,ge.default)(kt[it],J.directions);if(_t)J.container.innerHTML=ze({error:_t});else if(kt.length&&Lt){var ut=J.directions=kt[it];Et&&ut.legs.forEach(function(Cn){Cn.steps.forEach(function(an){an.maneuver.instruction=Et("en",an)})}),J.container.innerHTML=Ce({routeIndex:it,routes:kt.length,steps:ut.legs[0].steps,format:ie.default.format[gt],duration:ie.default.format[gt](ut.distance),distance:ie.default.format.duration(ut.duration)});var rt=J.container.querySelectorAll(".mapbox-directions-step");Array.prototype.forEach.call(rt,function(Cn){var an=Cn.getAttribute("data-lng"),Ln=Cn.getAttribute("data-lat");Cn.addEventListener("mouseover",function(){Ie([an,Ln])}),Cn.addEventListener("mouseout",function(){Ie(null)}),Cn.addEventListener("click",function(){J._map.flyTo({center:[an,Ln],zoom:16})})});var un=J.container.querySelectorAll('input[type="radio"]');Array.prototype.forEach.call(un,function(Cn){Cn.addEventListener("change",function(an){Be(parseInt(an.target.id,10))})})}else J.container.innerHTML&&Lt&&(J.container.innerHTML="")})}}]),Ee}();h.default=Q},{"../utils":47,"lodash.isequal":8,"lodash.template":9}],43:[function(we,de,h){"use strict";Object.defineProperty(h,"__esModule",{value:!0});var U=function(){function Et(Lt,ut){for(var rt=0;rt<ut.length;rt++){var un=ut[rt];un.enumerable=un.enumerable||!1,un.configurable=!0,"value"in un&&(un.writable=!0),Object.defineProperty(Lt,un.key,un)}}return function(Lt,ut,rt){return ut&&Et(Lt.prototype,ut),rt&&Et(Lt,rt),Lt}}(),Y=we("redux"),$=He(we("redux-thunk")),K=we("@mapbox/polyline"),ge=He(we("./utils")),ue=He(we("./reducers")),ze=function Be(Et){if(Et&&Et.__esModule)return Et;var Lt={};if(null!=Et)for(var ut in Et)Object.prototype.hasOwnProperty.call(Et,ut)&&(Lt[ut]=Et[ut]);return Lt.default=Et,Lt}(we("./actions")),Ee=He(we("./directions_style")),J=He(we("./controls/inputs")),Ie=He(we("./controls/instructions"));function He(Et){return Et&&Et.__esModule?Et:{default:Et}}var kt=(0,Y.applyMiddleware)($.default)(Y.createStore)(ue.default),_t=function(){function Et(Lt){(function it(Et,Lt){if(!(Et instanceof Lt))throw new TypeError("Cannot call a class as a function")})(this,Et),this.actions=(0,Y.bindActionCreators)(ze,kt.dispatch),this.actions.setOptions(Lt||{}),this.options=Lt||{},this.onDragDown=this._onDragDown.bind(this),this.onDragMove=this._onDragMove.bind(this),this.onDragUp=this._onDragUp.bind(this),this.move=this._move.bind(this),this.onClick=this._clickHandler().bind(this)}return U(Et,[{key:"onAdd",value:function(ut){var rt=this;this._map=ut;var Cn=kt.getState().controls,an=this.container=document.createElement("div");an.className="mapboxgl-ctrl-directions mapboxgl-ctrl";var Ln=document.createElement("div");Ln.className="directions-control directions-control-inputs",new J.default(Ln,kt,this.actions,this._map);var hn=document.createElement("div");return hn.className="directions-control directions-control-instructions",new Ie.default(hn,kt,{hoverMarker:this.actions.hoverMarker,setRouteIndex:this.actions.setRouteIndex},this._map),Cn.inputs&&an.appendChild(Ln),Cn.instructions&&an.appendChild(hn),this.subscribedActions(),this._map.loaded()?this.mapState():this._map.on("load",function(){return rt.mapState()}),an}},{key:"onRemove",value:function(ut){return this.container.parentNode.removeChild(this.container),this.removeRoutes(),ut.off("mousedown",this.onDragDown),ut.off("mousemove",this.move),ut.off("touchstart",this.onDragDown),ut.off("touchstart",this.move),ut.off("click",this.onClick),this.storeUnsubscribe&&(this.storeUnsubscribe(),delete this.storeUnsubscribe),Ee.default.forEach(function(rt){ut.getLayer(rt.id)&&ut.removeLayer(rt.id)}),ut.getSource("directions")&&ut.removeSource("directions"),this._map=null,this}},{key:"mapState",value:function(){var ut=this,rt=kt.getState(),Ln=rt.styles,hn=rt.interactive;this.actions.eventEmit("profile",{profile:rt.profile}),this._map.addSource("directions",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),Ln&&Ln.length&&Ln.forEach(function(Rt){return ut._map.addLayer(Rt)}),Ee.default.forEach(function(Rt){ut._map.getLayer(Rt.id)||ut._map.addLayer(Rt)}),hn&&(this._map.on("mousedown",this.onDragDown),this._map.on("mousemove",this.move),this._map.on("click",this.onClick),this._map.on("touchstart",this.move),this._map.on("touchstart",this.onDragDown))}},{key:"subscribedActions",value:function(){var ut=this;this.storeUnsubscribe=kt.subscribe(function(){var rt=kt.getState(),Ln=rt.directions,hn=rt.routeIndex,Bn={type:"FeatureCollection",features:[rt.origin,rt.destination,rt.hoverMarker].filter(function(sr){return sr.geometry})};Ln.length&&Ln.forEach(function(sr,Rt){var kn=[];(0,K.decode)(sr.geometry,5).map(function(Ct){return Ct.reverse()}).forEach(function(Ct,Gt){var pn=kn[kn.length-1],bt=sr.legs[0].annotation&&sr.legs[0].annotation.congestion&&sr.legs[0].annotation.congestion[Gt-1];if(!pn||bt&&pn.properties.congestion!==bt){var Rn={geometry:{type:"LineString",coordinates:[]},properties:{"route-index":Rt,route:Rt===hn?"selected":"alternate"}};pn&&Rn.geometry.coordinates.push(pn.geometry.coordinates[pn.geometry.coordinates.length-1]),Rn.geometry.coordinates.push(Ct),bt&&(Rn.properties.congestion=sr.legs[0].annotation.congestion[Gt-1]),kn.push(Rn)}else pn.geometry.coordinates.push(Ct)}),Bn.features=Bn.features.concat(kn),Rt===hn&&sr.legs[0].steps.forEach(function(Ct){"waypoint"===Ct.maneuver.type&&Bn.features.push({type:"Feature",geometry:Ct.maneuver.location,properties:{id:"waypoint"}})})}),ut._map.style&&ut._map.getSource("directions")&&ut._map.getSource("directions").setData(Bn)})}},{key:"_clickHandler",value:function(){var ut=null;return function(un){if(ut)clearTimeout(ut),ut=null,this._map.zoomIn();else{var Cn=this._onSingleClick.bind(this);ut=setTimeout(function(){Cn(un),ut=null},250)}}}},{key:"_onSingleClick",value:function(ut){var rt=this,un=kt.getState(),an=[ut.lngLat.lng,ut.lngLat.lat];if(un.origin.geometry){var Ln=this._map.queryRenderedFeatures(ut.point,{layers:["directions-origin-point","directions-destination-point","directions-waypoint-point","directions-route-line-alt"]});Ln.length?(Ln.forEach(function(Bn){"directions-waypoint-point"===Bn.layer.id&&rt.actions.removeWaypoint(Bn)}),"alternate"===Ln[0].properties.route&&this.actions.setRouteIndex(Ln[0].properties["route-index"])):(this.actions.setDestinationFromCoordinates(an),this._map.flyTo({center:an}))}else this.actions.setOriginFromCoordinates(an)}},{key:"_move",value:function(ut){var rt=this,Cn=kt.getState().hoverMarker,an=this._map.queryRenderedFeatures(ut.point,{layers:["directions-route-line-alt","directions-route-line","directions-origin-point","directions-destination-point","directions-hover-point"]});this._map.getCanvas().style.cursor=an.length?"pointer":"",an.length?(this.isCursorOverPoint=an[0],this._map.dragPan.disable(),an.forEach(function(Ln){"directions-route-line"===Ln.layer.id?rt.actions.hoverMarker([ut.lngLat.lng,ut.lngLat.lat]):Cn.geometry&&rt.actions.hoverMarker(null)})):this.isCursorOverPoint&&(this.isCursorOverPoint=!1,this._map.dragPan.enable())}},{key:"_onDragDown",value:function(){!this.isCursorOverPoint||(this.isDragging=this.isCursorOverPoint,this._map.getCanvas().style.cursor="grab",this._map.on("mousemove",this.onDragMove),this._map.on("mouseup",this.onDragUp),this._map.on("touchmove",this.onDragMove),this._map.on("touchend",this.onDragUp))}},{key:"_onDragMove",value:function(ut){if(this.isDragging){var rt=[ut.lngLat.lng,ut.lngLat.lat];switch(this.isDragging.layer.id){case"directions-origin-point":this.actions.createOrigin(rt);break;case"directions-destination-point":this.actions.createDestination(rt);break;case"directions-hover-point":this.actions.hoverMarker(rt)}}}},{key:"_onDragUp",value:function(){if(this.isDragging){var ut=kt.getState(),rt=ut.hoverMarker,un=ut.origin,Cn=ut.destination;switch(this.isDragging.layer.id){case"directions-origin-point":this.actions.setOriginFromCoordinates(un.geometry.coordinates);break;case"directions-destination-point":this.actions.setDestinationFromCoordinates(Cn.geometry.coordinates);break;case"directions-hover-point":rt.geometry&&!ge.default.coordinateMatch(this.isDragging,rt)&&this.actions.addWaypoint(0,rt)}this.isDragging=!1,this._map.getCanvas().style.cursor="",this._map.off("touchmove",this.onDragMove),this._map.off("touchend",this.onDragUp),this._map.off("mousemove",this.onDragMove),this._map.off("mouseup",this.onDragUp)}}},{key:"interactive",value:function(ut){return ut?(this._map.on("touchstart",this.move),this._map.on("touchstart",this.onDragDown),this._map.on("mousedown",this.onDragDown),this._map.on("mousemove",this.move),this._map.on("click",this.onClick)):(this._map.off("touchstart",this.move),this._map.off("touchstart",this.onDragDown),this._map.off("mousedown",this.onDragDown),this._map.off("mousemove",this.move),this._map.off("click",this.onClick)),this}},{key:"getOrigin",value:function(){return kt.getState().origin}},{key:"setOrigin",value:function(ut){return"string"==typeof ut?this.actions.queryOrigin(ut):this.actions.setOriginFromCoordinates(ut),this}},{key:"getDestination",value:function(){return kt.getState().destination}},{key:"setDestination",value:function(ut){return"string"==typeof ut?this.actions.queryDestination(ut):this.actions.setDestinationFromCoordinates(ut),this}},{key:"reverse",value:function(){return this.actions.reverse(),this}},{key:"addWaypoint",value:function(ut,rt){return rt.type||(rt=ge.default.createPoint(rt,{id:"waypoint"})),this.actions.addWaypoint(ut,rt),this}},{key:"setWaypoint",value:function(ut,rt){return rt.type||(rt=ge.default.createPoint(rt,{id:"waypoint"})),this.actions.setWaypoint(ut,rt),this}},{key:"removeWaypoint",value:function(ut){var rt=kt.getState();return this.actions.removeWaypoint(rt.waypoints[ut]),this}},{key:"getWaypoints",value:function(){return kt.getState().waypoints}},{key:"removeRoutes",value:function(){return this.actions.clearOrigin(),this.actions.clearDestination(),this}},{key:"on",value:function(ut,rt){return this.actions.eventSubscribe(ut,rt),this}}]),Et}();h.default=_t},{"./actions":38,"./controls/inputs":41,"./controls/instructions":42,"./directions_style":44,"./reducers":46,"./utils":47,"@mapbox/polyline":1,redux:28,"redux-thunk":22}],44:[function(we,de,h){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.default=[{id:"directions-route-line-alt",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#bbb","line-width":4},filter:["all",["in","$type","LineString"],["in","route","alternate"]]},{id:"directions-route-line-casing",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#2d5f99","line-width":12},filter:["all",["in","$type","LineString"],["in","route","selected"]]},{id:"directions-route-line",type:"line",source:"directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":{property:"congestion",type:"categorical",default:"#4882c5",stops:[["unknown","#4882c5"],["low","#4882c5"],["moderate","#f09a46"],["heavy","#e34341"],["severe","#8b2342"]]},"line-width":7},filter:["all",["in","$type","LineString"],["in","route","selected"]]},{id:"directions-hover-point-casing",type:"circle",source:"directions",paint:{"circle-radius":8,"circle-color":"#fff"},filter:["all",["in","$type","Point"],["in","id","hover"]]},{id:"directions-hover-point",type:"circle",source:"directions",paint:{"circle-radius":6,"circle-color":"#3bb2d0"},filter:["all",["in","$type","Point"],["in","id","hover"]]},{id:"directions-waypoint-point-casing",type:"circle",source:"directions",paint:{"circle-radius":8,"circle-color":"#fff"},filter:["all",["in","$type","Point"],["in","id","waypoint"]]},{id:"directions-waypoint-point",type:"circle",source:"directions",paint:{"circle-radius":6,"circle-color":"#8a8bc9"},filter:["all",["in","$type","Point"],["in","id","waypoint"]]},{id:"directions-origin-point",type:"circle",source:"directions",paint:{"circle-radius":18,"circle-color":"#3bb2d0"},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-origin-label",type:"symbol",source:"directions",layout:{"text-field":"A","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#fff"},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-destination-point",type:"circle",source:"directions",paint:{"circle-radius":18,"circle-color":"#8a8bc9"},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]},{id:"directions-destination-label",type:"symbol",source:"directions",layout:{"text-field":"B","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#fff"},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]}]},{}],45:[function(we,de,h){"use strict";var Y=function ie($){return $&&$.__esModule?$:{default:$}}(we("./directions"));de.exports=Y.default},{"./directions":43}],46:[function(we,de,h){"use strict";Object.defineProperty(h,"__esModule",{value:!0});var Y=function W(ue){if(ue&&ue.__esModule)return ue;var Ce={};if(null!=ue)for(var ze in ue)Object.prototype.hasOwnProperty.call(ue,ze)&&(Ce[ze]=ue[ze]);return Ce.default=ue,Ce}(we("../constants/action_types.js")),$=function K(ue){return ue&&ue.__esModule?ue:{default:ue}}(we("deep-assign"));var ge={api:"https://api.mapbox.com/directions/v5/",profile:"mapbox/driving-traffic",alternatives:!1,congestion:!1,unit:"imperial",flyTo:!0,placeholderOrigin:"Choose a starting place",placeholderDestination:"Choose destination",zoom:16,language:"en",compile:null,proximity:!1,styles:[],controls:{profileSwitcher:!0,inputs:!0,instructions:!0},geocoder:{},interactive:!0,events:{},origin:{},destination:{},hoverMarker:{},waypoints:[],originQuery:null,destinationQuery:null,originQueryCoordinates:null,destinationQueryCoordinates:null,directions:[],routeIndex:0,routePadding:80};h.default=function ce(){var ue=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ge,Ce=arguments[1];switch(Ce.type){case Y.SET_OPTIONS:return(0,$.default)({},ue,Ce.options);case Y.DIRECTIONS_PROFILE:return Object.assign({},ue,{profile:Ce.profile});case Y.ORIGIN:return Object.assign({},ue,{origin:Ce.origin,hoverMarker:{}});case Y.DESTINATION:return Object.assign({},ue,{destination:Ce.destination,hoverMarker:{}});case Y.HOVER_MARKER:return Object.assign({},ue,{hoverMarker:Ce.hoverMarker});case Y.WAYPOINTS:return Object.assign({},ue,{waypoints:Ce.waypoints});case Y.ORIGIN_QUERY:return Object.assign({},ue,{originQuery:Ce.query});case Y.DESTINATION_QUERY:return Object.assign({},ue,{destinationQuery:Ce.query});case Y.ORIGIN_FROM_COORDINATES:return Object.assign({},ue,{originQueryCoordinates:Ce.coordinates});case Y.DESTINATION_FROM_COORDINATES:return Object.assign({},ue,{destinationQueryCoordinates:Ce.coordinates});case Y.ORIGIN_CLEAR:return Object.assign({},ue,{origin:{},originQuery:"",waypoints:[],directions:[]});case Y.DESTINATION_CLEAR:return Object.assign({},ue,{destination:{},destinationQuery:"",waypoints:[],directions:[]});case Y.DIRECTIONS:return Object.assign({},ue,{directions:Ce.directions});case Y.ROUTE_INDEX:return Object.assign({},ue,{routeIndex:Ce.routeIndex});case Y.ERROR:return Object.assign({},ue,{error:Ce.error});default:return ue}}},{"../constants/action_types.js":39,"deep-assign":2}],47:[function(we,de,h){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.default={format:{duration:function(ce){var ue=Math.floor(ce/60),Ce=Math.floor(ue/60);return ce%=60,ue%=60,0===Ce&&0===ue?ce+"s":0===Ce?ue+"min":Ce+"h "+ue+"min"},imperial:function(ce){var ue=ce/1609.344;return ue>=100?ue.toFixed(0)+"mi":ue>=10?ue.toFixed(1)+"mi":ue>=.1?ue.toFixed(2)+"mi":(5280*ue).toFixed(0)+"ft"},metric:function(ce){return ce>=1e5?(ce/1e3).toFixed(0)+"km":ce>=1e4?(ce/1e3).toFixed(1)+"km":ce>=100?(ce/1e3).toFixed(2)+"km":ce.toFixed(0)+"m"}},coordinateMatch:function Y(ge,ce){return ce=ce.geometry.coordinates,(ge=ge.geometry.coordinates).join()===ce.join()||ge[0].toFixed(3)===ce[0].toFixed(3)&&ge[1].toFixed(3)===ce[1].toFixed(3)},createPoint:function K(ge,ce){return{type:"Feature",geometry:{type:"Point",coordinates:ge},properties:ce||{}}},validCoords:function U(ge){return ge[0]>=-180&&ge[0]<=180&&ge[1]>=-90&&ge[1]<=90},wrap:function ie(ge){var ue=((ge- -180)%360+360)%360-180;return-180===ue?180:ue},roundWithOriginalPrecision:function $(ge,ce){var ue=0;return Math.floor(ce)!==ce&&(ue=ce.toString().split(".")[1].length),ge.toFixed(Math.min(ue,5))}}},{}]},{},[45])(45)},564:(Bt,Vt,Xe)=>{"use strict";var lt=Xe(652).x0;function we(de){this.origin=de.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=de.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=de,this.send=this.send.bind(this),this.countries=de.countries?de.countries.split(","):null,this.types=de.types?de.types.split(","):null,this.bbox=de.bbox?de.bbox:null,this.language=de.language?de.language.split(","):null,this.limit=de.limit?+de.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(de),this.eventQueue=new Array,this.flushInterval=de.flushInterval||1e3,this.maxQueueSize=de.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}we.prototype={select:function(de,h){var U=this.getSelectedIndex(de,h),Y=this.getEventPayload("search.select",h);if(Y.resultIndex=U,Y.resultPlaceName=de.place_name,Y.resultId=de.id,(U!==this.lastSentIndex||Y.queryString!==this.lastSentInput)&&-1!=U&&(this.lastSentIndex=U,this.lastSentInput=Y.queryString,Y.queryString))return this.push(Y)},start:function(de){var h=this.getEventPayload("search.start",de);if(h.queryString)return this.push(h)},keyevent:function(de,h){if(de.key&&!de.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(de.keyCode)){var U=this.getEventPayload("search.keystroke",h);if(U.lastAction=de.key,U.queryString)return this.push(U)}},send:function(de,h){if(!this.enableEventLogging)return h?h():void 0;var U=this.getRequestOptions(de);this.request(U,function(Y){return Y?this.handleError(Y,h):h?h():void 0}.bind(this))},getRequestOptions:function(de){return Array.isArray(de)||(de=[de]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(de)}},getEventPayload:function(de,h){var U;U=h.options.proximity?"object"==typeof h.options.proximity?[h.options.proximity.longitude,h.options.proximity.latitude]:"ip"===h.options.proximity?[999,999]:h.options.proximity:null;var Y=h._map?h._map.getZoom():void 0,ie={event:de,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:h.options.autocomplete,fuzzyMatch:h.options.fuzzyMatch,proximity:U,limit:h.options.limit,routing:h.options.routing,worldview:h.options.worldview,mapZoom:Y,keyboardLocale:this.locale};return ie.queryString="search.select"===de?h.inputString:"search.select"!=de&&h._inputEl?h._inputEl.value:h.inputString,ie},request:function(de,h){var U=new XMLHttpRequest;for(var Y in U.onreadystatechange=function(){if(4==this.readyState)return h(204==this.status?null:this.statusText)},U.open(de.method,de.host+"/"+de.path,!0),de.headers)U.setRequestHeader(Y,de.headers[Y]);U.send(de.body)},handleError:function(de,h){if(h)return h(de)},generateSessionID:function(){return lt()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(de,h){if(h._typeahead){var Y=de.id;return h._typeahead.data.map(function(K){return K.id}).indexOf(Y)}},shouldEnableLogging:function(de){return!(!1===de.enableEventLogging||de.origin&&-1==de.origin.indexOf("api.mapbox.com")||de.localGeocoder||de.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(de,h){this.eventQueue.push(de),(this.eventQueue.length>=this.maxQueueSize||h)&&this.flush()},remove:function(){this.flush()}},Bt.exports=we},424:Bt=>{Bt.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}},569:Bt=>{function Vt(){}Vt.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){const Xe={enableHighAccuracy:!0};return new Promise(function(lt,we){window.navigator.geolocation.getCurrentPosition(lt,we,Xe)})}},Bt.exports=Vt},545:(Bt,Vt,Xe)=>{"use strict";var lt=Xe(11),we=Xe(82),de=Xe(703),h=Xe(69).EventEmitter,U=Xe(424),Y=Xe(471),ie=Xe(75),$=Xe(564),K=Xe(234),W=Xe(775),ge=Xe(569),ce=Xe(777);function ze(Q){this._eventEmitter=new h,this.options=de({},this.options,Q),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new ge}ze.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(Q){return Q.place_name},render:function(Q){var Ee=Q.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+Ee[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+Ee.splice(1,Ee.length).join(",")+"</div></div>"}},addTo:function(Q){function Ee(Ae,J){if(!document.body.contains(J))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const re=Ae.onAdd();J.appendChild(re)}if(Q._controlContainer)Q.addControl(this);else if(Q instanceof HTMLElement)Ee(this,Q);else{if("string"!=typeof Q)throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element");{const Ae=document.querySelectorAll(Q);if(0===Ae.length)throw new Error("Element ",Q,"not found.");if(Ae.length>1)throw new Error("Geocoder can only be added to a single html element");Ee(this,Ae[0])}}},onAdd:function(Q){if(Q&&"string"!=typeof Q&&(this._map=Q),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=ie(Y({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new $(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var Ee=this.container=document.createElement("div");Ee.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var Ae=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",we(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(gt){this.eventManager.keyevent(gt,this)}.bind(this));var J=document.createElement("div");J.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var re=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(re),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),J.appendChild(this._clearEl),J.appendChild(this._loadingEl),Ee.appendChild(Ae),Ee.appendChild(this._inputEl),Ee.appendChild(J),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var Ie=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(Ie),J.appendChild(this._geolocateEl),this._showGeolocateButton()}var Be=this._typeahead=new lt(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),Be.getItemValue=this.options.getItemValue;var He=Be.list.draw,it=this._footerNode=function Ce(){var Q=document.createElement("div");return Q.className="mapboxgl-ctrl-geocoder--powered-by",Q.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',Q}();return Be.list.draw=function(){He.call(this),it.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),it.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(it)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),Ee},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(Q){this._hideLoadingIcon();const Ee={geometry:{type:"Point",coordinates:[Q.coords.longitude,Q.coords.latitude]}};this._handleMarker(Ee),this._fly(Ee),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(Ee),this._showClearButton(),this.fresh=!1;const Ae={limit:1,language:[this.options.language],query:Ee.geometry.coordinates,types:["address"]};this.options.localGeocoderOnly?(this._setInputValue(Ee.geometry.coordinates[0]+","+Ee.geometry.coordinates[1]),this._eventEmitter.emit("result",{result:Ee})):this.geocoderService.reverseGeocode(Ae).send().then(function(J){const re=J.body.features[0];if(re){const Ie=ce.transformFeatureToGeolocationText(re,this.options.addressAccuracy);this._setInputValue(Ie),re.user_coordinates=Ee.geometry.coordinates,this._eventEmitter.emit("result",{result:re})}else this._eventEmitter.emit("result",{result:{user_coordinates:Ee.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(Q){1===Q.code?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(Q,Ee){var Ae=document.createElementNS("http://www.w3.org/2000/svg","svg");return Ae.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+Q),Ae.setAttribute("viewBox","0 0 18 18"),Ae.setAttribute("xml:space","preserve"),Ae.setAttribute("width",18),Ae.setAttribute("height",18),Ae.innerHTML=Ee,Ae},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(Q){this._inputEl.value=Q,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(Q){var Ee=(Q.clipboardData||window.clipboardData).getData("text");Ee.length>=this.options.minLength&&this._geocode(Ee)},_onKeyDown:function(Q){var Ee=27,Ae=9;if(Q.keyCode===Ee&&this.options.clearAndBlurOnEsc)return this._clear(Q),this._inputEl.blur();var J=Q.target&&Q.target.shadowRoot?Q.target.shadowRoot.activeElement:Q.target;if(!J||!J.value)return this.fresh=!0,Q.keyCode!==Ae&&this.clear(Q),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!Q.metaKey&&-1===[Ae,Ee,37,39,13,38,40].indexOf(Q.keyCode)&&J.value.length>=this.options.minLength&&this._geocode(J.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(Q){this.options.clearOnBlur&&this._clearOnBlur(Q),this.options.collapsed&&this._collapse()},_onChange:function(){var Q=this._typeahead.selected;Q&&JSON.stringify(Q)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(Q),this.options.marker&&this._mapboxgl&&this._handleMarker(Q),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(Q),this._eventEmitter.emit("result",{result:Q}),this.eventManager.select(Q,this))},_fly:function(Q){var Ee;if(Q.properties&&U[Q.properties.short_code])Ee=de({},this.options.flyTo),this._map&&this._map.fitBounds(U[Q.properties.short_code].bbox,Ee);else if(Q.bbox){var Ae=Q.bbox;Ee=de({},this.options.flyTo),this._map&&this._map.fitBounds([[Ae[0],Ae[1]],[Ae[2],Ae[3]]],Ee)}else Ee=de({},{zoom:this.options.zoom},this.options.flyTo),Q.center?Ee.center=Q.center:Q.geometry&&Q.geometry.type&&"Point"===Q.geometry.type&&Q.geometry.coordinates&&(Ee.center=Q.geometry.coordinates),this._map&&this._map.flyTo(Ee)},_requestType:function(Q,Ee){return Q.localGeocoderOnly?1:Q.reverseGeocode&&/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/.test(Ee)?2:0},_setupConfig:function(Q,Ee){const J=/[\s,]+/;var re=this,Ie=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"].reduce(function(He,it){return null==re.options[it]||(He[it]=["countries","types","language"].indexOf(it)>-1?re.options[it].split(J):re.options[it],"proximity"===it&&"number"==typeof re.options[it].longitude&&"number"==typeof re.options[it].latitude&&(He[it]=[re.options[it].longitude,re.options[it].latitude])),He},{});switch(Q){case 2:var Be=Ee.split(J).map(function(He){return parseFloat(He,10)});re.options.flipCoordinates||Be.reverse(),Ie=de(Ie,{query:Be,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(He){He in Ie&&delete Ie[He]});break;case 0:/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)*[ ]*$/.test(Ee)&&(Ee=Ee.replace(/,/g," ")),Ie=de(Ie,{query:Ee})}return Ie},_geocode:function(Q){this.inputString=Q,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:Q});const Ee=this._requestType(this.options,Q),Ae=this._setupConfig(Ee,Q);var J;switch(Ee){case 1:J=Promise.resolve();break;case 0:J=this.geocoderService.forwardGeocode(Ae).send();break;case 2:J=this.geocoderService.reverseGeocode(Ae).send()}var re=this.options.localGeocoder&&this.options.localGeocoder(Q)||[],Ie=[],Be=null;return J.catch(function(He){Be=He}.bind(this)).then(function(He){this._hideLoadingIcon();var it={};return He?"200"==He.statusCode&&((it=He.body).request=He.request,it.headers=He.headers):it={type:"FeatureCollection",features:[]},it.config=Ae,this.fresh&&(this.eventManager.start(this),this.fresh=!1),it.features=it.features?re.concat(it.features):re,this.options.externalGeocoder?(Ie=this.options.externalGeocoder(Q,it.features)||Promise.resolve([])).then(function(gt){return it.features=it.features?gt.concat(it.features):gt,it},function(){return it}):it}.bind(this)).then(function(He){if(Be)throw Be;this.options.filter&&He.features.length&&(He.features=He.features.filter(this.options.filter)),He.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",He),this._typeahead.update(He.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",He))}.bind(this)).catch(function(He){this._hideLoadingIcon(),this._hideAttribution(),re.length&&this.options.localGeocoder||Ie.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(re)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:re}),this._eventEmitter.emit("error",{error:He})}.bind(this)),J},_clear:function(Q){Q&&Q.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(Q){this._clear(Q),this._inputEl.focus()},_clearOnBlur:function(Q){Q.relatedTarget&&this._clear(Q)},_onQueryResult:function(Q){var Ee=Q.body;if(Ee.features.length){var Ae=Ee.features[0];this._typeahead.selected=Ae,this._inputEl.value=Ae.place_name,this._onChange()}},_updateProximity:function(){if(this._map&&this.options.trackProximity)if(this._map.getZoom()>9){var Q=this._map.getCenter().wrap();this.setProximity({longitude:Q.lng,latitude:Q.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(Q){return this._geocode(Q).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderLocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderUserDeniedGeolocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>")},_renderMessage:function(Q){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(Q)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var Q=this.options.language.split(",")[0],Ee=W.language(Q),Ae=K.placeholder[Ee];if(Ae)return Ae}return"Search"},setInput:function(Q){return this._inputEl.value=Q,this._typeahead.selected=null,this._typeahead.clear(),Q.length>=this.options.minLength&&this._geocode(Q),this},setProximity:function(Q,Ee=!0){return this.options.proximity=Q,Ee&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(Q){return Q&&"function"==typeof Q&&(this._typeahead.render=Q),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(Q){var Ee=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=Q||this.options.language||Ee,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(Q){return this.options.zoom=Q,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(Q){return this.options.flyTo=Q,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(Q){return this.placeholder=Q||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(Q){return this.options.bbox=Q,this},getCountries:function(){return this.options.countries},setCountries:function(Q){return this.options.countries=Q,this},getTypes:function(){return this.options.types},setTypes:function(Q){return this.options.types=Q,this},getMinLength:function(){return this.options.minLength},setMinLength:function(Q){return this.options.minLength=Q,this._typeahead&&(this._typeahead.options.minLength=Q),this},getLimit:function(){return this.options.limit},setLimit:function(Q){return this.options.limit=Q,this._typeahead&&(this._typeahead.options.limit=Q),this},getFilter:function(){return this.options.filter},setFilter:function(Q){return this.options.filter=Q,this},setOrigin:function(Q){return this.options.origin=Q,this.geocoderService=ie(Y({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(Q){return this.options.accessToken=Q,this.geocoderService=ie(Y({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(Q){return this.options.autocomplete=Q,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(Q){return this.options.fuzzyMatch=Q,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(Q){return this.options.routing=Q,this},getRouting:function(){return this.options.routing},setWorldview:function(Q){return this.options.worldview=Q,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(Q){if(this._map){this._removeMarker();var Ae=de({},{color:"#4668F2"},this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(Ae),Q.center?this.mapMarker.setLngLat(Q.center).addTo(this._map):Q.geometry&&Q.geometry.type&&"Point"===Q.geometry.type&&Q.geometry.coordinates&&this.mapMarker.setLngLat(Q.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(Q,Ee){return this._eventEmitter.on(Q,Ee),this},off:function(Q,Ee){return this._eventEmitter.removeListener(Q,Ee),this.eventManager.remove(),this}},Bt.exports=ze},234:Bt=>{"use strict";Bt.exports={placeholder:{de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05dc\u05d7\u05e4\u05e9",ja:"\u30b5\u30fc\u30c1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041f\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641c\u7d22",cs:"Vyhled\xe1v\xe1n\xed",hu:"Keres\xe9s",ka:"\u10eb\u10d8\u10d4\u10d1\u10d0",nb:"S\xf8ke",sk:"Vyh\u013ead\xe1vanie",th:"\u0e04\u0e49\u0e19\u0e2b\u0e32",fi:"Hae",is:"Leita",ko:"\uc218\uc0c9",pl:"Szukaj",sl:"Iskanje",fa:"\u062c\u0633\u062a\u062c\u0648",ru:"\u041f\u043e\u0438\u0441\u043a"}}},777:Bt=>{function Xe(lt){const we=lt.address||"",de=lt.text||"",h=lt.place_name||"",Y={address:h.split(",")[0],houseNumber:we,street:de,placeName:h};return lt.context.forEach(function(ie){const $=ie.id.split(".")[0];Y[$]=ie.text}),Y}Bt.exports={transformFeatureToGeolocationText:function Vt(lt,we){const de=Xe(lt),h=["address","street","place","country"];if("function"==typeof we)return we(de);const Y=h.indexOf(we);return(-1===Y?h:h.slice(Y)).reduce(function(ie,$){return de[$]?(""!==ie&&(ie+=", "),ie+de[$]):ie},"")},getAddressInfo:Xe}},11:(Bt,Vt,Xe)=>{"use strict";var lt=Xe(83);Bt.exports=lt,"undefined"!=typeof window&&(window.Suggestions=lt)},636:Bt=>{"use strict";var Vt=function(Xe){return this.component=Xe,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,Xe.el.parentNode.insertBefore(this.wrapper,Xe.el.nextSibling),this};Vt.prototype.show=function(){this.element.style.display="block"},Vt.prototype.hide=function(){this.element.style.display="none"},Vt.prototype.add=function(Xe){this.items.push(Xe)},Vt.prototype.clear=function(){this.items=[],this.active=0},Vt.prototype.isEmpty=function(){return!this.items.length},Vt.prototype.isVisible=function(){return"block"===this.element.style.display},Vt.prototype.draw=function(){if(this.element.innerHTML="",0!==this.items.length){for(var Xe=0;Xe<this.items.length;Xe++)this.drawItem(this.items[Xe],this.active===Xe);this.show()}else this.hide()},Vt.prototype.drawItem=function(Xe,lt){var we=document.createElement("li"),de=document.createElement("a");lt&&(we.className+=" active"),de.innerHTML=Xe.string,we.appendChild(de),this.element.appendChild(we),we.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),we.addEventListener("mouseup",function(){this.handleMouseUp.call(this,Xe)}.bind(this))},Vt.prototype.handleMouseUp=function(Xe){this.selectingListItem=!1,this.component.value(Xe.original),this.clear(),this.draw()},Vt.prototype.move=function(Xe){this.active=Xe,this.draw()},Vt.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},Vt.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},Vt.prototype.drawError=function(Xe){var lt=document.createElement("li");lt.innerHTML=Xe,this.element.appendChild(lt),this.show()},Bt.exports=Vt},83:(Bt,Vt,Xe)=>{"use strict";var lt=Xe(703),we=Xe(780),de=Xe(636),h=function(U,Y,ie){return this.options=lt({minLength:2,limit:5,filter:!0,hideOnBlur:!0},ie=ie||{}),this.el=U,this.data=Y||[],this.list=new de(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function($){this.handleKeyUp($.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function($){this.handleKeyDown($)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function($){this.handlePaste($)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};h.prototype.handleKeyUp=function(U){40===U||38===U||27===U||13===U||9===U||this.handleInputChange(this.el.value)},h.prototype.handleKeyDown=function(U){switch(U.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&U.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},h.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},h.prototype.handlePaste=function(U){if(U.clipboardData)this.handleInputChange(U.clipboardData.getData("Text"));else{var Y=this;setTimeout(function(){Y.handleInputChange(U.target.value)},100)}},h.prototype.handleInputChange=function(U){this.query=this.normalize(U),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(Y){for(var ie=0;ie<Y.length&&(this.list.add(Y[ie]),ie!==this.options.limit-1);ie++);this.list.draw()}.bind(this))},h.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},h.prototype.update=function(U){this.data=U,this.handleKeyUp()},h.prototype.clear=function(){this.data=[],this.list.clear()},h.prototype.normalize=function(U){return U.toLowerCase()},h.prototype.match=function(U,Y){return U.indexOf(Y)>-1},h.prototype.value=function(U){if(this.selected=U,this.el.value=this.getItemValue(U),document.createEvent){var Y=document.createEvent("HTMLEvents");Y.initEvent("change",!0,!1),this.el.dispatchEvent(Y)}else this.el.fireEvent("onchange")},h.prototype.getCandidates=function(U){var Y={pre:"<strong>",post:"</strong>",extract:function($){return this.getItemValue($)}.bind(this)};U(this.options.filter?we.filter(this.query,this.data,Y).map(function($){return{original:$.original,string:this.render($.original,$.string)}}.bind(this)):this.data.map(function($){return{original:$,string:this.render($)}}.bind(this)))},h.prototype.getItemValue=function(U){return U},h.prototype.render=function(U,Y){if(Y)return Y;for(var ie=this.getItemValue(U.original?U.original:U),$=this.normalize(ie),K=$.lastIndexOf(this.query);K>-1;){var W=K+this.query.length;ie=ie.slice(0,K)+"<strong>"+ie.slice(K,W)+"</strong>"+ie.slice(W),K=$.slice(0,K).lastIndexOf(this.query)}return ie},h.prototype.renderError=function(U){this.list.drawError(U)},Bt.exports=h},471:(Bt,Vt,Xe)=>{"use strict";var lt=Xe(454);Bt.exports=lt},454:(Bt,Vt,Xe)=>{"use strict";var lt=Xe(753),we=Xe(176);function de(U){we.call(this,U)}(de.prototype=Object.create(we.prototype)).constructor=de,de.prototype.sendRequest=lt.browserSend,de.prototype.abortRequest=lt.browserAbort,Bt.exports=function h(U){return new de(U)}},753:(Bt,Vt,Xe)=>{"use strict";var lt=Xe(332),we=Xe(158),de=Xe(719),h=Xe(829),U={};function $(ce){var ue=ce.total,Ce=ce.loaded;return{total:ue,transferred:Ce,percent:100*Ce/ue}}function K(ce,ue){return new Promise(function(Ce,ze){ue.onprogress=function(Ae){ce.emitter.emit(de.EVENT_PROGRESS_DOWNLOAD,$(Ae))};var Q=ce.file;Q&&(ue.upload.onprogress=function(Ae){ce.emitter.emit(de.EVENT_PROGRESS_UPLOAD,$(Ae))}),ue.onerror=function(Ae){ze(Ae)},ue.onabort=function(){var Ae=new we({request:ce,type:de.ERROR_REQUEST_ABORTED});ze(Ae)},ue.onload=function(){if(delete U[ce.id],ue.status<200||ue.status>=400){var Ae=new we({request:ce,body:ue.response,statusCode:ue.status});ze(Ae)}else Ce(ue)};var Ee=ce.body;"string"==typeof Ee?ue.send(Ee):Ee?ue.send(JSON.stringify(Ee)):Q?ue.send(Q):ue.send(),U[ce.id]=ue}).then(function(Ce){return function ie(ce,ue){return new lt(ce,{body:ue.response,headers:h(ue.getAllResponseHeaders()),statusCode:ue.status})}(ce,Ce)})}function W(ce,ue){var Ce=ce.url(ue),ze=new window.XMLHttpRequest;return ze.open(ce.method,Ce),Object.keys(ce.headers).forEach(function(Q){ze.setRequestHeader(Q,ce.headers[Q])}),ze}Bt.exports={browserAbort:function Y(ce){var ue=U[ce.id];!ue||(ue.abort(),delete U[ce.id])},sendRequestXhr:K,browserSend:function ge(ce){return Promise.resolve().then(function(){var ue=W(ce,ce.client.accessToken);return K(ce,ue)})},createRequestXhr:W}},176:(Bt,Vt,Xe)=>{"use strict";var lt=Xe(129),we=Xe(538),de=Xe(719);function h(U){if(!U||!U.accessToken)throw new Error("Cannot create a client without an access token");lt(U.accessToken),this.accessToken=U.accessToken,this.origin=U.origin||de.API_ORIGIN}h.prototype.createRequest=function(Y){return new we(this,Y)},Bt.exports=h},158:(Bt,Vt,Xe)=>{"use strict";var lt=Xe(719);Bt.exports=function we(de){var U,h=de.type||lt.ERROR_HTTP;if(de.body)try{U=JSON.parse(de.body)}catch(ie){U=de.body}else U=null;var Y=de.message||null;Y||("string"==typeof U?Y=U:U&&"string"==typeof U.message?Y=U.message:h===lt.ERROR_REQUEST_ABORTED&&(Y="Request aborted")),this.message=Y,this.type=h,this.statusCode=de.statusCode||null,this.request=de.request,this.body=U}},538:(Bt,Vt,Xe)=>{"use strict";var lt=Xe(129),we=Xe(703),de=Xe(661),h=Xe(449),U=Xe(719),Y=1;function ie($,K){if(!$)throw new Error("MapiRequest requires a client");if(!K||!K.path||!K.method)throw new Error("MapiRequest requires an options object with path and method properties");var W={};K.body&&(W["content-type"]="application/json");var ge=we(W,K.headers),ce=Object.keys(ge).reduce(function(ue,Ce){return ue[Ce.toLowerCase()]=ge[Ce],ue},{});this.id=Y++,this._options=K,this.emitter=new de,this.client=$,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=K.path,this.method=K.method,this.origin=K.origin||$.origin,this.query=K.query||{},this.params=K.params||{},this.body=K.body||null,this.file=K.file||null,this.encoding=K.encoding||"utf8",this.sendFileAs=K.sendFileAs||null,this.headers=ce}ie.prototype.url=function(K){var W=h.prependOrigin(this.path,this.origin);W=h.appendQueryObject(W,this.query);var ge=this.params,ce=null==K?this.client.accessToken:K;if(ce){W=h.appendQueryParam(W,"access_token",ce);var ue=lt(ce).user;ge=we({ownerId:ue},ge)}return h.interpolateRouteParams(W,ge)},ie.prototype.send=function(){var K=this;if(K.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return K.sent=!0,K.client.sendRequest(K).then(function(W){return K.response=W,K.emitter.emit(U.EVENT_RESPONSE,W),W},function(W){throw K.error=W,K.emitter.emit(U.EVENT_ERROR,W),W})},ie.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))},ie.prototype.eachPage=function(K){var W=this;function ge(Ce){K(null,Ce,function ze(){delete W._nextPageRequest;var Q=Ce.nextPage();Q&&(W._nextPageRequest=Q,ue(Q))})}function ce(Ce){K(Ce,null,function(){})}function ue(Ce){Ce.send().then(ge,ce)}ue(this)},ie.prototype.clone=function(){return this._extend()},ie.prototype._extend=function(K){var W=we(this._options,K);return new ie(this.client,W)},Bt.exports=ie},332:(Bt,Vt,Xe)=>{"use strict";var lt=Xe(699);function we(de,h){this.request=de,this.headers=h.headers,this.rawBody=h.body,this.statusCode=h.statusCode;try{this.body=JSON.parse(h.body||"{}")}catch(U){this.body=h.body}this.links=lt(this.headers.link)}we.prototype.hasNextPage=function(){return!!this.links.next},we.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},Bt.exports=we},719:Bt=>{"use strict";Bt.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}},829:Bt=>{"use strict";Bt.exports=function Xe(lt){var we={};return lt&&lt.trim().split(/[\r|\n]+/).forEach(function(de){var h=function Vt(lt){var we=lt.indexOf(":");return{name:lt.substring(0,we).trim().toLowerCase(),value:lt.substring(we+1).trim()}}(de);we[h.name]=h.value}),we}},699:Bt=>{"use strict";Bt.exports=function lt(we){return we?we.split(/,\s*</).reduce(function(de,h){var U=function Xe(we){var de=we.match(/<?([^>]*)>(.*)/);if(!de)return null;var h=de[1],U=de[2].split(";"),Y=null,ie=U.reduce(function($,K){var W=function Vt(we){var de=we.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return de?{key:de[1],value:de[2]}:null}(K);return W?"rel"===W.key?(Y||(Y=W.value),$):($[W.key]=W.value,$):$},{});return Y?{url:h,rel:Y,params:ie}:null}(h);return U?(U.rel.split(/\s+/).forEach(function(ie){de[ie]||(de[ie]={url:U.url,params:U.params})}),de):de},{}):{}}},449:Bt=>{"use strict";function Xe(U){return Array.isArray(U)?function Vt(U){return U.map(encodeURIComponent).join(",")}(U):encodeURIComponent(String(U))}function lt(U,Y,ie){if(!1===ie||null===ie)return U;var $=/\?/.test(U)?"&":"?",K=encodeURIComponent(Y);return void 0!==ie&&""!==ie&&!0!==ie&&(K+="="+Xe(ie)),""+U+$+K}Bt.exports={appendQueryObject:function we(U,Y){if(!Y)return U;var ie=U;return Object.keys(Y).forEach(function($){var K=Y[$];void 0!==K&&(Array.isArray(K)&&(K=K.filter(function(W){return null!=W}).join(",")),ie=lt(ie,$,K))}),ie},appendQueryParam:lt,prependOrigin:function de(U,Y){if(!Y||"http"===U.slice(0,4))return U;var ie="/"===U[0]?"":"/";return""+Y.replace(/\/$/,"")+ie+U},interpolateRouteParams:function h(U,Y){return Y?U.replace(/\/:([a-zA-Z0-9]+)/g,function(ie,$){var K=Y[$];if(void 0===K)throw new Error("Unspecified route parameter "+$);return"/"+Xe(K)}):U}}},661:Bt=>{"use strict";var Vt=Object.prototype.hasOwnProperty,Xe="~";function lt(){}function we(Y,ie,$){this.fn=Y,this.context=ie,this.once=$||!1}function de(Y,ie,$,K,W){if("function"!=typeof $)throw new TypeError("The listener must be a function");var ge=new we($,K||Y,W),ce=Xe?Xe+ie:ie;return Y._events[ce]?Y._events[ce].fn?Y._events[ce]=[Y._events[ce],ge]:Y._events[ce].push(ge):(Y._events[ce]=ge,Y._eventsCount++),Y}function h(Y,ie){0==--Y._eventsCount?Y._events=new lt:delete Y._events[ie]}function U(){this._events=new lt,this._eventsCount=0}Object.create&&(lt.prototype=Object.create(null),(new lt).__proto__||(Xe=!1)),U.prototype.eventNames=function(){var $,K,ie=[];if(0===this._eventsCount)return ie;for(K in $=this._events)Vt.call($,K)&&ie.push(Xe?K.slice(1):K);return Object.getOwnPropertySymbols?ie.concat(Object.getOwnPropertySymbols($)):ie},U.prototype.listeners=function(ie){var K=this._events[Xe?Xe+ie:ie];if(!K)return[];if(K.fn)return[K.fn];for(var W=0,ge=K.length,ce=new Array(ge);W<ge;W++)ce[W]=K[W].fn;return ce},U.prototype.listenerCount=function(ie){var K=this._events[Xe?Xe+ie:ie];return K?K.fn?1:K.length:0},U.prototype.emit=function(ie,$,K,W,ge,ce){var ue=Xe?Xe+ie:ie;if(!this._events[ue])return!1;var Q,Ee,Ce=this._events[ue],ze=arguments.length;if(Ce.fn){switch(Ce.once&&this.removeListener(ie,Ce.fn,void 0,!0),ze){case 1:return Ce.fn.call(Ce.context),!0;case 2:return Ce.fn.call(Ce.context,$),!0;case 3:return Ce.fn.call(Ce.context,$,K),!0;case 4:return Ce.fn.call(Ce.context,$,K,W),!0;case 5:return Ce.fn.call(Ce.context,$,K,W,ge),!0;case 6:return Ce.fn.call(Ce.context,$,K,W,ge,ce),!0}for(Ee=1,Q=new Array(ze-1);Ee<ze;Ee++)Q[Ee-1]=arguments[Ee];Ce.fn.apply(Ce.context,Q)}else{var J,Ae=Ce.length;for(Ee=0;Ee<Ae;Ee++)switch(Ce[Ee].once&&this.removeListener(ie,Ce[Ee].fn,void 0,!0),ze){case 1:Ce[Ee].fn.call(Ce[Ee].context);break;case 2:Ce[Ee].fn.call(Ce[Ee].context,$);break;case 3:Ce[Ee].fn.call(Ce[Ee].context,$,K);break;case 4:Ce[Ee].fn.call(Ce[Ee].context,$,K,W);break;default:if(!Q)for(J=1,Q=new Array(ze-1);J<ze;J++)Q[J-1]=arguments[J];Ce[Ee].fn.apply(Ce[Ee].context,Q)}}return!0},U.prototype.on=function(ie,$,K){return de(this,ie,$,K,!1)},U.prototype.once=function(ie,$,K){return de(this,ie,$,K,!0)},U.prototype.removeListener=function(ie,$,K,W){var ge=Xe?Xe+ie:ie;if(!this._events[ge])return this;if(!$)return h(this,ge),this;var ce=this._events[ge];if(ce.fn)ce.fn===$&&(!W||ce.once)&&(!K||ce.context===K)&&h(this,ge);else{for(var ue=0,Ce=[],ze=ce.length;ue<ze;ue++)(ce[ue].fn!==$||W&&!ce[ue].once||K&&ce[ue].context!==K)&&Ce.push(ce[ue]);Ce.length?this._events[ge]=1===Ce.length?Ce[0]:Ce:h(this,ge)}return this},U.prototype.removeAllListeners=function(ie){var $;return ie?this._events[$=Xe?Xe+ie:ie]&&h(this,$):(this._events=new lt,this._eventsCount=0),this},U.prototype.off=U.prototype.removeListener,U.prototype.addListener=U.prototype.on,U.prefixed=Xe,U.EventEmitter=U,Bt.exports=U},75:(Bt,Vt,Xe)=>{"use strict";var lt=Xe(703),we=Xe(801),de=Xe(313),h=Xe(836),U=Xe(497),Y={},ie=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Y.forwardGeocode=function($){we.assertShape({query:we.required(we.string),mode:we.oneOf("mapbox.places","mapbox.places-permanent"),countries:we.arrayOf(we.string),proximity:we.oneOf(we.coordinates,"ip"),types:we.arrayOf(we.oneOf(ie)),autocomplete:we.boolean,bbox:we.arrayOf(we.number),limit:we.number,language:we.arrayOf(we.string),routing:we.boolean,fuzzyMatch:we.boolean,worldview:we.string})($),$.mode=$.mode||"mapbox.places";var K=h(lt({country:$.countries},de($,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:de($,["mode","query"]),query:K})},Y.reverseGeocode=function($){we.assertShape({query:we.required(we.coordinates),mode:we.oneOf("mapbox.places","mapbox.places-permanent"),countries:we.arrayOf(we.string),types:we.arrayOf(we.oneOf(ie)),bbox:we.arrayOf(we.number),limit:we.number,language:we.arrayOf(we.string),reverseMode:we.oneOf("distance","score"),routing:we.boolean,worldview:we.string})($),$.mode=$.mode||"mapbox.places";var K=h(lt({country:$.countries},de($,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:de($,["mode","query"]),query:K})},Bt.exports=U(Y)},497:(Bt,Vt,Xe)=>{"use strict";var lt=Xe(176),we=Xe(454);Bt.exports=function de(h){return function(U){var Y;Y=lt.prototype.isPrototypeOf(U)?U:we(U);var ie=Object.create(h);return ie.client=Y,ie}}},621:Bt=>{"use strict";Bt.exports=function Vt(Xe,lt){return Object.keys(Xe).reduce(function(we,de){return we[de]=lt(de,Xe[de]),we},{})}},313:Bt=>{"use strict";Bt.exports=function Vt(Xe,lt){var we=function(de,h){return-1!==lt.indexOf(de)&&void 0!==h};return"function"==typeof lt&&(we=lt),Object.keys(Xe).filter(function(de){return we(de,Xe[de])}).reduce(function(de,h){return de[h]=Xe[h],de},{})}},836:(Bt,Vt,Xe)=>{"use strict";var lt=Xe(621);Bt.exports=function we(de){return lt(de,function(h,U){return"boolean"==typeof U?JSON.stringify(U):U})}},801:(Bt,Vt,Xe)=>{"use strict";var lt=Xe(703),we=Xe(89);Bt.exports=lt(we,{file:function de(ie){return"undefined"!=typeof window?ie instanceof global.Blob||ie instanceof global.ArrayBuffer?void 0:"Blob or ArrayBuffer":"string"!=typeof ie&&void 0===ie.pipe?"Filename or Readable stream":void 0},date:function U(ie){var $="date";if("boolean"==typeof ie)return $;try{var K=new Date(ie);if(K.getTime&&isNaN(K.getTime()))return $}catch(W){return $}},coordinates:function Y(ie){return we.tuple(we.number,we.number)(ie)},assertShape:function h(ie,$){return we.assert(we.strictShape(ie),$)}})},129:(Bt,Vt,Xe)=>{"use strict";var lt=Xe(49),we={};function U(Y,ie){return Object.prototype.hasOwnProperty.call(Y,ie)}Bt.exports=function de(Y){if(we[Y])return we[Y];var ie=Y.split("."),$=ie[0],K=ie[1];if(!K)throw new Error("Invalid token");var W=function h(Y){try{return JSON.parse(lt.decode(Y))}catch(ie){throw new Error("Invalid token")}}(K),ge={usage:$,user:W.u};return U(W,"a")&&(ge.authorization=W.a),U(W,"exp")&&(ge.expires=1e3*W.exp),U(W,"iat")&&(ge.created=1e3*W.iat),U(W,"scopes")&&(ge.scopes=W.scopes),U(W,"client")&&(ge.client=W.client),U(W,"ll")&&(ge.lastLogin=W.ll),U(W,"iu")&&(ge.impersonator=W.iu),we[Y]=ge,ge}},779:(Bt,Vt,Xe)=>{"use strict";function lt(t){return"function"==typeof t}let we=!1;const de={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){const e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else we&&console.log("RxJS: Back to a better error behavior. Thank you. <3");we=t},get useDeprecatedSynchronousErrorHandling(){return we}};function h(t){setTimeout(()=>{throw t},0)}const U={closed:!0,next(t){},error(t){if(de.useDeprecatedSynchronousErrorHandling)throw t;h(t)},complete(){}},Y=Array.isArray||(t=>t&&"number"==typeof t.length);function ie(t){return null!==t&&"object"==typeof t}const K=(()=>{function t(e){return Error.call(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((n,i)=>`${i+1}) ${n.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e,this}return t.prototype=Object.create(Error.prototype),t})();class W{constructor(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}unsubscribe(){let e;if(this.closed)return;let{_parentOrParents:n,_ctorUnsubscribe:i,_unsubscribe:c,_subscriptions:p}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof W)n.remove(this);else if(null!==n)for(let v=0;v<n.length;++v)n[v].remove(this);if(lt(c)){i&&(this._unsubscribe=void 0);try{c.call(this)}catch(v){e=v instanceof K?ge(v.errors):[v]}}if(Y(p)){let v=-1,C=p.length;for(;++v<C;){const S=p[v];if(ie(S))try{S.unsubscribe()}catch(R){e=e||[],R instanceof K?e=e.concat(ge(R.errors)):e.push(R)}}}if(e)throw new K(e)}add(e){let n=e;if(!e)return W.EMPTY;switch(typeof e){case"function":n=new W(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof W)){const p=n;n=new W,n._subscriptions=[p]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}let{_parentOrParents:i}=n;if(null===i)n._parentOrParents=this;else if(i instanceof W){if(i===this)return n;n._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return n;i.push(this)}const c=this._subscriptions;return null===c?this._subscriptions=[n]:c.push(n),n}remove(e){const n=this._subscriptions;if(n){const i=n.indexOf(e);-1!==i&&n.splice(i,1)}}}var t;function ge(t){return t.reduce((e,n)=>e.concat(n instanceof K?n.errors:n),[])}W.EMPTY=((t=new W).closed=!0,t);const ce="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class Ce extends W{constructor(e,n,i){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=U;break;case 1:if(!e){this.destination=U;break}if("object"==typeof e){e instanceof Ce?(this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e,e.add(this)):(this.syncErrorThrowable=!0,this.destination=new ze(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new ze(this,e,n,i)}}[ce](){return this}static create(e,n,i){const c=new Ce(e,n,i);return c.syncErrorThrowable=!1,c}next(e){this.isStopped||this._next(e)}error(e){this.isStopped||(this.isStopped=!0,this._error(e))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(e){this.destination.next(e)}_error(e){this.destination.error(e),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:e}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}class ze extends Ce{constructor(e,n,i,c){super(),this._parentSubscriber=e;let p,v=this;lt(n)?p=n:n&&(p=n.next,i=n.error,c=n.complete,n!==U&&(v=Object.create(n),lt(v.unsubscribe)&&this.add(v.unsubscribe.bind(v)),v.unsubscribe=this.unsubscribe.bind(this))),this._context=v,this._next=p,this._error=i,this._complete=c}next(e){if(!this.isStopped&&this._next){const{_parentSubscriber:n}=this;de.useDeprecatedSynchronousErrorHandling&&n.syncErrorThrowable?this.__tryOrSetError(n,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}error(e){if(!this.isStopped){const{_parentSubscriber:n}=this,{useDeprecatedSynchronousErrorHandling:i}=de;if(this._error)i&&n.syncErrorThrowable?(this.__tryOrSetError(n,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(n.syncErrorThrowable)i?(n.syncErrorValue=e,n.syncErrorThrown=!0):h(e),this.unsubscribe();else{if(this.unsubscribe(),i)throw e;h(e)}}}complete(){if(!this.isStopped){const{_parentSubscriber:e}=this;if(this._complete){const n=()=>this._complete.call(this._context);de.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(e,n){try{e.call(this._context,n)}catch(i){if(this.unsubscribe(),de.useDeprecatedSynchronousErrorHandling)throw i;h(i)}}__tryOrSetError(e,n,i){if(!de.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{n.call(this._context,i)}catch(c){return de.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=c,e.syncErrorThrown=!0,!0):(h(c),!0)}return!1}_unsubscribe(){const{_parentSubscriber:e}=this;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}const Ae="function"==typeof Symbol&&Symbol.observable||"@@observable";function J(t){return t}let Be=(()=>{class t{constructor(n){this._isScalar=!1,n&&(this._subscribe=n)}lift(n){const i=new t;return i.source=this,i.operator=n,i}subscribe(n,i,c){const{operator:p}=this,v=function Ee(t,e,n){if(t){if(t instanceof Ce)return t;if(t[ce])return t[ce]()}return t||e||n?new Ce(t,e,n):new Ce(U)}(n,i,c);if(v.add(p?p.call(v,this.source):this.source||de.useDeprecatedSynchronousErrorHandling&&!v.syncErrorThrowable?this._subscribe(v):this._trySubscribe(v)),de.useDeprecatedSynchronousErrorHandling&&v.syncErrorThrowable&&(v.syncErrorThrowable=!1,v.syncErrorThrown))throw v.syncErrorValue;return v}_trySubscribe(n){try{return this._subscribe(n)}catch(i){de.useDeprecatedSynchronousErrorHandling&&(n.syncErrorThrown=!0,n.syncErrorValue=i),function Q(t){for(;t;){const{closed:e,destination:n,isStopped:i}=t;if(e||i)return!1;t=n&&n instanceof Ce?n:null}return!0}(n)?n.error(i):console.warn(i)}}forEach(n,i){return new(i=He(i))((c,p)=>{let v;v=this.subscribe(C=>{try{n(C)}catch(S){p(S),v&&v.unsubscribe()}},p,c)})}_subscribe(n){const{source:i}=this;return i&&i.subscribe(n)}[Ae](){return this}pipe(...n){return 0===n.length?this:function Ie(t){return 0===t.length?J:1===t.length?t[0]:function(n){return t.reduce((i,c)=>c(i),n)}}(n)(this)}toPromise(n){return new(n=He(n))((i,c)=>{let p;this.subscribe(v=>p=v,v=>c(v),()=>i(p))})}}return t.create=e=>new t(e),t})();function He(t){if(t||(t=de.Promise||Promise),!t)throw new Error("no Promise impl found");return t}const gt=(()=>{function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t})();class kt extends W{constructor(e,n){super(),this.subject=e,this.subscriber=n,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const e=this.subject,n=e.observers;if(this.subject=null,!n||0===n.length||e.isStopped||e.closed)return;const i=n.indexOf(this.subscriber);-1!==i&&n.splice(i,1)}}class _t extends Ce{constructor(e){super(e),this.destination=e}}let Et=(()=>{class t extends Be{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[ce](){return new _t(this)}lift(n){const i=new Lt(this,this);return i.operator=n,i}next(n){if(this.closed)throw new gt;if(!this.isStopped){const{observers:i}=this,c=i.length,p=i.slice();for(let v=0;v<c;v++)p[v].next(n)}}error(n){if(this.closed)throw new gt;this.hasError=!0,this.thrownError=n,this.isStopped=!0;const{observers:i}=this,c=i.length,p=i.slice();for(let v=0;v<c;v++)p[v].error(n);this.observers.length=0}complete(){if(this.closed)throw new gt;this.isStopped=!0;const{observers:n}=this,i=n.length,c=n.slice();for(let p=0;p<i;p++)c[p].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(n){if(this.closed)throw new gt;return super._trySubscribe(n)}_subscribe(n){if(this.closed)throw new gt;return this.hasError?(n.error(this.thrownError),W.EMPTY):this.isStopped?(n.complete(),W.EMPTY):(this.observers.push(n),new kt(this,n))}asObservable(){const n=new Be;return n.source=this,n}}return t.create=(e,n)=>new Lt(e,n),t})();class Lt extends Et{constructor(e,n){super(),this.destination=e,this.source=n}next(e){const{destination:n}=this;n&&n.next&&n.next(e)}error(e){const{destination:n}=this;n&&n.error&&this.destination.error(e)}complete(){const{destination:e}=this;e&&e.complete&&this.destination.complete()}_subscribe(e){const{source:n}=this;return n?this.source.subscribe(e):W.EMPTY}}function ut(t){return t&&"function"==typeof t.schedule}function rt(t,e){return function(i){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return i.lift(new un(t,e))}}class un{constructor(e,n){this.project=e,this.thisArg=n}call(e,n){return n.subscribe(new Cn(e,this.project,this.thisArg))}}class Cn extends Ce{constructor(e,n,i){super(e),this.project=n,this.count=0,this.thisArg=i||this}_next(e){let n;try{n=this.project.call(this.thisArg,e,this.count++)}catch(i){return void this.destination.error(i)}this.destination.next(n)}}const an=t=>e=>{for(let n=0,i=t.length;n<i&&!e.closed;n++)e.next(t[n]);e.complete()},Bn=function hn(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}(),nt=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function Ct(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}const Gt=t=>{if(t&&"function"==typeof t[Ae])return(t=>e=>{const n=t[Ae]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(e)})(t);if(nt(t))return an(t);if(Ct(t))return(t=>e=>(t.then(n=>{e.closed||(e.next(n),e.complete())},n=>e.error(n)).then(null,h),e))(t);if(t&&"function"==typeof t[Bn])return(t=>e=>{const n=t[Bn]();for(;;){let i;try{i=n.next()}catch(c){return e.error(c),e}if(i.done){e.complete();break}if(e.next(i.value),e.closed)break}return"function"==typeof n.return&&e.add(()=>{n.return&&n.return()}),e})(t);{const n=`You provided ${ie(t)?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(n)}};function Rn(t,e){return new Be(n=>{const i=new W;let c=0;return i.add(e.schedule(function(){c!==t.length?(n.next(t[c++]),n.closed||i.add(this.schedule())):n.complete()})),i})}function ar(t,e){return e?function xn(t,e){if(null!=t){if(function dr(t){return t&&"function"==typeof t[Ae]}(t))return function pn(t,e){return new Be(n=>{const i=new W;return i.add(e.schedule(()=>{const c=t[Ae]();i.add(c.subscribe({next(p){i.add(e.schedule(()=>n.next(p)))},error(p){i.add(e.schedule(()=>n.error(p)))},complete(){i.add(e.schedule(()=>n.complete()))}}))})),i})}(t,e);if(Ct(t))return function bt(t,e){return new Be(n=>{const i=new W;return i.add(e.schedule(()=>t.then(c=>{i.add(e.schedule(()=>{n.next(c),i.add(e.schedule(()=>n.complete()))}))},c=>{i.add(e.schedule(()=>n.error(c)))}))),i})}(t,e);if(nt(t))return Rn(t,e);if(function tr(t){return t&&"function"==typeof t[Bn]}(t)||"string"==typeof t)return function Hr(t,e){if(!t)throw new Error("Iterable cannot be null");return new Be(n=>{const i=new W;let c;return i.add(()=>{c&&"function"==typeof c.return&&c.return()}),i.add(e.schedule(()=>{c=t[Bn](),i.add(e.schedule(function(){if(n.closed)return;let p,v;try{const C=c.next();p=C.value,v=C.done}catch(C){return void n.error(C)}v?n.complete():(n.next(p),this.schedule())}))})),i})}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}(t,e):t instanceof Be?t:new Be(Gt(t))}class Un extends Ce{constructor(e){super(),this.parent=e}_next(e){this.parent.notifyNext(e)}_error(e){this.parent.notifyError(e),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class Wr extends Ce{notifyNext(e){this.destination.next(e)}notifyError(e){this.destination.error(e)}notifyComplete(){this.destination.complete()}}function ko(t,e){if(e.closed)return;if(t instanceof Be)return t.subscribe(e);let n;try{n=Gt(t)(e)}catch(i){e.error(i)}return n}function Br(t,e,n=Number.POSITIVE_INFINITY){return"function"==typeof e?i=>i.pipe(Br((c,p)=>ar(t(c,p)).pipe(rt((v,C)=>e(c,v,p,C))),n)):("number"==typeof e&&(n=e),i=>i.lift(new oo(t,n)))}class oo{constructor(e,n=Number.POSITIVE_INFINITY){this.project=e,this.concurrent=n}call(e,n){return n.subscribe(new Ki(e,this.project,this.concurrent))}}class Ki extends Wr{constructor(e,n,i=Number.POSITIVE_INFINITY){super(e),this.project=n,this.concurrent=i,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}_tryNext(e){let n;const i=this.index++;try{n=this.project(e,i)}catch(c){return void this.destination.error(c)}this.active++,this._innerSub(n)}_innerSub(e){const n=new Un(this),i=this.destination;i.add(n);const c=ko(e,n);c!==n&&i.add(c)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(e){this.destination.next(e)}notifyComplete(){const e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function mi(t=Number.POSITIVE_INFINITY){return Br(J,t)}function Ri(t,e){return e?Rn(t,e):new Be(an(t))}function so(...t){let e=Number.POSITIVE_INFINITY,n=null,i=t[t.length-1];return ut(i)?(n=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(e=t.pop())):"number"==typeof i&&(e=t.pop()),null===n&&1===t.length&&t[0]instanceof Be?t[0]:mi(e)(Ri(t,n))}function Wo(){return function(e){return e.lift(new us(e))}}class us{constructor(e){this.connectable=e}call(e,n){const{connectable:i}=this;i._refCount++;const c=new ks(e,i),p=n.subscribe(c);return c.closed||(c.connection=i.connect()),p}}class ks extends Ce{constructor(e,n){super(e),this.connectable=n}_unsubscribe(){const{connectable:e}=this;if(!e)return void(this.connection=null);this.connectable=null;const n=e._refCount;if(n<=0)return void(this.connection=null);if(e._refCount=n-1,n>1)return void(this.connection=null);const{connection:i}=this,c=e._connection;this.connection=null,c&&(!i||c===i)&&c.unsubscribe()}}class hs extends Be{constructor(e,n){super(),this.source=e,this.subjectFactory=n,this._refCount=0,this._isComplete=!1}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let e=this._connection;return e||(this._isComplete=!1,e=this._connection=new W,e.add(this.source.subscribe(new Ys(this.getSubject(),this))),e.closed&&(this._connection=null,e=W.EMPTY)),e}refCount(){return Wo()(this)}}const Rs=(()=>{const t=hs.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:t._subscribe},_isComplete:{value:t._isComplete,writable:!0},getSubject:{value:t.getSubject},connect:{value:t.connect},refCount:{value:t.refCount}}})();class Ys extends _t{constructor(e,n){super(e),this.connectable=n}_error(e){this._unsubscribe(),super._error(e)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const e=this.connectable;if(e){this.connectable=null;const n=e._connection;e._refCount=0,e._subject=null,e._connection=null,n&&n.unsubscribe()}}}function Oi(t,e){return function(i){let c;if(c="function"==typeof t?t:function(){return t},"function"==typeof e)return i.lift(new Os(c,e));const p=Object.create(i,Rs);return p.source=i,p.subjectFactory=c,p}}class Os{constructor(e,n){this.subjectFactory=e,this.selector=n}call(e,n){const{selector:i}=this,c=this.subjectFactory(),p=i(c).subscribe(e);return p.add(n.subscribe(c)),p}}function Ei(){return new Et}function Qn(t){for(let e in t)if(t[e]===Qn)return e;throw Error("Could not find renamed property on target object.")}function ao(t,e){for(const n in e)e.hasOwnProperty(n)&&!t.hasOwnProperty(n)&&(t[n]=e[n])}function nr(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(nr).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const e=t.toString();if(null==e)return""+e;const n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}function Ui(t,e){return null==t||""===t?null===e?"":e:null==e||""===e?t:t+" "+e}const Xo=Qn({__forward_ref__:Qn});function ne(t){return t.__forward_ref__=ne,t.toString=function(){return nr(this())},t}function N(t){return j(t)?t():t}function j(t){return"function"==typeof t&&t.hasOwnProperty(Xo)&&t.__forward_ref__===ne}class se extends Error{constructor(e,n){super(function De(t,e){return`NG0${Math.abs(t)}${e?": "+e:""}`}(e,n)),this.code=e}}function Me(t){return"string"==typeof t?t:null==t?"":String(t)}function Oe(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():Me(t)}function It(t,e){const n=e?` in ${e}`:"";throw new se(-201,`No provider for ${Oe(t)} found${n}`)}function mn(t,e){null==t&&function nn(t,e,n,i){throw new Error(`ASSERTION ERROR: ${t}`+(null==i?"":` [Expected=> ${n} ${i} ${e} <=Actual]`))}(e,t,null,"!=")}function gn(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}const ps=gn;function mr(t){return{providers:t.providers||[],imports:t.imports||[]}}function hi(t){return Sr(t,lo)||Sr(t,ea)}function Sr(t,e){return t.hasOwnProperty(e)?t[e]:null}function Qs(t){return t&&(t.hasOwnProperty(Ls)||t.hasOwnProperty(Wn))?t[Ls]:null}const lo=Qn({\u0275prov:Qn}),Ls=Qn({\u0275inj:Qn}),ea=Qn({ngInjectableDef:Qn}),Wn=Qn({ngInjectorDef:Qn});var wn=(()=>((wn=wn||{})[wn.Default=0]="Default",wn[wn.Host=1]="Host",wn[wn.Self=2]="Self",wn[wn.SkipSelf=4]="SkipSelf",wn[wn.Optional=8]="Optional",wn))();let Oo;function Pr(t){const e=Oo;return Oo=t,e}function gi(t,e,n){const i=hi(t);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:n&wn.Optional?null:void 0!==e?e:void It(nr(t),"Injector")}function wr(t){return{toString:t}.toString()}var oi=(()=>((oi=oi||{})[oi.OnPush=0]="OnPush",oi[oi.Default=1]="Default",oi))(),Li=(()=>(function(t){t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom"}(Li||(Li={})),Li))();const co="undefined"!=typeof globalThis&&globalThis,Fs="undefined"!=typeof window&&window,ms="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Nn=co||"undefined"!=typeof global&&global||Fs||ms,Se={},Ze=[],yt=Qn({\u0275cmp:Qn}),Pn=Qn({\u0275dir:Qn}),Yn=Qn({\u0275pipe:Qn}),Yr=Qn({\u0275mod:Qn}),yr=Qn({\u0275fac:Qn}),Cr=Qn({__NG_ELEMENT_ID__:Qn});let bo=0;function Mr(t){return wr(()=>{const n={},i={type:t.type,providersResolver:null,decls:t.decls,vars:t.vars,factory:null,template:t.template||null,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,inputs:null,outputs:null,exportAs:t.exportAs||null,onPush:t.changeDetection===oi.OnPush,directiveDefs:null,pipeDefs:null,selectors:t.selectors||Ze,viewQuery:t.viewQuery||null,features:t.features||null,data:t.data||{},encapsulation:t.encapsulation||Li.Emulated,id:"c",styles:t.styles||Ze,_:null,setInput:null,schemas:t.schemas||null,tView:null},c=t.directives,p=t.features,v=t.pipes;return i.id+=bo++,i.inputs=Yo(t.inputs,n),i.outputs=Yo(t.outputs),p&&p.forEach(C=>C(i)),i.directiveDefs=c?()=>("function"==typeof c?c():c).map(ci):null,i.pipeDefs=v?()=>("function"==typeof v?v():v).map(Ml):null,i})}function ci(t){return vr(t)||function ji(t){return t[Pn]||null}(t)}function Ml(t){return function pe(t){return t[Yn]||null}(t)}const Ns={};function qr(t){return wr(()=>{const e={type:t.type,bootstrap:t.bootstrap||Ze,declarations:t.declarations||Ze,imports:t.imports||Ze,exports:t.exports||Ze,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null};return null!=t.id&&(Ns[t.id]=t.type),e})}function Yo(t,e){if(null==t)return Se;const n={};for(const i in t)if(t.hasOwnProperty(i)){let c=t[i],p=c;Array.isArray(c)&&(p=c[1],c=c[0]),n[c]=i,e&&(e[c]=p)}return n}const yn=Mr;function vr(t){return t[yt]||null}function Ne(t,e){const n=t[Yr]||null;if(!n&&!0===e)throw new Error(`Type ${nr(t)} does not have '\u0275mod' property.`);return n}function Fo(t){return Array.isArray(t)&&"object"==typeof t[1]}function Eo(t){return Array.isArray(t)&&!0===t[1]}function Il(t){return 0!=(8&t.flags)}function lc(t){return 2==(2&t.flags)}function cc(t){return 1==(1&t.flags)}function Ji(t){return null!==t.template}function Wf(t){return 0!=(512&t[2])}function Wa(t,e){return t.hasOwnProperty(yr)?t[yr]:null}class Qf{constructor(e,n,i){this.previousValue=e,this.currentValue=n,this.firstChange=i}isFirstChange(){return this.firstChange}}function Qi(){return ih}function ih(t){return t.type.prototype.ngOnChanges&&(t.setInput=kl),ou}function ou(){const t=su(this),e=null==t?void 0:t.current;if(e){const n=t.previous;if(n===Se)t.previous=e;else for(let i in e)n[i]=e[i];t.current=null,this.ngOnChanges(e)}}function kl(t,e,n,i){const c=su(t)||function oh(t,e){return t[Rl]=e}(t,{previous:Se,current:null}),p=c.current||(c.current={}),v=c.previous,C=this.declaredInputs[n],S=v[C];p[C]=new Qf(S&&S.currentValue,e,v===Se),t[i]=e}Qi.ngInherit=!0;const Rl="__ngSimpleChanges__";function su(t){return t[Rl]||null}let Da;function kr(t){return!!t.listen}const cu={createRenderer:(t,e)=>function Ka(){return void 0!==Da?Da:"undefined"!=typeof document?document:void 0}()};function jr(t){for(;Array.isArray(t);)t=t[0];return t}function Ja(t,e){return jr(e[t])}function eo(t,e){return jr(e[t.index])}function dc(t,e){return t.data[e]}function $i(t,e){const n=e[t];return Fo(n)?n:n[0]}function ra(t){return 4==(4&t[2])}function fc(t){return 128==(128&t[2])}function gs(t,e){return null==e?null:t[e]}function uu(t){t[18]=0}function hu(t,e){t[5]+=e;let n=t,i=t[3];for(;null!==i&&(1===e&&1===n[5]||-1===e&&0===n[5]);)i[5]+=e,n=i,i=i[3]}const En={lFrame:ph(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function ah(){return En.bindingsEnabled}function pt(){return En.lFrame.lView}function or(){return En.lFrame.tView}function Di(){let t=js();for(;null!==t&&64===t.type;)t=t.parent;return t}function js(){return En.lFrame.currentTNode}function Gi(t,e){const n=En.lFrame;n.currentTNode=t,n.isParent=e}function Qo(){return En.lFrame.isParent}function Qa(){return En.isInCheckNoChangesMode}function Ma(t){En.isInCheckNoChangesMode=t}function oa(){return En.lFrame.bindingIndex++}function No(t){const e=En.lFrame,n=e.bindingIndex;return e.bindingIndex=e.bindingIndex+t,n}function hh(t,e){const n=En.lFrame;n.bindingIndex=n.bindingRootIndex=t,el(e)}function el(t){En.lFrame.currentDirectiveIndex=t}function dh(){return En.lFrame.currentQueryIndex}function fu(t){En.lFrame.currentQueryIndex=t}function Od(t){const e=t[1];return 2===e.type?e.declTNode:1===e.type?t[6]:null}function pu(t,e,n){if(n&wn.SkipSelf){let c=e,p=t;for(;!(c=c.parent,null!==c||n&wn.Host||(c=Od(p),null===c||(p=p[15],10&c.type))););if(null===c)return!1;e=c,t=p}const i=En.lFrame=fh();return i.currentTNode=e,i.lView=t,!0}function mc(t){const e=fh(),n=t[1];En.lFrame=e,e.currentTNode=n.firstChild,e.lView=t,e.tView=n,e.contextLView=t,e.bindingIndex=n.bindingStartIndex,e.inI18n=!1}function fh(){const t=En.lFrame,e=null===t?null:t.child;return null===e?ph(t):e}function ph(t){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=e),e}function mu(){const t=En.lFrame;return En.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const mh=mu;function gc(){const t=mu();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function Hi(){return En.lFrame.selectedIndex}function sa(t){En.lFrame.selectedIndex=t}function $r(){const t=En.lFrame;return dc(t.tView,t.selectedIndex)}function tl(t,e){for(let n=e.directiveStart,i=e.directiveEnd;n<i;n++){const p=t.data[n].type.prototype,{ngAfterContentInit:v,ngAfterContentChecked:C,ngAfterViewInit:S,ngAfterViewChecked:R,ngOnDestroy:z}=p;v&&(t.contentHooks||(t.contentHooks=[])).push(-n,v),C&&((t.contentHooks||(t.contentHooks=[])).push(n,C),(t.contentCheckHooks||(t.contentCheckHooks=[])).push(n,C)),S&&(t.viewHooks||(t.viewHooks=[])).push(-n,S),R&&((t.viewHooks||(t.viewHooks=[])).push(n,R),(t.viewCheckHooks||(t.viewCheckHooks=[])).push(n,R)),null!=z&&(t.destroyHooks||(t.destroyHooks=[])).push(n,z)}}function nl(t,e,n){Bd(t,e,3,n)}function rl(t,e,n,i){(3&t[2])===n&&Bd(t,e,n,i)}function _h(t,e){let n=t[2];(3&n)===e&&(n&=2047,n+=1,t[2]=n)}function Bd(t,e,n,i){const p=null!=i?i:-1,v=e.length-1;let C=0;for(let S=void 0!==i?65535&t[18]:0;S<v;S++)if("number"==typeof e[S+1]){if(C=e[S],null!=i&&C>=i)break}else e[S]<0&&(t[18]+=65536),(C<p||-1==p)&&(yh(t,n,e,S),t[18]=(4294901760&t[18])+S+2),S++}function yh(t,e,n,i){const c=n[i]<0,p=n[i+1],C=t[c?-n[i]:n[i]];if(c){if(t[2]>>11<t[18]>>16&&(3&t[2])===e){t[2]+=2048;try{p.call(C)}finally{}}}else try{p.call(C)}finally{}}class il{constructor(e,n,i){this.factory=e,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=i}}function fo(t,e,n){const i=kr(t);let c=0;for(;c<n.length;){const p=n[c];if("number"==typeof p){if(0!==p)break;c++;const v=n[c++],C=n[c++],S=n[c++];i?t.setAttribute(e,C,S,v):e.setAttributeNS(v,C,S)}else{const v=p,C=n[++c];al(v)?i&&t.setProperty(e,v,C):i?t.setAttribute(e,v,C):e.setAttribute(v,C),c++}}return c}function Rr(t){return 3===t||4===t||6===t}function al(t){return 64===t.charCodeAt(0)}function aa(t,e){if(null!==e&&0!==e.length)if(null===t||0===t.length)t=e.slice();else{let n=-1;for(let i=0;i<e.length;i++){const c=e[i];"number"==typeof c?n=c:0===n||m(t,n,c,null,-1===n||2===n?e[++i]:null)}}return t}function m(t,e,n,i,c){let p=0,v=t.length;if(-1===e)v=-1;else for(;p<t.length;){const C=t[p++];if("number"==typeof C){if(C===e){v=-1;break}if(C>e){v=p-1;break}}}for(;p<t.length;){const C=t[p];if("number"==typeof C)break;if(C===n){if(null===i)return void(null!==c&&(t[p+1]=c));if(i===t[p+1])return void(t[p+2]=c)}p++,null!==i&&p++,null!==c&&p++}-1!==v&&(t.splice(v,0,e),p=v+1),t.splice(p++,0,n),null!==i&&t.splice(p++,0,i),null!==c&&t.splice(p++,0,c)}function o(t){return-1!==t}function d(t){return 32767&t}function b(t,e){let n=function _(t){return t>>16}(t),i=e;for(;n>0;)i=i[15],n--;return i}let w=!0;function T(t){const e=w;return w=t,e}let L=0;function H(t,e){const n=X(t,e);if(-1!==n)return n;const i=e[1];i.firstCreatePass&&(t.injectorIndex=e.length,te(i.data,t),te(e,null),te(i.blueprint,null));const c=G(t,e),p=t.injectorIndex;if(o(c)){const v=d(c),C=b(c,e),S=C[1].data;for(let R=0;R<8;R++)e[p+R]=C[v+R]|S[v+R]}return e[p+8]=c,p}function te(t,e){t.push(0,0,0,0,0,0,0,0,e)}function X(t,e){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===e[t.injectorIndex+8]?-1:t.injectorIndex}function G(t,e){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let n=0,i=null,c=e;for(;null!==c;){const p=c[1],v=p.type;if(i=2===v?p.declTNode:1===v?c[6]:null,null===i)return-1;if(n++,c=c[15],-1!==i.injectorIndex)return i.injectorIndex|n<<16}return-1}function _e(t,e,n){!function B(t,e,n){let i;"string"==typeof n?i=n.charCodeAt(0)||0:n.hasOwnProperty(Cr)&&(i=n[Cr]),null==i&&(i=n[Cr]=L++);const c=255&i;e.data[t+(c>>5)]|=1<<c}(t,e,n)}function fe(t,e,n){if(n&wn.Optional)return t;It(e,"NodeInjector")}function ye(t,e,n,i){if(n&wn.Optional&&void 0===i&&(i=null),0==(n&(wn.Self|wn.Host))){const c=t[9],p=Pr(void 0);try{return c?c.get(e,i,n&wn.Optional):gi(e,i,n&wn.Optional)}finally{Pr(p)}}return fe(i,e,n)}function xe(t,e,n,i=wn.Default,c){if(null!==t){const p=function Je(t){if("string"==typeof t)return t.charCodeAt(0)||0;const e=t.hasOwnProperty(Cr)?t[Cr]:void 0;return"number"==typeof e?e>=0?255&e:Te:e}(n);if("function"==typeof p){if(!pu(e,t,i))return i&wn.Host?fe(c,n,i):ye(e,n,i,c);try{const v=p(i);if(null!=v||i&wn.Optional)return v;It(n)}finally{mh()}}else if("number"==typeof p){let v=null,C=X(t,e),S=-1,R=i&wn.Host?e[16][6]:null;for((-1===C||i&wn.SkipSelf)&&(S=-1===C?G(t,e):e[C+8],-1!==S&&Ve(i,!1)?(v=e[1],C=d(S),e=b(S,e)):C=-1);-1!==C;){const z=e[1];if(Dt(p,C,z.data)){const q=Ue(C,e,n,v,i,R);if(q!==he)return q}S=e[C+8],-1!==S&&Ve(i,e[1].data[C+8]===R)&&Dt(p,C,e)?(v=z,C=d(S),e=b(S,e)):C=-1}}}return ye(e,n,i,c)}const he={};function Te(){return new vt(Di(),pt())}function Ue(t,e,n,i,c,p){const v=e[1],C=v.data[t+8],z=We(C,v,n,null==i?lc(C)&&w:i!=v&&0!=(3&C.type),c&wn.Host&&p===C);return null!==z?et(e,v,z,C):he}function We(t,e,n,i,c){const p=t.providerIndexes,v=e.data,C=1048575&p,S=t.directiveStart,z=p>>20,me=c?C+z:t.directiveEnd;for(let be=i?C:C+z;be<me;be++){const Ge=v[be];if(be<S&&n===Ge||be>=S&&Ge.type===n)return be}if(c){const be=v[S];if(be&&Ji(be)&&be.type===n)return S}return null}function et(t,e,n,i){let c=t[n];const p=e.data;if(function vh(t){return t instanceof il}(c)){const v=c;v.resolving&&function ke(t,e){const n=e?`. Dependency path: ${e.join(" > ")} > ${t}`:"";throw new se(-200,`Circular dependency in DI detected for ${t}${n}`)}(Oe(p[n]));const C=T(v.canSeeViewProviders);v.resolving=!0;const S=v.injectImpl?Pr(v.injectImpl):null;pu(t,i,wn.Default);try{c=t[n]=v.factory(void 0,p,t,i),e.firstCreatePass&&n>=i.directiveStart&&function zd(t,e,n){const{ngOnChanges:i,ngOnInit:c,ngDoCheck:p}=e.type.prototype;if(i){const v=ih(e);(n.preOrderHooks||(n.preOrderHooks=[])).push(t,v),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t,v)}c&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-t,c),p&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t,p),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t,p))}(n,p[n],e)}finally{null!==S&&Pr(S),T(C),v.resolving=!1,mh()}}return c}function Dt(t,e,n){return!!(n[e+(t>>5)]&1<<t)}function Ve(t,e){return!(t&wn.Self||t&wn.Host&&e)}class vt{constructor(e,n){this._tNode=e,this._lView=n}get(e,n,i){return xe(this._tNode,this._lView,e,i,n)}}function qt(t){return j(t)?()=>{const e=qt(N(t));return e&&e()}:Wa(t)}function Ke(t){return function ae(t,e){if("class"===e)return t.classes;if("style"===e)return t.styles;const n=t.attrs;if(n){const i=n.length;let c=0;for(;c<i;){const p=n[c];if(Rr(p))break;if(0===p)c+=2;else if("number"==typeof p)for(c++;c<i&&"string"==typeof n[c];)c++;else{if(p===e)return n[c+1];c+=2}}}return null}(Di(),t)}const en="__parameters__";function Tn(t,e,n){return wr(()=>{const i=function ln(t){return function(...n){if(t){const i=t(...n);for(const c in i)this[c]=i[c]}}}(e);function c(...p){if(this instanceof c)return i.apply(this,p),this;const v=new c(...p);return C.annotation=v,C;function C(S,R,z){const q=S.hasOwnProperty(en)?S[en]:Object.defineProperty(S,en,{value:[]})[en];for(;q.length<=z;)q.push(null);return(q[z]=q[z]||[]).push(v),S}}return n&&(c.prototype=Object.create(n.prototype)),c.prototype.ngMetadataName=t,c.annotationCls=c,c})}class Xt{constructor(e,n){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=gn({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}toString(){return`InjectionToken ${this._desc}`}}const ii=new Xt("AnalyzeForEntryComponents");function ai(t,e){void 0===e&&(e=t);for(let n=0;n<t.length;n++){let i=t[n];Array.isArray(i)?(e===t&&(e=t.slice(0,n)),ai(i,e)):e!==t&&e.push(i)}return e}function To(t,e){t.forEach(n=>Array.isArray(n)?To(n,e):e(n))}function Do(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function Gs(t,e){return e>=t.length-1?t.pop():t.splice(e,1)[0]}function rs(t,e,n){let i=ul(t,e);return i>=0?t[1|i]=n:(i=~i,function np(t,e,n,i){let c=t.length;if(c==e)t.push(n,i);else if(1===c)t.push(i,t[0]),t[0]=n;else{for(c--,t.push(t[c-1],t[c]);c>e;)t[c]=t[c-2],c--;t[e]=n,t[e+1]=i}}(t,i,e,n)),i}function Eh(t,e){const n=ul(t,e);if(n>=0)return t[1|n]}function ul(t,e){return function Ch(t,e,n){let i=0,c=t.length>>n;for(;c!==i;){const p=i+(c-i>>1),v=t[p<<n];if(e===v)return p<<n;v>e?c=p:i=p+1}return~(c<<n)}(t,e,1)}const Bo={},Aa="__NG_DI_FLAG__",la="ngTempTokenPath",Ly=/\n/gm,eg="__source",Ny=Qn({provide:String,useValue:Qn});let vu;function Th(t){const e=vu;return vu=t,e}function ca(t,e=wn.Default){if(void 0===vu)throw new se(203,"");return null===vu?gi(t,void 0,e):vu.get(t,e&wn.Optional?null:void 0,e)}function dn(t,e=wn.Default){return(function Kr(){return Oo}()||ca)(N(t),e)}const li=dn;function In(t){const e=[];for(let n=0;n<t.length;n++){const i=N(t[n]);if(Array.isArray(i)){if(0===i.length)throw new se(900,"");let c,p=wn.Default;for(let v=0;v<i.length;v++){const C=i[v],S=rp(C);"number"==typeof S?-1===S?c=C.token:p|=S:c=C}e.push(dn(c,p))}else e.push(dn(i))}return e}function Hs(t,e){return t[Aa]=e,t.prototype[Aa]=e,t}function rp(t){return t[Aa]}const xu=Hs(Tn("Inject",t=>({token:t})),-1),qs=Hs(Tn("Optional"),8),Pa=Hs(Tn("SkipSelf"),4);class Ih{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function Si(t){return t instanceof Ih?t.changingThisBreaksApplicationSecurity:t}const Ah=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,fg=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var Mi=(()=>((Mi=Mi||{})[Mi.NONE=0]="NONE",Mi[Mi.HTML=1]="HTML",Mi[Mi.STYLE=2]="STYLE",Mi[Mi.SCRIPT=3]="SCRIPT",Mi[Mi.URL=4]="URL",Mi[Mi.RESOURCE_URL=5]="RESOURCE_URL",Mi))();function Rh(t){const e=function Oh(){const t=pt();return t&&t[12]}();return e?e.sanitize(Mi.URL,t)||"":function wu(t,e){const n=function ka(t){return t instanceof Ih&&t.getTypeName()||null}(t);if(null!=n&&n!==e){if("ResourceURL"===n&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${n} (see https://g.co/ng/security#xss)`)}return n===e}(t,"URL")?Si(t):function Ph(t){return(t=String(t)).match(Ah)||t.match(fg)?t:"unsafe:"+t}(Me(t))}const Su="__ngContext__";function So(t,e){t[Su]=e}function vp(t){const e=function Lh(t){return t[Su]||null}(t);return e?Array.isArray(e)?e:e.lView:null}function Iu(t){return t.ngOriginalError}function bg(t,...e){t.error(...e)}class Au{constructor(){this._console=console}handleError(e){const n=this._findOriginalError(e),i=function Fh(t){return t&&t.ngErrorLogger||bg}(e);i(this._console,"ERROR",e),n&&i(this._console,"ORIGINAL ERROR",n)}_findOriginalError(e){let n=e&&Iu(e);for(;n&&Iu(n);)n=Iu(n);return n||null}}const Cp=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Nn))();function Oa(t){return t instanceof Function?t():t}var xs=(()=>((xs=xs||{})[xs.Important=1]="Important",xs[xs.DashCase=2]="DashCase",xs))();function Yd(t,e){return undefined(t,e)}function Bh(t){const e=t[3];return Eo(e)?e[3]:e}function Sp(t){return Ru(t[13])}function Mp(t){return Ru(t[4])}function Ru(t){for(;null!==t&&!Eo(t);)t=t[4];return t}function Dc(t,e,n,i,c){if(null!=i){let p,v=!1;Eo(i)?p=i:Fo(i)&&(v=!0,i=i[0]);const C=jr(i);0===t&&null!==n?null==c?Pg(e,n,C):Ic(e,n,C,c||null,!0):1===t&&null!==n?Ic(e,n,C,c||null,!0):2===t?function Rg(t,e,n){const i=Uh(t,e);i&&function pv(t,e,n,i){kr(t)?t.removeChild(e,n,i):e.removeChild(n)}(t,i,e,n)}(e,C,v):3===t&&e.destroyNode(C),null!=p&&function Rp(t,e,n,i,c){const p=n[7];p!==jr(n)&&Dc(e,t,i,p,c);for(let C=10;C<n.length;C++){const S=n[C];Nu(S[1],S,t,e,i,p)}}(e,t,p,n,c)}}function Mc(t,e,n){if(kr(t))return t.createElement(e,n);{const i=null!==n?function Dd(t){const e=t.toLowerCase();return"svg"===e?"http://www.w3.org/2000/svg":"math"===e?"http://www.w3.org/1998/MathML/":null}(n):null;return null===i?t.createElement(e):t.createElementNS(i,e)}}function Mg(t,e){const n=t[9],i=n.indexOf(e),c=e[3];1024&e[2]&&(e[2]&=-1025,hu(c,-1)),n.splice(i,1)}function Ip(t,e){if(t.length<=10)return;const n=10+e,i=t[n];if(i){const c=i[17];null!==c&&c!==t&&Mg(c,i),e>0&&(t[n-1][4]=i[4]);const p=Gs(t,10+e);!function Dg(t,e){Nu(t,e,e[11],2,null,null),e[0]=null,e[6]=null}(i[1],i);const v=p[19];null!==v&&v.detachView(p[1]),i[3]=null,i[4]=null,i[2]&=-129}return i}function Ig(t,e){if(!(256&e[2])){const n=e[11];kr(n)&&n.destroyNode&&Nu(t,e,n,3,null,null),function uv(t){let e=t[13];if(!e)return Ou(t[1],t);for(;e;){let n=null;if(Fo(e))n=e[13];else{const i=e[10];i&&(n=i)}if(!n){for(;e&&!e[4]&&e!==t;)Fo(e)&&Ou(e[1],e),e=e[3];null===e&&(e=t),Fo(e)&&Ou(e[1],e),n=e&&e[4]}e=n}}(e)}}function Ou(t,e){if(!(256&e[2])){e[2]&=-129,e[2]|=256,function Ag(t,e){let n;if(null!=t&&null!=(n=t.destroyHooks))for(let i=0;i<n.length;i+=2){const c=e[n[i]];if(!(c instanceof il)){const p=n[i+1];if(Array.isArray(p))for(let v=0;v<p.length;v+=2){const C=c[p[v]],S=p[v+1];try{S.call(C)}finally{}}else try{p.call(c)}finally{}}}}(t,e),function fv(t,e){const n=t.cleanup,i=e[7];let c=-1;if(null!==n)for(let p=0;p<n.length-1;p+=2)if("string"==typeof n[p]){const v=n[p+1],C="function"==typeof v?v(e):jr(e[v]),S=i[c=n[p+2]],R=n[p+3];"boolean"==typeof R?C.removeEventListener(n[p],S,R):R>=0?i[c=R]():i[c=-R].unsubscribe(),p+=2}else{const v=i[c=n[p+1]];n[p].call(v)}if(null!==i){for(let p=c+1;p<i.length;p++)i[p]();e[7]=null}}(t,e),1===e[1].type&&kr(e[11])&&e[11].destroy();const n=e[17];if(null!==n&&Eo(e[3])){n!==e[3]&&Mg(n,e);const i=e[19];null!==i&&i.detachView(t)}}}function Ap(t,e,n){return function Pp(t,e,n){let i=e;for(;null!==i&&40&i.type;)i=(e=i).parent;if(null===i)return n[0];if(2&i.flags){const c=t.data[i.directiveStart].encapsulation;if(c===Li.None||c===Li.Emulated)return null}return eo(i,n)}(t,e.parent,n)}function Ic(t,e,n,i,c){kr(t)?t.insertBefore(e,n,i,c):e.insertBefore(n,i,c)}function Pg(t,e,n){kr(t)?t.appendChild(e,n):e.appendChild(n)}function kg(t,e,n,i,c){null!==i?Ic(t,e,n,i,c):Pg(t,e,n)}function Uh(t,e){return kr(t)?t.parentNode(e):e.parentNode}let Qd=function ua(t,e,n){return 40&t.type?eo(t,n):null};function ef(t,e,n,i){const c=Ap(t,i,e),p=e[11],C=function Wi(t,e,n){return Qd(t,e,n)}(i.parent||e[6],i,e);if(null!=c)if(Array.isArray(n))for(let S=0;S<n.length;S++)kg(p,c,n[S],C,!1);else kg(p,c,n,C,!1)}function tf(t,e){if(null!==e){const n=e.type;if(3&n)return eo(e,t);if(4&n)return kp(-1,t[e.index]);if(8&n){const i=e.child;if(null!==i)return tf(t,i);{const c=t[e.index];return Eo(c)?kp(-1,c):jr(c)}}if(32&n)return Yd(e,t)()||jr(t[e.index]);{const i=Fu(t,e);return null!==i?Array.isArray(i)?i[0]:tf(Bh(t[16]),i):tf(t,e.next)}}return null}function Fu(t,e){return null!==e?t[16][6].projection[e.projection]:null}function kp(t,e){const n=10+t+1;if(n<e.length){const i=e[n],c=i[1].firstChild;if(null!==c)return tf(i,c)}return e[7]}function nf(t,e,n,i,c,p,v){for(;null!=n;){const C=i[n.index],S=n.type;if(v&&0===e&&(C&&So(jr(C),i),n.flags|=4),64!=(64&n.flags))if(8&S)nf(t,e,n.child,i,c,p,!1),Dc(e,t,c,C,p);else if(32&S){const R=Yd(n,i);let z;for(;z=R();)Dc(e,t,c,z,p);Dc(e,t,c,C,p)}else 16&S?Ar(t,e,i,n,c,p):Dc(e,t,c,C,p);n=v?n.projectionNext:n.next}}function Nu(t,e,n,i,c,p){nf(n,i,t.firstChild,e,c,p,!1)}function Ar(t,e,n,i,c,p){const v=n[16],S=v[6].projection[i.projection];if(Array.isArray(S))for(let R=0;R<S.length;R++)Dc(e,t,c,S[R],p);else nf(t,e,S,v[3],c,p,!0)}function Op(t,e,n){kr(t)?t.setAttribute(e,"style",n):e.style.cssText=n}function ha(t,e,n){kr(t)?""===n?t.removeAttribute(e,"class"):t.setAttribute(e,"class",n):e.className=n}function Pc(t,e,n){let i=t.length;for(;;){const c=t.indexOf(e,n);if(-1===c)return c;if(0===c||t.charCodeAt(c-1)<=32){const p=e.length;if(c+p===i||t.charCodeAt(c+p)<=32)return c}n=c+1}}const Lg="ng-template";function _v(t,e,n){let i=0;for(;i<t.length;){let c=t[i++];if(n&&"class"===c){if(c=t[i],-1!==Pc(c.toLowerCase(),e,0))return!0}else if(1===c){for(;i<t.length&&"string"==typeof(c=t[i++]);)if(c.toLowerCase()===e)return!0;return!1}}return!1}function Fg(t){return 4===t.type&&t.value!==Lg}function yv(t,e,n){return e===(4!==t.type||n?t.value:Lg)}function vv(t,e,n){let i=4;const c=t.attrs||[],p=function rf(t){for(let e=0;e<t.length;e++)if(Rr(t[e]))return e;return t.length}(c);let v=!1;for(let C=0;C<e.length;C++){const S=e[C];if("number"!=typeof S){if(!v)if(4&i){if(i=2|1&i,""!==S&&!yv(t,S,n)||""===S&&1===e.length){if(da(i))return!1;v=!0}}else{const R=8&i?S:e[++C];if(8&i&&null!==t.attrs){if(!_v(t.attrs,R,n)){if(da(i))return!1;v=!0}continue}const q=xv(8&i?"class":S,c,Fg(t),n);if(-1===q){if(da(i))return!1;v=!0;continue}if(""!==R){let me;me=q>p?"":c[q+1].toLowerCase();const be=8&i?me:null;if(be&&-1!==Pc(be,R,0)||2&i&&R!==me){if(da(i))return!1;v=!0}}}}else{if(!v&&!da(i)&&!da(S))return!1;if(v&&da(S))continue;v=!1,i=S|1&i}}return da(i)||v}function da(t){return 0==(1&t)}function xv(t,e,n,i){if(null===e)return-1;let c=0;if(i||!n){let p=!1;for(;c<e.length;){const v=e[c];if(v===t)return c;if(3===v||6===v)p=!0;else{if(1===v||2===v){let C=e[++c];for(;"string"==typeof C;)C=e[++c];continue}if(4===v)break;if(0===v){c+=4;continue}}c+=p?1:2}return-1}return function zu(t,e){let n=t.indexOf(4);if(n>-1)for(n++;n<t.length;){const i=t[n];if("number"==typeof i)return-1;if(i===e)return n;n++}return-1}(e,t)}function Ng(t,e,n=!1){for(let i=0;i<e.length;i++)if(vv(t,e[i],n))return!0;return!1}function Bg(t,e){return t?":not("+e.trim()+")":e}function wv(t){let e=t[0],n=1,i=2,c="",p=!1;for(;n<t.length;){let v=t[n];if("string"==typeof v)if(2&i){const C=t[++n];c+="["+v+(C.length>0?'="'+C+'"':"")+"]"}else 8&i?c+="."+v:4&i&&(c+=" "+v);else""!==c&&!da(v)&&(e+=Bg(p,c),c=""),i=v,p=p||!da(i);n++}return""!==c&&(e+=Bg(p,c)),e}const Gn={};function fa(t){os(or(),pt(),Hi()+t,Qa())}function os(t,e,n,i){if(!i)if(3==(3&e[2])){const p=t.preOrderCheckHooks;null!==p&&nl(e,p,n)}else{const p=t.preOrderHooks;null!==p&&rl(e,p,0,n)}sa(n)}function pl(t,e){return t<<17|e<<2}function bs(t){return t>>17&32767}function of(t){return 2|t}function La(t){return(131068&t)>>2}function Fp(t,e){return-131069&t|e<<2}function sf(t){return 1|t}function qh(t,e){const n=t.contentQueries;if(null!==n)for(let i=0;i<n.length;i+=2){const c=n[i],p=n[i+1];if(-1!==p){const v=t.data[p];fu(c),v.contentQueries(2,e[p],p)}}}function Rc(t,e,n,i,c,p,v,C,S,R){const z=e.blueprint.slice();return z[0]=c,z[2]=140|i,uu(z),z[3]=z[15]=t,z[8]=n,z[10]=v||t&&t[10],z[11]=C||t&&t[11],z[12]=S||t&&t[12]||null,z[9]=R||t&&t[9]||null,z[6]=p,z[16]=2==e.type?t[16]:z,z}function Wl(t,e,n,i,c){let p=t.data[e];if(null===p)p=function Fa(t,e,n,i,c){const p=js(),v=Qo(),S=t.data[e]=function Lv(t,e,n,i,c,p){return{type:n,index:i,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:c,attrs:p,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,v?p:p&&p.parent,n,e,i,c);return null===t.firstChild&&(t.firstChild=S),null!==p&&(v?null==p.child&&null!==S.parent&&(p.child=S):null===p.next&&(p.next=S)),S}(t,e,n,i,c),function ch(){return En.lFrame.inI18n}()&&(p.flags|=64);else if(64&p.type){p.type=n,p.value=i,p.attrs=c;const v=function Ol(){const t=En.lFrame,e=t.currentTNode;return t.isParent?e:e.parent}();p.injectorIndex=null===v?-1:v.injectorIndex}return Gi(p,!0),p}function Uu(t,e,n,i){if(0===n)return-1;const c=e.length;for(let p=0;p<n;p++)e.push(i),t.blueprint.push(i),t.data.push(null);return c}function Oc(t,e,n){mc(e);try{const i=t.viewQuery;null!==i&&Tf(1,i,n);const c=t.template;null!==c&&Zg(t,e,c,1,n),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&qh(t,e),t.staticViewQueries&&Tf(2,t.viewQuery,n);const p=t.components;null!==p&&function Ov(t,e){for(let n=0;n<e.length;n++)Na(t,e[n])}(e,p)}catch(i){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),i}finally{e[2]&=-5,gc()}}function Lc(t,e,n,i){const c=e[2];if(256==(256&c))return;mc(e);const p=Qa();try{uu(e),function lh(t){return En.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==n&&Zg(t,e,n,2,i);const v=3==(3&c);if(!p)if(v){const R=t.preOrderCheckHooks;null!==R&&nl(e,R,null)}else{const R=t.preOrderHooks;null!==R&&rl(e,R,0,null),_h(e,0)}if(function zv(t){for(let e=Sp(t);null!==e;e=Mp(e)){if(!e[2])continue;const n=e[9];for(let i=0;i<n.length;i++){const c=n[i],p=c[3];0==(1024&c[2])&&hu(p,1),c[2]|=1024}}}(e),function o_(t){for(let e=Sp(t);null!==e;e=Mp(e))for(let n=10;n<e.length;n++){const i=e[n],c=i[1];fc(i)&&Lc(c,i,c.template,i[8])}}(e),null!==t.contentQueries&&qh(t,e),!p)if(v){const R=t.contentCheckHooks;null!==R&&nl(e,R)}else{const R=t.contentHooks;null!==R&&rl(e,R,1),_h(e,1)}!function Rv(t,e){const n=t.hostBindingOpCodes;if(null!==n)try{for(let i=0;i<n.length;i++){const c=n[i];if(c<0)sa(~c);else{const p=c,v=n[++i],C=n[++i];hh(v,p),C(2,e[p])}}}finally{sa(-1)}}(t,e);const C=t.components;null!==C&&function $p(t,e){for(let n=0;n<e.length;n++)s_(t,e[n])}(e,C);const S=t.viewQuery;if(null!==S&&Tf(2,S,i),!p)if(v){const R=t.viewCheckHooks;null!==R&&nl(e,R)}else{const R=t.viewHooks;null!==R&&rl(e,R,2),_h(e,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),p||(e[2]&=-73),1024&e[2]&&(e[2]&=-1025,hu(e[3],-1))}finally{gc()}}function _f(t,e,n,i){const c=e[10],p=!Qa(),v=ra(e);try{p&&!v&&c.begin&&c.begin(),v&&Oc(t,e,i),Lc(t,e,n,i)}finally{p&&!v&&c.end&&c.end()}}function Zg(t,e,n,i,c){const p=Hi(),v=2&i;try{sa(-1),v&&e.length>20&&os(t,e,20,Qa()),n(i,c)}finally{sa(p)}}function yf(t){const e=t.tView;return null===e||e.incompleteFirstPass?t.tView=vf(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):e}function vf(t,e,n,i,c,p,v,C,S,R){const z=20+i,q=z+c,me=function Zh(t,e){const n=[];for(let i=0;i<e;i++)n.push(i<t?null:Gn);return n}(z,q),be="function"==typeof R?R():R;return me[1]={type:t,blueprint:me,template:n,queries:null,viewQuery:C,declTNode:e,data:me.slice().fill(null,z),bindingStartIndex:z,expandoStartIndex:q,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof p?p():p,pipeRegistry:"function"==typeof v?v():v,firstChild:null,schemas:S,consts:be,incompleteFirstPass:!1}}function qp(t,e,n,i){const c=tm(e);null===n?c.push(i):(c.push(n),t.firstCreatePass&&nm(t).push(i,c.length-1))}function Kg(t,e,n){for(let i in t)if(t.hasOwnProperty(i)){const c=t[i];(n=null===n?{}:n).hasOwnProperty(i)?n[i].push(e,c):n[i]=[e,c]}return n}function Qg(t,e,n,i,c,p){const v=p.hostBindings;if(v){let C=t.hostBindingOpCodes;null===C&&(C=t.hostBindingOpCodes=[]);const S=~e.index;(function Wp(t){let e=t.length;for(;e>0;){const n=t[--e];if("number"==typeof n&&n<0)return n}return 0})(C)!=S&&C.push(S),C.push(i,c,v)}}function Xp(t,e){null!==t.hostBindings&&t.hostBindings(1,e)}function Yp(t,e){e.flags|=2,(t.components||(t.components=[])).push(e.index)}function n_(t,e,n){if(n){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)n[e.exportAs[i]]=t;Ji(e)&&(n[""]=t)}}function Jp(t,e,n){t.flags|=1,t.directiveStart=e,t.directiveEnd=e+n,t.providerIndexes=e}function r_(t,e,n,i,c){t.data[i]=c;const p=c.factory||(c.factory=Wa(c.type)),v=new il(p,Ji(c),null);t.blueprint[i]=v,n[i]=v,Qg(t,e,0,i,Uu(t,n,c.hostVars,Gn),c)}function Nv(t,e,n){const i=eo(e,t),c=yf(n),p=t[10],v=Cs(t,Rc(t,c,null,n.onPush?64:16,i,e,p,p.createRenderer(i,n),null,null));t[e.index]=v}function ga(t,e,n,i,c,p){const v=eo(t,e);!function $u(t,e,n,i,c,p,v){if(null==p)kr(t)?t.removeAttribute(e,c,n):e.removeAttribute(c);else{const C=null==v?Me(p):v(p,i||"",c);kr(t)?t.setAttribute(e,c,C,n):n?e.setAttributeNS(n,c,C):e.setAttribute(c,C)}}(e[11],v,p,t.value,n,i,c)}function i_(t,e,n,i,c,p){const v=p[e];if(null!==v){const C=i.setInput;for(let S=0;S<v.length;){const R=v[S++],z=v[S++],q=v[S++];null!==C?i.setInput(n,q,R,z):n[z]=q}}}function Mo(t,e){let n=null,i=0;for(;i<e.length;){const c=e[i];if(0!==c)if(5!==c){if("number"==typeof c)break;t.hasOwnProperty(c)&&(null===n&&(n=[]),n.push(c,t[c],e[i+1])),i+=2}else i+=2;else i+=4}return n}function s_(t,e){const n=$i(e,t);if(fc(n)){const i=n[1];80&n[2]?Lc(i,n,i.template,n[8]):n[5]>0&&as(n)}}function as(t){for(let i=Sp(t);null!==i;i=Mp(i))for(let c=10;c<i.length;c++){const p=i[c];if(1024&p[2]){const v=p[1];Lc(v,p,v.template,p[8])}else p[5]>0&&as(p)}const n=t[1].components;if(null!==n)for(let i=0;i<n.length;i++){const c=$i(n[i],t);fc(c)&&c[5]>0&&as(c)}}function Na(t,e){const n=$i(e,t),i=n[1];(function Kl(t,e){for(let n=e.length;n<t.blueprint.length;n++)e.push(t.blueprint[n])})(i,n),Oc(i,n,n[8])}function Cs(t,e){return t[13]?t[14][4]=e:t[13]=e,t[14]=e,e}function za(t){for(;t;){t[2]|=64;const e=Bh(t);if(Wf(t)&&!e)return t;t=e}return null}function Cf(t,e,n){const i=e[10];i.begin&&i.begin();try{Lc(t,e,t.template,n)}catch(c){throw im(e,c),c}finally{i.end&&i.end()}}function Qp(t){!function Ef(t){for(let e=0;e<t.components.length;e++){const n=t.components[e],i=vp(n),c=i[1];_f(c,i,c.template,n)}}(t[8])}function Tf(t,e,n){fu(0),e(t,n)}const a_=(()=>Promise.resolve(null))();function tm(t){return t[7]||(t[7]=[])}function nm(t){return t.cleanup||(t.cleanup=[])}function im(t,e){const n=t[9],i=n?n.get(Au,null):null;i&&i.handleError(e)}function _l(t,e,n,i,c){for(let p=0;p<n.length;){const v=n[p++],C=n[p++],S=e[v],R=t.data[v];null!==R.setInput?R.setInput(S,c,i,C):S[C]=c}}function Ba(t,e,n){const i=Ja(e,t);!function Tg(t,e,n){kr(t)?t.setValue(e,n):e.textContent=n}(t[11],i,n)}function Nc(t,e,n){let i=n?t.styles:null,c=n?t.classes:null,p=0;if(null!==e)for(let v=0;v<e.length;v++){const C=e[v];"number"==typeof C?p=C:1==p?c=Ui(c,C):2==p&&(i=Ui(i,C+": "+e[++v]+";"))}n?t.styles=i:t.stylesWithoutHost=i,n?t.classes=c:t.classesWithoutHost=c}const Xh=new Xt("INJECTOR",-1);class _a{get(e,n=Bo){if(n===Bo){const i=new Error(`NullInjectorError: No provider for ${nr(e)}!`);throw i.name="NullInjectorError",i}return n}}const Kh=new Xt("Set Injector scope."),zc={},ya={};let yl;function om(){return void 0===yl&&(yl=new _a),yl}function sm(t,e=null,n=null,i){const c=Yh(t,e,n,i);return c._resolveInjectorDefTypes(),c}function Yh(t,e=null,n=null,i){return new c_(t,n,e||om(),i)}class c_{constructor(e,n,i,c=null){this.parent=i,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const p=[];n&&To(n,C=>this.processProvider(C,e,n)),To([e],C=>this.processInjectorType(C,[],p)),this.records.set(Xh,Yl(void 0,this));const v=this.records.get(Kh);this.scope=null!=v?v.value:null,this.source=c||("object"==typeof e?null:nr(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,n=Bo,i=wn.Default){this.assertNotDestroyed();const c=Th(this),p=Pr(void 0);try{if(!(i&wn.SkipSelf)){let C=this.records.get(e);if(void 0===C){const S=function Qh(t){return"function"==typeof t||"object"==typeof t&&t instanceof Xt}(e)&&hi(e);C=S&&this.injectableDefInScope(S)?Yl(Df(e),zc):null,this.records.set(e,C)}if(null!=C)return this.hydrate(e,C)}return(i&wn.Self?om():this.parent).get(e,n=i&wn.Optional&&n===Bo?null:n)}catch(v){if("NullInjectorError"===v.name){if((v[la]=v[la]||[]).unshift(nr(e)),c)throw v;return function Tr(t,e,n,i){const c=t[la];throw e[eg]&&c.unshift(e[eg]),t.message=function ng(t,e,n,i=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.substr(2):t;let c=nr(e);if(Array.isArray(e))c=e.map(nr).join(" -> ");else if("object"==typeof e){let p=[];for(let v in e)if(e.hasOwnProperty(v)){let C=e[v];p.push(v+":"+("string"==typeof C?JSON.stringify(C):nr(C)))}c=`{${p.join(", ")}}`}return`${n}${i?"("+i+")":""}[${c}]: ${t.replace(Ly,"\n  ")}`}("\n"+t.message,c,n,i),t.ngTokenPath=c,t[la]=null,t}(v,e,"R3InjectorError",this.source)}throw v}finally{Pr(p),Th(c)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((i,c)=>e.push(nr(c))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new se(205,!1)}processInjectorType(e,n,i){if(!(e=N(e)))return!1;let c=Qs(e);const p=null==c&&e.ngModule||void 0,v=void 0===p?e:p,C=-1!==i.indexOf(v);if(void 0!==p&&(c=Qs(p)),null==c)return!1;if(null!=c.imports&&!C){let z;i.push(v);try{To(c.imports,q=>{this.processInjectorType(q,n,i)&&(void 0===z&&(z=[]),z.push(q))})}finally{}if(void 0!==z)for(let q=0;q<z.length;q++){const{ngModule:me,providers:be}=z[q];To(be,Ge=>this.processProvider(Ge,me,be||Ze))}}this.injectorDefTypes.add(v);const S=Wa(v)||(()=>new v);this.records.set(v,Yl(S,zc));const R=c.providers;if(null!=R&&!C){const z=e;To(R,q=>this.processProvider(q,z,R))}return void 0!==p&&void 0!==e.providers}processProvider(e,n,i){let c=Ts(e=N(e))?e:N(e&&e.provide);const p=function u_(t,e,n){return am(t)?Yl(void 0,t.useValue):Yl(h_(t),zc)}(e);if(Ts(e)||!0!==e.multi)this.records.get(c);else{let v=this.records.get(c);v||(v=Yl(void 0,zc,!0),v.factory=()=>In(v.multi),this.records.set(c,v)),c=e,v.multi.push(e)}this.records.set(c,p)}hydrate(e,n){return n.value===zc&&(n.value=ya,n.value=n.factory()),"object"==typeof n.value&&n.value&&function Jh(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(n.value)&&this.onDestroy.add(n.value),n.value}injectableDefInScope(e){if(!e.providedIn)return!1;const n=N(e.providedIn);return"string"==typeof n?"any"===n||n===this.scope:this.injectorDefTypes.has(n)}}function Df(t){const e=hi(t),n=null!==e?e.factory:Wa(t);if(null!==n)return n;if(t instanceof Xt)throw new se(204,!1);if(t instanceof Function)return function jv(t){const e=t.length;if(e>0)throw function Fl(t,e){const n=[];for(let i=0;i<t;i++)n.push(e);return n}(e,"?"),new se(204,!1);const n=function oc(t){const e=t&&(t[lo]||t[ea]);if(e){const n=function Yi(t){if(t.hasOwnProperty("name"))return t.name;const e=(""+t).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(t);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),e}return null}(t);return null!==n?()=>n.factory(t):()=>new t}(t);throw new se(204,!1)}function h_(t,e,n){let i;if(Ts(t)){const c=N(t);return Wa(c)||Df(c)}if(am(t))i=()=>N(t.useValue);else if(function $v(t){return!(!t||!t.useFactory)}(t))i=()=>t.useFactory(...In(t.deps||[]));else if(function d_(t){return!(!t||!t.useExisting)}(t))i=()=>dn(N(t.useExisting));else{const c=N(t&&(t.useClass||t.provide));if(!function Hv(t){return!!t.deps}(t))return Wa(c)||Df(c);i=()=>new c(...In(t.deps))}return i}function Yl(t,e,n=!1){return{factory:t,value:e,multi:n?[]:void 0}}function am(t){return null!==t&&"object"==typeof t&&Ny in t}function Ts(t){return"function"==typeof t}let Fi=(()=>{class t{static create(n,i){var c;if(Array.isArray(n))return sm({name:""},i,n,"");{const p=null!==(c=n.name)&&void 0!==c?c:"";return sm({name:p},n.parent,n.providers,p)}}}return t.THROW_IF_NOT_FOUND=Bo,t.NULL=new _a,t.\u0275prov=gn({token:t,providedIn:"any",factory:()=>dn(Xh)}),t.__NG_ELEMENT_ID__=-1,t})();function Z(t,e){tl(vp(t)[1],Di())}function ve(t){let e=function le(t){return Object.getPrototypeOf(t.prototype).constructor}(t.type),n=!0;const i=[t];for(;e;){let c;if(Ji(t))c=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new se(903,"");c=e.\u0275dir}if(c){if(n){i.push(c);const v=t;v.inputs=Re(t.inputs),v.declaredInputs=Re(t.declaredInputs),v.outputs=Re(t.outputs);const C=c.hostBindings;C&&Ye(t,C);const S=c.viewQuery,R=c.contentQueries;if(S&&Le(t,S),R&&Fe(t,R),ao(t.inputs,c.inputs),ao(t.declaredInputs,c.declaredInputs),ao(t.outputs,c.outputs),Ji(c)&&c.data.animation){const z=t.data;z.animation=(z.animation||[]).concat(c.data.animation)}}const p=c.features;if(p)for(let v=0;v<p.length;v++){const C=p[v];C&&C.ngInherit&&C(t),C===ve&&(n=!1)}}e=Object.getPrototypeOf(e)}!function Pe(t){let e=0,n=null;for(let i=t.length-1;i>=0;i--){const c=t[i];c.hostVars=e+=c.hostVars,c.hostAttrs=aa(c.hostAttrs,n=aa(n,c.hostAttrs))}}(i)}function Re(t){return t===Se?{}:t===Ze?[]:t}function Le(t,e){const n=t.viewQuery;t.viewQuery=n?(i,c)=>{e(i,c),n(i,c)}:e}function Fe(t,e){const n=t.contentQueries;t.contentQueries=n?(i,c,p)=>{e(i,c,p),n(i,c,p)}:e}function Ye(t,e){const n=t.hostBindings;t.hostBindings=n?(i,c)=>{e(i,c),n(i,c)}:e}let qe=null;function tt(){if(!qe){const t=Nn.Symbol;if(t&&t.iterator)qe=t.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let n=0;n<e.length;++n){const i=e[n];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(qe=i)}}}return qe}function cn(t,e,n){return!Object.is(t[e],n)&&(t[e]=n,!0)}function Wt(t,e,n,i){const c=cn(t,e,n);return cn(t,e+1,i)||c}function Hn(t,e,n,i){const c=pt();return cn(c,oa(),e)&&(or(),ga($r(),c,t,e,n,i)),Hn}function jn(t,e,n,i,c,p,v,C,S,R){const q=function Mn(t,e,n,i,c,p){const v=Wt(t,e,n,i);return Wt(t,e+2,c,p)||v}(t,function _s(){return En.lFrame.bindingIndex}(),n,c,v,S);return No(4),q?e+Me(n)+i+Me(c)+p+Me(v)+C+Me(S)+R:Gn}function Mt(t,e=wn.Default){const n=pt();return null===n?dn(t,e):xe(Di(),n,N(t),e)}function Jv(){throw new Error("invalid")}function id(t,e,n){const i=pt();return cn(i,oa(),e)&&function ss(t,e,n,i,c,p,v,C){const S=eo(e,n);let z,R=e.inputs;!C&&null!=R&&(z=R[i])?(_l(t,n,z,i,c),lc(e)&&function Wh(t,e){const n=$i(e,t);16&n[2]||(n[2]|=64)}(n,e.index)):3&e.type&&(i=function Yg(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(i),c=null!=v?v(c,e.value||"",i):c,kr(p)?p.setProperty(S,i,c):al(i)||(S.setProperty?S.setProperty(i,c):S[i]=c))}(or(),$r(),i,t,e,i[11],n,!1),id}function Qv(t,e,n,i,c){const v=c?"class":"style";_l(t,n,e.inputs[v],v,i)}function Go(t,e,n,i){const c=pt(),p=or(),v=20+t,C=c[11],S=c[v]=Mc(C,e,function Nd(){return En.lFrame.currentNamespace}()),R=p.firstCreatePass?function FD(t,e,n,i,c,p,v){const C=e.consts,R=Wl(e,t,2,c,gs(C,p));return function Fc(t,e,n,i){let c=!1;if(ah()){const p=function Kp(t,e,n){const i=t.directiveRegistry;let c=null;if(i)for(let p=0;p<i.length;p++){const v=i[p];Ng(n,v.selectors,!1)&&(c||(c=[]),_e(H(n,e),t,v.type),Ji(v)?(Yp(t,n),c.unshift(v)):c.push(v))}return c}(t,e,n),v=null===i?null:{"":-1};if(null!==p){c=!0,Jp(n,t.data.length,p.length);for(let z=0;z<p.length;z++){const q=p[z];q.providersResolver&&q.providersResolver(q)}let C=!1,S=!1,R=Uu(t,e,p.length,null);for(let z=0;z<p.length;z++){const q=p[z];n.mergedAttrs=aa(n.mergedAttrs,q.hostAttrs),r_(t,n,e,R,q),n_(R,q,v),null!==q.contentQueries&&(n.flags|=8),(null!==q.hostBindings||null!==q.hostAttrs||0!==q.hostVars)&&(n.flags|=128);const me=q.type.prototype;!C&&(me.ngOnChanges||me.ngOnInit||me.ngDoCheck)&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n.index),C=!0),!S&&(me.ngOnChanges||me.ngDoCheck)&&((t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n.index),S=!0),R++}!function Fv(t,e){const i=e.directiveEnd,c=t.data,p=e.attrs,v=[];let C=null,S=null;for(let R=e.directiveStart;R<i;R++){const z=c[R],q=z.inputs,me=null===p||Fg(e)?null:Mo(q,p);v.push(me),C=Kg(q,R,C),S=Kg(z.outputs,R,S)}null!==C&&(C.hasOwnProperty("class")&&(e.flags|=16),C.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=v,e.inputs=C,e.outputs=S}(t,n)}v&&function t_(t,e,n){if(e){const i=t.localNames=[];for(let c=0;c<e.length;c+=2){const p=n[e[c+1]];if(null==p)throw new se(-301,!1);i.push(e[c],p)}}}(n,i,v)}return n.mergedAttrs=aa(n.mergedAttrs,n.attrs),c}(e,n,R,gs(C,v)),null!==R.attrs&&Nc(R,R.attrs,!1),null!==R.mergedAttrs&&Nc(R,R.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,R),R}(v,p,c,0,e,n,i):p.data[v];Gi(R,!0);const z=R.mergedAttrs;null!==z&&fo(C,S,z);const q=R.classes;null!==q&&ha(C,S,q);const me=R.styles;return null!==me&&Op(C,S,me),64!=(64&R.flags)&&ef(p,c,S,R),0===function Ad(){return En.lFrame.elementDepthCount}()&&So(S,c),function Pd(){En.lFrame.elementDepthCount++}(),cc(R)&&(function Gp(t,e,n){!ah()||(function e_(t,e,n,i){const c=n.directiveStart,p=n.directiveEnd;t.firstCreatePass||H(n,e),So(i,e);const v=n.initialInputs;for(let C=c;C<p;C++){const S=t.data[C],R=Ji(S);R&&Nv(e,n,S);const z=et(e,t,C,n);So(z,e),null!==v&&i_(0,C-c,z,S,0,v),R&&($i(n.index,e)[8]=z)}}(t,e,n,eo(n,e)),128==(128&n.flags)&&function gl(t,e,n){const i=n.directiveStart,c=n.directiveEnd,v=n.index,C=function du(){return En.lFrame.currentDirectiveIndex}();try{sa(v);for(let S=i;S<c;S++){const R=t.data[S],z=e[S];el(S),(null!==R.hostBindings||0!==R.hostVars||null!==R.hostAttrs)&&Xp(R,z)}}finally{sa(-1),el(C)}}(t,e,n))}(p,c,R),function Wg(t,e,n){if(Il(e)){const c=e.directiveEnd;for(let p=e.directiveStart;p<c;p++){const v=t.data[p];v.contentQueries&&v.contentQueries(1,n[p],p)}}}(p,R,c)),null!==i&&function Hp(t,e,n=eo){const i=e.localNames;if(null!==i){let c=e.index+1;for(let p=0;p<i.length;p+=2){const v=i[p+1],C=-1===v?n(e,t):t[v];t[c++]=C}}}(c,R),Go}function Ho(){let t=Di();Qo()?function ia(){En.lFrame.isParent=!1}():(t=t.parent,Gi(t,!1));const e=t;!function kd(){En.lFrame.elementDepthCount--}();const n=or();return n.firstCreatePass&&(tl(n,t),Il(t)&&n.queries.elementEnd(t)),null!=e.classesWithoutHost&&function sl(t){return 0!=(16&t.flags)}(e)&&Qv(n,e,pt(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function xh(t){return 0!=(32&t.flags)}(e)&&Qv(n,e,pt(),e.stylesWithoutHost,!1),Ho}function xl(t,e,n,i){return Go(t,e,n,i),Ho(),xl}function fm(t){return!!t&&"function"==typeof t.then}const nx=function Vb(t){return!!t&&"function"==typeof t.subscribe};function Ss(t,e,n,i){const c=pt(),p=or(),v=Di();return function jb(t,e,n,i,c,p,v,C){const S=cc(i),z=t.firstCreatePass&&nm(t),q=e[8],me=tm(e);let be=!0;if(3&i.type||C){const Ot=eo(i,e),jt=C?C(Ot):Ot,ct=me.length,fn=C?er=>C(jr(er[i.index])):i.index;if(kr(n)){let er=null;if(!C&&S&&(er=function BD(t,e,n,i){const c=t.cleanup;if(null!=c)for(let p=0;p<c.length-1;p+=2){const v=c[p];if(v===n&&c[p+1]===i){const C=e[7],S=c[p+2];return C.length>S?C[S]:null}"string"==typeof v&&(p+=2)}return null}(t,e,c,i.index)),null!==er)(er.__ngLastListenerFn__||er).__ngNextListenerFn__=p,er.__ngLastListenerFn__=p,be=!1;else{p=rx(i,e,q,p,!1);const Lr=n.listen(jt,c,p);me.push(p,Lr),z&&z.push(c,fn,ct,ct+1)}}else p=rx(i,e,q,p,!0),jt.addEventListener(c,p,v),me.push(p),z&&z.push(c,fn,ct,v)}else p=rx(i,e,q,p,!1);const Ge=i.outputs;let xt;if(be&&null!==Ge&&(xt=Ge[c])){const Ot=xt.length;if(Ot)for(let jt=0;jt<Ot;jt+=2){const Ea=e[xt[jt]][xt[jt+1]].subscribe(p),_d=me.length;me.push(p,Ea),z&&z.push(c,i.index,_d,-(_d+1))}}}(p,c,c[11],v,t,e,!!n,i),Ss}function $b(t,e,n,i){try{return!1!==n(i)}catch(c){return im(t,c),!1}}function rx(t,e,n,i,c){return function p(v){if(v===Function)return i;const C=2&t.flags?$i(t.index,e):e;0==(32&e[2])&&za(C);let S=$b(e,0,i,v),R=p.__ngNextListenerFn__;for(;R;)S=$b(e,0,R,v)&&S,R=R.__ngNextListenerFn__;return c&&!1===S&&(v.preventDefault(),v.returnValue=!1),S}}function Qb(t,e,n,i,c){const p=t[n+1],v=null===e;let C=i?bs(p):La(p),S=!1;for(;0!==C&&(!1===S||v);){const z=t[C+1];qD(t[C],e)&&(S=!0,t[C+1]=i?sf(z):of(z)),C=i?bs(z):La(z)}S&&(t[n+1]=i?of(p):sf(p))}function qD(t,e){return null===t||null==e||(Array.isArray(t)?t[1]:t)===e||!(!Array.isArray(t)||"string"!=typeof e)&&ul(t,e)>=0}function v_(t,e){return function bl(t,e,n,i){const c=pt(),p=or(),v=No(2);p.firstUpdatePass&&function lw(t,e,n,i){const c=t.data;if(null===c[n+1]){const p=c[Hi()],v=function aw(t,e){return e>=t.expandoStartIndex}(t,n);(function dw(t,e){return 0!=(t.flags&(e?16:32))})(p,i)&&null===e&&!v&&(e=!1),e=function tS(t,e,n,i){const c=function Ll(t){const e=En.lFrame.currentDirectiveIndex;return-1===e?null:t[e]}(t);let p=i?e.residualClasses:e.residualStyles;if(null===c)0===(i?e.classBindings:e.styleBindings)&&(n=pm(n=ox(null,t,e,n,i),e.attrs,i),p=null);else{const v=e.directiveStylingLast;if(-1===v||t[v]!==c)if(n=ox(c,t,e,n,i),null===p){let S=function nS(t,e,n){const i=n?e.classBindings:e.styleBindings;if(0!==La(i))return t[bs(i)]}(t,e,i);void 0!==S&&Array.isArray(S)&&(S=ox(null,t,e,S[1],i),S=pm(S,e.attrs,i),function rS(t,e,n,i){t[bs(n?e.classBindings:e.styleBindings)]=i}(t,e,i,S))}else p=function iS(t,e,n){let i;const c=e.directiveEnd;for(let p=1+e.directiveStylingLast;p<c;p++)i=pm(i,t[p].hostAttrs,n);return pm(i,e.attrs,n)}(t,e,i)}return void 0!==p&&(i?e.residualClasses=p:e.residualStyles=p),n}(c,p,e,i),function GD(t,e,n,i,c,p){let v=p?e.classBindings:e.styleBindings,C=bs(v),S=La(v);t[i]=n;let z,R=!1;if(Array.isArray(n)){const q=n;z=q[1],(null===z||ul(q,z)>0)&&(R=!0)}else z=n;if(c)if(0!==S){const me=bs(t[C+1]);t[i+1]=pl(me,C),0!==me&&(t[me+1]=Fp(t[me+1],i)),t[C+1]=function Cv(t,e){return 131071&t|e<<17}(t[C+1],i)}else t[i+1]=pl(C,0),0!==C&&(t[C+1]=Fp(t[C+1],i)),C=i;else t[i+1]=pl(S,0),0===C?C=i:t[S+1]=Fp(t[S+1],i),S=i;R&&(t[i+1]=of(t[i+1])),Qb(t,z,i,!0),Qb(t,z,i,!1),function HD(t,e,n,i,c){const p=c?t.residualClasses:t.residualStyles;null!=p&&"string"==typeof e&&ul(p,e)>=0&&(n[i+1]=sf(n[i+1]))}(e,z,t,i,p),v=pl(C,S),p?e.classBindings=v:e.styleBindings=v}(c,p,e,n,v,i)}}(p,t,v,i),e!==Gn&&cn(c,v,e)&&function uw(t,e,n,i,c,p,v,C){if(!(3&e.type))return;const S=t.data,R=S[C+1];x_(function Np(t){return 1==(1&t)}(R)?hw(S,e,n,c,La(R),v):void 0)||(x_(p)||function $h(t){return 2==(2&t)}(R)&&(p=hw(S,null,n,c,C,v)),function Og(t,e,n,i,c){const p=kr(t);if(e)c?p?t.addClass(n,i):n.classList.add(i):p?t.removeClass(n,i):n.classList.remove(i);else{let v=-1===i.indexOf("-")?void 0:xs.DashCase;if(null==c)p?t.removeStyle(n,i,v):n.style.removeProperty(i);else{const C="string"==typeof c&&c.endsWith("!important");C&&(c=c.slice(0,-10),v|=xs.Important),p?t.setStyle(n,i,c,v):n.style.setProperty(i,c,C?"important":"")}}}(i,v,Ja(Hi(),n),c,p))}(p,p.data[Hi()],c,c[11],t,c[v+1]=function aS(t,e){return null==t||("string"==typeof e?t+=e:"object"==typeof t&&(t=nr(Si(t)))),t}(e,n),i,v)}(t,e,null,!0),v_}function ox(t,e,n,i,c){let p=null;const v=n.directiveEnd;let C=n.directiveStylingLast;for(-1===C?C=n.directiveStart:C++;C<v&&(p=e[C],i=pm(i,p.hostAttrs,c),p!==t);)C++;return null!==t&&(n.directiveStylingLast=C),i}function pm(t,e,n){const i=n?1:2;let c=-1;if(null!==e)for(let p=0;p<e.length;p++){const v=e[p];"number"==typeof v?c=v:c===i&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),rs(t,v,!!n||e[++p]))}return void 0===t?null:t}function hw(t,e,n,i,c,p){const v=null===e;let C;for(;c>0;){const S=t[c],R=Array.isArray(S),z=R?S[1]:S,q=null===z;let me=n[c+1];me===Gn&&(me=q?Ze:void 0);let be=q?Eh(me,i):z===i?me:void 0;if(R&&!x_(be)&&(be=Eh(S,i)),x_(be)&&(C=be,v))return C;const Ge=t[c+1];c=v?bs(Ge):La(Ge)}if(null!==e){let S=p?e.residualClasses:e.residualStyles;null!=S&&(C=Eh(S,i))}return C}function x_(t){return void 0!==t}function Ms(t,e=""){const n=pt(),i=or(),c=t+20,p=i.firstCreatePass?Wl(i,c,1,e,null):i.data[c],v=n[c]=function Sc(t,e){return kr(t)?t.createText(e):t.createTextNode(e)}(n[11],e);ef(i,n,v,p),Gi(p,!1)}function od(t,e,n){const i=pt(),c=function xr(t,e,n,i){return cn(t,oa(),n)?e+Me(n)+i:Gn}(i,t,e,n);return c!==Gn&&Ba(i,Hi(),c),od}function sx(t,e,n,i,c,p,v,C,S){const R=pt(),z=jn(R,t,e,n,i,c,p,v,C,S);return z!==Gn&&Ba(R,Hi(),z),sx}const b_="en-US";let Ow=b_;function cx(t,e,n,i,c){if(t=N(t),Array.isArray(t))for(let p=0;p<t.length;p++)cx(t[p],e,n,i,c);else{const p=or(),v=pt();let C=Ts(t)?t:N(t.provide),S=h_(t);const R=Di(),z=1048575&R.providerIndexes,q=R.directiveStart,me=R.providerIndexes>>20;if(Ts(t)||!t.multi){const be=new il(S,c,Mt),Ge=hx(C,e,c?z:z+me,q);-1===Ge?(_e(H(R,v),p,C),ux(p,t,e.length),e.push(C),R.directiveStart++,R.directiveEnd++,c&&(R.providerIndexes+=1048576),n.push(be),v.push(be)):(n[Ge]=be,v[Ge]=be)}else{const be=hx(C,e,z+me,q),Ge=hx(C,e,z,z+me),xt=be>=0&&n[be],Ot=Ge>=0&&n[Ge];if(c&&!Ot||!c&&!xt){_e(H(R,v),p,C);const jt=function DM(t,e,n,i,c){const p=new il(t,n,Mt);return p.multi=[],p.index=e,p.componentProviders=0,i1(p,c,i&&!n),p}(c?TM:CM,n.length,c,i,S);!c&&Ot&&(n[Ge].providerFactory=jt),ux(p,t,e.length,0),e.push(C),R.directiveStart++,R.directiveEnd++,c&&(R.providerIndexes+=1048576),n.push(jt),v.push(jt)}else ux(p,t,be>-1?be:Ge,i1(n[c?Ge:be],S,!c&&i));!c&&i&&Ot&&n[Ge].componentProviders++}}}function ux(t,e,n,i){const c=Ts(e),p=function Gv(t){return!!t.useClass}(e);if(c||p){const S=(p?N(e.useClass):e).prototype.ngOnDestroy;if(S){const R=t.destroyHooks||(t.destroyHooks=[]);if(!c&&e.multi){const z=R.indexOf(n);-1===z?R.push(n,[i,S]):R[z+1].push(i,S)}else R.push(n,S)}}}function i1(t,e,n){return n&&t.componentProviders++,t.multi.push(e)-1}function hx(t,e,n,i){for(let c=n;c<i;c++)if(e[c]===t)return c;return-1}function CM(t,e,n,i){return dx(this.multi,[])}function TM(t,e,n,i){const c=this.multi;let p;if(this.providerFactory){const v=this.providerFactory.componentProviders,C=et(n,n[1],this.providerFactory.index,i);p=C.slice(0,v),dx(c,p);for(let S=v;S<C.length;S++)p.push(C[S])}else p=[],dx(c,p);return p}function dx(t,e){for(let n=0;n<t.length;n++)e.push((0,t[n])());return e}function xi(t,e=[]){return n=>{n.providersResolver=(i,c)=>function EM(t,e,n){const i=or();if(i.firstCreatePass){const c=Ji(t);cx(n,i.data,i.blueprint,c,!0),cx(e,i.data,i.blueprint,c,!1)}}(i,c?c(t):t,e)}}class o1{}class IM{resolveComponentFactory(e){throw function MM(t){const e=Error(`No component factory found for ${nr(t)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=t,e}(e)}}let vm=(()=>{class t{}return t.NULL=new IM,t})();function AM(){return Lf(Di(),pt())}function Lf(t,e){return new va(eo(t,e))}let va=(()=>{class t{constructor(n){this.nativeElement=n}}return t.__NG_ELEMENT_ID__=AM,t})();function PM(t){return t instanceof va?t.nativeElement:t}class a1{}let $c=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>function RM(){const t=pt(),n=$i(Di().index,t);return function kM(t){return t[11]}(Fo(n)?n:t)}(),t})(),OM=(()=>{class t{}return t.\u0275prov=gn({token:t,providedIn:"root",factory:()=>null}),t})();class xm{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const LM=new xm("13.3.4"),fx={};function D_(t,e,n,i,c=!1){for(;null!==n;){const p=e[n.index];if(null!==p&&i.push(jr(p)),Eo(p))for(let C=10;C<p.length;C++){const S=p[C],R=S[1].firstChild;null!==R&&D_(S[1],S,R,i)}const v=n.type;if(8&v)D_(t,e,n.child,i);else if(32&v){const C=Yd(n,e);let S;for(;S=C();)i.push(S)}else if(16&v){const C=Fu(e,n);if(Array.isArray(C))i.push(...C);else{const S=Bh(e[16]);D_(S[1],S,C,i,!0)}}n=c?n.projectionNext:n.next}return i}class bm{constructor(e,n){this._lView=e,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,n=e[1];return D_(n,e,n.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(Eo(e)){const n=e[8],i=n?n.indexOf(this):-1;i>-1&&(Ip(e,i),Gs(n,i))}this._attachedToViewContainer=!1}Ig(this._lView[1],this._lView)}onDestroy(e){qp(this._lView[1],this._lView,null,e)}markForCheck(){za(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Cf(this._lView[1],this._lView,this.context)}checkNoChanges(){!function em(t,e,n){Ma(!0);try{Cf(t,e,n)}finally{Ma(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new se(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function cv(t,e){Nu(t,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new se(902,"");this._appRef=e}}class FM extends bm{constructor(e){super(e),this._view=e}detectChanges(){Qp(this._view)}checkNoChanges(){!function Bv(t){Ma(!0);try{Qp(t)}finally{Ma(!1)}}(this._view)}get context(){return null}}class l1 extends vm{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const n=vr(e);return new px(n,this.ngModule)}}function c1(t){const e=[];for(let n in t)t.hasOwnProperty(n)&&e.push({propName:t[n],templateName:n});return e}class px extends o1{constructor(e,n){super(),this.componentDef=e,this.ngModule=n,this.componentType=e.type,this.selector=function Ev(t){return t.map(wv).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!n}get inputs(){return c1(this.componentDef.inputs)}get outputs(){return c1(this.componentDef.outputs)}create(e,n,i,c){const p=(c=c||this.ngModule)?function zM(t,e){return{get:(n,i,c)=>{const p=t.get(n,fx,c);return p!==fx||i===fx?p:e.get(n,i,c)}}}(e,c.injector):e,v=p.get(a1,cu),C=p.get(OM,null),S=v.createRenderer(null,this.componentDef),R=this.componentDef.selectors[0][0]||"div",z=i?function Xg(t,e,n){if(kr(t))return t.selectRootElement(e,n===Li.ShadowDom);let i="string"==typeof e?t.querySelector(e):e;return i.textContent="",i}(S,i,this.componentDef.encapsulation):Mc(v.createRenderer(null,this.componentDef),R,function NM(t){const e=t.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(R)),q=this.componentDef.onPush?576:528,me=function V(t,e){return{components:[],scheduler:t||Cp,clean:a_,playerHandler:e||null,flags:0}}(),be=vf(0,null,null,1,0,null,null,null,null,null),Ge=Rc(null,be,me,q,null,null,v,S,C,p);let xt,Ot;mc(Ge);try{const jt=function k(t,e,n,i,c,p){const v=n[1];n[20]=t;const S=Wl(v,20,2,"#host",null),R=S.mergedAttrs=e.hostAttrs;null!==R&&(Nc(S,R,!0),null!==t&&(fo(c,t,R),null!==S.classes&&ha(c,t,S.classes),null!==S.styles&&Op(c,t,S.styles)));const z=i.createRenderer(t,e),q=Rc(n,yf(e),null,e.onPush?64:16,n[20],S,i,z,p||null,null);return v.firstCreatePass&&(_e(H(S,n),v,e.type),Yp(v,S),Jp(S,n.length,1)),Cs(n,q),n[20]=q}(z,this.componentDef,Ge,v,S);if(z)if(i)fo(S,z,["ng-version",LM.full]);else{const{attrs:ct,classes:fn}=function Lp(t){const e=[],n=[];let i=1,c=2;for(;i<t.length;){let p=t[i];if("string"==typeof p)2===c?""!==p&&e.push(p,t[++i]):8===c&&n.push(p);else{if(!da(c))break;c=p}i++}return{attrs:e,classes:n}}(this.componentDef.selectors[0]);ct&&fo(S,z,ct),fn&&fn.length>0&&ha(S,z,fn.join(" "))}if(Ot=dc(be,20),void 0!==n){const ct=Ot.projection=[];for(let fn=0;fn<this.ngContentSelectors.length;fn++){const er=n[fn];ct.push(null!=er?Array.from(er):null)}}xt=function F(t,e,n,i,c){const p=n[1],v=function Zp(t,e,n){const i=Di();t.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),r_(t,i,e,Uu(t,e,1,null),n));const c=et(e,t,i.directiveStart,i);So(c,e);const p=eo(i,e);return p&&So(p,e),c}(p,n,e);if(i.components.push(v),t[8]=v,c&&c.forEach(S=>S(v,e)),e.contentQueries){const S=Di();e.contentQueries(1,v,S.directiveStart)}const C=Di();return!p.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(sa(C.index),Qg(n[1],C,0,C.directiveStart,C.directiveEnd,e),Xp(e,v)),v}(jt,this.componentDef,Ge,me,[Z]),Oc(be,Ge,null)}finally{gc()}return new VM(this.componentType,xt,Lf(Ot,Ge),Ge,Ot)}}class VM extends class SM{}{constructor(e,n,i,c,p){super(),this.location=i,this._rootLView=c,this._tNode=p,this.instance=n,this.hostView=this.changeDetectorRef=new FM(c),this.componentType=e}get injector(){return new vt(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}class Gc{}class u1{}const Ff=new Map;class f1 extends Gc{constructor(e,n){super(),this._parent=n,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new l1(this);const i=Ne(e);this._bootstrapComponents=Oa(i.bootstrap),this._r3Injector=Yh(e,n,[{provide:Gc,useValue:this},{provide:vm,useValue:this.componentFactoryResolver}],nr(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,n=Fi.THROW_IF_NOT_FOUND,i=wn.Default){return e===Fi||e===Gc||e===Xh?this:this._r3Injector.get(e,n,i)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class mx extends u1{constructor(e){super(),this.moduleType=e,null!==Ne(e)&&function jM(t){const e=new Set;!function n(i){const c=Ne(i,!0),p=c.id;null!==p&&(function h1(t,e,n){if(e&&e!==n)throw new Error(`Duplicate module registered for ${t} - ${nr(e)} vs ${nr(e.name)}`)}(p,Ff.get(p),i),Ff.set(p,i));const v=Oa(c.imports);for(const C of v)e.has(C)||(e.add(C),n(C))}(t)}(e)}create(e){return new f1(this.moduleType,e)}}function gx(t,e,n){const i=function vi(){const t=En.lFrame;let e=t.bindingRootIndex;return-1===e&&(e=t.bindingRootIndex=t.tView.bindingStartIndex),e}()+t,c=pt();return c[i]===Gn?function Sn(t,e,n){return t[e]=n}(c,i,n?e.call(n):e()):function _n(t,e){return t[e]}(c,i)}function _x(t){return e=>{setTimeout(t,void 0,e)}}const bi=class oI extends Et{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,n,i){var c,p,v;let C=e,S=n||(()=>null),R=i;if(e&&"object"==typeof e){const q=e;C=null===(c=q.next)||void 0===c?void 0:c.bind(q),S=null===(p=q.error)||void 0===p?void 0:p.bind(q),R=null===(v=q.complete)||void 0===v?void 0:v.bind(q)}this.__isAsync&&(S=_x(S),C&&(C=_x(C)),R&&(R=_x(R)));const z=super.subscribe({next:C,error:S,complete:R});return e instanceof W&&e.add(z),z}};function sI(){return this._results[tt()]()}class yx{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const n=tt(),i=yx.prototype;i[n]||(i[n]=sI)}get changes(){return this._changes||(this._changes=new bi)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,n){return this._results.reduce(e,n)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,n){const i=this;i.dirty=!1;const c=ai(e);(this._changesDetected=!function Qr(t,e,n){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++){let c=t[i],p=e[i];if(n&&(c=n(c),p=n(p)),p!==c)return!1}return!0}(i._results,c,n))&&(i._results=c,i.length=c.length,i.last=c[this.length-1],i.first=c[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let Hc=(()=>{class t{}return t.__NG_ELEMENT_ID__=cI,t})();const aI=Hc,lI=class extends aI{constructor(e,n,i){super(),this._declarationLView=e,this._declarationTContainer=n,this.elementRef=i}createEmbeddedView(e){const n=this._declarationTContainer.tViews,i=Rc(this._declarationLView,n,e,16,null,n.declTNode,null,null,null,null);i[17]=this._declarationLView[this._declarationTContainer.index];const p=this._declarationLView[19];return null!==p&&(i[19]=p.createEmbeddedView(n)),Oc(n,i,e),new bm(i)}};function cI(){return S_(Di(),pt())}function S_(t,e){return 4&t.type?new lI(e,t,Lf(t,e)):null}let Va=(()=>{class t{}return t.__NG_ELEMENT_ID__=uI,t})();function uI(){return b1(Di(),pt())}const hI=Va,v1=class extends hI{constructor(e,n,i){super(),this._lContainer=e,this._hostTNode=n,this._hostLView=i}get element(){return Lf(this._hostTNode,this._hostLView)}get injector(){return new vt(this._hostTNode,this._hostLView)}get parentInjector(){const e=G(this._hostTNode,this._hostLView);if(o(e)){const n=b(e,this._hostLView),i=d(e);return new vt(n[1].data[i+8],n)}return new vt(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const n=x1(this._lContainer);return null!==n&&n[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,n,i){const c=e.createEmbeddedView(n||{});return this.insert(c,i),c}createComponent(e,n,i,c,p){const v=e&&!function Jr(t){return"function"==typeof t}(e);let C;if(v)C=n;else{const q=n||{};C=q.index,i=q.injector,c=q.projectableNodes,p=q.ngModuleRef}const S=v?e:new px(vr(e)),R=i||this.parentInjector;if(!p&&null==S.ngModule){const me=(v?R:this.parentInjector).get(Gc,null);me&&(p=me)}const z=S.create(R,c,void 0,p);return this.insert(z.hostView,C),z}insert(e,n){const i=e._lView,c=i[1];if(function sh(t){return Eo(t[3])}(i)){const z=this.indexOf(e);if(-1!==z)this.detach(z);else{const q=i[3],me=new v1(q,q[6],q[3]);me.detach(me.indexOf(e))}}const p=this._adjustIndex(n),v=this._lContainer;!function hv(t,e,n,i){const c=10+i,p=n.length;i>0&&(n[c-1][4]=e),i<p-10?(e[4]=n[c],Do(n,10+i,e)):(n.push(e),e[4]=null),e[3]=n;const v=e[17];null!==v&&n!==v&&function dv(t,e){const n=t[9];e[16]!==e[3][3][16]&&(t[2]=!0),null===n?t[9]=[e]:n.push(e)}(v,e);const C=e[19];null!==C&&C.insertView(t),e[2]|=128}(c,i,v,p);const C=kp(p,v),S=i[11],R=Uh(S,v[7]);return null!==R&&function Sg(t,e,n,i,c,p){i[0]=c,i[6]=e,Nu(t,i,n,1,c,p)}(c,v[6],S,i,R,C),e.attachToViewContainerRef(),Do(vx(v),p,e),e}move(e,n){return this.insert(e,n)}indexOf(e){const n=x1(this._lContainer);return null!==n?n.indexOf(e):-1}remove(e){const n=this._adjustIndex(e,-1),i=Ip(this._lContainer,n);i&&(Gs(vx(this._lContainer),n),Ig(i[1],i))}detach(e){const n=this._adjustIndex(e,-1),i=Ip(this._lContainer,n);return i&&null!=Gs(vx(this._lContainer),n)?new bm(i):null}_adjustIndex(e,n=0){return null==e?this.length+n:e}};function x1(t){return t[8]}function vx(t){return t[8]||(t[8]=[])}function b1(t,e){let n;const i=e[t.index];if(Eo(i))n=i;else{let c;if(8&t.type)c=jr(i);else{const p=e[11];c=p.createComment("");const v=eo(t,e);Ic(p,Uh(p,v),c,function mv(t,e){return kr(t)?t.nextSibling(e):e.nextSibling}(p,v),!1)}e[t.index]=n=function Xl(t,e,n,i){return new Array(t,!0,!1,e,null,0,i,n,null,null)}(i,e,c,t),Cs(e,n)}return new v1(n,t,e)}class xx{constructor(e){this.queryList=e,this.matches=null}clone(){return new xx(this.queryList)}setDirty(){this.queryList.setDirty()}}class bx{constructor(e=[]){this.queries=e}createEmbeddedView(e){const n=e.queries;if(null!==n){const i=null!==e.contentQueries?e.contentQueries[0]:n.length,c=[];for(let p=0;p<i;p++){const v=n.getByIndex(p);c.push(this.queries[v.indexInDeclarationView].clone())}return new bx(c)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let n=0;n<this.queries.length;n++)null!==S1(e,n).matches&&this.queries[n].setDirty()}}class w1{constructor(e,n,i=null){this.predicate=e,this.flags=n,this.read=i}}class wx{constructor(e=[]){this.queries=e}elementStart(e,n){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(e,n)}elementEnd(e){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(e)}embeddedTView(e){let n=null;for(let i=0;i<this.length;i++){const c=null!==n?n.length:0,p=this.getByIndex(i).embeddedTView(e,c);p&&(p.indexInDeclarationView=i,null!==n?n.push(p):n=[p])}return null!==n?new wx(n):null}template(e,n){for(let i=0;i<this.queries.length;i++)this.queries[i].template(e,n)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class Ex{constructor(e,n=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(e,n){this.isApplyingToNode(n)&&this.matchTNode(e,n)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,n){this.elementStart(e,n)}embeddedTView(e,n){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,n),new Ex(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const n=this._declarationNodeIndex;let i=e.parent;for(;null!==i&&8&i.type&&i.index!==n;)i=i.parent;return n===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(e,n){const i=this.metadata.predicate;if(Array.isArray(i))for(let c=0;c<i.length;c++){const p=i[c];this.matchTNodeWithReadOption(e,n,pI(n,p)),this.matchTNodeWithReadOption(e,n,We(n,e,p,!1,!1))}else i===Hc?4&n.type&&this.matchTNodeWithReadOption(e,n,-1):this.matchTNodeWithReadOption(e,n,We(n,e,i,!1,!1))}matchTNodeWithReadOption(e,n,i){if(null!==i){const c=this.metadata.read;if(null!==c)if(c===va||c===Va||c===Hc&&4&n.type)this.addMatch(n.index,-2);else{const p=We(n,e,c,!1,!1);null!==p&&this.addMatch(n.index,p)}else this.addMatch(n.index,i)}}addMatch(e,n){null===this.matches?this.matches=[e,n]:this.matches.push(e,n)}}function pI(t,e){const n=t.localNames;if(null!==n)for(let i=0;i<n.length;i+=2)if(n[i]===e)return n[i+1];return null}function gI(t,e,n,i){return-1===n?function mI(t,e){return 11&t.type?Lf(t,e):4&t.type?S_(t,e):null}(e,t):-2===n?function _I(t,e,n){return n===va?Lf(e,t):n===Hc?S_(e,t):n===Va?b1(e,t):void 0}(t,e,i):et(t,t[1],n,e)}function E1(t,e,n,i){const c=e[19].queries[i];if(null===c.matches){const p=t.data,v=n.matches,C=[];for(let S=0;S<v.length;S+=2){const R=v[S];C.push(R<0?null:gI(e,p[R],v[S+1],n.metadata.read))}c.matches=C}return c.matches}function Cx(t,e,n,i){const c=t.queries.getByIndex(n),p=c.matches;if(null!==p){const v=E1(t,e,c,n);for(let C=0;C<p.length;C+=2){const S=p[C];if(S>0)i.push(v[C/2]);else{const R=p[C+1],z=e[-S];for(let q=10;q<z.length;q++){const me=z[q];me[17]===me[3]&&Cx(me[1],me,R,i)}if(null!==z[9]){const q=z[9];for(let me=0;me<q.length;me++){const be=q[me];Cx(be[1],be,R,i)}}}}}return i}function M_(t){const e=pt(),n=or(),i=dh();fu(i+1);const c=S1(n,i);if(t.dirty&&ra(e)===(2==(2&c.metadata.flags))){if(null===c.matches)t.reset([]);else{const p=c.crossesNgTemplate?Cx(n,e,i,[]):E1(n,e,c,i);t.reset(p,PM),t.notifyOnChanges()}return!0}return!1}function Tx(t,e,n,i){const c=or();if(c.firstCreatePass){const p=Di();D1(c,new w1(e,n,i),p.index),function vI(t,e){const n=t.contentQueries||(t.contentQueries=[]);e!==(n.length?n[n.length-1]:-1)&&n.push(t.queries.length-1,e)}(c,t),2==(2&n)&&(c.staticContentQueries=!0)}T1(c,pt(),n)}function I_(){return function yI(t,e){return t[19].queries[e].queryList}(pt(),dh())}function T1(t,e,n){const i=new yx(4==(4&n));qp(t,e,i,i.destroy),null===e[19]&&(e[19]=new bx),e[19].queries.push(new xx(i))}function D1(t,e,n){null===t.queries&&(t.queries=new wx),t.queries.track(new Ex(e,n))}function S1(t,e){return t.queries.getByIndex(e)}function k_(...t){}const R_=new Xt("Application Initializer");let Px=(()=>{class t{constructor(n){this.appInits=n,this.resolve=k_,this.reject=k_,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,c)=>{this.resolve=i,this.reject=c})}runInitializers(){if(this.initialized)return;const n=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let c=0;c<this.appInits.length;c++){const p=this.appInits[c]();if(fm(p))n.push(p);else if(nx(p)){const v=new Promise((C,S)=>{p.subscribe({complete:C,error:S})});n.push(v)}}Promise.all(n).then(()=>{i()}).catch(c=>{this.reject(c)}),0===n.length&&i(),this.initialized=!0}}return t.\u0275fac=function(n){return new(n||t)(dn(R_,8))},t.\u0275prov=gn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const Tm=new Xt("AppId",{providedIn:"root",factory:function G1(){return`${kx()}${kx()}${kx()}`}});function kx(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const H1=new Xt("Platform Initializer"),Dm=new Xt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),q1=new Xt("appBootstrapListener");let NI=(()=>{class t{log(n){console.log(n)}warn(n){console.warn(n)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=gn({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();const Zu=new Xt("LocaleId",{providedIn:"root",factory:()=>li(Zu,wn.Optional|wn.SkipSelf)||function zI(){return"undefined"!=typeof $localize&&$localize.locale||b_}()});class VI{constructor(e,n){this.ngModuleFactory=e,this.componentFactories=n}}let Z1=(()=>{class t{compileModuleSync(n){return new mx(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const i=this.compileModuleSync(n),p=Oa(Ne(n).declarations).reduce((v,C)=>{const S=vr(C);return S&&v.push(new px(S)),v},[]);return new VI(i,p)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=gn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const jI=(()=>Promise.resolve(0))();function Rx(t){"undefined"==typeof Zone?jI.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class Po{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new bi(!1),this.onMicrotaskEmpty=new bi(!1),this.onStable=new bi(!1),this.onError=new bi(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const c=this;c._nesting=0,c._outer=c._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(c._inner=c._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(c._inner=c._inner.fork(Zone.longStackTraceZoneSpec)),c.shouldCoalesceEventChangeDetection=!i&&n,c.shouldCoalesceRunChangeDetection=i,c.lastRequestAnimationFrameId=-1,c.nativeRequestAnimationFrame=function $I(){let t=Nn.requestAnimationFrame,e=Nn.cancelAnimationFrame;if("undefined"!=typeof Zone&&t&&e){const n=t[Zone.__symbol__("OriginalDelegate")];n&&(t=n);const i=e[Zone.__symbol__("OriginalDelegate")];i&&(e=i)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function qI(t){const e=()=>{!function HI(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(Nn,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,Lx(t),t.isCheckStableRunning=!0,Ox(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),Lx(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,i,c,p,v,C)=>{try{return W1(t),n.invokeTask(c,p,v,C)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===p.type||t.shouldCoalesceRunChangeDetection)&&e(),X1(t)}},onInvoke:(n,i,c,p,v,C,S)=>{try{return W1(t),n.invoke(c,p,v,C,S)}finally{t.shouldCoalesceRunChangeDetection&&e(),X1(t)}},onHasTask:(n,i,c,p)=>{n.hasTask(c,p),i===c&&("microTask"==p.change?(t._hasPendingMicrotasks=p.microTask,Lx(t),Ox(t)):"macroTask"==p.change&&(t.hasPendingMacrotasks=p.macroTask))},onHandleError:(n,i,c,p)=>(n.handleError(c,p),t.runOutsideAngular(()=>t.onError.emit(p)),!1)})}(c)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Po.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Po.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,n,i){return this._inner.run(e,n,i)}runTask(e,n,i,c){const p=this._inner,v=p.scheduleEventTask("NgZoneEvent: "+c,e,GI,k_,k_);try{return p.runTask(v,n,i)}finally{p.cancelTask(v)}}runGuarded(e,n,i){return this._inner.runGuarded(e,n,i)}runOutsideAngular(e){return this._outer.run(e)}}const GI={};function Ox(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function Lx(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function W1(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function X1(t){t._nesting--,Ox(t)}class ZI{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new bi,this.onMicrotaskEmpty=new bi,this.onStable=new bi,this.onError=new bi}run(e,n,i){return e.apply(n,i)}runGuarded(e,n,i){return e.apply(n,i)}runOutsideAngular(e){return e()}runTask(e,n,i,c){return e.apply(n,i)}}let Fx=(()=>{class t{constructor(n){this._ngZone=n,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Po.assertNotInAngularZone(),Rx(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Rx(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(n)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,i,c){let p=-1;i&&i>0&&(p=setTimeout(()=>{this._callbacks=this._callbacks.filter(v=>v.timeoutId!==p),n(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:n,timeoutId:p,updateCb:c})}whenStable(n,i,c){if(c&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,i,c),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(n,i,c){return[]}}return t.\u0275fac=function(n){return new(n||t)(dn(Po))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})(),WI=(()=>{class t{constructor(){this._applications=new Map,Nx.addToWindow(this)}registerApplication(n,i){this._applications.set(n,i)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,i=!0){return Nx.findTestabilityInTree(this,n,i)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=gn({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();class XI{addToWindow(e){}findTestabilityInTree(e,n,i){return null}}let Nx=new XI,ad=null;const K1=new Xt("AllowMultipleToken"),Y1=new Xt("PlatformOnDestroy");class J1{constructor(e,n){this.name=e,this.token=n}}function Q1(t,e,n=[]){const i=`Platform: ${e}`,c=new Xt(i);return(p=[])=>{let v=zx();if(!v||v.injector.get(K1,!1)){const C=[...n,...p,{provide:c,useValue:!0}];t?t(C):function QI(t){if(ad&&!ad.get(K1,!1))throw new se(400,"");ad=t;const e=t.get(eE),n=t.get(H1,null);n&&n.forEach(i=>i())}(function tA(t=[],e){return Fi.create({name:e,providers:[{provide:Kh,useValue:"platform"},{provide:Y1,useValue:()=>ad=null},...t]})}(C,i))}return function eA(t){const e=zx();if(!e)throw new se(401,"");return e}()}}function zx(){var t;return null!==(t=null==ad?void 0:ad.get(eE))&&void 0!==t?t:null}let eE=(()=>{class t{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,i){const C=function nA(t,e){let n;return n="noop"===t?new ZI:("zone.js"===t?void 0:t)||new Po({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==e?void 0:e.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==e?void 0:e.ngZoneRunCoalescing)}),n}(i?i.ngZone:void 0,{ngZoneEventCoalescing:i&&i.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:i&&i.ngZoneRunCoalescing||!1}),S=[{provide:Po,useValue:C}];return C.run(()=>{const R=Fi.create({providers:S,parent:this.injector,name:n.moduleType.name}),z=n.create(R),q=z.injector.get(Au,null);if(!q)throw new se(402,"");return C.runOutsideAngular(()=>{const me=C.onError.subscribe({next:be=>{q.handleError(be)}});z.onDestroy(()=>{Bx(this._modules,z),me.unsubscribe()})}),function rA(t,e,n){try{const i=n();return fm(i)?i.catch(c=>{throw e.runOutsideAngular(()=>t.handleError(c)),c}):i}catch(i){throw e.runOutsideAngular(()=>t.handleError(i)),i}}(q,C,()=>{const me=z.injector.get(Px);return me.runInitializers(),me.donePromise.then(()=>(function kS(t){mn(t,"Expected localeId to be defined"),"string"==typeof t&&(Ow=t.toLowerCase().replace(/_/g,"-"))}(z.injector.get(Zu,b_)||b_),this._moduleDoBootstrap(z),z))})})}bootstrapModule(n,i=[]){const c=tE({},i);return function YI(t,e,n){const i=new mx(n);return Promise.resolve(i)}(0,0,n).then(p=>this.bootstrapModuleFactory(p,c))}_moduleDoBootstrap(n){const i=n.injector.get(O_);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(c=>i.bootstrap(c));else{if(!n.instance.ngDoBootstrap)throw new se(403,"");n.instance.ngDoBootstrap(i)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new se(404,"");this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const n=this._injector.get(Y1,null);null==n||n(),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(n){return new(n||t)(dn(Fi))},t.\u0275prov=gn({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();function tE(t,e){return Array.isArray(e)?e.reduce(tE,t):Object.assign(Object.assign({},t),e)}let O_=(()=>{class t{constructor(n,i,c,p){this._zone=n,this._injector=i,this._exceptionHandler=c,this._initStatus=p,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const v=new Be(S=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{S.next(this._stable),S.complete()})}),C=new Be(S=>{let R;this._zone.runOutsideAngular(()=>{R=this._zone.onStable.subscribe(()=>{Po.assertNotInAngularZone(),Rx(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,S.next(!0))})})});const z=this._zone.onUnstable.subscribe(()=>{Po.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{S.next(!1)}))});return()=>{R.unsubscribe(),z.unsubscribe()}});this.isStable=so(v,C.pipe(function Xr(){return t=>Wo()(Oi(Ei)(t))}()))}bootstrap(n,i){if(!this._initStatus.done)throw new se(405,"");let c;c=n instanceof o1?n:this._injector.get(vm).resolveComponentFactory(n),this.componentTypes.push(c.componentType);const p=function JI(t){return t.isBoundToModule}(c)?void 0:this._injector.get(Gc),C=c.create(Fi.NULL,[],i||c.selector,p),S=C.location.nativeElement,R=C.injector.get(Fx,null),z=R&&C.injector.get(WI);return R&&z&&z.registerApplication(S,R),C.onDestroy(()=>{this.detachView(C.hostView),Bx(this.components,C),z&&z.unregisterApplication(S)}),this._loadComponent(C),C}tick(){if(this._runningTick)throw new se(101,"");try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const i=n;this._views.push(i),i.attachToAppRef(this)}detachView(n){const i=n;Bx(this._views,i),i.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n),this._injector.get(q1,[]).concat(this._bootstrapListeners).forEach(c=>c(n))}ngOnDestroy(){this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return t.\u0275fac=function(n){return new(n||t)(dn(Po),dn(Fi),dn(Au),dn(Px))},t.\u0275prov=gn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function Bx(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}let rE=!0,L_=(()=>{class t{}return t.__NG_ELEMENT_ID__=sA,t})();function sA(t){return function aA(t,e,n){if(lc(t)&&!n){const i=$i(t.index,e);return new bm(i,i)}return 47&t.type?new bm(e[16],e):null}(Di(),pt(),16==(16&t))}const xA=Q1(null,"core",[]);let bA=(()=>{class t{constructor(n){}}return t.\u0275fac=function(n){return new(n||t)(dn(O_))},t.\u0275mod=qr({type:t}),t.\u0275inj=mr({}),t})(),B_=null;function tc(){return B_}const xa=new Xt("DocumentToken");let cd=(()=>{class t{historyGo(n){throw new Error("Not implemented")}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=gn({token:t,factory:function(){return function TA(){return dn(pE)}()},providedIn:"platform"}),t})();const DA=new Xt("Location Initialized");let pE=(()=>{class t extends cd{constructor(n){super(),this._doc=n,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return tc().getBaseHref(this._doc)}onPopState(n){const i=tc().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",n,!1),()=>i.removeEventListener("popstate",n)}onHashChange(n){const i=tc().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",n,!1),()=>i.removeEventListener("hashchange",n)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(n){this.location.pathname=n}pushState(n,i,c){mE()?this._history.pushState(n,i,c):this.location.hash=c}replaceState(n,i,c){mE()?this._history.replaceState(n,i,c):this.location.hash=c}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return t.\u0275fac=function(n){return new(n||t)(dn(xa))},t.\u0275prov=gn({token:t,factory:function(){return function SA(){return new pE(dn(xa))}()},providedIn:"platform"}),t})();function mE(){return!!window.history.pushState}function Gx(t,e){if(0==t.length)return e;if(0==e.length)return t;let n=0;return t.endsWith("/")&&n++,e.startsWith("/")&&n++,2==n?t+e.substring(1):1==n?t+e:t+"/"+e}function gE(t){const e=t.match(/#|\?|$/),n=e&&e.index||t.length;return t.slice(0,n-("/"===t[n-1]?1:0))+t.slice(n)}function qc(t){return t&&"?"!==t[0]?"?"+t:t}let zf=(()=>{class t{historyGo(n){throw new Error("Not implemented")}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=gn({token:t,factory:function(){return function MA(t){const e=dn(xa).location;return new _E(dn(cd),e&&e.origin||"")}()},providedIn:"root"}),t})();const Hx=new Xt("appBaseHref");let _E=(()=>{class t extends zf{constructor(n,i){if(super(),this._platformLocation=n,this._removeListenerFns=[],null==i&&(i=this._platformLocation.getBaseHrefFromDOM()),null==i)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=i}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return Gx(this._baseHref,n)}path(n=!1){const i=this._platformLocation.pathname+qc(this._platformLocation.search),c=this._platformLocation.hash;return c&&n?`${i}${c}`:i}pushState(n,i,c,p){const v=this.prepareExternalUrl(c+qc(p));this._platformLocation.pushState(n,i,v)}replaceState(n,i,c,p){const v=this.prepareExternalUrl(c+qc(p));this._platformLocation.replaceState(n,i,v)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){var i,c;null===(c=(i=this._platformLocation).historyGo)||void 0===c||c.call(i,n)}}return t.\u0275fac=function(n){return new(n||t)(dn(cd),dn(Hx,8))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})(),IA=(()=>{class t extends zf{constructor(n,i){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(n){const i=Gx(this._baseHref,n);return i.length>0?"#"+i:i}pushState(n,i,c,p){let v=this.prepareExternalUrl(c+qc(p));0==v.length&&(v=this._platformLocation.pathname),this._platformLocation.pushState(n,i,v)}replaceState(n,i,c,p){let v=this.prepareExternalUrl(c+qc(p));0==v.length&&(v=this._platformLocation.pathname),this._platformLocation.replaceState(n,i,v)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){var i,c;null===(c=(i=this._platformLocation).historyGo)||void 0===c||c.call(i,n)}}return t.\u0275fac=function(n){return new(n||t)(dn(cd),dn(Hx,8))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})(),qx=(()=>{class t{constructor(n,i){this._subject=new bi,this._urlChangeListeners=[],this._platformStrategy=n;const c=this._platformStrategy.getBaseHref();this._platformLocation=i,this._baseHref=gE(yE(c)),this._platformStrategy.onPopState(p=>{this._subject.emit({url:this.path(!0),pop:!0,state:p.state,type:p.type})})}path(n=!1){return this.normalize(this._platformStrategy.path(n))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(n,i=""){return this.path()==this.normalize(n+qc(i))}normalize(n){return t.stripTrailingSlash(function PA(t,e){return t&&e.startsWith(t)?e.substring(t.length):e}(this._baseHref,yE(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._platformStrategy.prepareExternalUrl(n)}go(n,i="",c=null){this._platformStrategy.pushState(c,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+qc(i)),c)}replaceState(n,i="",c=null){this._platformStrategy.replaceState(c,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+qc(i)),c)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(n=0){var i,c;null===(c=(i=this._platformStrategy).historyGo)||void 0===c||c.call(i,n)}onUrlChange(n){this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}))}_notifyUrlChangeListeners(n="",i){this._urlChangeListeners.forEach(c=>c(n,i))}subscribe(n,i,c){return this._subject.subscribe({next:n,error:i,complete:c})}}return t.normalizeQueryParams=qc,t.joinWithSlash=Gx,t.stripTrailingSlash=gE,t.\u0275fac=function(n){return new(n||t)(dn(zf),dn(cd))},t.\u0275prov=gn({token:t,factory:function(){return function AA(){return new qx(dn(zf),dn(cd))}()},providedIn:"root"}),t})();function yE(t){return t.replace(/\/index.html$/,"")}function SE(t,e){e=encodeURIComponent(e);for(const n of t.split(";")){const i=n.indexOf("="),[c,p]=-1==i?[n,""]:[n.slice(0,i),n.slice(i+1)];if(c.trim()===e)return decodeURIComponent(p)}return null}let kE=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=qr({type:t}),t.\u0275inj=mr({}),t})();const RE="browser";function OE(t){return t===RE}let X2=(()=>{class t{}return t.\u0275prov=gn({token:t,providedIn:"root",factory:()=>new K2(dn(xa),window)}),t})();class K2{constructor(e,n){this.document=e,this.window=n,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const n=function Y2(t,e){const n=t.getElementById(e)||t.getElementsByName(e)[0];if(n)return n;if("function"==typeof t.createTreeWalker&&t.body&&(t.body.createShadowRoot||t.body.attachShadow)){const i=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);let c=i.currentNode;for(;c;){const p=c.shadowRoot;if(p){const v=p.getElementById(e)||p.querySelector(`[name="${e}"]`);if(v)return v}c=i.nextNode()}}return null}(this.document,e);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=e)}}scrollToElement(e){const n=e.getBoundingClientRect(),i=n.left+this.window.pageXOffset,c=n.top+this.window.pageYOffset,p=this.offset();this.window.scrollTo(i-p[0],c-p[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=LE(this.window.history)||LE(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch(e){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(e){return!1}}}function LE(t){return Object.getOwnPropertyDescriptor(t,"scrollRestoration")}class FE{}class a0 extends class J2 extends class CA{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function EA(t){B_||(B_=t)}(new a0)}onAndCancel(e,n,i){return e.addEventListener(n,i,!1),()=>{e.removeEventListener(n,i,!1)}}dispatchEvent(e,n){e.dispatchEvent(n)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,n){return(n=n||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,n){return"window"===n?window:"document"===n?e:"body"===n?e.body:null}getBaseHref(e){const n=function Q2(){return Am=Am||document.querySelector("base"),Am?Am.getAttribute("href"):null}();return null==n?null:function eP(t){X_=X_||document.createElement("a"),X_.setAttribute("href",t);const e=X_.pathname;return"/"===e.charAt(0)?e:`/${e}`}(n)}resetBaseElement(){Am=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return SE(document.cookie,e)}}let X_,Am=null;const NE=new Xt("TRANSITION_ID"),nP=[{provide:R_,useFactory:function tP(t,e,n){return()=>{n.get(Px).donePromise.then(()=>{const i=tc(),c=e.querySelectorAll(`style[ng-transition="${t}"]`);for(let p=0;p<c.length;p++)i.remove(c[p])})}},deps:[NE,xa,Fi],multi:!0}];class l0{static init(){!function KI(t){Nx=t}(new l0)}addToWindow(e){Nn.getAngularTestability=(i,c=!0)=>{const p=e.findTestabilityInTree(i,c);if(null==p)throw new Error("Could not find testability for element.");return p},Nn.getAllAngularTestabilities=()=>e.getAllTestabilities(),Nn.getAllAngularRootElements=()=>e.getAllRootElements(),Nn.frameworkStabilizers||(Nn.frameworkStabilizers=[]),Nn.frameworkStabilizers.push(i=>{const c=Nn.getAllAngularTestabilities();let p=c.length,v=!1;const C=function(S){v=v||S,p--,0==p&&i(v)};c.forEach(function(S){S.whenStable(C)})})}findTestabilityInTree(e,n,i){if(null==n)return null;const c=e.getTestability(n);return null!=c?c:i?tc().isShadowRoot(n)?this.findTestabilityInTree(e,n.host,!0):this.findTestabilityInTree(e,n.parentElement,!0):null}}let rP=(()=>{class t{build(){return new XMLHttpRequest}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();const K_=new Xt("EventManagerPlugins");let Y_=(()=>{class t{constructor(n,i){this._zone=i,this._eventNameToPlugin=new Map,n.forEach(c=>c.manager=this),this._plugins=n.slice().reverse()}addEventListener(n,i,c){return this._findPluginFor(i).addEventListener(n,i,c)}addGlobalEventListener(n,i,c){return this._findPluginFor(i).addGlobalEventListener(n,i,c)}getZone(){return this._zone}_findPluginFor(n){const i=this._eventNameToPlugin.get(n);if(i)return i;const c=this._plugins;for(let p=0;p<c.length;p++){const v=c[p];if(v.supports(n))return this._eventNameToPlugin.set(n,v),v}throw new Error(`No event manager plugin found for event ${n}`)}}return t.\u0275fac=function(n){return new(n||t)(dn(K_),dn(Po))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();class zE{constructor(e){this._doc=e}addGlobalEventListener(e,n,i){const c=tc().getGlobalEventTarget(this._doc,e);if(!c)throw new Error(`Unsupported event target ${c} for event ${n}`);return this.addEventListener(c,n,i)}}let BE=(()=>{class t{constructor(){this._stylesSet=new Set}addStyles(n){const i=new Set;n.forEach(c=>{this._stylesSet.has(c)||(this._stylesSet.add(c),i.add(c))}),this.onStylesAdded(i)}onStylesAdded(n){}getAllStyles(){return Array.from(this._stylesSet)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})(),Pm=(()=>{class t extends BE{constructor(n){super(),this._doc=n,this._hostNodes=new Map,this._hostNodes.set(n.head,[])}_addStylesToHost(n,i,c){n.forEach(p=>{const v=this._doc.createElement("style");v.textContent=p,c.push(i.appendChild(v))})}addHost(n){const i=[];this._addStylesToHost(this._stylesSet,n,i),this._hostNodes.set(n,i)}removeHost(n){const i=this._hostNodes.get(n);i&&i.forEach(VE),this._hostNodes.delete(n)}onStylesAdded(n){this._hostNodes.forEach((i,c)=>{this._addStylesToHost(n,c,i)})}ngOnDestroy(){this._hostNodes.forEach(n=>n.forEach(VE))}}return t.\u0275fac=function(n){return new(n||t)(dn(xa))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();function VE(t){tc().remove(t)}const c0={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},u0=/%COMP%/g;function J_(t,e,n){for(let i=0;i<e.length;i++){let c=e[i];Array.isArray(c)?J_(t,c,n):(c=c.replace(u0,t),n.push(c))}return n}function $E(t){return e=>{if("__ngUnwrap__"===e)return t;!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}let h0=(()=>{class t{constructor(n,i,c){this.eventManager=n,this.sharedStylesHost=i,this.appId=c,this.rendererByCompId=new Map,this.defaultRenderer=new d0(n)}createRenderer(n,i){if(!n||!i)return this.defaultRenderer;switch(i.encapsulation){case Li.Emulated:{let c=this.rendererByCompId.get(i.id);return c||(c=new cP(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,c)),c.applyToHost(n),c}case 1:case Li.ShadowDom:return new uP(this.eventManager,this.sharedStylesHost,n,i);default:if(!this.rendererByCompId.has(i.id)){const c=J_(i.id,i.styles,[]);this.sharedStylesHost.addStyles(c),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return t.\u0275fac=function(n){return new(n||t)(dn(Y_),dn(Pm),dn(Tm))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();class d0{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,n){return n?document.createElementNS(c0[n]||n,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,n){e.appendChild(n)}insertBefore(e,n,i){e&&e.insertBefore(n,i)}removeChild(e,n){e&&e.removeChild(n)}selectRootElement(e,n){let i="string"==typeof e?document.querySelector(e):e;if(!i)throw new Error(`The selector "${e}" did not match any elements`);return n||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,n,i,c){if(c){n=c+":"+n;const p=c0[c];p?e.setAttributeNS(p,n,i):e.setAttribute(n,i)}else e.setAttribute(n,i)}removeAttribute(e,n,i){if(i){const c=c0[i];c?e.removeAttributeNS(c,n):e.removeAttribute(`${i}:${n}`)}else e.removeAttribute(n)}addClass(e,n){e.classList.add(n)}removeClass(e,n){e.classList.remove(n)}setStyle(e,n,i,c){c&(xs.DashCase|xs.Important)?e.style.setProperty(n,i,c&xs.Important?"important":""):e.style[n]=i}removeStyle(e,n,i){i&xs.DashCase?e.style.removeProperty(n):e.style[n]=""}setProperty(e,n,i){e[n]=i}setValue(e,n){e.nodeValue=n}listen(e,n,i){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,n,$E(i)):this.eventManager.addEventListener(e,n,$E(i))}}class cP extends d0{constructor(e,n,i,c){super(e),this.component=i;const p=J_(c+"-"+i.id,i.styles,[]);n.addStyles(p),this.contentAttr=function sP(t){return"_ngcontent-%COMP%".replace(u0,t)}(c+"-"+i.id),this.hostAttr=function aP(t){return"_nghost-%COMP%".replace(u0,t)}(c+"-"+i.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,n){const i=super.createElement(e,n);return super.setAttribute(i,this.contentAttr,""),i}}class uP extends d0{constructor(e,n,i,c){super(e),this.sharedStylesHost=n,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const p=J_(c.id,c.styles,[]);for(let v=0;v<p.length;v++){const C=document.createElement("style");C.textContent=p[v],this.shadowRoot.appendChild(C)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,n){return super.appendChild(this.nodeOrShadowRoot(e),n)}insertBefore(e,n,i){return super.insertBefore(this.nodeOrShadowRoot(e),n,i)}removeChild(e,n){return super.removeChild(this.nodeOrShadowRoot(e),n)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let hP=(()=>{class t extends zE{constructor(n){super(n)}supports(n){return!0}addEventListener(n,i,c){return n.addEventListener(i,c,!1),()=>this.removeEventListener(n,i,c)}removeEventListener(n,i,c){return n.removeEventListener(i,c)}}return t.\u0275fac=function(n){return new(n||t)(dn(xa))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();const HE=["alt","control","meta","shift"],fP={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},qE={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},pP={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let mP=(()=>{class t extends zE{constructor(n){super(n)}supports(n){return null!=t.parseEventName(n)}addEventListener(n,i,c){const p=t.parseEventName(i),v=t.eventCallback(p.fullKey,c,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>tc().onAndCancel(n,p.domEventName,v))}static parseEventName(n){const i=n.toLowerCase().split("."),c=i.shift();if(0===i.length||"keydown"!==c&&"keyup"!==c)return null;const p=t._normalizeKey(i.pop());let v="";if(HE.forEach(S=>{const R=i.indexOf(S);R>-1&&(i.splice(R,1),v+=S+".")}),v+=p,0!=i.length||0===p.length)return null;const C={};return C.domEventName=c,C.fullKey=v,C}static getEventFullKey(n){let i="",c=function gP(t){let e=t.key;if(null==e){if(e=t.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===t.location&&qE.hasOwnProperty(e)&&(e=qE[e]))}return fP[e]||e}(n);return c=c.toLowerCase()," "===c?c="space":"."===c&&(c="dot"),HE.forEach(p=>{p!=c&&pP[p](n)&&(i+=p+".")}),i+=c,i}static eventCallback(n,i,c){return p=>{t.getEventFullKey(p)===n&&c.runGuarded(()=>i(p))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return t.\u0275fac=function(n){return new(n||t)(dn(xa))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();const xP=Q1(xA,"browser",[{provide:Dm,useValue:RE},{provide:H1,useValue:function _P(){a0.makeCurrent(),l0.init()},multi:!0},{provide:xa,useFactory:function vP(){return function na(t){Da=t}(document),document},deps:[]}]),bP=[{provide:Kh,useValue:"root"},{provide:Au,useFactory:function yP(){return new Au},deps:[]},{provide:K_,useClass:hP,multi:!0,deps:[xa,Po,Dm]},{provide:K_,useClass:mP,multi:!0,deps:[xa]},{provide:h0,useClass:h0,deps:[Y_,Pm,Tm]},{provide:a1,useExisting:h0},{provide:BE,useExisting:Pm},{provide:Pm,useClass:Pm,deps:[xa]},{provide:Fx,useClass:Fx,deps:[Po]},{provide:Y_,useClass:Y_,deps:[K_,Po]},{provide:FE,useClass:rP,deps:[]}];let wP=(()=>{class t{constructor(n){if(n)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(n){return{ngModule:t,providers:[{provide:Tm,useValue:n.appId},{provide:NE,useExisting:Tm},nP]}}}return t.\u0275fac=function(n){return new(n||t)(dn(t,12))},t.\u0275mod=qr({type:t}),t.\u0275inj=mr({providers:bP,imports:[kE,bA]}),t})();function Zn(...t){let e=t[t.length-1];return ut(e)?(t.pop(),Rn(t,e)):Ri(t)}"undefined"!=typeof window&&window;class Tl extends Et{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const n=super._subscribe(e);return n&&!n.closed&&e.next(this._value),n}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new gt;return this._value}next(e){super.next(this._value=e)}}class RP extends Ce{notifyNext(e,n,i,c,p){this.destination.next(n)}notifyError(e,n){this.destination.error(e)}notifyComplete(e){this.destination.complete()}}class OP extends Ce{constructor(e,n,i){super(),this.parent=e,this.outerValue=n,this.outerIndex=i,this.index=0}_next(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}_error(e){this.parent.notifyError(e,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}function LP(t,e,n,i,c=new OP(t,n,i)){if(!c.closed)return e instanceof Be?e.subscribe(c):Gt(e)(c)}const XE={};class NP{constructor(e){this.resultSelector=e}call(e,n){return n.subscribe(new zP(e,this.resultSelector))}}class zP extends RP{constructor(e,n){super(e),this.resultSelector=n,this.active=0,this.values=[],this.observables=[]}_next(e){this.values.push(XE),this.observables.push(e)}_complete(){const e=this.observables,n=e.length;if(0===n)this.destination.complete();else{this.active=n,this.toRespond=n;for(let i=0;i<n;i++)this.add(LP(this,e[i],void 0,i))}}notifyComplete(e){0==(this.active-=1)&&this.destination.complete()}notifyNext(e,n,i){const c=this.values,v=this.toRespond?c[i]===XE?--this.toRespond:this.toRespond:0;c[i]=n,0===v&&(this.resultSelector?this._tryResultSelector(c):this.destination.next(c.slice()))}_tryResultSelector(e){let n;try{n=this.resultSelector.apply(this,e)}catch(i){return void this.destination.error(i)}this.destination.next(n)}}function Bf(t,e){return new Be(e?n=>e.schedule(BP,0,{error:t,subscriber:n}):n=>n.error(t))}function BP({error:t,subscriber:e}){e.error(t)}const Q_=(()=>{function t(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t.prototype=Object.create(Error.prototype),t})();function ey(...t){return function VP(){return mi(1)}()(Zn(...t))}const Vf=new Be(t=>t.complete());function ty(t){return t?function UP(t){return new Be(e=>t.schedule(()=>e.complete()))}(t):Vf}function ny(t){return new Be(e=>{let n;try{n=t()}catch(c){return void e.error(c)}return(n?ar(n):ty()).subscribe(e)})}function $a(t,e){return"function"==typeof e?n=>n.pipe($a((i,c)=>ar(t(i,c)).pipe(rt((p,v)=>e(i,p,c,v))))):n=>n.lift(new jP(t))}class jP{constructor(e){this.project=e}call(e,n){return n.subscribe(new $P(e,this.project))}}class $P extends Wr{constructor(e,n){super(e),this.project=n,this.index=0}_next(e){let n;const i=this.index++;try{n=this.project(e,i)}catch(c){return void this.destination.error(c)}this._innerSub(n)}_innerSub(e){const n=this.innerSubscription;n&&n.unsubscribe();const i=new Un(this),c=this.destination;c.add(i),this.innerSubscription=ko(e,i),this.innerSubscription!==i&&c.add(this.innerSubscription)}_complete(){const{innerSubscription:e}=this;(!e||e.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(e){this.destination.next(e)}}const KE=(()=>{function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t})();function Wc(t){return e=>0===t?ty():e.lift(new GP(t))}class GP{constructor(e){if(this.total=e,this.total<0)throw new KE}call(e,n){return n.subscribe(new HP(e,this.total))}}class HP extends Ce{constructor(e,n){super(e),this.total=n,this.count=0}_next(e){const n=this.total,i=++this.count;i<=n&&(this.destination.next(e),i===n&&(this.destination.complete(),this.unsubscribe()))}}function YE(t,e){let n=!1;return arguments.length>=2&&(n=!0),function(c){return c.lift(new ZP(t,e,n))}}class ZP{constructor(e,n,i=!1){this.accumulator=e,this.seed=n,this.hasSeed=i}call(e,n){return n.subscribe(new WP(e,this.accumulator,this.seed,this.hasSeed))}}class WP extends Ce{constructor(e,n,i,c){super(e),this.accumulator=n,this._seed=i,this.hasSeed=c,this.index=0}get seed(){return this._seed}set seed(e){this.hasSeed=!0,this._seed=e}_next(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}_tryNext(e){const n=this.index++;let i;try{i=this.accumulator(this.seed,e,n)}catch(c){this.destination.error(c)}this.seed=i,this.destination.next(i)}}function ba(t,e){return function(i){return i.lift(new XP(t,e))}}class XP{constructor(e,n){this.predicate=e,this.thisArg=n}call(e,n){return n.subscribe(new KP(e,this.predicate,this.thisArg))}}class KP extends Ce{constructor(e,n,i){super(e),this.predicate=n,this.thisArg=i,this.count=0}_next(e){let n;try{n=this.predicate.call(this.thisArg,e,this.count++)}catch(i){return void this.destination.error(i)}n&&this.destination.next(e)}}function ud(t){return function(n){const i=new YP(t),c=n.lift(i);return i.caught=c}}class YP{constructor(e){this.selector=e}call(e,n){return n.subscribe(new JP(e,this.selector,this.caught))}}class JP extends Wr{constructor(e,n,i){super(e),this.selector=n,this.caught=i}error(e){if(!this.isStopped){let n;try{n=this.selector(e,this.caught)}catch(p){return void super.error(p)}this._unsubscribeAndRecycle();const i=new Un(this);this.add(i);const c=ko(n,i);c!==i&&this.add(c)}}}function Uf(t,e){return Br(t,e,1)}function p0(t){return function(n){return 0===t?ty():n.lift(new QP(t))}}class QP{constructor(e){if(this.total=e,this.total<0)throw new KE}call(e,n){return n.subscribe(new ek(e,this.total))}}class ek extends Ce{constructor(e,n){super(e),this.total=n,this.ring=new Array,this.count=0}_next(e){const n=this.ring,i=this.total,c=this.count++;n.length<i?n.push(e):n[c%i]=e}_complete(){const e=this.destination;let n=this.count;if(n>0){const i=this.count>=this.total?this.total:this.count,c=this.ring;for(let p=0;p<i;p++){const v=n++%i;e.next(c[v])}}e.complete()}}function JE(t=rk){return e=>e.lift(new tk(t))}class tk{constructor(e){this.errorFactory=e}call(e,n){return n.subscribe(new nk(e,this.errorFactory))}}class nk extends Ce{constructor(e,n){super(e),this.errorFactory=n,this.hasValue=!1}_next(e){this.hasValue=!0,this.destination.next(e)}_complete(){if(this.hasValue)return this.destination.complete();{let e;try{e=this.errorFactory()}catch(n){e=n}this.destination.error(e)}}}function rk(){return new Q_}function QE(t=null){return e=>e.lift(new ik(t))}class ik{constructor(e){this.defaultValue=e}call(e,n){return n.subscribe(new ok(e,this.defaultValue))}}class ok extends Ce{constructor(e,n){super(e),this.defaultValue=n,this.isEmpty=!0}_next(e){this.isEmpty=!1,this.destination.next(e)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function jf(t,e){const n=arguments.length>=2;return i=>i.pipe(t?ba((c,p)=>t(c,p,i)):J,Wc(1),n?QE(e):JE(()=>new Q_))}function Xc(){}function Ks(t,e,n){return function(c){return c.lift(new ak(t,e,n))}}class ak{constructor(e,n,i){this.nextOrObserver=e,this.error=n,this.complete=i}call(e,n){return n.subscribe(new lk(e,this.nextOrObserver,this.error,this.complete))}}class lk extends Ce{constructor(e,n,i,c){super(e),this._tapNext=Xc,this._tapError=Xc,this._tapComplete=Xc,this._tapError=i||Xc,this._tapComplete=c||Xc,lt(n)?(this._context=this,this._tapNext=n):n&&(this._context=n,this._tapNext=n.next||Xc,this._tapError=n.error||Xc,this._tapComplete=n.complete||Xc)}_next(e){try{this._tapNext.call(this._context,e)}catch(n){return void this.destination.error(n)}this.destination.next(e)}_error(e){try{this._tapError.call(this._context,e)}catch(n){return void this.destination.error(n)}this.destination.error(e)}_complete(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}class uk{constructor(e){this.callback=e}call(e,n){return n.subscribe(new hk(e,this.callback))}}class hk extends Ce{constructor(e,n){super(e),this.add(new W(n))}}class Kc{constructor(e,n){this.id=e,this.url=n}}class m0 extends Kc{constructor(e,n,i="imperative",c=null){super(e,n),this.navigationTrigger=i,this.restoredState=c}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class km extends Kc{constructor(e,n,i){super(e,n),this.urlAfterRedirects=i}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class eC extends Kc{constructor(e,n,i){super(e,n),this.reason=i}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class dk extends Kc{constructor(e,n,i){super(e,n),this.error=i}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class fk extends Kc{constructor(e,n,i,c){super(e,n),this.urlAfterRedirects=i,this.state=c}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class pk extends Kc{constructor(e,n,i,c){super(e,n),this.urlAfterRedirects=i,this.state=c}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class mk extends Kc{constructor(e,n,i,c,p){super(e,n),this.urlAfterRedirects=i,this.state=c,this.shouldActivate=p}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class gk extends Kc{constructor(e,n,i,c){super(e,n),this.urlAfterRedirects=i,this.state=c}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _k extends Kc{constructor(e,n,i,c){super(e,n),this.urlAfterRedirects=i,this.state=c}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class tC{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class nC{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class yk{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class vk{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class xk{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class bk{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class rC{constructor(e,n,i){this.routerEvent=e,this.position=n,this.anchor=i}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const _r="primary";class wk{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const n=this.params[e];return Array.isArray(n)?n[0]:n}return null}getAll(e){if(this.has(e)){const n=this.params[e];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function $f(t){return new wk(t)}const iC="ngNavigationCancelingError";function g0(t){const e=Error("NavigationCancelingError: "+t);return e[iC]=!0,e}function Ck(t,e,n){const i=n.path.split("/");if(i.length>t.length||"full"===n.pathMatch&&(e.hasChildren()||i.length<t.length))return null;const c={};for(let p=0;p<i.length;p++){const v=i[p],C=t[p];if(v.startsWith(":"))c[v.substring(1)]=C;else if(v!==C.path)return null}return{consumed:t.slice(0,i.length),posParams:c}}function nc(t,e){const n=t?Object.keys(t):void 0,i=e?Object.keys(e):void 0;if(!n||!i||n.length!=i.length)return!1;let c;for(let p=0;p<n.length;p++)if(c=n[p],!oC(t[c],e[c]))return!1;return!0}function oC(t,e){if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;const n=[...t].sort(),i=[...e].sort();return n.every((c,p)=>i[p]===c)}return t===e}function sC(t){return Array.prototype.concat.apply([],t)}function aC(t){return t.length>0?t[t.length-1]:null}function qo(t,e){for(const n in t)t.hasOwnProperty(n)&&e(t[n],n)}function rc(t){return nx(t)?t:fm(t)?ar(Promise.resolve(t)):Zn(t)}const Sk={exact:function uC(t,e,n){if(!dd(t.segments,e.segments)||!ry(t.segments,e.segments,n)||t.numberOfChildren!==e.numberOfChildren)return!1;for(const i in e.children)if(!t.children[i]||!uC(t.children[i],e.children[i],n))return!1;return!0},subset:hC},lC={exact:function Mk(t,e){return nc(t,e)},subset:function Ik(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(n=>oC(t[n],e[n]))},ignored:()=>!0};function cC(t,e,n){return Sk[n.paths](t.root,e.root,n.matrixParams)&&lC[n.queryParams](t.queryParams,e.queryParams)&&!("exact"===n.fragment&&t.fragment!==e.fragment)}function hC(t,e,n){return dC(t,e,e.segments,n)}function dC(t,e,n,i){if(t.segments.length>n.length){const c=t.segments.slice(0,n.length);return!(!dd(c,n)||e.hasChildren()||!ry(c,n,i))}if(t.segments.length===n.length){if(!dd(t.segments,n)||!ry(t.segments,n,i))return!1;for(const c in e.children)if(!t.children[c]||!hC(t.children[c],e.children[c],i))return!1;return!0}{const c=n.slice(0,t.segments.length),p=n.slice(t.segments.length);return!!(dd(t.segments,c)&&ry(t.segments,c,i)&&t.children[_r])&&dC(t.children[_r],e,p,i)}}function ry(t,e,n){return e.every((i,c)=>lC[n](t[c].parameters,i.parameters))}class hd{constructor(e,n,i){this.root=e,this.queryParams=n,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=$f(this.queryParams)),this._queryParamMap}toString(){return kk.serialize(this)}}class Er{constructor(e,n){this.segments=e,this.children=n,this.parent=null,qo(n,(i,c)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return iy(this)}}class Rm{constructor(e,n){this.path=e,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=$f(this.parameters)),this._parameterMap}toString(){return _C(this)}}function dd(t,e){return t.length===e.length&&t.every((n,i)=>n.path===e[i].path)}class fC{}class pC{parse(e){const n=new Uk(e);return new hd(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(e){const n=`/${Om(e.root,!0)}`,i=function Lk(t){const e=Object.keys(t).map(n=>{const i=t[n];return Array.isArray(i)?i.map(c=>`${oy(n)}=${oy(c)}`).join("&"):`${oy(n)}=${oy(i)}`}).filter(n=>!!n);return e.length?`?${e.join("&")}`:""}(e.queryParams),c="string"==typeof e.fragment?`#${function Rk(t){return encodeURI(t)}(e.fragment)}`:"";return`${n}${i}${c}`}}const kk=new pC;function iy(t){return t.segments.map(e=>_C(e)).join("/")}function Om(t,e){if(!t.hasChildren())return iy(t);if(e){const n=t.children[_r]?Om(t.children[_r],!1):"",i=[];return qo(t.children,(c,p)=>{p!==_r&&i.push(`${p}:${Om(c,!1)}`)}),i.length>0?`${n}(${i.join("//")})`:n}{const n=function Pk(t,e){let n=[];return qo(t.children,(i,c)=>{c===_r&&(n=n.concat(e(i,c)))}),qo(t.children,(i,c)=>{c!==_r&&(n=n.concat(e(i,c)))}),n}(t,(i,c)=>c===_r?[Om(t.children[_r],!1)]:[`${c}:${Om(i,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[_r]?`${iy(t)}/${n[0]}`:`${iy(t)}/(${n.join("//")})`}}function mC(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function oy(t){return mC(t).replace(/%3B/gi,";")}function _0(t){return mC(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function sy(t){return decodeURIComponent(t)}function gC(t){return sy(t.replace(/\+/g,"%20"))}function _C(t){return`${_0(t.path)}${function Ok(t){return Object.keys(t).map(e=>`;${_0(e)}=${_0(t[e])}`).join("")}(t.parameters)}`}const Fk=/^[^\/()?;=#]+/;function ay(t){const e=t.match(Fk);return e?e[0]:""}const Nk=/^[^=?&#]+/,Bk=/^[^&#]+/;class Uk{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Er([],{}):new Er([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(e.length>0||Object.keys(n).length>0)&&(i[_r]=new Er(e,n)),i}parseSegment(){const e=ay(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new Rm(sy(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const n=ay(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){const c=ay(this.remaining);c&&(i=c,this.capture(i))}e[sy(n)]=sy(i)}parseQueryParam(e){const n=function zk(t){const e=t.match(Nk);return e?e[0]:""}(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){const v=function Vk(t){const e=t.match(Bk);return e?e[0]:""}(this.remaining);v&&(i=v,this.capture(i))}const c=gC(n),p=gC(i);if(e.hasOwnProperty(c)){let v=e[c];Array.isArray(v)||(v=[v],e[c]=v),v.push(p)}else e[c]=p}parseParens(e){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=ay(this.remaining),c=this.remaining[i.length];if("/"!==c&&")"!==c&&";"!==c)throw new Error(`Cannot parse url '${this.url}'`);let p;i.indexOf(":")>-1?(p=i.substr(0,i.indexOf(":")),this.capture(p),this.capture(":")):e&&(p=_r);const v=this.parseChildren();n[p]=1===Object.keys(v).length?v[_r]:new Er([],v),this.consumeOptional("//")}return n}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class yC{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const n=this.pathFromRoot(e);return n.length>1?n[n.length-2]:null}children(e){const n=y0(e,this._root);return n?n.children.map(i=>i.value):[]}firstChild(e){const n=y0(e,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(e){const n=v0(e,this._root);return n.length<2?[]:n[n.length-2].children.map(c=>c.value).filter(c=>c!==e)}pathFromRoot(e){return v0(e,this._root).map(n=>n.value)}}function y0(t,e){if(t===e.value)return e;for(const n of e.children){const i=y0(t,n);if(i)return i}return null}function v0(t,e){if(t===e.value)return[e];for(const n of e.children){const i=v0(t,n);if(i.length)return i.unshift(e),i}return[]}class Yc{constructor(e,n){this.value=e,this.children=n}toString(){return`TreeNode(${this.value})`}}function Gf(t){const e={};return t&&t.children.forEach(n=>e[n.value.outlet]=n),e}class vC extends yC{constructor(e,n){super(e),this.snapshot=n,x0(this,e)}toString(){return this.snapshot.toString()}}function xC(t,e){const n=function jk(t,e){const v=new ly([],{},{},"",{},_r,e,null,t.root,-1,{});return new wC("",new Yc(v,[]))}(t,e),i=new Tl([new Rm("",{})]),c=new Tl({}),p=new Tl({}),v=new Tl({}),C=new Tl(""),S=new Hf(i,c,v,C,p,_r,e,n.root);return S.snapshot=n.root,new vC(new Yc(S,[]),n)}class Hf{constructor(e,n,i,c,p,v,C,S){this.url=e,this.params=n,this.queryParams=i,this.fragment=c,this.data=p,this.outlet=v,this.component=C,this._futureSnapshot=S}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(rt(e=>$f(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(rt(e=>$f(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function bC(t,e="emptyOnly"){const n=t.pathFromRoot;let i=0;if("always"!==e)for(i=n.length-1;i>=1;){const c=n[i],p=n[i-1];if(c.routeConfig&&""===c.routeConfig.path)i--;else{if(p.component)break;i--}}return function $k(t){return t.reduce((e,n)=>({params:Object.assign(Object.assign({},e.params),n.params),data:Object.assign(Object.assign({},e.data),n.data),resolve:Object.assign(Object.assign({},e.resolve),n._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(i))}class ly{constructor(e,n,i,c,p,v,C,S,R,z,q){this.url=e,this.params=n,this.queryParams=i,this.fragment=c,this.data=p,this.outlet=v,this.component=C,this.routeConfig=S,this._urlSegment=R,this._lastPathIndex=z,this._resolve=q}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=$f(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=$f(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class wC extends yC{constructor(e,n){super(n),this.url=e,x0(this,n)}toString(){return EC(this._root)}}function x0(t,e){e.value._routerState=t,e.children.forEach(n=>x0(t,n))}function EC(t){const e=t.children.length>0?` { ${t.children.map(EC).join(", ")} } `:"";return`${t.value}${e}`}function b0(t){if(t.snapshot){const e=t.snapshot,n=t._futureSnapshot;t.snapshot=n,nc(e.queryParams,n.queryParams)||t.queryParams.next(n.queryParams),e.fragment!==n.fragment&&t.fragment.next(n.fragment),nc(e.params,n.params)||t.params.next(n.params),function Tk(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!nc(t[n],e[n]))return!1;return!0}(e.url,n.url)||t.url.next(n.url),nc(e.data,n.data)||t.data.next(n.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function w0(t,e){const n=nc(t.params,e.params)&&function Ak(t,e){return dd(t,e)&&t.every((n,i)=>nc(n.parameters,e[i].parameters))}(t.url,e.url);return n&&!(!t.parent!=!e.parent)&&(!t.parent||w0(t.parent,e.parent))}function Lm(t,e,n){if(n&&t.shouldReuseRoute(e.value,n.value.snapshot)){const i=n.value;i._futureSnapshot=e.value;const c=function Hk(t,e,n){return e.children.map(i=>{for(const c of n.children)if(t.shouldReuseRoute(i.value,c.value.snapshot))return Lm(t,i,c);return Lm(t,i)})}(t,e,n);return new Yc(i,c)}{if(t.shouldAttach(e.value)){const p=t.retrieve(e.value);if(null!==p){const v=p.route;return v.value._futureSnapshot=e.value,v.children=e.children.map(C=>Lm(t,C)),v}}const i=function qk(t){return new Hf(new Tl(t.url),new Tl(t.params),new Tl(t.queryParams),new Tl(t.fragment),new Tl(t.data),t.outlet,t.component,t)}(e.value),c=e.children.map(p=>Lm(t,p));return new Yc(i,c)}}function cy(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function Fm(t){return"object"==typeof t&&null!=t&&t.outlets}function E0(t,e,n,i,c){let p={};if(i&&qo(i,(C,S)=>{p[S]=Array.isArray(C)?C.map(R=>`${R}`):`${C}`}),t===e)return new hd(n,p,c);const v=CC(t,e,n);return new hd(v,p,c)}function CC(t,e,n){const i={};return qo(t.children,(c,p)=>{i[p]=c===e?n:CC(c,e,n)}),new Er(t.segments,i)}class TC{constructor(e,n,i){if(this.isAbsolute=e,this.numberOfDoubleDots=n,this.commands=i,e&&i.length>0&&cy(i[0]))throw new Error("Root segment cannot have matrix parameters");const c=i.find(Fm);if(c&&c!==aC(i))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class C0{constructor(e,n,i){this.segmentGroup=e,this.processChildren=n,this.index=i}}function DC(t,e,n){if(t||(t=new Er([],{})),0===t.segments.length&&t.hasChildren())return uy(t,e,n);const i=function Jk(t,e,n){let i=0,c=e;const p={match:!1,pathIndex:0,commandIndex:0};for(;c<t.segments.length;){if(i>=n.length)return p;const v=t.segments[c],C=n[i];if(Fm(C))break;const S=`${C}`,R=i<n.length-1?n[i+1]:null;if(c>0&&void 0===S)break;if(S&&R&&"object"==typeof R&&void 0===R.outlets){if(!MC(S,R,v))return p;i+=2}else{if(!MC(S,{},v))return p;i++}c++}return{match:!0,pathIndex:c,commandIndex:i}}(t,e,n),c=n.slice(i.commandIndex);if(i.match&&i.pathIndex<t.segments.length){const p=new Er(t.segments.slice(0,i.pathIndex),{});return p.children[_r]=new Er(t.segments.slice(i.pathIndex),t.children),uy(p,0,c)}return i.match&&0===c.length?new Er(t.segments,{}):i.match&&!t.hasChildren()?T0(t,e,n):i.match?uy(t,0,c):T0(t,e,n)}function uy(t,e,n){if(0===n.length)return new Er(t.segments,{});{const i=function Yk(t){return Fm(t[0])?t[0].outlets:{[_r]:t}}(n),c={};return qo(i,(p,v)=>{"string"==typeof p&&(p=[p]),null!==p&&(c[v]=DC(t.children[v],e,p))}),qo(t.children,(p,v)=>{void 0===i[v]&&(c[v]=p)}),new Er(t.segments,c)}}function T0(t,e,n){const i=t.segments.slice(0,e);let c=0;for(;c<n.length;){const p=n[c];if(Fm(p)){const S=Qk(p.outlets);return new Er(i,S)}if(0===c&&cy(n[0])){i.push(new Rm(t.segments[e].path,SC(n[0]))),c++;continue}const v=Fm(p)?p.outlets[_r]:`${p}`,C=c<n.length-1?n[c+1]:null;v&&C&&cy(C)?(i.push(new Rm(v,SC(C))),c+=2):(i.push(new Rm(v,{})),c++)}return new Er(i,{})}function Qk(t){const e={};return qo(t,(n,i)=>{"string"==typeof n&&(n=[n]),null!==n&&(e[i]=T0(new Er([],{}),0,n))}),e}function SC(t){const e={};return qo(t,(n,i)=>e[i]=`${n}`),e}function MC(t,e,n){return t==n.path&&nc(e,n.parameters)}class tR{constructor(e,n,i,c){this.routeReuseStrategy=e,this.futureState=n,this.currState=i,this.forwardEvent=c}activate(e){const n=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,i,e),b0(this.futureState.root),this.activateChildRoutes(n,i,e)}deactivateChildRoutes(e,n,i){const c=Gf(n);e.children.forEach(p=>{const v=p.value.outlet;this.deactivateRoutes(p,c[v],i),delete c[v]}),qo(c,(p,v)=>{this.deactivateRouteAndItsChildren(p,i)})}deactivateRoutes(e,n,i){const c=e.value,p=n?n.value:null;if(c===p)if(c.component){const v=i.getContext(c.outlet);v&&this.deactivateChildRoutes(e,n,v.children)}else this.deactivateChildRoutes(e,n,i);else p&&this.deactivateRouteAndItsChildren(n,i)}deactivateRouteAndItsChildren(e,n){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,n):this.deactivateRouteAndOutlet(e,n)}detachAndStoreRouteSubtree(e,n){const i=n.getContext(e.value.outlet),c=i&&e.value.component?i.children:n,p=Gf(e);for(const v of Object.keys(p))this.deactivateRouteAndItsChildren(p[v],c);if(i&&i.outlet){const v=i.outlet.detach(),C=i.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:v,route:e,contexts:C})}}deactivateRouteAndOutlet(e,n){const i=n.getContext(e.value.outlet),c=i&&e.value.component?i.children:n,p=Gf(e);for(const v of Object.keys(p))this.deactivateRouteAndItsChildren(p[v],c);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(e,n,i){const c=Gf(n);e.children.forEach(p=>{this.activateRoutes(p,c[p.value.outlet],i),this.forwardEvent(new bk(p.value.snapshot))}),e.children.length&&this.forwardEvent(new vk(e.value.snapshot))}activateRoutes(e,n,i){const c=e.value,p=n?n.value:null;if(b0(c),c===p)if(c.component){const v=i.getOrCreateContext(c.outlet);this.activateChildRoutes(e,n,v.children)}else this.activateChildRoutes(e,n,i);else if(c.component){const v=i.getOrCreateContext(c.outlet);if(this.routeReuseStrategy.shouldAttach(c.snapshot)){const C=this.routeReuseStrategy.retrieve(c.snapshot);this.routeReuseStrategy.store(c.snapshot,null),v.children.onOutletReAttached(C.contexts),v.attachRef=C.componentRef,v.route=C.route.value,v.outlet&&v.outlet.attach(C.componentRef,C.route.value),b0(C.route.value),this.activateChildRoutes(e,null,v.children)}else{const C=function nR(t){for(let e=t.parent;e;e=e.parent){const n=e.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(c.snapshot),S=C?C.module.componentFactoryResolver:null;v.attachRef=null,v.route=c,v.resolver=S,v.outlet&&v.outlet.activateWith(c,S),this.activateChildRoutes(e,null,v.children)}}else this.activateChildRoutes(e,null,i)}}class D0{constructor(e,n){this.routes=e,this.module=n}}function Xu(t){return"function"==typeof t}function fd(t){return t instanceof hd}const Nm=Symbol("INITIAL_VALUE");function zm(){return $a(t=>function FP(...t){let e,n;return ut(t[t.length-1])&&(n=t.pop()),"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&Y(t[0])&&(t=t[0]),Ri(t,n).lift(new NP(e))}(t.map(e=>e.pipe(Wc(1),function qP(...t){const e=t[t.length-1];return ut(e)?(t.pop(),n=>ey(t,n,e)):n=>ey(t,n)}(Nm)))).pipe(YE((e,n)=>{let i=!1;return n.reduce((c,p,v)=>c!==Nm?c:(p===Nm&&(i=!0),i||!1!==p&&v!==n.length-1&&!fd(p)?c:p),e)},Nm),ba(e=>e!==Nm),rt(e=>fd(e)?e:!0===e),Wc(1)))}class lR{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Bm,this.attachRef=null}}class Bm{constructor(){this.contexts=new Map}onChildOutletCreated(e,n){const i=this.getOrCreateContext(e);i.outlet=n,this.contexts.set(e,i)}onChildOutletDestroyed(e){const n=this.getContext(e);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let n=this.getContext(e);return n||(n=new lR,this.contexts.set(e,n)),n}getContext(e){return this.contexts.get(e)||null}}let hy=(()=>{class t{constructor(n,i,c,p,v){this.parentContexts=n,this.location=i,this.resolver=c,this.changeDetector=v,this.activated=null,this._activatedRoute=null,this.activateEvents=new bi,this.deactivateEvents=new bi,this.attachEvents=new bi,this.detachEvents=new bi,this.name=p||_r,n.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const n=this.parentContexts.getContext(this.name);n&&n.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,i){this.activated=n,this._activatedRoute=i,this.location.insert(n.hostView),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,i){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=n;const v=(i=i||this.resolver).resolveComponentFactory(n._futureSnapshot.routeConfig.component),C=this.parentContexts.getOrCreateContext(this.name).children,S=new cR(n,C,this.location.injector);this.activated=this.location.createComponent(v,this.location.length,S),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return t.\u0275fac=function(n){return new(n||t)(Mt(Bm),Mt(Va),Mt(vm),Ke("name"),Mt(L_))},t.\u0275dir=yn({type:t,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),t})();class cR{constructor(e,n,i){this.route=e,this.childContexts=n,this.parent=i}get(e,n){return e===Hf?this.route:e===Bm?this.childContexts:this.parent.get(e,n)}}let IC=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=Mr({type:t,selectors:[["ng-component"]],decls:1,vars:0,template:function(n,i){1&n&&xl(0,"router-outlet")},directives:[hy],encapsulation:2}),t})();function AC(t,e=""){for(let n=0;n<t.length;n++){const i=t[n];uR(i,hR(e,i))}}function uR(t,e){t.children&&AC(t.children,e)}function hR(t,e){return e?t||e.path?t&&!e.path?`${t}/`:!t&&e.path?e.path:`${t}/${e.path}`:"":t}function S0(t){const e=t.children&&t.children.map(S0),n=e?Object.assign(Object.assign({},t),{children:e}):Object.assign({},t);return!n.component&&(e||n.loadChildren)&&n.outlet&&n.outlet!==_r&&(n.component=IC),n}function Ga(t){return t.outlet||_r}function PC(t,e){const n=t.filter(i=>Ga(i)===e);return n.push(...t.filter(i=>Ga(i)!==e)),n}const kC={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function dy(t,e,n){var i;if(""===e.path)return"full"===e.pathMatch&&(t.hasChildren()||n.length>0)?Object.assign({},kC):{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const p=(e.matcher||Ck)(n,t,e);if(!p)return Object.assign({},kC);const v={};qo(p.posParams,(S,R)=>{v[R]=S.path});const C=p.consumed.length>0?Object.assign(Object.assign({},v),p.consumed[p.consumed.length-1].parameters):v;return{matched:!0,consumedSegments:p.consumed,remainingSegments:n.slice(p.consumed.length),parameters:C,positionalParamSegments:null!==(i=p.posParams)&&void 0!==i?i:{}}}function fy(t,e,n,i,c="corrected"){if(n.length>0&&function pR(t,e,n){return n.some(i=>py(t,e,i)&&Ga(i)!==_r)}(t,n,i)){const v=new Er(e,function fR(t,e,n,i){const c={};c[_r]=i,i._sourceSegment=t,i._segmentIndexShift=e.length;for(const p of n)if(""===p.path&&Ga(p)!==_r){const v=new Er([],{});v._sourceSegment=t,v._segmentIndexShift=e.length,c[Ga(p)]=v}return c}(t,e,i,new Er(n,t.children)));return v._sourceSegment=t,v._segmentIndexShift=e.length,{segmentGroup:v,slicedSegments:[]}}if(0===n.length&&function mR(t,e,n){return n.some(i=>py(t,e,i))}(t,n,i)){const v=new Er(t.segments,function dR(t,e,n,i,c,p){const v={};for(const C of i)if(py(t,n,C)&&!c[Ga(C)]){const S=new Er([],{});S._sourceSegment=t,S._segmentIndexShift="legacy"===p?t.segments.length:e.length,v[Ga(C)]=S}return Object.assign(Object.assign({},c),v)}(t,e,n,i,t.children,c));return v._sourceSegment=t,v._segmentIndexShift=e.length,{segmentGroup:v,slicedSegments:n}}const p=new Er(t.segments,t.children);return p._sourceSegment=t,p._segmentIndexShift=e.length,{segmentGroup:p,slicedSegments:n}}function py(t,e,n){return(!(t.hasChildren()||e.length>0)||"full"!==n.pathMatch)&&""===n.path}function RC(t,e,n,i){return!!(Ga(t)===i||i!==_r&&py(e,n,t))&&("**"===t.path||dy(e,t,n).matched)}function OC(t,e,n){return 0===e.length&&!t.children[n]}class my{constructor(e){this.segmentGroup=e||null}}class LC{constructor(e){this.urlTree=e}}function Vm(t){return Bf(new my(t))}function FC(t){return Bf(new LC(t))}function gR(t){return Bf(new Error(`Only absolute redirects can have named outlets. redirectTo: '${t}'`))}class vR{constructor(e,n,i,c,p){this.configLoader=n,this.urlSerializer=i,this.urlTree=c,this.config=p,this.allowRedirects=!0,this.ngModule=e.get(Gc)}apply(){const e=fy(this.urlTree.root,[],[],this.config).segmentGroup,n=new Er(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,n,_r).pipe(rt(p=>this.createUrlTree(M0(p),this.urlTree.queryParams,this.urlTree.fragment))).pipe(ud(p=>{if(p instanceof LC)return this.allowRedirects=!1,this.match(p.urlTree);throw p instanceof my?this.noMatchError(p):p}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,_r).pipe(rt(c=>this.createUrlTree(M0(c),e.queryParams,e.fragment))).pipe(ud(c=>{throw c instanceof my?this.noMatchError(c):c}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,n,i){const c=e.segments.length>0?new Er([],{[_r]:e}):e;return new hd(c,n,i)}expandSegmentGroup(e,n,i,c){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(e,n,i).pipe(rt(p=>new Er([],p))):this.expandSegment(e,i,n,i.segments,c,!0)}expandChildren(e,n,i){const c=[];for(const p of Object.keys(i.children))"primary"===p?c.unshift(p):c.push(p);return ar(c).pipe(Uf(p=>{const v=i.children[p],C=PC(n,p);return this.expandSegmentGroup(e,C,v,p).pipe(rt(S=>({segment:S,outlet:p})))}),YE((p,v)=>(p[v.outlet]=v.segment,p),{}),function sk(t,e){const n=arguments.length>=2;return i=>i.pipe(t?ba((c,p)=>t(c,p,i)):J,p0(1),n?QE(e):JE(()=>new Q_))}())}expandSegment(e,n,i,c,p,v){return ar(i).pipe(Uf(C=>this.expandSegmentAgainstRoute(e,n,i,C,c,p,v).pipe(ud(R=>{if(R instanceof my)return Zn(null);throw R}))),jf(C=>!!C),ud((C,S)=>{if(C instanceof Q_||"EmptyError"===C.name)return OC(n,c,p)?Zn(new Er([],{})):Vm(n);throw C}))}expandSegmentAgainstRoute(e,n,i,c,p,v,C){return RC(c,n,p,v)?void 0===c.redirectTo?this.matchSegmentAgainstRoute(e,n,c,p,v):C&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,n,i,c,p,v):Vm(n):Vm(n)}expandSegmentAgainstRouteUsingRedirect(e,n,i,c,p,v){return"**"===c.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,i,c,v):this.expandRegularSegmentAgainstRouteUsingRedirect(e,n,i,c,p,v)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,i,c){const p=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?FC(p):this.lineralizeSegments(i,p).pipe(Br(v=>{const C=new Er(v,{});return this.expandSegment(e,C,n,v,c,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,n,i,c,p,v){const{matched:C,consumedSegments:S,remainingSegments:R,positionalParamSegments:z}=dy(n,c,p);if(!C)return Vm(n);const q=this.applyRedirectCommands(S,c.redirectTo,z);return c.redirectTo.startsWith("/")?FC(q):this.lineralizeSegments(c,q).pipe(Br(me=>this.expandSegment(e,n,i,me.concat(R),v,!1)))}matchSegmentAgainstRoute(e,n,i,c,p){if("**"===i.path)return i.loadChildren?(i._loadedConfig?Zn(i._loadedConfig):this.configLoader.load(e.injector,i)).pipe(rt(q=>(i._loadedConfig=q,new Er(c,{})))):Zn(new Er(c,{}));const{matched:v,consumedSegments:C,remainingSegments:S}=dy(n,i,c);return v?this.getChildConfig(e,i,c).pipe(Br(z=>{const q=z.module,me=z.routes,{segmentGroup:be,slicedSegments:Ge}=fy(n,C,S,me),xt=new Er(be.segments,be.children);if(0===Ge.length&&xt.hasChildren())return this.expandChildren(q,me,xt).pipe(rt(fn=>new Er(C,fn)));if(0===me.length&&0===Ge.length)return Zn(new Er(C,{}));const Ot=Ga(i)===p;return this.expandSegment(q,xt,me,Ge,Ot?_r:p,!0).pipe(rt(ct=>new Er(C.concat(ct.segments),ct.children)))})):Vm(n)}getChildConfig(e,n,i){return n.children?Zn(new D0(n.children,e)):n.loadChildren?void 0!==n._loadedConfig?Zn(n._loadedConfig):this.runCanLoadGuards(e.injector,n,i).pipe(Br(c=>c?this.configLoader.load(e.injector,n).pipe(rt(p=>(n._loadedConfig=p,p))):function _R(t){return Bf(g0(`Cannot load children because the guard of the route "path: '${t.path}'" returned false`))}(n))):Zn(new D0([],e))}runCanLoadGuards(e,n,i){const c=n.canLoad;if(!c||0===c.length)return Zn(!0);const p=c.map(v=>{const C=e.get(v);let S;if(function iR(t){return t&&Xu(t.canLoad)}(C))S=C.canLoad(n,i);else{if(!Xu(C))throw new Error("Invalid CanLoad guard");S=C(n,i)}return rc(S)});return Zn(p).pipe(zm(),Ks(v=>{if(!fd(v))return;const C=g0(`Redirecting to "${this.urlSerializer.serialize(v)}"`);throw C.url=v,C}),rt(v=>!0===v))}lineralizeSegments(e,n){let i=[],c=n.root;for(;;){if(i=i.concat(c.segments),0===c.numberOfChildren)return Zn(i);if(c.numberOfChildren>1||!c.children[_r])return gR(e.redirectTo);c=c.children[_r]}}applyRedirectCommands(e,n,i){return this.applyRedirectCreatreUrlTree(n,this.urlSerializer.parse(n),e,i)}applyRedirectCreatreUrlTree(e,n,i,c){const p=this.createSegmentGroup(e,n.root,i,c);return new hd(p,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(e,n){const i={};return qo(e,(c,p)=>{if("string"==typeof c&&c.startsWith(":")){const C=c.substring(1);i[p]=n[C]}else i[p]=c}),i}createSegmentGroup(e,n,i,c){const p=this.createSegments(e,n.segments,i,c);let v={};return qo(n.children,(C,S)=>{v[S]=this.createSegmentGroup(e,C,i,c)}),new Er(p,v)}createSegments(e,n,i,c){return n.map(p=>p.path.startsWith(":")?this.findPosParam(e,p,c):this.findOrReturn(p,i))}findPosParam(e,n,i){const c=i[n.path.substring(1)];if(!c)throw new Error(`Cannot redirect to '${e}'. Cannot find '${n.path}'.`);return c}findOrReturn(e,n){let i=0;for(const c of n){if(c.path===e.path)return n.splice(i),c;i++}return e}}function M0(t){const e={};for(const i of Object.keys(t.children)){const p=M0(t.children[i]);(p.segments.length>0||p.hasChildren())&&(e[i]=p)}return function xR(t){if(1===t.numberOfChildren&&t.children[_r]){const e=t.children[_r];return new Er(t.segments.concat(e.segments),e.children)}return t}(new Er(t.segments,e))}class NC{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class gy{constructor(e,n){this.component=e,this.route=n}}function wR(t,e,n){const i=t._root;return Um(i,e?e._root:null,n,[i.value])}function _y(t,e,n){const i=function CR(t){if(!t)return null;for(let e=t.parent;e;e=e.parent){const n=e.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(e);return(i?i.module.injector:n).get(t)}function Um(t,e,n,i,c={canDeactivateChecks:[],canActivateChecks:[]}){const p=Gf(e);return t.children.forEach(v=>{(function TR(t,e,n,i,c={canDeactivateChecks:[],canActivateChecks:[]}){const p=t.value,v=e?e.value:null,C=n?n.getContext(t.value.outlet):null;if(v&&p.routeConfig===v.routeConfig){const S=function DR(t,e,n){if("function"==typeof n)return n(t,e);switch(n){case"pathParamsChange":return!dd(t.url,e.url);case"pathParamsOrQueryParamsChange":return!dd(t.url,e.url)||!nc(t.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!w0(t,e)||!nc(t.queryParams,e.queryParams);default:return!w0(t,e)}}(v,p,p.routeConfig.runGuardsAndResolvers);S?c.canActivateChecks.push(new NC(i)):(p.data=v.data,p._resolvedData=v._resolvedData),Um(t,e,p.component?C?C.children:null:n,i,c),S&&C&&C.outlet&&C.outlet.isActivated&&c.canDeactivateChecks.push(new gy(C.outlet.component,v))}else v&&jm(e,C,c),c.canActivateChecks.push(new NC(i)),Um(t,null,p.component?C?C.children:null:n,i,c)})(v,p[v.value.outlet],n,i.concat([v.value]),c),delete p[v.value.outlet]}),qo(p,(v,C)=>jm(v,n.getContext(C),c)),c}function jm(t,e,n){const i=Gf(t),c=t.value;qo(i,(p,v)=>{jm(p,c.component?e?e.children.getContext(v):null:e,n)}),n.canDeactivateChecks.push(new gy(c.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,c))}class LR{}function zC(t){return new Be(e=>e.error(t))}class NR{constructor(e,n,i,c,p,v){this.rootComponentType=e,this.config=n,this.urlTree=i,this.url=c,this.paramsInheritanceStrategy=p,this.relativeLinkResolution=v}recognize(){const e=fy(this.urlTree.root,[],[],this.config.filter(v=>void 0===v.redirectTo),this.relativeLinkResolution).segmentGroup,n=this.processSegmentGroup(this.config,e,_r);if(null===n)return null;const i=new ly([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},_r,this.rootComponentType,null,this.urlTree.root,-1,{}),c=new Yc(i,n),p=new wC(this.url,c);return this.inheritParamsAndData(p._root),p}inheritParamsAndData(e){const n=e.value,i=bC(n,this.paramsInheritanceStrategy);n.params=Object.freeze(i.params),n.data=Object.freeze(i.data),e.children.forEach(c=>this.inheritParamsAndData(c))}processSegmentGroup(e,n,i){return 0===n.segments.length&&n.hasChildren()?this.processChildren(e,n):this.processSegment(e,n,n.segments,i)}processChildren(e,n){const i=[];for(const p of Object.keys(n.children)){const v=n.children[p],C=PC(e,p),S=this.processSegmentGroup(C,v,p);if(null===S)return null;i.push(...S)}const c=BC(i);return function zR(t){t.sort((e,n)=>e.value.outlet===_r?-1:n.value.outlet===_r?1:e.value.outlet.localeCompare(n.value.outlet))}(c),c}processSegment(e,n,i,c){for(const p of e){const v=this.processSegmentAgainstRoute(p,n,i,c);if(null!==v)return v}return OC(n,i,c)?[]:null}processSegmentAgainstRoute(e,n,i,c){if(e.redirectTo||!RC(e,n,i,c))return null;let p,v=[],C=[];if("**"===e.path){const be=i.length>0?aC(i).parameters:{};p=new ly(i,be,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,jC(e),Ga(e),e.component,e,VC(n),UC(n)+i.length,$C(e))}else{const be=dy(n,e,i);if(!be.matched)return null;v=be.consumedSegments,C=be.remainingSegments,p=new ly(v,be.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,jC(e),Ga(e),e.component,e,VC(n),UC(n)+v.length,$C(e))}const S=function BR(t){return t.children?t.children:t.loadChildren?t._loadedConfig.routes:[]}(e),{segmentGroup:R,slicedSegments:z}=fy(n,v,C,S.filter(be=>void 0===be.redirectTo),this.relativeLinkResolution);if(0===z.length&&R.hasChildren()){const be=this.processChildren(S,R);return null===be?null:[new Yc(p,be)]}if(0===S.length&&0===z.length)return[new Yc(p,[])];const q=Ga(e)===c,me=this.processSegment(S,R,z,q?_r:c);return null===me?null:[new Yc(p,me)]}}function VR(t){const e=t.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function BC(t){const e=[],n=new Set;for(const i of t){if(!VR(i)){e.push(i);continue}const c=e.find(p=>i.value.routeConfig===p.value.routeConfig);void 0!==c?(c.children.push(...i.children),n.add(c)):e.push(i)}for(const i of n){const c=BC(i.children);e.push(new Yc(i.value,c))}return e.filter(i=>!n.has(i))}function VC(t){let e=t;for(;e._sourceSegment;)e=e._sourceSegment;return e}function UC(t){let e=t,n=e._segmentIndexShift?e._segmentIndexShift:0;for(;e._sourceSegment;)e=e._sourceSegment,n+=e._segmentIndexShift?e._segmentIndexShift:0;return n-1}function jC(t){return t.data||{}}function $C(t){return t.resolve||{}}function GC(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}function I0(t){return $a(e=>{const n=t(e);return n?ar(n).pipe(rt(()=>e)):Zn(e)})}class WR extends class ZR{shouldDetach(e){return!1}store(e,n){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,n){return e.routeConfig===n.routeConfig}}{}const A0=new Xt("ROUTES");class HC{constructor(e,n,i,c){this.injector=e,this.compiler=n,this.onLoadStartListener=i,this.onLoadEndListener=c}load(e,n){if(n._loader$)return n._loader$;this.onLoadStartListener&&this.onLoadStartListener(n);const c=this.loadModuleFactory(n.loadChildren).pipe(rt(p=>{this.onLoadEndListener&&this.onLoadEndListener(n);const v=p.create(e);return new D0(sC(v.injector.get(A0,void 0,wn.Self|wn.Optional)).map(S0),v)}),ud(p=>{throw n._loader$=void 0,p}));return n._loader$=new hs(c,()=>new Et).pipe(Wo()),n._loader$}loadModuleFactory(e){return rc(e()).pipe(Br(n=>n instanceof u1?Zn(n):ar(this.compiler.compileModuleAsync(n))))}}class KR{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,n){return e}}function YR(t){throw t}function JR(t,e,n){return e.parse("/")}function qC(t,e){return Zn(null)}const QR={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},eO={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let wa=(()=>{class t{constructor(n,i,c,p,v,C,S){this.rootComponentType=n,this.urlSerializer=i,this.rootContexts=c,this.location=p,this.config=S,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Et,this.errorHandler=YR,this.malformedUriErrorHandler=JR,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:qC,afterPreactivation:qC},this.urlHandlingStrategy=new KR,this.routeReuseStrategy=new WR,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=v.get(Gc),this.console=v.get(NI);const q=v.get(Po);this.isNgZoneEnabled=q instanceof Po&&Po.isInAngularZone(),this.resetConfig(S),this.currentUrlTree=function Dk(){return new hd(new Er([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new HC(v,C,me=>this.triggerEvent(new tC(me)),me=>this.triggerEvent(new nC(me))),this.routerState=xC(this.currentUrlTree,this.rootComponentType),this.transitions=new Tl({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var n;return null===(n=this.location.getState())||void 0===n?void 0:n.\u0275routerPageId}setupNavigations(n){const i=this.events;return n.pipe(ba(c=>0!==c.id),rt(c=>Object.assign(Object.assign({},c),{extractedUrl:this.urlHandlingStrategy.extract(c.rawUrl)})),$a(c=>{let p=!1,v=!1;return Zn(c).pipe(Ks(C=>{this.currentNavigation={id:C.id,initialUrl:C.currentRawUrl,extractedUrl:C.extractedUrl,trigger:C.source,extras:C.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),$a(C=>{const S=this.browserUrlTree.toString(),R=!this.navigated||C.extractedUrl.toString()!==S||S!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||R)&&this.urlHandlingStrategy.shouldProcessUrl(C.rawUrl))return ZC(C.source)&&(this.browserUrlTree=C.extractedUrl),Zn(C).pipe($a(q=>{const me=this.transitions.getValue();return i.next(new m0(q.id,this.serializeUrl(q.extractedUrl),q.source,q.restoredState)),me!==this.transitions.getValue()?Vf:Promise.resolve(q)}),function bR(t,e,n,i){return $a(c=>function yR(t,e,n,i,c){return new vR(t,e,n,i,c).apply()}(t,e,n,c.extractedUrl,i).pipe(rt(p=>Object.assign(Object.assign({},c),{urlAfterRedirects:p}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Ks(q=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:q.urlAfterRedirects})}),function UR(t,e,n,i,c){return Br(p=>function FR(t,e,n,i,c="emptyOnly",p="legacy"){try{const v=new NR(t,e,n,i,c,p).recognize();return null===v?zC(new LR):Zn(v)}catch(v){return zC(v)}}(t,e,p.urlAfterRedirects,n(p.urlAfterRedirects),i,c).pipe(rt(v=>Object.assign(Object.assign({},p),{targetSnapshot:v}))))}(this.rootComponentType,this.config,q=>this.serializeUrl(q),this.paramsInheritanceStrategy,this.relativeLinkResolution),Ks(q=>{if("eager"===this.urlUpdateStrategy){if(!q.extras.skipLocationChange){const be=this.urlHandlingStrategy.merge(q.urlAfterRedirects,q.rawUrl);this.setBrowserUrl(be,q)}this.browserUrlTree=q.urlAfterRedirects}const me=new fk(q.id,this.serializeUrl(q.extractedUrl),this.serializeUrl(q.urlAfterRedirects),q.targetSnapshot);i.next(me)}));if(R&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:me,extractedUrl:be,source:Ge,restoredState:xt,extras:Ot}=C,jt=new m0(me,this.serializeUrl(be),Ge,xt);i.next(jt);const ct=xC(be,this.rootComponentType).snapshot;return Zn(Object.assign(Object.assign({},C),{targetSnapshot:ct,urlAfterRedirects:be,extras:Object.assign(Object.assign({},Ot),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=C.rawUrl,C.resolve(null),Vf}),I0(C=>{const{targetSnapshot:S,id:R,extractedUrl:z,rawUrl:q,extras:{skipLocationChange:me,replaceUrl:be}}=C;return this.hooks.beforePreactivation(S,{navigationId:R,appliedUrlTree:z,rawUrlTree:q,skipLocationChange:!!me,replaceUrl:!!be})}),Ks(C=>{const S=new pk(C.id,this.serializeUrl(C.extractedUrl),this.serializeUrl(C.urlAfterRedirects),C.targetSnapshot);this.triggerEvent(S)}),rt(C=>Object.assign(Object.assign({},C),{guards:wR(C.targetSnapshot,C.currentSnapshot,this.rootContexts)})),function SR(t,e){return Br(n=>{const{targetSnapshot:i,currentSnapshot:c,guards:{canActivateChecks:p,canDeactivateChecks:v}}=n;return 0===v.length&&0===p.length?Zn(Object.assign(Object.assign({},n),{guardsResult:!0})):function MR(t,e,n,i){return ar(t).pipe(Br(c=>function OR(t,e,n,i,c){const p=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return p&&0!==p.length?Zn(p.map(C=>{const S=_y(C,e,c);let R;if(function aR(t){return t&&Xu(t.canDeactivate)}(S))R=rc(S.canDeactivate(t,e,n,i));else{if(!Xu(S))throw new Error("Invalid CanDeactivate guard");R=rc(S(t,e,n,i))}return R.pipe(jf())})).pipe(zm()):Zn(!0)}(c.component,c.route,n,e,i)),jf(c=>!0!==c,!0))}(v,i,c,t).pipe(Br(C=>C&&function rR(t){return"boolean"==typeof t}(C)?function IR(t,e,n,i){return ar(e).pipe(Uf(c=>ey(function PR(t,e){return null!==t&&e&&e(new yk(t)),Zn(!0)}(c.route.parent,i),function AR(t,e){return null!==t&&e&&e(new xk(t)),Zn(!0)}(c.route,i),function RR(t,e,n){const i=e[e.length-1],p=e.slice(0,e.length-1).reverse().map(v=>function ER(t){const e=t.routeConfig?t.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:t,guards:e}:null}(v)).filter(v=>null!==v).map(v=>ny(()=>Zn(v.guards.map(S=>{const R=_y(S,v.node,n);let z;if(function sR(t){return t&&Xu(t.canActivateChild)}(R))z=rc(R.canActivateChild(i,t));else{if(!Xu(R))throw new Error("Invalid CanActivateChild guard");z=rc(R(i,t))}return z.pipe(jf())})).pipe(zm())));return Zn(p).pipe(zm())}(t,c.path,n),function kR(t,e,n){const i=e.routeConfig?e.routeConfig.canActivate:null;if(!i||0===i.length)return Zn(!0);const c=i.map(p=>ny(()=>{const v=_y(p,e,n);let C;if(function oR(t){return t&&Xu(t.canActivate)}(v))C=rc(v.canActivate(e,t));else{if(!Xu(v))throw new Error("Invalid CanActivate guard");C=rc(v(e,t))}return C.pipe(jf())}));return Zn(c).pipe(zm())}(t,c.route,n))),jf(c=>!0!==c,!0))}(i,p,t,e):Zn(C)),rt(C=>Object.assign(Object.assign({},n),{guardsResult:C})))})}(this.ngModule.injector,C=>this.triggerEvent(C)),Ks(C=>{if(fd(C.guardsResult)){const R=g0(`Redirecting to "${this.serializeUrl(C.guardsResult)}"`);throw R.url=C.guardsResult,R}const S=new mk(C.id,this.serializeUrl(C.extractedUrl),this.serializeUrl(C.urlAfterRedirects),C.targetSnapshot,!!C.guardsResult);this.triggerEvent(S)}),ba(C=>!!C.guardsResult||(this.restoreHistory(C),this.cancelNavigationTransition(C,""),!1)),I0(C=>{if(C.guards.canActivateChecks.length)return Zn(C).pipe(Ks(S=>{const R=new gk(S.id,this.serializeUrl(S.extractedUrl),this.serializeUrl(S.urlAfterRedirects),S.targetSnapshot);this.triggerEvent(R)}),$a(S=>{let R=!1;return Zn(S).pipe(function jR(t,e){return Br(n=>{const{targetSnapshot:i,guards:{canActivateChecks:c}}=n;if(!c.length)return Zn(n);let p=0;return ar(c).pipe(Uf(v=>function $R(t,e,n,i){return function GR(t,e,n,i){const c=GC(t);if(0===c.length)return Zn({});const p={};return ar(c).pipe(Br(v=>function HR(t,e,n,i){const c=_y(t,e,i);return rc(c.resolve?c.resolve(e,n):c(e,n))}(t[v],e,n,i).pipe(Ks(C=>{p[v]=C}))),p0(1),Br(()=>GC(p).length===c.length?Zn(p):Vf))}(t._resolve,t,e,i).pipe(rt(p=>(t._resolvedData=p,t.data=Object.assign(Object.assign({},t.data),bC(t,n).resolve),null)))}(v.route,i,t,e)),Ks(()=>p++),p0(1),Br(v=>p===c.length?Zn(n):Vf))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Ks({next:()=>R=!0,complete:()=>{R||(this.restoreHistory(S),this.cancelNavigationTransition(S,"At least one route resolver didn't emit any value."))}}))}),Ks(S=>{const R=new _k(S.id,this.serializeUrl(S.extractedUrl),this.serializeUrl(S.urlAfterRedirects),S.targetSnapshot);this.triggerEvent(R)}))}),I0(C=>{const{targetSnapshot:S,id:R,extractedUrl:z,rawUrl:q,extras:{skipLocationChange:me,replaceUrl:be}}=C;return this.hooks.afterPreactivation(S,{navigationId:R,appliedUrlTree:z,rawUrlTree:q,skipLocationChange:!!me,replaceUrl:!!be})}),rt(C=>{const S=function Gk(t,e,n){const i=Lm(t,e._root,n?n._root:void 0);return new vC(i,e)}(this.routeReuseStrategy,C.targetSnapshot,C.currentRouterState);return Object.assign(Object.assign({},C),{targetRouterState:S})}),Ks(C=>{this.currentUrlTree=C.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(C.urlAfterRedirects,C.rawUrl),this.routerState=C.targetRouterState,"deferred"===this.urlUpdateStrategy&&(C.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,C),this.browserUrlTree=C.urlAfterRedirects)}),((t,e,n)=>rt(i=>(new tR(e,i.targetRouterState,i.currentRouterState,n).activate(t),i)))(this.rootContexts,this.routeReuseStrategy,C=>this.triggerEvent(C)),Ks({next(){p=!0},complete(){p=!0}}),function ck(t){return e=>e.lift(new uk(t))}(()=>{var C;p||v||this.cancelNavigationTransition(c,`Navigation ID ${c.id} is not equal to the current navigation id ${this.navigationId}`),(null===(C=this.currentNavigation)||void 0===C?void 0:C.id)===c.id&&(this.currentNavigation=null)}),ud(C=>{if(v=!0,function Ek(t){return t&&t[iC]}(C)){const S=fd(C.url);S||(this.navigated=!0,this.restoreHistory(c,!0));const R=new eC(c.id,this.serializeUrl(c.extractedUrl),C.message);i.next(R),S?setTimeout(()=>{const z=this.urlHandlingStrategy.merge(C.url,this.rawUrlTree),q={skipLocationChange:c.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||ZC(c.source)};this.scheduleNavigation(z,"imperative",null,q,{resolve:c.resolve,reject:c.reject,promise:c.promise})},0):c.resolve(!1)}else{this.restoreHistory(c,!0);const S=new dk(c.id,this.serializeUrl(c.extractedUrl),C);i.next(S);try{c.resolve(this.errorHandler(C))}catch(R){c.reject(R)}}return Vf}))}))}resetRootComponentType(n){this.rootComponentType=n,this.routerState.root.component=this.rootComponentType}setTransition(n){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),n))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const i="popstate"===n.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{var c;const p={replaceUrl:!0},v=(null===(c=n.state)||void 0===c?void 0:c.navigationId)?n.state:null;if(v){const S=Object.assign({},v);delete S.navigationId,delete S.\u0275routerPageId,0!==Object.keys(S).length&&(p.state=S)}const C=this.parseUrl(n.url);this.scheduleNavigation(C,i,v,p)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(n){this.events.next(n)}resetConfig(n){AC(n),this.config=n.map(S0),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,i={}){const{relativeTo:c,queryParams:p,fragment:v,queryParamsHandling:C,preserveFragment:S}=i,R=c||this.routerState.root,z=S?this.currentUrlTree.fragment:v;let q=null;switch(C){case"merge":q=Object.assign(Object.assign({},this.currentUrlTree.queryParams),p);break;case"preserve":q=this.currentUrlTree.queryParams;break;default:q=p||null}return null!==q&&(q=this.removeEmptyProps(q)),function Zk(t,e,n,i,c){if(0===n.length)return E0(e.root,e.root,e.root,i,c);const p=function Wk(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new TC(!0,0,t);let e=0,n=!1;const i=t.reduce((c,p,v)=>{if("object"==typeof p&&null!=p){if(p.outlets){const C={};return qo(p.outlets,(S,R)=>{C[R]="string"==typeof S?S.split("/"):S}),[...c,{outlets:C}]}if(p.segmentPath)return[...c,p.segmentPath]}return"string"!=typeof p?[...c,p]:0===v?(p.split("/").forEach((C,S)=>{0==S&&"."===C||(0==S&&""===C?n=!0:".."===C?e++:""!=C&&c.push(C))}),c):[...c,p]},[]);return new TC(n,e,i)}(n);if(p.toRoot())return E0(e.root,e.root,new Er([],{}),i,c);const v=function Xk(t,e,n){if(t.isAbsolute)return new C0(e.root,!0,0);if(-1===n.snapshot._lastPathIndex){const p=n.snapshot._urlSegment;return new C0(p,p===e.root,0)}const i=cy(t.commands[0])?0:1;return function Kk(t,e,n){let i=t,c=e,p=n;for(;p>c;){if(p-=c,i=i.parent,!i)throw new Error("Invalid number of '../'");c=i.segments.length}return new C0(i,!1,c-p)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+i,t.numberOfDoubleDots)}(p,e,t),C=v.processChildren?uy(v.segmentGroup,v.index,p.commands):DC(v.segmentGroup,v.index,p.commands);return E0(e.root,v.segmentGroup,C,i,c)}(R,this.currentUrlTree,n,q,null!=z?z:null)}navigateByUrl(n,i={skipLocationChange:!1}){const c=fd(n)?n:this.parseUrl(n),p=this.urlHandlingStrategy.merge(c,this.rawUrlTree);return this.scheduleNavigation(p,"imperative",null,i)}navigate(n,i={skipLocationChange:!1}){return function tO(t){for(let e=0;e<t.length;e++){const n=t[e];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${e}`)}}(n),this.navigateByUrl(this.createUrlTree(n,i),i)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let i;try{i=this.urlSerializer.parse(n)}catch(c){i=this.malformedUriErrorHandler(c,this.urlSerializer,n)}return i}isActive(n,i){let c;if(c=!0===i?Object.assign({},QR):!1===i?Object.assign({},eO):i,fd(n))return cC(this.currentUrlTree,n,c);const p=this.parseUrl(n);return cC(this.currentUrlTree,p,c)}removeEmptyProps(n){return Object.keys(n).reduce((i,c)=>{const p=n[c];return null!=p&&(i[c]=p),i},{})}processNavigations(){this.navigations.subscribe(n=>{this.navigated=!0,this.lastSuccessfulId=n.id,this.currentPageId=n.targetPageId,this.events.next(new km(n.id,this.serializeUrl(n.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,n.resolve(!0)},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}scheduleNavigation(n,i,c,p,v){var C,S;if(this.disposed)return Promise.resolve(!1);let R,z,q;v?(R=v.resolve,z=v.reject,q=v.promise):q=new Promise((Ge,xt)=>{R=Ge,z=xt});const me=++this.navigationId;let be;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(c=this.location.getState()),be=c&&c.\u0275routerPageId?c.\u0275routerPageId:p.replaceUrl||p.skipLocationChange?null!==(C=this.browserPageId)&&void 0!==C?C:0:(null!==(S=this.browserPageId)&&void 0!==S?S:0)+1):be=0,this.setTransition({id:me,targetPageId:be,source:i,restoredState:c,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:n,extras:p,resolve:R,reject:z,promise:q,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),q.catch(Ge=>Promise.reject(Ge))}setBrowserUrl(n,i){const c=this.urlSerializer.serialize(n),p=Object.assign(Object.assign({},i.extras.state),this.generateNgRouterState(i.id,i.targetPageId));this.location.isCurrentPathEqualTo(c)||i.extras.replaceUrl?this.location.replaceState(c,"",p):this.location.go(c,"",p)}restoreHistory(n,i=!1){var c,p;if("computed"===this.canceledNavigationResolution){const v=this.currentPageId-n.targetPageId;"popstate"!==n.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(c=this.currentNavigation)||void 0===c?void 0:c.finalUrl)||0===v?this.currentUrlTree===(null===(p=this.currentNavigation)||void 0===p?void 0:p.finalUrl)&&0===v&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(v)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(n,i){const c=new eC(n.id,this.serializeUrl(n.extractedUrl),i);this.triggerEvent(c),n.resolve(!1)}generateNgRouterState(n,i){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:i}:{navigationId:n}}}return t.\u0275fac=function(n){Jv()},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();function ZC(t){return"imperative"!==t}let P0=(()=>{class t{constructor(n,i,c,p,v){this.router=n,this.route=i,this.tabIndexAttribute=c,this.renderer=p,this.el=v,this.commands=null,this.onChanges=new Et,this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(n){if(null!=this.tabIndexAttribute)return;const i=this.renderer,c=this.el.nativeElement;null!==n?i.setAttribute(c,"tabindex",n):i.removeAttribute(c,"tabindex")}ngOnChanges(n){this.onChanges.next(this)}set routerLink(n){null!=n?(this.commands=Array.isArray(n)?n:[n],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){if(null===this.urlTree)return!0;const n={skipLocationChange:qf(this.skipLocationChange),replaceUrl:qf(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,n),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:qf(this.preserveFragment)})}}return t.\u0275fac=function(n){return new(n||t)(Mt(wa),Mt(Hf),Ke("tabindex"),Mt($c),Mt(va))},t.\u0275dir=yn({type:t,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(n,i){1&n&&Ss("click",function(){return i.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[Qi]}),t})(),yy=(()=>{class t{constructor(n,i,c){this.router=n,this.route=i,this.locationStrategy=c,this.commands=null,this.href=null,this.onChanges=new Et,this.subscription=n.events.subscribe(p=>{p instanceof km&&this.updateTargetUrlAndHref()})}set routerLink(n){this.commands=null!=n?Array.isArray(n)?n:[n]:null}ngOnChanges(n){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(n,i,c,p,v){if(0!==n||i||c||p||v||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)return!0;const C={skipLocationChange:qf(this.skipLocationChange),replaceUrl:qf(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,C),!1}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:qf(this.preserveFragment)})}}return t.\u0275fac=function(n){return new(n||t)(Mt(wa),Mt(Hf),Mt(zf))},t.\u0275dir=yn({type:t,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(n,i){1&n&&Ss("click",function(p){return i.onClick(p.button,p.ctrlKey,p.shiftKey,p.altKey,p.metaKey)}),2&n&&Hn("target",i.target)("href",i.href,Rh)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[Qi]}),t})();function qf(t){return""===t||!!t}let WC=(()=>{class t{constructor(n,i,c,p,v,C){this.router=n,this.element=i,this.renderer=c,this.cdr=p,this.link=v,this.linkWithHref=C,this.classes=[],this.isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new bi,this.routerEventsSubscription=n.events.subscribe(S=>{S instanceof km&&this.update()})}ngAfterContentInit(){Zn(this.links.changes,this.linksWithHrefs.changes,Zn(null)).pipe(mi()).subscribe(n=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){var n;null===(n=this.linkInputChangesSubscription)||void 0===n||n.unsubscribe();const i=[...this.links.toArray(),...this.linksWithHrefs.toArray(),this.link,this.linkWithHref].filter(c=>!!c).map(c=>c.onChanges);this.linkInputChangesSubscription=ar(i).pipe(mi()).subscribe(c=>{this.isActive!==this.isLinkActive(this.router)(c)&&this.update()})}set routerLinkActive(n){const i=Array.isArray(n)?n:n.split(" ");this.classes=i.filter(c=>!!c)}ngOnChanges(n){this.update()}ngOnDestroy(){var n;this.routerEventsSubscription.unsubscribe(),null===(n=this.linkInputChangesSubscription)||void 0===n||n.unsubscribe()}update(){!this.links||!this.linksWithHrefs||!this.router.navigated||Promise.resolve().then(()=>{const n=this.hasActiveLinks();this.isActive!==n&&(this.isActive=n,this.cdr.markForCheck(),this.classes.forEach(i=>{n?this.renderer.addClass(this.element.nativeElement,i):this.renderer.removeClass(this.element.nativeElement,i)}),this.isActiveChange.emit(n))})}isLinkActive(n){const i=function nO(t){return!!t.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return c=>!!c.urlTree&&n.isActive(c.urlTree,i)}hasActiveLinks(){const n=this.isLinkActive(this.router);return this.link&&n(this.link)||this.linkWithHref&&n(this.linkWithHref)||this.links.some(n)||this.linksWithHrefs.some(n)}}return t.\u0275fac=function(n){return new(n||t)(Mt(wa),Mt(va),Mt($c),Mt(L_),Mt(P0,8),Mt(yy,8))},t.\u0275dir=yn({type:t,selectors:[["","routerLinkActive",""]],contentQueries:function(n,i,c){if(1&n&&(Tx(c,P0,5),Tx(c,yy,5)),2&n){let p;M_(p=I_())&&(i.links=p),M_(p=I_())&&(i.linksWithHrefs=p)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[Qi]}),t})();class XC{}class KC{preload(e,n){return Zn(null)}}let YC=(()=>{class t{constructor(n,i,c,p){this.router=n,this.injector=c,this.preloadingStrategy=p,this.loader=new HC(c,i,S=>n.triggerEvent(new tC(S)),S=>n.triggerEvent(new nC(S)))}setUpPreloading(){this.subscription=this.router.events.pipe(ba(n=>n instanceof km),Uf(()=>this.preload())).subscribe(()=>{})}preload(){const n=this.injector.get(Gc);return this.processRoutes(n,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,i){const c=[];for(const p of i)if(p.loadChildren&&!p.canLoad&&p._loadedConfig){const v=p._loadedConfig;c.push(this.processRoutes(v.module,v.routes))}else p.loadChildren&&!p.canLoad?c.push(this.preloadConfig(n,p)):p.children&&c.push(this.processRoutes(n,p.children));return ar(c).pipe(mi(),rt(p=>{}))}preloadConfig(n,i){return this.preloadingStrategy.preload(i,()=>(i._loadedConfig?Zn(i._loadedConfig):this.loader.load(n.injector,i)).pipe(Br(p=>(i._loadedConfig=p,this.processRoutes(p.module,p.routes)))))}}return t.\u0275fac=function(n){return new(n||t)(dn(wa),dn(Z1),dn(Fi),dn(XC))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})(),k0=(()=>{class t{constructor(n,i,c={}){this.router=n,this.viewportScroller=i,this.options=c,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},c.scrollPositionRestoration=c.scrollPositionRestoration||"disabled",c.anchorScrolling=c.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(n=>{n instanceof m0?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof km&&(this.lastId=n.id,this.scheduleScrollEvent(n,this.router.parseUrl(n.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(n=>{n instanceof rC&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,i){this.router.triggerEvent(new rC(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return t.\u0275fac=function(n){Jv()},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();const pd=new Xt("ROUTER_CONFIGURATION"),JC=new Xt("ROUTER_FORROOT_GUARD"),iO=[qx,{provide:fC,useClass:pC},{provide:wa,useFactory:function cO(t,e,n,i,c,p,v={},C,S){const R=new wa(null,t,e,n,i,c,sC(p));return C&&(R.urlHandlingStrategy=C),S&&(R.routeReuseStrategy=S),function uO(t,e){t.errorHandler&&(e.errorHandler=t.errorHandler),t.malformedUriErrorHandler&&(e.malformedUriErrorHandler=t.malformedUriErrorHandler),t.onSameUrlNavigation&&(e.onSameUrlNavigation=t.onSameUrlNavigation),t.paramsInheritanceStrategy&&(e.paramsInheritanceStrategy=t.paramsInheritanceStrategy),t.relativeLinkResolution&&(e.relativeLinkResolution=t.relativeLinkResolution),t.urlUpdateStrategy&&(e.urlUpdateStrategy=t.urlUpdateStrategy),t.canceledNavigationResolution&&(e.canceledNavigationResolution=t.canceledNavigationResolution)}(v,R),v.enableTracing&&R.events.subscribe(z=>{var q,me;null===(q=console.group)||void 0===q||q.call(console,`Router Event: ${z.constructor.name}`),console.log(z.toString()),console.log(z),null===(me=console.groupEnd)||void 0===me||me.call(console)}),R},deps:[fC,Bm,qx,Fi,Z1,A0,pd,[class XR{},new qs],[class qR{},new qs]]},Bm,{provide:Hf,useFactory:function hO(t){return t.routerState.root},deps:[wa]},YC,KC,class rO{preload(e,n){return n().pipe(ud(()=>Zn(null)))}},{provide:pd,useValue:{enableTracing:!1}}];function oO(){return new J1("Router",wa)}let QC=(()=>{class t{constructor(n,i){}static forRoot(n,i){return{ngModule:t,providers:[iO,eT(n),{provide:JC,useFactory:lO,deps:[[wa,new qs,new Pa]]},{provide:pd,useValue:i||{}},{provide:zf,useFactory:aO,deps:[cd,[new xu(Hx),new qs],pd]},{provide:k0,useFactory:sO,deps:[wa,X2,pd]},{provide:XC,useExisting:i&&i.preloadingStrategy?i.preloadingStrategy:KC},{provide:J1,multi:!0,useFactory:oO},[R0,{provide:R_,multi:!0,useFactory:dO,deps:[R0]},{provide:tT,useFactory:fO,deps:[R0]},{provide:q1,multi:!0,useExisting:tT}]]}}static forChild(n){return{ngModule:t,providers:[eT(n)]}}}return t.\u0275fac=function(n){return new(n||t)(dn(JC,8),dn(wa,8))},t.\u0275mod=qr({type:t}),t.\u0275inj=mr({}),t})();function sO(t,e,n){return n.scrollOffset&&e.setOffset(n.scrollOffset),new k0(t,e,n)}function aO(t,e,n={}){return n.useHash?new IA(t,e):new _E(t,e)}function lO(t){return"guarded"}function eT(t){return[{provide:ii,multi:!0,useValue:t},{provide:A0,multi:!0,useValue:t}]}let R0=(()=>{class t{constructor(n){this.injector=n,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Et}appInitializer(){return this.injector.get(DA,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let i=null;const c=new Promise(C=>i=C),p=this.injector.get(wa),v=this.injector.get(pd);return"disabled"===v.initialNavigation?(p.setUpLocationChangeListener(),i(!0)):"enabled"===v.initialNavigation||"enabledBlocking"===v.initialNavigation?(p.hooks.afterPreactivation=()=>this.initNavigation?Zn(null):(this.initNavigation=!0,i(!0),this.resultOfPreactivationDone),p.initialNavigation()):i(!0),c})}bootstrapListener(n){const i=this.injector.get(pd),c=this.injector.get(YC),p=this.injector.get(k0),v=this.injector.get(wa),C=this.injector.get(O_);n===C.components[0]&&(("enabledNonBlocking"===i.initialNavigation||void 0===i.initialNavigation)&&v.initialNavigation(),c.setUpPreloading(),p.init(),v.resetRootComponentType(C.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return t.\u0275fac=function(n){return new(n||t)(dn(Fi))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();function dO(t){return t.appInitializer.bind(t)}function fO(t){return t.bootstrapListener.bind(t)}const tT=new Xt("Router Initializer"),Ku={production:!0,appVersion:Xe(147).i8,environmentName:"Production",CompanyName:"Actilogic",AuthorName:"Antonio Joboy",mapbox:{accessToken:"pk.eyJ1IjoiYW50b25pb2pvYm95IiwiYSI6ImNsMXBhd3hsYTBhb24zY2tiaTNjMG1mMTcifQ.Y7o3Fo3xLvPXMAbTnrc7IA"}};let mO=(()=>{class t{constructor(){this.environment=Ku}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=Mr({type:t,selectors:[["app-home"]],decls:4,vars:1,template:function(n,i){1&n&&(Go(0,"p"),Ms(1,"home works!"),Ho(),Go(2,"p"),Ms(3),Ho()),2&n&&(fa(3),od(" Current environment: ",i.environment.environmentName,"\n"))},styles:[""]}),t})();function nT(t,e,n,i,c,p,v){try{var C=t[p](v),S=C.value}catch(R){return void n(R)}C.done?e(S):Promise.resolve(S).then(i,c)}function O0(t){return function(){var e=this,n=arguments;return new Promise(function(i,c){var p=t.apply(e,n);function v(S){nT(p,i,c,v,C,"next",S)}function C(S){nT(p,i,c,v,C,"throw",S)}v(void 0)})}}class gO{constructor(e){this.title="",this.ttl="",this.link="",this.description="",this.language="",this.copyright="",this.lastBuildDate="",this.image=null,this.item=null,this.rss=null,this.title=e.title,this.ttl=e.ttl,this.link=e.link,this.description=e.description,this.language=e.language,this.copyright=e.copyright,this.lastBuildDate=e.lastBuildDate,this.image=e.image,this.item=e.item,this.rss=e.rss}toString(){return this.copyright}}class Jc{constructor(){}xmlToJson(e){let n={};if(1===e.nodeType){if(e.attributes.length>0){n["@attributes"]={};for(let i=0;i<e.attributes.length;i+=1){const c=e.attributes.item(i);n["@attributes"][c.nodeName]=c.nodeValue}}}else 3===e.nodeType&&(n=e.nodeValue);if(e.hasChildNodes()&&1===e.childNodes.length&&3===e.childNodes[0].nodeType)n=e.childNodes[0].nodeValue;else if(e.hasChildNodes())for(let i=0;i<e.childNodes.length;i+=1){const c=e.childNodes.item(i),p=c.nodeName;if(void 0===n[p])n[p]=this.xmlToJson(c);else{if(void 0===n[p].push){const v=n[p];n[p]=[],n[p].push(v)}n[p].push(this.xmlToJson(c))}}return n}}Jc.\u0275fac=function(e){return new(e||Jc)},Jc.\u0275prov=gn({token:Jc,factory:Jc.\u0275fac,providedIn:"root"}),Jc.ngInjectableDef=ps({factory:function(){return new Jc},token:Jc,providedIn:"root"});class rT{}class iT{}class Qc{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(n=>{const i=n.indexOf(":");if(i>0){const c=n.slice(0,i),p=c.toLowerCase(),v=n.slice(i+1).trim();this.maybeSetNormalizedName(c,p),this.headers.has(p)?this.headers.get(p).push(v):this.headers.set(p,[v])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(n=>{let i=e[n];const c=n.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(c,i),this.maybeSetNormalizedName(n,c))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const n=this.headers.get(e.toLowerCase());return n&&n.length>0?n[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,n){return this.clone({name:e,value:n,op:"a"})}set(e,n){return this.clone({name:e,value:n,op:"s"})}delete(e,n){return this.clone({name:e,value:n,op:"d"})}maybeSetNormalizedName(e,n){this.normalizedNames.has(n)||this.normalizedNames.set(n,e)}init(){this.lazyInit&&(this.lazyInit instanceof Qc?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(n=>{this.headers.set(n,e.headers.get(n)),this.normalizedNames.set(n,e.normalizedNames.get(n))})}clone(e){const n=new Qc;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof Qc?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([e]),n}applyUpdate(e){const n=e.name.toLowerCase();switch(e.op){case"a":case"s":let i=e.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(e.name,n);const c=("a"===e.op?this.headers.get(n):void 0)||[];c.push(...i),this.headers.set(n,c);break;case"d":const p=e.value;if(p){let v=this.headers.get(n);if(!v)return;v=v.filter(C=>-1===p.indexOf(C)),0===v.length?(this.headers.delete(n),this.normalizedNames.delete(n)):this.headers.set(n,v)}else this.headers.delete(n),this.normalizedNames.delete(n)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(n=>e(this.normalizedNames.get(n),this.headers.get(n)))}}class _O{encodeKey(e){return oT(e)}encodeValue(e){return oT(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const vO=/%(\d[a-f0-9])/gi,xO={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function oT(t){return encodeURIComponent(t).replace(vO,(e,n)=>{var i;return null!==(i=xO[n])&&void 0!==i?i:e})}function sT(t){return`${t}`}class Yu{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new _O,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function yO(t,e){const n=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(c=>{const p=c.indexOf("="),[v,C]=-1==p?[e.decodeKey(c),""]:[e.decodeKey(c.slice(0,p)),e.decodeValue(c.slice(p+1))],S=n.get(v)||[];S.push(C),n.set(v,S)}),n}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(n=>{const i=e.fromObject[n];this.map.set(n,Array.isArray(i)?i:[i])})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const n=this.map.get(e);return n?n[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,n){return this.clone({param:e,value:n,op:"a"})}appendAll(e){const n=[];return Object.keys(e).forEach(i=>{const c=e[i];Array.isArray(c)?c.forEach(p=>{n.push({param:i,value:p,op:"a"})}):n.push({param:i,value:c,op:"a"})}),this.clone(n)}set(e,n){return this.clone({param:e,value:n,op:"s"})}delete(e,n){return this.clone({param:e,value:n,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const n=this.encoder.encodeKey(e);return this.map.get(e).map(i=>n+"="+this.encoder.encodeValue(i)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const n=new Yu({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(e),n}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const n=("a"===e.op?this.map.get(e.param):void 0)||[];n.push(sT(e.value)),this.map.set(e.param,n);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let i=this.map.get(e.param)||[];const c=i.indexOf(sT(e.value));-1!==c&&i.splice(c,1),i.length>0?this.map.set(e.param,i):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class bO{constructor(){this.map=new Map}set(e,n){return this.map.set(e,n),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}}function aT(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer}function lT(t){return"undefined"!=typeof Blob&&t instanceof Blob}function cT(t){return"undefined"!=typeof FormData&&t instanceof FormData}class $m{constructor(e,n,i,c){let p;if(this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function wO(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||c?(this.body=void 0!==i?i:null,p=c):p=i,p&&(this.reportProgress=!!p.reportProgress,this.withCredentials=!!p.withCredentials,p.responseType&&(this.responseType=p.responseType),p.headers&&(this.headers=p.headers),p.context&&(this.context=p.context),p.params&&(this.params=p.params)),this.headers||(this.headers=new Qc),this.context||(this.context=new bO),this.params){const v=this.params.toString();if(0===v.length)this.urlWithParams=n;else{const C=n.indexOf("?");this.urlWithParams=n+(-1===C?"?":C<n.length-1?"&":"")+v}}else this.params=new Yu,this.urlWithParams=n}serializeBody(){return null===this.body?null:aT(this.body)||lT(this.body)||cT(this.body)||function EO(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Yu?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||cT(this.body)?null:lT(this.body)?this.body.type||null:aT(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Yu?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){var n;const i=e.method||this.method,c=e.url||this.url,p=e.responseType||this.responseType,v=void 0!==e.body?e.body:this.body,C=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,S=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let R=e.headers||this.headers,z=e.params||this.params;const q=null!==(n=e.context)&&void 0!==n?n:this.context;return void 0!==e.setHeaders&&(R=Object.keys(e.setHeaders).reduce((me,be)=>me.set(be,e.setHeaders[be]),R)),e.setParams&&(z=Object.keys(e.setParams).reduce((me,be)=>me.set(be,e.setParams[be]),z)),new $m(i,c,v,{params:z,headers:R,context:q,reportProgress:S,responseType:p,withCredentials:C})}}var io=(()=>((io=io||{})[io.Sent=0]="Sent",io[io.UploadProgress=1]="UploadProgress",io[io.ResponseHeader=2]="ResponseHeader",io[io.DownloadProgress=3]="DownloadProgress",io[io.Response=4]="Response",io[io.User=5]="User",io))();class L0{constructor(e,n=200,i="OK"){this.headers=e.headers||new Qc,this.status=void 0!==e.status?e.status:n,this.statusText=e.statusText||i,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class F0 extends L0{constructor(e={}){super(e),this.type=io.ResponseHeader}clone(e={}){return new F0({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class vy extends L0{constructor(e={}){super(e),this.type=io.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new vy({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class uT extends L0{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function N0(t,e){return{body:e,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}let hT=(()=>{class t{constructor(n){this.handler=n}request(n,i,c={}){let p;if(n instanceof $m)p=n;else{let S,R;S=c.headers instanceof Qc?c.headers:new Qc(c.headers),c.params&&(R=c.params instanceof Yu?c.params:new Yu({fromObject:c.params})),p=new $m(n,i,void 0!==c.body?c.body:null,{headers:S,context:c.context,params:R,reportProgress:c.reportProgress,responseType:c.responseType||"json",withCredentials:c.withCredentials})}const v=Zn(p).pipe(Uf(S=>this.handler.handle(S)));if(n instanceof $m||"events"===c.observe)return v;const C=v.pipe(ba(S=>S instanceof vy));switch(c.observe||"body"){case"body":switch(p.responseType){case"arraybuffer":return C.pipe(rt(S=>{if(null!==S.body&&!(S.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return S.body}));case"blob":return C.pipe(rt(S=>{if(null!==S.body&&!(S.body instanceof Blob))throw new Error("Response is not a Blob.");return S.body}));case"text":return C.pipe(rt(S=>{if(null!==S.body&&"string"!=typeof S.body)throw new Error("Response is not a string.");return S.body}));default:return C.pipe(rt(S=>S.body))}case"response":return C;default:throw new Error(`Unreachable: unhandled observe type ${c.observe}}`)}}delete(n,i={}){return this.request("DELETE",n,i)}get(n,i={}){return this.request("GET",n,i)}head(n,i={}){return this.request("HEAD",n,i)}jsonp(n,i){return this.request("JSONP",n,{params:(new Yu).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,i={}){return this.request("OPTIONS",n,i)}patch(n,i,c={}){return this.request("PATCH",n,N0(c,i))}post(n,i,c={}){return this.request("POST",n,N0(c,i))}put(n,i,c={}){return this.request("PUT",n,N0(c,i))}}return t.\u0275fac=function(n){return new(n||t)(dn(rT))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();class dT{constructor(e,n){this.next=e,this.interceptor=n}handle(e){return this.interceptor.intercept(e,this.next)}}const fT=new Xt("HTTP_INTERCEPTORS");let CO=(()=>{class t{intercept(n,i){return i.handle(n)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();const TO=/^\)\]\}',?\n/;let pT=(()=>{class t{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Be(i=>{const c=this.xhrFactory.build();if(c.open(n.method,n.urlWithParams),n.withCredentials&&(c.withCredentials=!0),n.headers.forEach((be,Ge)=>c.setRequestHeader(be,Ge.join(","))),n.headers.has("Accept")||c.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const be=n.detectContentTypeHeader();null!==be&&c.setRequestHeader("Content-Type",be)}if(n.responseType){const be=n.responseType.toLowerCase();c.responseType="json"!==be?be:"text"}const p=n.serializeBody();let v=null;const C=()=>{if(null!==v)return v;const be=c.statusText||"OK",Ge=new Qc(c.getAllResponseHeaders()),xt=function DO(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(c)||n.url;return v=new F0({headers:Ge,status:c.status,statusText:be,url:xt}),v},S=()=>{let{headers:be,status:Ge,statusText:xt,url:Ot}=C(),jt=null;204!==Ge&&(jt=void 0===c.response?c.responseText:c.response),0===Ge&&(Ge=jt?200:0);let ct=Ge>=200&&Ge<300;if("json"===n.responseType&&"string"==typeof jt){const fn=jt;jt=jt.replace(TO,"");try{jt=""!==jt?JSON.parse(jt):null}catch(er){jt=fn,ct&&(ct=!1,jt={error:er,text:jt})}}ct?(i.next(new vy({body:jt,headers:be,status:Ge,statusText:xt,url:Ot||void 0})),i.complete()):i.error(new uT({error:jt,headers:be,status:Ge,statusText:xt,url:Ot||void 0}))},R=be=>{const{url:Ge}=C(),xt=new uT({error:be,status:c.status||0,statusText:c.statusText||"Unknown Error",url:Ge||void 0});i.error(xt)};let z=!1;const q=be=>{z||(i.next(C()),z=!0);let Ge={type:io.DownloadProgress,loaded:be.loaded};be.lengthComputable&&(Ge.total=be.total),"text"===n.responseType&&!!c.responseText&&(Ge.partialText=c.responseText),i.next(Ge)},me=be=>{let Ge={type:io.UploadProgress,loaded:be.loaded};be.lengthComputable&&(Ge.total=be.total),i.next(Ge)};return c.addEventListener("load",S),c.addEventListener("error",R),c.addEventListener("timeout",R),c.addEventListener("abort",R),n.reportProgress&&(c.addEventListener("progress",q),null!==p&&c.upload&&c.upload.addEventListener("progress",me)),c.send(p),i.next({type:io.Sent}),()=>{c.removeEventListener("error",R),c.removeEventListener("abort",R),c.removeEventListener("load",S),c.removeEventListener("timeout",R),n.reportProgress&&(c.removeEventListener("progress",q),null!==p&&c.upload&&c.upload.removeEventListener("progress",me)),c.readyState!==c.DONE&&c.abort()}})}}return t.\u0275fac=function(n){return new(n||t)(dn(FE))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();const z0=new Xt("XSRF_COOKIE_NAME"),B0=new Xt("XSRF_HEADER_NAME");class mT{}let SO=(()=>{class t{constructor(n,i,c){this.doc=n,this.platform=i,this.cookieName=c,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=SE(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return t.\u0275fac=function(n){return new(n||t)(dn(xa),dn(Dm),dn(z0))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})(),V0=(()=>{class t{constructor(n,i){this.tokenService=n,this.headerName=i}intercept(n,i){const c=n.url.toLowerCase();if("GET"===n.method||"HEAD"===n.method||c.startsWith("http://")||c.startsWith("https://"))return i.handle(n);const p=this.tokenService.getToken();return null!==p&&!n.headers.has(this.headerName)&&(n=n.clone({headers:n.headers.set(this.headerName,p)})),i.handle(n)}}return t.\u0275fac=function(n){return new(n||t)(dn(mT),dn(B0))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})(),MO=(()=>{class t{constructor(n,i){this.backend=n,this.injector=i,this.chain=null}handle(n){if(null===this.chain){const i=this.injector.get(fT,[]);this.chain=i.reduceRight((c,p)=>new dT(c,p),this.backend)}return this.chain.handle(n)}}return t.\u0275fac=function(n){return new(n||t)(dn(iT),dn(Fi))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})(),IO=(()=>{class t{static disable(){return{ngModule:t,providers:[{provide:V0,useClass:CO}]}}static withOptions(n={}){return{ngModule:t,providers:[n.cookieName?{provide:z0,useValue:n.cookieName}:[],n.headerName?{provide:B0,useValue:n.headerName}:[]]}}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=qr({type:t}),t.\u0275inj=mr({providers:[V0,{provide:fT,useExisting:V0,multi:!0},{provide:mT,useClass:SO},{provide:z0,useValue:"XSRF-TOKEN"},{provide:B0,useValue:"X-XSRF-TOKEN"}]}),t})(),AO=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=qr({type:t}),t.\u0275inj=mr({providers:[hT,{provide:rT,useClass:MO},pT,{provide:iT,useExisting:pT}],imports:[[IO.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),t})(),gT=(()=>{class t{constructor(n){this.http=n,this.fuelWatchURL="https://www.fuelwatch.wa.gov.au/fuelwatch/fuelWatchRSS?",this.CORS_PROXY="https://cors-anywhere.herokuapp.com/"}get(){var n=Ku.production?this.fuelWatchURL:this.CORS_PROXY+this.fuelWatchURL;return console.log("fetching from",n),this.http.get(n)}static test(){return console.log("test function called"),"this is the returened data from test"}}return t.\u0275fac=function(n){return new(n||t)(dn(hT))},t.\u0275prov=gn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function xy(t,e){return new Be(n=>{const i=t.length;if(0===i)return void n.complete();const c=new Array(i);let p=0,v=0;for(let C=0;C<i;C++){const S=ar(t[C]);let R=!1;n.add(S.subscribe({next:z=>{R||(R=!0,v++),c[C]=z},error:z=>n.error(z),complete:()=>{p++,(p===i||!R)&&(v===i&&n.next(e?e.reduce((z,q,me)=>(z[q]=c[me],z),{}):c),n.complete())}}))}})}let _T=(()=>{class t{constructor(n,i){this._renderer=n,this._elementRef=i,this.onChange=c=>{},this.onTouched=()=>{}}setProperty(n,i){this._renderer.setProperty(this._elementRef.nativeElement,n,i)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}}return t.\u0275fac=function(n){return new(n||t)(Mt($c),Mt(va))},t.\u0275dir=yn({type:t}),t})(),md=(()=>{class t extends _T{}return t.\u0275fac=function(){let e;return function(i){return(e||(e=function ht(t){return wr(()=>{const e=t.prototype.constructor,n=e[yr]||qt(e),i=Object.prototype;let c=Object.getPrototypeOf(t.prototype).constructor;for(;c&&c!==i;){const p=c[yr]||qt(c);if(p&&p!==n)return p;c=Object.getPrototypeOf(c)}return p=>new p})}(t)))(i||t)}}(),t.\u0275dir=yn({type:t,features:[ve]}),t})();const ic=new Xt("NgValueAccessor"),RO={provide:ic,useExisting:ne(()=>by),multi:!0},LO=new Xt("CompositionEventMode");let by=(()=>{class t extends _T{constructor(n,i,c){super(n,i),this._compositionMode=c,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function OO(){const t=tc()?tc().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}())}writeValue(n){this.setProperty("value",null==n?"":n)}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}}return t.\u0275fac=function(n){return new(n||t)(Mt($c),Mt(va),Mt(LO,8))},t.\u0275dir=yn({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,i){1&n&&Ss("input",function(p){return i._handleInput(p.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(p){return i._compositionEnd(p.target.value)})},features:[xi([RO]),ve]}),t})();const cs=new Xt("NgValidators"),Qu=new Xt("NgAsyncValidators");function MT(t){return null!=t}function IT(t){const e=fm(t)?ar(t):t;return nx(e),e}function AT(t){let e={};return t.forEach(n=>{e=null!=n?Object.assign(Object.assign({},e),n):e}),0===Object.keys(e).length?null:e}function PT(t,e){return e.map(n=>n(t))}function kT(t){return t.map(e=>function NO(t){return!t.validate}(e)?e:n=>e.validate(n))}function U0(t){return null!=t?function RT(t){if(!t)return null;const e=t.filter(MT);return 0==e.length?null:function(n){return AT(PT(n,e))}}(kT(t)):null}function j0(t){return null!=t?function OT(t){if(!t)return null;const e=t.filter(MT);return 0==e.length?null:function(n){return function PO(...t){if(1===t.length){const e=t[0];if(Y(e))return xy(e,null);if(ie(e)&&Object.getPrototypeOf(e)===Object.prototype){const n=Object.keys(e);return xy(n.map(i=>e[i]),n)}}if("function"==typeof t[t.length-1]){const e=t.pop();return xy(t=1===t.length&&Y(t[0])?t[0]:t,null).pipe(rt(n=>e(...n)))}return xy(t,null)}(PT(n,e).map(IT)).pipe(rt(AT))}}(kT(t)):null}function LT(t,e){return null===t?[e]:Array.isArray(t)?[...t,e]:[t,e]}function $0(t){return t?Array.isArray(t)?t:[t]:[]}function Ey(t,e){return Array.isArray(t)?t.includes(e):t===e}function zT(t,e){const n=$0(e);return $0(t).forEach(c=>{Ey(n,c)||n.push(c)}),n}function BT(t,e){return $0(e).filter(n=>!Ey(t,n))}class VT{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=U0(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=j0(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e){this.control&&this.control.reset(e)}hasError(e,n){return!!this.control&&this.control.hasError(e,n)}getError(e,n){return this.control?this.control.getError(e,n):null}}class eh extends VT{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Ps extends VT{get formDirective(){return null}get path(){return null}}let jT=(()=>{class t extends class UT{constructor(e){this._cd=e}is(e){var n,i,c;return"submitted"===e?!!(null===(n=this._cd)||void 0===n?void 0:n.submitted):!!(null===(c=null===(i=this._cd)||void 0===i?void 0:i.control)||void 0===c?void 0:c[e])}}{constructor(n){super(n)}}return t.\u0275fac=function(n){return new(n||t)(Mt(eh,2))},t.\u0275dir=yn({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,i){2&n&&v_("ng-untouched",i.is("untouched"))("ng-touched",i.is("touched"))("ng-pristine",i.is("pristine"))("ng-dirty",i.is("dirty"))("ng-valid",i.is("valid"))("ng-invalid",i.is("invalid"))("ng-pending",i.is("pending"))},features:[ve]}),t})();function Gm(t,e){(function q0(t,e){const n=function FT(t){return t._rawValidators}(t);null!==e.validator?t.setValidators(LT(n,e.validator)):"function"==typeof n&&t.setValidators([n]);const i=function NT(t){return t._rawAsyncValidators}(t);null!==e.asyncValidator?t.setAsyncValidators(LT(i,e.asyncValidator)):"function"==typeof i&&t.setAsyncValidators([i]);const c=()=>t.updateValueAndValidity();Sy(e._rawValidators,c),Sy(e._rawAsyncValidators,c)})(t,e),e.valueAccessor.writeValue(t.value),function qO(t,e){e.valueAccessor.registerOnChange(n=>{t._pendingValue=n,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&GT(t,e)})}(t,e),function WO(t,e){const n=(i,c)=>{e.valueAccessor.writeValue(i),c&&e.viewToModelUpdate(i)};t.registerOnChange(n),e._registerOnDestroy(()=>{t._unregisterOnChange(n)})}(t,e),function ZO(t,e){e.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&GT(t,e),"submit"!==t.updateOn&&t.markAsTouched()})}(t,e),function HO(t,e){if(e.valueAccessor.setDisabledState){const n=i=>{e.valueAccessor.setDisabledState(i)};t.registerOnDisabledChange(n),e._registerOnDestroy(()=>{t._unregisterOnDisabledChange(n)})}}(t,e)}function Sy(t,e){t.forEach(n=>{n.registerOnValidatorChange&&n.registerOnValidatorChange(e)})}function GT(t,e){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function X0(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}const Hm="VALID",Iy="INVALID",Zf="PENDING",qm="DISABLED";function Y0(t){return(Ay(t)?t.validators:t)||null}function WT(t){return Array.isArray(t)?U0(t):t||null}function J0(t,e){return(Ay(e)?e.asyncValidators:t)||null}function XT(t){return Array.isArray(t)?j0(t):t||null}function Ay(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}const Q0=t=>t instanceof tb;function YT(t){return(t=>t instanceof eD)(t)?t.value:t.getRawValue()}function JT(t,e){const n=Q0(t),i=t.controls;if(!(n?Object.keys(i):i).length)throw new se(1e3,"");if(!i[e])throw new se(1001,"")}function QT(t,e){Q0(t),t._forEachChild((i,c)=>{if(void 0===e[c])throw new se(1002,"")})}class eb{constructor(e,n){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=n,this._composedValidatorFn=WT(this._rawValidators),this._composedAsyncValidatorFn=XT(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Hm}get invalid(){return this.status===Iy}get pending(){return this.status==Zf}get disabled(){return this.status===qm}get enabled(){return this.status!==qm}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=WT(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=XT(e)}addValidators(e){this.setValidators(zT(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(zT(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(BT(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(BT(e,this._rawAsyncValidators))}hasValidator(e){return Ey(this._rawValidators,e)}hasAsyncValidator(e){return Ey(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(n=>{n.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(n=>{n.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Zf,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const n=this._parentMarkedDirty(e.onlySelf);this.status=qm,this.errors=null,this._forEachChild(i=>{i.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:n})),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){const n=this._parentMarkedDirty(e.onlySelf);this.status=Hm,this._forEachChild(i=>{i.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:n})),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Hm||this.status===Zf)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(n=>n._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?qm:Hm}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Zf,this._hasOwnPendingAsyncValidator=!0;const n=IT(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,n={}){this.errors=e,this._updateControlsErrors(!1!==n.emitEvent)}get(e){return function JO(t,e,n){if(null==e||(Array.isArray(e)||(e=e.split(n)),Array.isArray(e)&&0===e.length))return null;let i=t;return e.forEach(c=>{i=Q0(i)?i.controls.hasOwnProperty(c)?i.controls[c]:null:(t=>t instanceof eL)(i)&&i.at(c)||null}),i}(this,e,".")}getError(e,n){const i=n?this.get(n):this;return i&&i.errors?i.errors[e]:null}hasError(e,n){return!!this.getError(e,n)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new bi,this.statusChanges=new bi}_calculateStatus(){return this._allControlsDisabled()?qm:this.errors?Iy:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Zf)?Zf:this._anyControlsHaveStatus(Iy)?Iy:Hm}_anyControlsHaveStatus(e){return this._anyControls(n=>n.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_isBoxedValue(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Ay(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class eD extends eb{constructor(e=null,n,i){super(Y0(n),J0(i,n)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(n),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Ay(n)&&n.initialValueIsDefault&&(this.defaultValue=this._isBoxedValue(e)?e.value:e)}setValue(e,n={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==n.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==n.emitViewToModelChange)),this.updateValueAndValidity(n)}patchValue(e,n={}){this.setValue(e,n)}reset(e=this.defaultValue,n={}){this._applyFormState(e),this.markAsPristine(n),this.markAsUntouched(n),this.setValue(this.value,n),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){X0(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){X0(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}class tb extends eb{constructor(e,n,i){super(Y0(n),J0(i,n)),this.controls=e,this._initObservables(),this._setUpdateStrategy(n),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,n){return this.controls[e]?this.controls[e]:(this.controls[e]=n,n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange),n)}addControl(e,n,i={}){this.registerControl(e,n),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(e,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}setControl(e,n,i={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],n&&this.registerControl(e,n),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,n={}){QT(this,e),Object.keys(e).forEach(i=>{JT(this,i),this.controls[i].setValue(e[i],{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n)}patchValue(e,n={}){null!=e&&(Object.keys(e).forEach(i=>{this.controls[i]&&this.controls[i].patchValue(e[i],{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n))}reset(e={},n={}){this._forEachChild((i,c)=>{i.reset(e[c],{onlySelf:!0,emitEvent:n.emitEvent})}),this._updatePristine(n),this._updateTouched(n),this.updateValueAndValidity(n)}getRawValue(){return this._reduceChildren({},(e,n,i)=>(e[i]=YT(n),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(n,i)=>!!i._syncPendingControls()||n);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(n=>{const i=this.controls[n];i&&e(i,n)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const n of Object.keys(this.controls)){const i=this.controls[n];if(this.contains(n)&&e(i))return!0}return!1}_reduceValue(){return this._reduceChildren({},(e,n,i)=>((n.enabled||this.disabled)&&(e[i]=n.value),e))}_reduceChildren(e,n){let i=e;return this._forEachChild((c,p)=>{i=n(i,c,p)}),i}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}}class eL extends eb{constructor(e,n,i){super(Y0(n),J0(i,n)),this.controls=e,this._initObservables(),this._setUpdateStrategy(n),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[e]}push(e,n={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}insert(e,n,i={}){this.controls.splice(e,0,n),this._registerControl(n),this.updateValueAndValidity({emitEvent:i.emitEvent})}removeAt(e,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),this.updateValueAndValidity({emitEvent:n.emitEvent})}setControl(e,n,i={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),n&&(this.controls.splice(e,0,n),this._registerControl(n)),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,n={}){QT(this,e),e.forEach((i,c)=>{JT(this,c),this.at(c).setValue(i,{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n)}patchValue(e,n={}){null!=e&&(e.forEach((i,c)=>{this.at(c)&&this.at(c).patchValue(i,{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n))}reset(e=[],n={}){this._forEachChild((i,c)=>{i.reset(e[c],{onlySelf:!0,emitEvent:n.emitEvent})}),this._updatePristine(n),this._updateTouched(n),this.updateValueAndValidity(n)}getRawValue(){return this.controls.map(e=>YT(e))}clear(e={}){this.controls.length<1||(this._forEachChild(n=>n._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_syncPendingControls(){let e=this.controls.reduce((n,i)=>!!i._syncPendingControls()||n,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((n,i)=>{e(n,i)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(n=>n.enabled&&e(n))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}const rL={provide:eh,useExisting:ne(()=>rb)},rD=(()=>Promise.resolve(null))();let rb=(()=>{class t extends eh{constructor(n,i,c,p,v){super(),this._changeDetectorRef=v,this.control=new eD,this._registered=!1,this.update=new bi,this._parent=n,this._setValidators(i),this._setAsyncValidators(c),this.valueAccessor=function W0(t,e){if(!e)return null;let n,i,c;return Array.isArray(e),e.forEach(p=>{p.constructor===by?n=p:function YO(t){return Object.getPrototypeOf(t.constructor)===md}(p)?i=p:c=p}),c||i||n||null}(0,p)}ngOnChanges(n){if(this._checkForErrors(),!this._registered||"name"in n){if(this._registered&&(this._checkName(),this.formDirective)){const i=n.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in n&&this._updateDisabled(n),function Z0(t,e){if(!t.hasOwnProperty("model"))return!1;const n=t.model;return!!n.isFirstChange()||!Object.is(e,n.currentValue)}(n,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Gm(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(n){rD.then(()=>{var i;this.control.setValue(n,{emitViewToModelChange:!1}),null===(i=this._changeDetectorRef)||void 0===i||i.markForCheck()})}_updateDisabled(n){const i=n.isDisabled.currentValue,c=""===i||i&&"false"!==i;rD.then(()=>{var p;c&&!this.control.disabled?this.control.disable():!c&&this.control.disabled&&this.control.enable(),null===(p=this._changeDetectorRef)||void 0===p||p.markForCheck()})}_getPath(n){return this._parent?function Ty(t,e){return[...e.path,t]}(n,this._parent):[n]}}return t.\u0275fac=function(n){return new(n||t)(Mt(Ps,9),Mt(cs,10),Mt(Qu,10),Mt(ic,10),Mt(L_,8))},t.\u0275dir=yn({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[xi([rL]),ve,Qi]}),t})(),oD=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=qr({type:t}),t.\u0275inj=mr({}),t})();const ib=new Xt("NgModelWithFormControlWarning");let wD=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=qr({type:t}),t.\u0275inj=mr({imports:[[oD]]}),t})(),IL=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=qr({type:t}),t.\u0275inj=mr({imports:[wD]}),t})(),AL=(()=>{class t{static withConfig(n){return{ngModule:t,providers:[{provide:ib,useValue:n.warnOnNgModelWithFormControl}]}}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=qr({type:t}),t.\u0275inj=mr({imports:[wD]}),t})(),PL=(()=>{class t{constructor(){this.FuelCalc_cost=0}ngOnInit(){document.getElementById("openbtn").addEventListener("click",function(){document.getElementById("mySidepanel").style.width="250px"}),document.getElementById("closebtn").addEventListener("click",function(){document.getElementById("mySidepanel").style.width="0"})}ngOnChanges(n){console.log("new onchange",this.ngOnChanges),console.log("new change",n),this.calcCost();for(let i in n)"FuelCalc_price"===i&&(console.log("Previous FuelCalc_price:",n[i].previousValue),console.log("Current FuelCalc_price:",n[i].currentValue),console.log("firstChange FuelCalc_price:",n[i].firstChange),this.FuelCalc_price=n[i].currentValue),"FuelCalc_distance"===i&&(console.log("Previous FuelCalc_distance:",n[i].previousValue),console.log("Current FuelCalc_distance:",n[i].currentValue),console.log("firstChange FuelCalc_distance:",n[i].firstChange),this.FuelCalc_distance=n[i].currentValue)}calcCost(){console.log("changing the cost");var n=this.FuelCalc_fuelEfficiency/100,i=n/1e3,c=this.FuelCalc_distance*i,v=c*(this.FuelCalc_price/100);console.log("litrePerKM",n),console.log("litrePerKM",n),console.log("litrePerMetre",i),console.log("litreForTrip",c),console.log("calculatedCost",v),console.log("new cost",v),this.setCost(v)}setFuelEfficiency(n){console.log("newFuelEfficiency",n),this.FuelCalc_fuelEfficiency=n,this.calcCost()}setCost(n){this.FuelCalc_cost=n}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=Mr({type:t,selectors:[["app-fuel-calc"]],inputs:{FuelCalc_price:"FuelCalc_price",FuelCalc_distance:"FuelCalc_distance"},features:[Qi],decls:14,vars:4,consts:[[1,"panel"],["id","openbtn",1,"openbtn"],["id","mySidepanel",1,"sidepanel"],["placeholder","Litres used per 100km",3,"ngModel","ngModelChange"]],template:function(n,i){1&n&&(Go(0,"div",0)(1,"button",1),Ms(2,"Fuel Calculations"),Ho(),Go(3,"div",2)(4,"p"),Ms(5,"fuel-calc works!"),Ho(),Ms(6),xl(7,"br"),Ms(8),xl(9,"br"),Ms(10," Efficiency: "),Go(11,"input",3),Ss("ngModelChange",function(p){return i.setFuelEfficiency(p)}),Ho(),xl(12,"br"),Ms(13),Ho()()),2&n&&(fa(6),od(" petrol cost : ",i.FuelCalc_price,""),fa(2),od(" distance to travel : ",i.FuelCalc_distance,""),fa(3),id("ngModel",i.FuelCalc_fuelEfficiency),fa(2),od(" Cost: ",i.FuelCalc_cost," "))},directives:[by,jT,rb],styles:[".panel[_ngcontent-%COMP%]{height:250px;width:0;position:fixed;z-index:2;top:0;left:0;background-color:#fff;overflow-x:hidden;padding-top:10px;transition:.5s}.sidepanel[_ngcontent-%COMP%]{height:250px;width:0;position:fixed;z-index:1;top:0;left:0;background-color:#fff;overflow-x:hidden;padding-top:60px;transition:.5s}.sidepanel[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{padding:8px 8px 8px 32px;text-decoration:none;font-size:25px;color:#818181;display:block;transition:.3s;position:fixed}.sidepanel[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{position:fixed;color:#f1f1f1}.sidepanel[_ngcontent-%COMP%]   .closebtn[_ngcontent-%COMP%]{position:fixed;top:0;right:25px;font-size:36px;margin-left:50px}.openbtn[_ngcontent-%COMP%]{font-size:20px;cursor:pointer;position:fixed;background-color:#111;color:#fff;border:none;z-index:2}.openbtn[_ngcontent-%COMP%]:hover{background-color:#444;position:fixed}"]}),t})(),kL=(()=>{class t{constructor(n){this.viewContainerRef=n}}return t.\u0275fac=function(n){return new(n||t)(Mt(Va))},t.\u0275dir=yn({type:t,selectors:[["","dynamicChildLoader",""]]}),t})(),RL=(()=>{class t{constructor(){}getPosition(){return new Promise((n,i)=>{navigator.geolocation.getCurrentPosition(c=>{n({lng:c.coords.longitude,lat:c.coords.latitude})},c=>{i(c)})})}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=gn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var eu=Xe(898),OL=Xe(518),LL=Xe(545),FL=Xe.n(LL);let NL=(()=>{class t{constructor(){this.style="mapbox://styles/antoniojoboy/cl2569rep000415mf7upq7j1m",this.lat=-31.9523,this.lng=115.8613,this.perth={lng:this.lng,lat:this.lat,coordinates:[this.lng,this.lat]},this.currentLocation=this.perth.coordinates,this.zoom=13,this.Icon_pump="../../assets/Mapbox-marker/Fuel-Saver/pump-256x256.png",this.geojson={},this.locationService=new RL,this.fuelMap_distance=new bi,this.fuelMap_price=new bi,this.feed={},eu.accessToken=Ku.mapbox.accessToken,this.directions=new OL({accessToken:eu.accessToken,interactive:!0,unit:"metric"})}ngOnInit(){function i(){return(i=O0(function*(c,p,v){var C=p.join(","),S=v.join(","),R=`${C};${S}`;console.log("getting distance between",C,S);var z=`https://api.mapbox.com/directions/v5/mapbox/${c}/${R}?alternatives=true&geometries=geojson&language=en&overview=simplified&steps=true&access_token=${eu.accessToken}`;const me=yield(yield fetch(z,{method:"GET"})).json();var be=me.routes[0].distance;return console.log("directionJSON",me),console.log("distance",be),be})).apply(this,arguments)}this.map=new eu.Map({container:"map",style:this.style,zoom:this.zoom,center:this.currentLocation}),this.addMapControls(),this.map.on("load",()=>{this.gotoCurrentLocation(),this.map.loadImage(this.Icon_pump,(c,p)=>{if(c)throw c;this.map.addImage("pump",p),this.addFuelStations()})}),this.map.on("click","stations",c=>{var p=c.features[0].properties.price,v=c.features[0].geometry.coordinates.slice(),C=JSON.parse(c.features[0].properties.popup).html;console.log("station.features[0]",c.features[0]);var S=this.map.queryRenderedFeatures(c.point,{layers:["stations"]}),R=S;for(S.length&&(R=S[0]);Math.abs(c.lngLat.lng-v[0])>180;)v[0]+=c.lngLat.lng>v[0]?360:-360;console.log("feature()",R),(new eu.Popup).setLngLat(v).setHTML(C).addTo(this.map);var z=this;document.getElementById("calcCost").addEventListener("click",function(){z.directions.setOrigin(z.currentLocation);var q=JSON.parse(R.properties.coordinates);z.directions.setDestination(q),console.log("self.current location",z.currentLocation),console.log("self.directions",z.directions),z.fuelMap_price.emit(p),function n(c,p,v){return i.apply(this,arguments)}("driving-traffic",z.currentLocation,q).then(me=>{console.log("distanceData",me),z.fuelMap_distance.emit(me)})})}),this.map.on("mouseenter","stations",()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave","stations",()=>{this.map.getCanvas().style.cursor=""})}addMapControls(){this.map.addControl(new(FL())({accessToken:eu.accessToken,mapboxgl:eu,marker:!0,placeholder:"  Search for places",proximity:{longitude:this.perth.lng,latitude:this.perth.lat}})),this.map.addControl(this.directions,"top-right"),this.map.addControl(new eu.NavigationControl,"bottom-right"),this.map.addControl(new eu.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),"bottom-right")}goTo(n){console.log("location",n),console.log("about to fly to 1",n),this.map.flyTo({center:n,zoom:this.zoom+3,essential:!0}),console.log("flew")}ngOnChanges(n){for(let i in n)"feed"===i&&(this.FuelWatchFeedtoGeoJSON(n[i].currentValue),this.addFuelStations())}addFuelStations(){console.log("adding from this",this.geojson);var n=this.map.getSource("fuelStations");n?n.setData(this.geojson):this.map.addSource("fuelStations",{type:"geojson",data:this.geojson}),this.map.addLayer({id:"stations",type:"symbol",source:"fuelStations",layout:{"icon-image":"pump","icon-size":.1}})}FuelWatchFeedtoGeoJSON(n){var i={type:"FeatureCollection",features:[]};n.item.forEach(c=>{i.features.push({type:"Feature",geometry:{type:"Point",coordinates:[c.longitude,c.latitude]},properties:{title:c.title,description:c.description,price:c.price,popup:{html:this.toPopup(c)},coordinates:[c.longitude,c.latitude]}})}),this.geojson=i,console.log("this.geojson",this.geojson)}toPopup(n){return`\n    <div class="simplebar-content" style="padding: 0px;">\n    <div class="fuel-station__name-wrapper">\n        <div class="container-fluid">\n\n            <div class="row position-relative">\n                <div class="col-8 col-lg-9">\n                    <div>\n                        <h2>${n["trading-name"]}</h2>\n                    </div>\n                </div>\n            </div>\n\n        </div>\n    </div>\n\n    <div class="fuel-station__address-wrapper">\n\n        <hr class="divider">\n\n        <div class="container-fluid">\n            <div class="row">\n                <div class="col-12">\n                    <span>Address: ${n.address}</span>\n                </div>\n            </div>\n\n            <div class="row">\n                <div class="col-12">\n                    <div class="fuel-station__contact-number">\n                        Call: <a href="tel:${n.phone}">${n.phone}</a>\n                    </div>\n                </div>\n            </div>\n\n            <hr class="divider">\n\n        </div>\n\n    </div>\n\n    <div class="fuel-station__pricing-wrapper ng-star-inserted">\n        <div class="container-fluid">\n            <div class="row">\n                <div class="col-12">\n                    <h4 class="fuel-price__title">ULP prices</h4>\n                </div>\n            </div>\n\n            <div class="row">\n                <div class="col-6 ng-star-inserted">\n                    <div>\n                        <p class="h2">\n                            ${n.price}\n                        </p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class="fuel-station__direction-wrapper ng-star-inserted">\n        <div class="container-fluid">\n            <div class="row">\n                <div class="col-12">\n                    <button id="calcCost" \n                        <span class="mat-button-wrapper">\n                            Calculate cost to get there\n                        </span>\n                        <span matripple="" class="mat-ripple mat-button-ripple"></span>\n                        <span class="mat-button-focus-overlay"> </span>\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n`}test(){alert("testing function")}gotoCurrentLocation(){this.locationService.getPosition().then(n=>{console.log(`Positon: ${n.lng} ${n.lat}`),this.currentLocation=[n.lng,n.lat],this.goTo(this.currentLocation)})}getLocation(){this.locationService.getPosition().then(n=>{console.log(`Positon: ${n.lng} ${n.lat}`)})}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=Mr({type:t,selectors:[["app-fuel-map"]],viewQuery:function(n,i){if(1&n&&function C1(t,e,n){const i=or();i.firstCreatePass&&(D1(i,new w1(t,e,n),-1),2==(2&e)&&(i.staticViewQueries=!0)),T1(i,pt(),e)}(kL,7),2&n){let c;M_(c=I_())&&(i.dynamicChild=c.first)}},inputs:{feed:"feed"},outputs:{fuelMap_distance:"fuelMap_distance",fuelMap_price:"fuelMap_price"},features:[Qi],decls:4,vars:0,consts:[["id","map-container"],["id","map"]],template:function(n,i){1&n&&(Go(0,"p"),Ms(1,"fuel-map works!"),Ho(),Go(2,"div",0),xl(3,"div",1),Ho())},styles:["#map-container[_ngcontent-%COMP%]{top:10;bottom:0}#map[_ngcontent-%COMP%]{position:fixed;top:0;bottom:0;width:100%;z-index:1}.marker[_ngcontent-%COMP%]{background-size:cover;width:50px;height:50px;border-radius:50%}.mapboxgl-popup[_ngcontent-%COMP%]{max-width:200px}.mapboxgl-popup-content[_ngcontent-%COMP%]{text-align:center;font-family:Open Sans,sans-serif}"]}),t})();const zL=[{path:"home",component:mO},{path:"FuelSaver",component:(()=>{class t{constructor(n,i){this.FuelWatch=n,this.FuelWatchService=i,this.environment=Ku,this.FuelWatchFeedList=null,this.ngxXml2jsonService=new Jc,this.Feed=new gO({})}ngOnInit(){var n=this;return O0(function*(){yield n.loadData()})()}loadData(){var n=this;return O0(function*(){n.FuelWatchService.get().subscribe(i=>{var p=n.parseXML(i.rss.channel);n.Feed=p.rss.channel,console.log("this.Feed",n.Feed)},i=>{if(Ku.production)console.error("Error in loading the fuel watch rss Feed",i);else{var p=n.parseXML(i.error.text);n.Feed=p.rss.channel}})})()}parseXML(n){var c=(new DOMParser).parseFromString(n,"text/xml");return this.ngxXml2jsonService.xmlToJson(c)}setDistance(n){this.fuelSaver_distance=n}setPrice(n){this.fuelSaver_price=n}}return t.\u0275fac=function(n){return new(n||t)(Mt(gT),Mt(gT))},t.\u0275cmp=Mr({type:t,selectors:[["app-fuel-saver"]],decls:2,vars:3,consts:[[3,"FuelCalc_distance","FuelCalc_price"],[3,"feed","fuelMap_distance","fuelMap_price"]],template:function(n,i){1&n&&(xl(0,"app-fuel-calc",0),Go(1,"app-fuel-map",1),Ss("fuelMap_distance",function(p){return i.setDistance(p)})("fuelMap_price",function(p){return i.setPrice(p)}),Ho()),2&n&&(id("FuelCalc_distance",i.fuelSaver_distance)("FuelCalc_price",i.fuelSaver_price),fa(1),id("feed",i.Feed))},directives:[PL,NL],styles:[""]}),t})()},{path:"",redirectTo:"/",pathMatch:"full"},{path:"**",redirectTo:"/",pathMatch:"full"}];let BL=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=qr({type:t}),t.\u0275inj=mr({imports:[[QC.forRoot(zL)],QC]}),t})();const VL=function(){return["/home"]},UL=function(){return["/FuelSaver"]};let jL=(()=>{class t{constructor(){}ngOnInit(){var n=document.getElementById("myTopnav");"topnav"===n.className?n.className+=" responsive":n.className="topnav",document.getElementById("myTopnav").getElementsByClassName("btn")}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=Mr({type:t,selectors:[["app-navigation-bar"]],decls:10,vars:4,consts:[[1,"navbar","navbar-fixed-top","navbar-dark","bg-inverse"],["rel","stylesheet","href","https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"],[1,"title"],["id","myTopnav",1,"topnav"],["routerLinkActive","active",3,"routerLink"]],template:function(n,i){1&n&&(Go(0,"nav",0),xl(1,"link",1),Go(2,"div",2),Ms(3," Actilogic "),Ho(),Go(4,"div",3)(5,"a",4),Ms(6,"Home"),Ho(),Go(7,"a",4),Ms(8,"Fuel Saver"),Ho()()(),xl(9,"router-outlet")),2&n&&(fa(5),id("routerLink",gx(2,VL)),fa(2),id("routerLink",gx(3,UL)))},directives:[yy,WC,hy],styles:[".topnav[_ngcontent-%COMP%]{background-color:#333;overflow:hidden}.topnav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{float:left;display:block;color:#f2f2f2;text-align:center;padding:14px 16px;text-decoration:none;font-size:17px}.topnav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#ddd;color:#000}.topnav[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{background-color:#04aa6d;color:#fff}.topnav[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{display:none}.title[_ngcontent-%COMP%]{display:block;padding:5px 10px;color:#1fc551;font-size:3em;letter-spacing:1px;text-align:center;text-decoration:none;text-transform:uppercase}.title[_ngcontent-%COMP%]:hover{background:rgba(0,0,0,0)}"]}),t})(),$L=(()=>{class t{constructor(){this.a=123,this.environment=Ku,this.year=(new Date).getFullYear()}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=Mr({type:t,selectors:[["app-footer"]],decls:3,vars:4,consts:[[1,"footer-basic"],[1,"copyright"]],template:function(n,i){1&n&&(Go(0,"footer",0)(1,"p",1),Ms(2),Ho()()),2&n&&(fa(2),sx("",i.environment.CompanyName," \xa9 ",i.year," ",i.environment.AuthorName," version: ",i.environment.appVersion,""))},styles:[".footer-basic[_ngcontent-%COMP%]{padding:40px 0;background-color:#fff;color:#4b4c4d;width:100%;height:60px;margin-top:auto;right:0;bottom:0;left:0;flex-shrink:0}.footer-basic[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding:0;list-style:none;text-align:center;font-size:18px;line-height:1.6;margin-bottom:0}.footer-basic[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:0 10px}.footer-basic[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:inherit;text-decoration:none;opacity:.8}.footer-basic[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{opacity:1}.footer-basic[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]{text-align:center;padding-bottom:25px}.footer-basic[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{font-size:24px;width:40px;height:40px;line-height:40px;display:inline-block;text-align:center;border-radius:50%;border:1px solid #ccc;margin:0 8px;color:inherit;opacity:.75}.footer-basic[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:hover{opacity:.9}.footer-basic[_ngcontent-%COMP%]   .copyright[_ngcontent-%COMP%]{margin-top:15px;text-align:center;font-size:13px;color:#aaa;margin-bottom:0}"]}),t})(),GL=(()=>{class t{constructor(){this.title="Actilogic"}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=Mr({type:t,selectors:[["app-root"]],decls:3,vars:0,template:function(n,i){1&n&&xl(0,"app-navigation-bar")(1,"app-footer")(2,"router-outlet")},directives:[jL,$L,hy],styles:['[_nghost-%COMP%]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol;font-size:14px;color:#333;box-sizing:border-box;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], h5[_ngcontent-%COMP%], h6[_ngcontent-%COMP%]{margin:8px 0;color:#f0f8ff}p[_ngcontent-%COMP%]{margin:0;color:#f0f8ff}html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{background-color:#171716}a[_ngcontent-%COMP%], a[_ngcontent-%COMP%]:visited, a[_ngcontent-%COMP%]:hover{color:#1976d2;text-decoration:none}a[_ngcontent-%COMP%]:hover{color:#125699}footer[_ngcontent-%COMP%]{margin-top:8px;display:flex;align-items:center;line-height:20px}footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;align-items:center}svg#clouds[_ngcontent-%COMP%]{position:fixed;background-color:#171716;bottom:-160px;left:-230px;z-index:-10;width:1920px}@media screen and (max-width: 767px){.card-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.circle-link), .terminal[_ngcontent-%COMP%]{width:100%}.card[_ngcontent-%COMP%]:not(.highlight-card){height:16px;margin:8px 0}.card.highlight-card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:72px}svg#rocket-smoke[_ngcontent-%COMP%]{right:120px;transform:rotate(-5deg)}}@media screen and (max-width: 575px){svg#rocket-smoke[_ngcontent-%COMP%]{display:none;visibility:hidden}}']}),t})();function hb(t,e,n,i){return lt(n)&&(i=n,n=void 0),i?hb(t,e,n).pipe(rt(c=>Y(c)?i(...c):i(c))):new Be(c=>{ED(t,e,function p(v){c.next(arguments.length>1?Array.prototype.slice.call(arguments):v)},c,n)})}function ED(t,e,n,i,c){let p;if(function ZL(t){return t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}(t)){const v=t;t.addEventListener(e,n,c),p=()=>v.removeEventListener(e,n,c)}else if(function qL(t){return t&&"function"==typeof t.on&&"function"==typeof t.off}(t)){const v=t;t.on(e,n),p=()=>v.off(e,n)}else if(function HL(t){return t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}(t)){const v=t;t.addListener(e,n),p=()=>v.removeListener(e,n)}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(let v=0,C=t.length;v<C;v++)ED(t[v],e,n,i,c)}i.add(p)}const th=new Be(Xc);class XL extends W{constructor(e,n){super()}schedule(e,n=0){return this}}let CD=(()=>{class t{constructor(n,i=t.now){this.SchedulerAction=n,this.now=i}schedule(n,i=0,c){return new this.SchedulerAction(this,n).schedule(c,i)}}return t.now=()=>Date.now(),t})();class nh extends CD{constructor(e,n=CD.now){super(e,()=>nh.delegate&&nh.delegate!==this?nh.delegate.now():n()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(e,n=0,i){return nh.delegate&&nh.delegate!==this?nh.delegate.schedule(e,n,i):super.schedule(e,n,i)}flush(e){const{actions:n}=this;if(this.active)return void n.push(e);let i;this.active=!0;do{if(i=e.execute(e.state,e.delay))break}while(e=n.shift());if(this.active=!1,i){for(;e=n.shift();)e.unsubscribe();throw i}}}const YL=new nh(class KL extends XL{constructor(e,n){super(e,n),this.scheduler=e,this.work=n,this.pending=!1}schedule(e,n=0){if(this.closed)return this;this.state=e;const i=this.id,c=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(c,i,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(c,this.id,n),this}requestAsyncId(e,n,i=0){return setInterval(e.flush.bind(e,this),i)}recycleAsyncId(e,n,i=0){if(null!==i&&this.delay===i&&!1===this.pending)return n;clearInterval(n)}execute(e,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(e,n);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,n){let c,i=!1;try{this.work(e)}catch(p){i=!0,c=!!p&&p||new Error(p)}if(i)return this.unsubscribe(),c}_unsubscribe(){const e=this.id,n=this.scheduler,i=n.actions,c=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==c&&i.splice(c,1),null!=e&&(this.id=this.recycleAsyncId(n,e,null)),this.delay=null}});class Dl{constructor(e,n,i){this.kind=e,this.value=n,this.error=i,this.hasValue="N"===e}observe(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}}do(e,n,i){switch(this.kind){case"N":return e&&e(this.value);case"E":return n&&n(this.error);case"C":return i&&i()}}accept(e,n,i){return e&&"function"==typeof e.next?this.observe(e):this.do(e,n,i)}toObservable(){switch(this.kind){case"N":return Zn(this.value);case"E":return Bf(this.error);case"C":return ty()}throw new Error("unexpected notification kind value")}static createNext(e){return void 0!==e?new Dl("N",e):Dl.undefinedValueNotification}static createError(e){return new Dl("E",void 0,e)}static createComplete(){return Dl.completeNotification}}Dl.completeNotification=new Dl("C"),Dl.undefinedValueNotification=new Dl("N",void 0);class eF{constructor(e,n){this.delay=e,this.scheduler=n}call(e,n){return n.subscribe(new db(e,this.delay,this.scheduler))}}class db extends Ce{constructor(e,n,i){super(e),this.delay=n,this.scheduler=i,this.queue=[],this.active=!1,this.errored=!1}static dispatch(e){const n=e.source,i=n.queue,c=e.scheduler,p=e.destination;for(;i.length>0&&i[0].time-c.now()<=0;)i.shift().notification.observe(p);if(i.length>0){const v=Math.max(0,i[0].time-c.now());this.schedule(e,v)}else this.unsubscribe(),n.active=!1}_schedule(e){this.active=!0,this.destination.add(e.schedule(db.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))}scheduleNotification(e){if(!0===this.errored)return;const n=this.scheduler,i=new tF(n.now()+this.delay,e);this.queue.push(i),!1===this.active&&this._schedule(n)}_next(e){this.scheduleNotification(Dl.createNext(e))}_error(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()}_complete(){this.scheduleNotification(Dl.createComplete()),this.unsubscribe()}}class tF{constructor(e,n){this.time=e,this.notification=n}}const Wm="Service workers are disabled or not supported by this browser";class Py{constructor(e){if(this.serviceWorker=e,e){const i=hb(e,"controllerchange").pipe(rt(()=>e.controller)),p=ey(ny(()=>Zn(e.controller)),i);this.worker=p.pipe(ba(z=>!!z)),this.registration=this.worker.pipe($a(()=>e.getRegistration()));const R=hb(e,"message").pipe(rt(z=>z.data)).pipe(ba(z=>z&&z.type)).pipe(function WL(t){return t?Oi(()=>new Et,t):Oi(new Et)}());R.connect(),this.events=R}else this.worker=this.events=this.registration=function nF(t){return ny(()=>Bf(new Error(t)))}(Wm)}postMessage(e,n){return this.worker.pipe(Wc(1),Ks(i=>{i.postMessage(Object.assign({action:e},n))})).toPromise().then(()=>{})}postMessageWithOperation(e,n,i){const c=this.waitForOperationCompleted(i),p=this.postMessage(e,n);return Promise.all([p,c]).then(([,v])=>v)}generateNonce(){return Math.round(1e7*Math.random())}eventsOfType(e){let n;return n="string"==typeof e?i=>i.type===e:i=>e.includes(i.type),this.events.pipe(ba(n))}nextEventOfType(e){return this.eventsOfType(e).pipe(Wc(1))}waitForOperationCompleted(e){return this.eventsOfType("OPERATION_COMPLETED").pipe(ba(n=>n.nonce===e),Wc(1),rt(n=>{if(void 0!==n.result)return n.result;throw new Error(n.error)})).toPromise()}get isEnabled(){return!!this.serviceWorker}}let rF=(()=>{class t{constructor(n){if(this.sw=n,this.subscriptionChanges=new Et,!n.isEnabled)return this.messages=th,this.notificationClicks=th,void(this.subscription=th);this.messages=this.sw.eventsOfType("PUSH").pipe(rt(c=>c.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(rt(c=>c.data)),this.pushManager=this.sw.registration.pipe(rt(c=>c.pushManager));const i=this.pushManager.pipe($a(c=>c.getSubscription()));this.subscription=so(i,this.subscriptionChanges)}get isEnabled(){return this.sw.isEnabled}requestSubscription(n){if(!this.sw.isEnabled)return Promise.reject(new Error(Wm));const i={userVisibleOnly:!0};let c=this.decodeBase64(n.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),p=new Uint8Array(new ArrayBuffer(c.length));for(let v=0;v<c.length;v++)p[v]=c.charCodeAt(v);return i.applicationServerKey=p,this.pushManager.pipe($a(v=>v.subscribe(i)),Wc(1)).toPromise().then(v=>(this.subscriptionChanges.next(v),v))}unsubscribe(){return this.sw.isEnabled?this.subscription.pipe(Wc(1),$a(i=>{if(null===i)throw new Error("Not subscribed to push notifications.");return i.unsubscribe().then(c=>{if(!c)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})})).toPromise():Promise.reject(new Error(Wm))}decodeBase64(n){return atob(n)}}return t.\u0275fac=function(n){return new(n||t)(dn(Py))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})(),iF=(()=>{class t{constructor(n){if(this.sw=n,!n.isEnabled)return this.versionUpdates=th,this.available=th,this.activated=th,void(this.unrecoverable=th);this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY"]),this.available=this.versionUpdates.pipe(ba(i=>"VERSION_READY"===i.type),rt(i=>({type:"UPDATE_AVAILABLE",current:i.currentVersion,available:i.latestVersion}))),this.activated=this.sw.eventsOfType("UPDATE_ACTIVATED"),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}get isEnabled(){return this.sw.isEnabled}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(Wm));const n=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:n},n)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(Wm));const n=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:n},n)}}return t.\u0275fac=function(n){return new(n||t)(dn(Py))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();class fb{}const TD=new Xt("NGSW_REGISTER_SCRIPT");function oF(t,e,n,i){return()=>{if(!OE(i)||!("serviceWorker"in navigator)||!1===n.enabled)return;let p;if(navigator.serviceWorker.addEventListener("controllerchange",()=>{null!==navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({action:"INITIALIZE"})}),"function"==typeof n.registrationStrategy)p=n.registrationStrategy();else{const[C,...S]=(n.registrationStrategy||"registerWhenStable:30000").split(":");switch(C){case"registerImmediately":p=Zn(null);break;case"registerWithDelay":p=DD(+S[0]||0);break;case"registerWhenStable":p=S[0]?so(SD(t),DD(+S[0])):SD(t);break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${n.registrationStrategy}`)}}t.get(Po).runOutsideAngular(()=>p.pipe(Wc(1)).subscribe(()=>navigator.serviceWorker.register(e,{scope:n.scope}).catch(C=>console.error("Service worker registration failed with:",C))))}}function DD(t){return Zn(null).pipe(function QL(t,e=YL){const i=function JL(t){return t instanceof Date&&!isNaN(+t)}(t)?+t-e.now():Math.abs(t);return c=>c.lift(new eF(i,e))}(t))}function SD(t){return t.get(O_).isStable.pipe(ba(n=>n))}function sF(t,e){return new Py(OE(e)&&!1!==t.enabled?navigator.serviceWorker:void 0)}let aF=(()=>{class t{static register(n,i={}){return{ngModule:t,providers:[{provide:TD,useValue:n},{provide:fb,useValue:i},{provide:Py,useFactory:sF,deps:[fb,Dm]},{provide:R_,useFactory:oF,deps:[Fi,TD,fb,Dm],multi:!0}]}}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=qr({type:t}),t.\u0275inj=mr({providers:[rF,iF]}),t})(),lF=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=qr({type:t,bootstrap:[GL]}),t.\u0275inj=mr({providers:[],imports:[[kE,IL,AL,wP,BL,AO,aF.register("ngsw-worker.js",{enabled:Ku.production,registrationStrategy:"registerWhenStable:30000"})]]}),t})();Ku.production&&function oA(){rE=!1}(),xP().bootstrapModule(lF).catch(t=>console.error(t))},49:function(Bt,Vt,Xe){var lt;Bt=Xe.nmd(Bt),function(we){"object"==typeof global&&global;var Y=function(Ce){this.message=Ce};(Y.prototype=new Error).name="InvalidCharacterError";var ie=function(Ce){throw new Y(Ce)},$="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",K=/[\t\n\f\r ]/g,ce={encode:function(Ce){Ce=String(Ce),/[^\0-\xFF]/.test(Ce)&&ie("The string to be encoded contains characters outside of the Latin1 range.");for(var Ae,J,re,Be,ze=Ce.length%3,Q="",Ee=-1,He=Ce.length-ze;++Ee<He;)Ae=Ce.charCodeAt(Ee)<<16,J=Ce.charCodeAt(++Ee)<<8,re=Ce.charCodeAt(++Ee),Q+=$.charAt((Be=Ae+J+re)>>18&63)+$.charAt(Be>>12&63)+$.charAt(Be>>6&63)+$.charAt(63&Be);return 2==ze?(Ae=Ce.charCodeAt(Ee)<<8,J=Ce.charCodeAt(++Ee),Q+=$.charAt((Be=Ae+J)>>10)+$.charAt(Be>>4&63)+$.charAt(Be<<2&63)+"="):1==ze&&(Be=Ce.charCodeAt(Ee),Q+=$.charAt(Be>>2)+$.charAt(Be<<4&63)+"=="),Q},decode:function(Ce){var ze=(Ce=String(Ce).replace(K,"")).length;ze%4==0&&(ze=(Ce=Ce.replace(/==?$/,"")).length),(ze%4==1||/[^+a-zA-Z0-9/]/.test(Ce))&&ie("Invalid character: the string to be decoded is not correctly encoded.");for(var Ee,Ae,Q=0,J="",re=-1;++re<ze;)Ae=$.indexOf(Ce.charAt(re)),Ee=Q%4?64*Ee+Ae:Ae,Q++%4&&(J+=String.fromCharCode(255&Ee>>(-2*Q&6)));return J},version:"0.1.0"};void 0!==(lt=function(){return ce}.call(Vt,Xe,Vt,Bt))&&(Bt.exports=lt)}()},69:Bt=>{"use strict";var lt,Vt="object"==typeof Reflect?Reflect:null,Xe=Vt&&"function"==typeof Vt.apply?Vt.apply:function(re,Ie,Be){return Function.prototype.apply.call(re,Ie,Be)};lt=Vt&&"function"==typeof Vt.ownKeys?Vt.ownKeys:Object.getOwnPropertySymbols?function(re){return Object.getOwnPropertyNames(re).concat(Object.getOwnPropertySymbols(re))}:function(re){return Object.getOwnPropertyNames(re)};var de=Number.isNaN||function(re){return re!=re};function h(){h.init.call(this)}Bt.exports=h,Bt.exports.once=function Q(J,re){return new Promise(function(Ie,Be){function He(gt){J.removeListener(re,it),Be(gt)}function it(){"function"==typeof J.removeListener&&J.removeListener("error",He),Ie([].slice.call(arguments))}Ae(J,re,it,{once:!0}),"error"!==re&&function Ee(J,re,Ie){"function"==typeof J.on&&Ae(J,"error",re,Ie)}(J,He,{once:!0})})},h.EventEmitter=h,h.prototype._events=void 0,h.prototype._eventsCount=0,h.prototype._maxListeners=void 0;var U=10;function Y(J){if("function"!=typeof J)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof J)}function ie(J){return void 0===J._maxListeners?h.defaultMaxListeners:J._maxListeners}function $(J,re,Ie,Be){var He,it,gt;if(Y(Ie),void 0===(it=J._events)?(it=J._events=Object.create(null),J._eventsCount=0):(void 0!==it.newListener&&(J.emit("newListener",re,Ie.listener?Ie.listener:Ie),it=J._events),gt=it[re]),void 0===gt)gt=it[re]=Ie,++J._eventsCount;else if("function"==typeof gt?gt=it[re]=Be?[Ie,gt]:[gt,Ie]:Be?gt.unshift(Ie):gt.push(Ie),(He=ie(J))>0&&gt.length>He&&!gt.warned){gt.warned=!0;var kt=new Error("Possible EventEmitter memory leak detected. "+gt.length+" "+String(re)+" listeners added. Use emitter.setMaxListeners() to increase limit");kt.name="MaxListenersExceededWarning",kt.emitter=J,kt.type=re,kt.count=gt.length,function we(J){console&&console.warn&&console.warn(J)}(kt)}return J}function K(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function W(J,re,Ie){var Be={fired:!1,wrapFn:void 0,target:J,type:re,listener:Ie},He=K.bind(Be);return He.listener=Ie,Be.wrapFn=He,He}function ge(J,re,Ie){var Be=J._events;if(void 0===Be)return[];var He=Be[re];return void 0===He?[]:"function"==typeof He?Ie?[He.listener||He]:[He]:Ie?function ze(J){for(var re=new Array(J.length),Ie=0;Ie<re.length;++Ie)re[Ie]=J[Ie].listener||J[Ie];return re}(He):ue(He,He.length)}function ce(J){var re=this._events;if(void 0!==re){var Ie=re[J];if("function"==typeof Ie)return 1;if(void 0!==Ie)return Ie.length}return 0}function ue(J,re){for(var Ie=new Array(re),Be=0;Be<re;++Be)Ie[Be]=J[Be];return Ie}function Ae(J,re,Ie,Be){if("function"==typeof J.on)Be.once?J.once(re,Ie):J.on(re,Ie);else{if("function"!=typeof J.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof J);J.addEventListener(re,function He(it){Be.once&&J.removeEventListener(re,He),Ie(it)})}}Object.defineProperty(h,"defaultMaxListeners",{enumerable:!0,get:function(){return U},set:function(J){if("number"!=typeof J||J<0||de(J))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+J+".");U=J}}),h.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=function(re){if("number"!=typeof re||re<0||de(re))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+re+".");return this._maxListeners=re,this},h.prototype.getMaxListeners=function(){return ie(this)},h.prototype.emit=function(re){for(var Ie=[],Be=1;Be<arguments.length;Be++)Ie.push(arguments[Be]);var He="error"===re,it=this._events;if(void 0!==it)He=He&&void 0===it.error;else if(!He)return!1;if(He){var gt;if(Ie.length>0&&(gt=Ie[0]),gt instanceof Error)throw gt;var kt=new Error("Unhandled error."+(gt?" ("+gt.message+")":""));throw kt.context=gt,kt}var _t=it[re];if(void 0===_t)return!1;if("function"==typeof _t)Xe(_t,this,Ie);else{var Et=_t.length,Lt=ue(_t,Et);for(Be=0;Be<Et;++Be)Xe(Lt[Be],this,Ie)}return!0},h.prototype.on=h.prototype.addListener=function(re,Ie){return $(this,re,Ie,!1)},h.prototype.prependListener=function(re,Ie){return $(this,re,Ie,!0)},h.prototype.once=function(re,Ie){return Y(Ie),this.on(re,W(this,re,Ie)),this},h.prototype.prependOnceListener=function(re,Ie){return Y(Ie),this.prependListener(re,W(this,re,Ie)),this},h.prototype.off=h.prototype.removeListener=function(re,Ie){var Be,He,it,gt,kt;if(Y(Ie),void 0===(He=this._events))return this;if(void 0===(Be=He[re]))return this;if(Be===Ie||Be.listener===Ie)0==--this._eventsCount?this._events=Object.create(null):(delete He[re],He.removeListener&&this.emit("removeListener",re,Be.listener||Ie));else if("function"!=typeof Be){for(it=-1,gt=Be.length-1;gt>=0;gt--)if(Be[gt]===Ie||Be[gt].listener===Ie){kt=Be[gt].listener,it=gt;break}if(it<0)return this;0===it?Be.shift():function Ce(J,re){for(;re+1<J.length;re++)J[re]=J[re+1];J.pop()}(Be,it),1===Be.length&&(He[re]=Be[0]),void 0!==He.removeListener&&this.emit("removeListener",re,kt||Ie)}return this},h.prototype.removeAllListeners=function(re){var Ie,Be,He;if(void 0===(Be=this._events))return this;if(void 0===Be.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==Be[re]&&(0==--this._eventsCount?this._events=Object.create(null):delete Be[re]),this;if(0===arguments.length){var gt,it=Object.keys(Be);for(He=0;He<it.length;++He)"removeListener"!==(gt=it[He])&&this.removeAllListeners(gt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(Ie=Be[re]))this.removeListener(re,Ie);else if(void 0!==Ie)for(He=Ie.length-1;He>=0;He--)this.removeListener(re,Ie[He]);return this},h.prototype.listeners=function(re){return ge(this,re,!0)},h.prototype.rawListeners=function(re){return ge(this,re,!1)},h.listenerCount=function(J,re){return"function"==typeof J.listenerCount?J.listenerCount(re):ce.call(J,re)},h.prototype.listenerCount=ce,h.prototype.eventNames=function(){return this._eventsCount>0?lt(this._events):[]}},780:Bt=>{var Xe;Bt.exports=Xe={},Xe.simpleFilter=function(lt,we){return we.filter(function(de){return Xe.test(lt,de)})},Xe.test=function(lt,we){return null!==Xe.match(lt,we)},Xe.match=function(lt,we,de){var ce,h=0,U=[],Y=we.length,ie=0,$=0,K=(de=de||{}).pre||"",W=de.post||"",ge=de.caseSensitive&&we||we.toLowerCase();lt=de.caseSensitive&&lt||lt.toLowerCase();for(var ue=0;ue<Y;ue++)ce=we[ue],ge[ue]===lt[h]?(ce=K+ce+W,h+=1,$+=1+$):$=0,ie+=$,U[U.length]=ce;return h===lt.length?(ie=ge===lt?1/0:ie,{rendered:U.join(""),score:ie}):null},Xe.filter=function(lt,we,de){return we&&0!==we.length?"string"!=typeof lt?we:(de=de||{},we.reduce(function(h,U,Y,ie){var $=U;de.extract&&($=de.extract(U));var K=Xe.match(lt,$,de);return null!=K&&(h[h.length]={string:K.rendered,score:K.score,index:Y,original:U}),h},[]).sort(function(h,U){return U.score-h.score||h.index-U.index})):[]}},494:Bt=>{"use strict";var Vt=Object.prototype.toString;Bt.exports=function(Xe){var lt;return"[object Object]"===Vt.call(Xe)&&(null===(lt=Object.getPrototypeOf(Xe))||lt===Object.getPrototypeOf({}))}},82:Bt=>{var we=/^\s+|\s+$/g,de=/^[-+]0x[0-9a-f]+$/i,h=/^0b[01]+$/i,U=/^0o[0-7]+$/i,Y=parseInt,ie="object"==typeof global&&global&&global.Object===Object&&global,$="object"==typeof self&&self&&self.Object===Object&&self,K=ie||$||Function("return this")(),ge=Object.prototype.toString,ce=Math.max,ue=Math.min,Ce=function(){return K.Date.now()};function Q(re){var Ie=typeof re;return!!re&&("object"==Ie||"function"==Ie)}function J(re){if("number"==typeof re)return re;if(function Ae(re){return"symbol"==typeof re||function Ee(re){return!!re&&"object"==typeof re}(re)&&"[object Symbol]"==ge.call(re)}(re))return NaN;if(Q(re)){var Ie="function"==typeof re.valueOf?re.valueOf():re;re=Q(Ie)?Ie+"":Ie}if("string"!=typeof re)return 0===re?re:+re;re=re.replace(we,"");var Be=h.test(re);return Be||U.test(re)?Y(re.slice(2),Be?2:8):de.test(re)?NaN:+re}Bt.exports=function ze(re,Ie,Be){var He,it,gt,kt,_t,Et,Lt=0,ut=!1,rt=!1,un=!0;if("function"!=typeof re)throw new TypeError("Expected a function");function Cn(Ct){var Gt=He,pn=it;return He=it=void 0,Lt=Ct,kt=re.apply(pn,Gt)}function an(Ct){return Lt=Ct,_t=setTimeout(Bn,Ie),ut?Cn(Ct):kt}function hn(Ct){var Gt=Ct-Et;return void 0===Et||Gt>=Ie||Gt<0||rt&&Ct-Lt>=gt}function Bn(){var Ct=Ce();if(hn(Ct))return sr(Ct);_t=setTimeout(Bn,function Ln(Ct){var bt=Ie-(Ct-Et);return rt?ue(bt,gt-(Ct-Lt)):bt}(Ct))}function sr(Ct){return _t=void 0,un&&He?Cn(Ct):(He=it=void 0,kt)}function nt(){var Ct=Ce(),Gt=hn(Ct);if(He=arguments,it=this,Et=Ct,Gt){if(void 0===_t)return an(Et);if(rt)return _t=setTimeout(Bn,Ie),Cn(Et)}return void 0===_t&&(_t=setTimeout(Bn,Ie)),kt}return Ie=J(Ie)||0,Q(Be)&&(ut=!!Be.leading,gt=(rt="maxWait"in Be)?ce(J(Be.maxWait)||0,Ie):gt,un="trailing"in Be?!!Be.trailing:un),nt.cancel=function Rt(){void 0!==_t&&clearTimeout(_t),Lt=0,He=Et=it=_t=void 0},nt.flush=function kn(){return void 0===_t?kt:sr(Ce())},nt}},898:function(Bt){Bt.exports=function(){"use strict";var Vt,Xe,lt;function we(h,U){if(Vt)if(Xe){var Y="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Vt+")(sharedChunk); ("+Xe+")(sharedChunk); self.onerror = null;",ie={};Vt(ie),lt=U(ie),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(lt.workerUrl=window.URL.createObjectURL(new Blob([Y],{type:"text/javascript"})))}else Xe=U;else Vt=U}return we(0,function(h){var U="2.8.1",Y=ie;function ie(s,r,a,u){this.cx=3*s,this.bx=3*(a-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(u-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=u,this.p2x=a,this.p2y=u}ie.prototype.sampleCurveX=function(s){return((this.ax*s+this.bx)*s+this.cx)*s},ie.prototype.sampleCurveY=function(s){return((this.ay*s+this.by)*s+this.cy)*s},ie.prototype.sampleCurveDerivativeX=function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},ie.prototype.solveCurveX=function(s,r){var a,u,f,g,y;for(void 0===r&&(r=1e-6),f=s,y=0;y<8;y++){if(g=this.sampleCurveX(f)-s,Math.abs(g)<r)return f;var x=this.sampleCurveDerivativeX(f);if(Math.abs(x)<1e-6)break;f-=g/x}if((f=s)<(a=0))return a;if(f>(u=1))return u;for(;a<u;){if(g=this.sampleCurveX(f),Math.abs(g-s)<r)return f;s>g?a=f:u=f,f=.5*(u-a)+a}return f},ie.prototype.solve=function(s,r){return this.sampleCurveY(this.solveCurveX(s,r))};var $=K;function K(s,r){this.x=s,this.y=r}K.prototype={clone:function(){return new K(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,r){return this.clone()._rotateAround(s,r)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var r=s.x-this.x,a=s.y-this.y;return r*r+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,r){return Math.atan2(this.x*r-this.y*s,this.x*s+this.y*r)},_matMult:function(s){var r=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=r,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var r=Math.cos(s),a=Math.sin(s),u=a*this.x+r*this.y;return this.x=r*this.x-a*this.y,this.y=u,this},_rotateAround:function(s,r){var a=Math.cos(s),u=Math.sin(s),f=r.y+u*(this.x-r.x)+a*(this.y-r.y);return this.x=r.x+a*(this.x-r.x)-u*(this.y-r.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},K.convert=function(s){return s instanceof K?s:Array.isArray(s)?new K(s[0],s[1]):s};var W="undefined"!=typeof self?self:{};const ge=Math.PI/180,ce=180/Math.PI;function ue(s){return s*ge}function Ce(s){return s*ce}const ze=[[0,0],[1,0],[1,1],[0,1]];function Q(s){if(s<=0)return 0;if(s>=1)return 1;const r=s*s,a=r*s;return 4*(s<.5?a:3*(s-r)+a-.75)}function Ee(s,r,a,u){const f=new Y(s,r,a,u);return function(g){return f.solve(g)}}const Ae=Ee(.25,.1,.25,1);function J(s,r,a){return Math.min(a,Math.max(r,s))}function re(s,r,a){return(a=J((a-s)/(r-s),0,1))*a*(3-2*a)}function Ie(s,r,a){const u=a-r,f=((s-r)%u+u)%u+r;return f===r?a:f}function Be(s,r,a){if(!s.length)return a(null,[]);let u=s.length;const f=new Array(s.length);let g=null;s.forEach((y,x)=>{r(y,(E,D)=>{E&&(g=E),f[x]=D,0==--u&&a(g,f)})})}function He(s){const r=[];for(const a in s)r.push(s[a]);return r}function it(s,...r){for(const a of r)for(const u in a)s[u]=a[u];return s}let gt=1;function kt(){return gt++}function _t(){return function s(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function Et(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Lt(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function ut(s,r){s.forEach(a=>{r[a]&&(r[a]=r[a].bind(r))})}function rt(s,r){return-1!==s.indexOf(r,s.length-r.length)}function un(s,r,a){const u={};for(const f in s)u[f]=r.call(a||this,s[f],f,s);return u}function Cn(s,r,a){const u={};for(const f in s)r.call(a||this,s[f],f,s)&&(u[f]=s[f]);return u}function an(s){return Array.isArray(s)?s.map(an):"object"==typeof s&&s?un(s,an):s}const Ln={};function hn(s){Ln[s]||("undefined"!=typeof console&&console.warn(s),Ln[s]=!0)}function Bn(s,r,a){return(a.y-s.y)*(r.x-s.x)>(r.y-s.y)*(a.x-s.x)}function sr(s){let r=0;for(let a,u,f=0,g=s.length,y=g-1;f<g;y=f++)a=s[f],u=s[y],r+=(u.x-a.x)*(a.y+u.y);return r}function Rt(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function kn(s){const r={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,u,f,g)=>{const y=f||g;return r[u]=!y||y.toLowerCase(),""}),r["max-age"]){const a=parseInt(r["max-age"],10);isNaN(a)?delete r["max-age"]:r["max-age"]=a}return r}let nt,Ct,Gt,pn,bt=null;function Rn(s){if(null==bt){const r=s.navigator?s.navigator.userAgent:null;bt=!!s.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return bt}function Hr(s){try{const r=W[s];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch(r){return!1}}const dr={now:()=>void 0!==Gt?Gt:W.performance.now(),setNow(s){Gt=s},restoreNow(){Gt=void 0},frame(s){const r=W.requestAnimationFrame(s);return{cancel:()=>W.cancelAnimationFrame(r)}},getImageData(s,r=0){const{width:a,height:u}=s;pn||(pn=W.document.createElement("canvas"));const f=pn.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return(a>pn.width||u>pn.height)&&(pn.width=a,pn.height=u),f.clearRect(-r,-r,a+2*r,u+2*r),f.drawImage(s,0,0,a,u),f.getImageData(-r,-r,a+2*r,u+2*r)},resolveURL:s=>(nt||(nt=W.document.createElement("a")),nt.href=s,nt.href),get devicePixelRatio(){return W.devicePixelRatio},get prefersReducedMotion(){return!!W.matchMedia&&(null==Ct&&(Ct=W.matchMedia("(prefers-reduced-motion: reduce)")),Ct.matches)}};let tr;const xn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==tr){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{tr=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):s}catch(r){tr=s}}return tr},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ar={supported:!1,testSupport:function(s){!Wr&&ki&&(Vi?ko(s):Un=s)}};let Un,ki,Wr=!1,Vi=!1;function ko(s){const r=s.createTexture();s.bindTexture(s.TEXTURE_2D,r);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,ki),s.isContextLost())return;ar.supported=!0}catch(a){}s.deleteTexture(r),Wr=!0}W.document&&(ki=W.document.createElement("img"),ki.onload=function(){Un&&ko(Un),Un=null,Vi=!0},ki.onerror=function(){Wr=!0,Un=null},ki.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Br="01",oo="NO_ACCESS_TOKEN";function Ki(s){return 0===s.indexOf("mapbox:")}function Zo(s){return xn.API_URL_REGEX.test(s)}const mi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ri(s){const r=s.match(mi);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function so(s){const r=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${r}`}function Wo(s){if(!s)return null;const r=s.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(decodeURIComponent(W.atob(r[1]).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(a){return null}}class us{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const a=Wo(xn.ACCESS_TOKEN);let u="";return u=a&&a.u?W.btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,(f,g)=>String.fromCharCode(Number("0x"+g)))):xn.ACCESS_TOKEN||"",r?`mapbox.eventData.${r}:${u}`:`mapbox.eventData:${u}`}fetchEventData(){const r=Hr("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid");if(r)try{const f=W.localStorage.getItem(a);f&&(this.eventData=JSON.parse(f));const g=W.localStorage.getItem(u);g&&(this.anonId=g)}catch(f){hn("Unable to read from LocalStorage")}}saveEventData(){const r=Hr("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid");if(r)try{W.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&W.localStorage.setItem(a,JSON.stringify(this.eventData))}catch(f){hn("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,a,u,f){if(!xn.EVENTS_URL)return;const g=Ri(xn.EVENTS_URL);g.params.push(`access_token=${f||xn.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(r).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:U,skuId:Br,userId:this.anonId},x=a?it(y,a):y,E={url:so(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=De(E,D=>{this.pendingRequest=null,u(D),this.saveEventData(),this.processRequests(f)})}queueRequest(r,a){this.queue.push(r),this.processRequests(a)}}const ks=new class extends us{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,r){xn.EVENTS_URL&&xn.ACCESS_TOKEN&&Array.isArray(s)&&s.some(a=>Ki(a)||Zo(a))&&this.queueRequest(Date.now(),r)}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=Wo(xn.ACCESS_TOKEN),a=r?r.u:xn.ACCESS_TOKEN;let u=a!==this.eventData.tokenU;Lt(this.anonId)||(this.anonId=_t(),u=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),y=new Date(f),x=(f-this.eventData.lastSuccess)/864e5;u=u||x>=1||x<-1||g.getDate()!==y.getDate()}else u=!0;u?this.postEvent(f,{"enabled.telemetry":!1},g=>{g||(this.eventData.lastSuccess=f,this.eventData.tokenU=a)},s):this.processRequests()}},hs=ks.postTurnstileEvent.bind(ks),Rs=new class extends us{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,r,a,u){this.skuToken=r,this.errorCb=u,xn.EVENTS_URL&&(a||xn.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},a):this.errorCb(new Error(oo)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),Lt(this.anonId)||(this.anonId=_t()),this.postEvent(a,{skuToken:this.skuToken},u=>{u?this.errorCb(u):r&&(this.success[r]=!0)},s))}},Ys=Rs.postMapLoadEvent.bind(Rs),wi=new class extends us{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,r,a,u){if(!xn.API_URL||!xn.SESSION_PATH)return;const f=Ri(xn.API_URL+xn.SESSION_PATH);f.params.push(`sku=${r||""}`),f.params.push(`access_token=${u||xn.ACCESS_TOKEN||""}`);const g={url:so(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Me(g,y=>{this.pendingRequest=null,a(y),this.saveEventData(),this.processRequests(u)})}getSessionAPI(s,r,a,u){this.skuToken=r,this.errorCb=u,xn.SESSION_PATH&&xn.API_URL&&(a||xn.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},a):this.errorCb(new Error(oo)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||this.getSession(a,this.skuToken,u=>{u?this.errorCb(u):r&&(this.success[r]=!0)},s)}},Js=wi.getSessionAPI.bind(wi),Oi=new Set,Os="mapbox-tiles";let Ei,Xr,Qn=500,ao=50;function nr(){W.caches&&!Ei&&(Ei=W.caches.open(Os))}function Ui(s){const r=s.indexOf("?");return r<0?s:s.slice(0,r)}let Xo=1/0;const ne={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ne);class N extends Error{constructor(r,a,u){401===a&&Zo(u)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(r),this.status=a,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const j=Rt()?()=>self.worker&&self.worker.referrer:()=>("blob:"===W.location.protocol?W.parent:W).location.href,oe=function(s,r){if(!(/^file:/.test(a=s.url)||/^file:/.test(j())&&!/^\w+:/.test(a))){if(W.fetch&&W.Request&&W.AbortController&&W.Request.prototype.hasOwnProperty("signal"))return function(u,f){const g=new W.AbortController,y=new W.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:j(),signal:g.signal});let x=!1,E=!1;const D=(I=y.url).indexOf("sku=")>0&&Zo(I);var I;"json"===u.type&&y.headers.set("Accept","application/json");const A=(F,V,Z)=>{if(E)return;if(F&&"SecurityError"!==F.message&&hn(F),V&&Z)return k(V);const ee=Date.now();W.fetch(y).then(le=>{if(le.ok){const ve=D?le.clone():null;return k(le,ve,ee)}return f(new N(le.statusText,le.status,u.url))}).catch(le=>{20!==le.code&&f(new Error(le.message))})},k=(F,V,Z)=>{("arrayBuffer"===u.type?F.arrayBuffer():"json"===u.type?F.json():F.text()).then(ee=>{E||(V&&Z&&function(le,ve,Pe){if(nr(),!Ei)return;const Re={status:ve.status,statusText:ve.statusText,headers:new W.Headers};ve.headers.forEach((Ye,Qe)=>Re.headers.set(Qe,Ye));const Le=kn(ve.headers.get("Cache-Control")||"");if(Le["no-store"])return;Le["max-age"]&&Re.headers.set("Expires",new Date(Pe+1e3*Le["max-age"]).toUTCString());const Fe=Re.headers.get("Expires");Fe&&(new Date(Fe).getTime()-Pe<42e4||function(Ye,Qe){if(void 0===Xr)try{new Response(new ReadableStream),Xr=!0}catch(at){Xr=!1}Xr?Qe(Ye.body):Ye.blob().then(Qe)}(ve,Ye=>{const Qe=new W.Response(Ye,Re);nr(),Ei&&Ei.then(at=>at.put(Ui(le.url),Qe)).catch(at=>hn(at.message))}))}(y,V,Z),x=!0,f(null,ee,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(ee=>{E||f(new Error(ee.message))})};return D?function(F,V){if(nr(),!Ei)return V(null);const Z=Ui(F.url);Ei.then(ee=>{ee.match(Z).then(le=>{const ve=function(Pe){if(!Pe)return!1;const Re=new Date(Pe.headers.get("Expires")||0),Le=kn(Pe.headers.get("Cache-Control")||"");return Re>Date.now()&&!Le["no-cache"]}(le);ee.delete(Z),ve&&ee.put(Z,le.clone()),V(null,le,ve)}).catch(V)}).catch(V)}(y,A):A(null,null),{cancel:()=>{E=!0,x||g.abort()}}}(s,r);if(Rt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,r,void 0,!0)}var a;return function(u,f){const g=new W.XMLHttpRequest;g.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(g.responseType="arraybuffer");for(const y in u.headers)g.setRequestHeader(y,u.headers[y]);return"json"===u.type&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials="include"===u.credentials,g.onerror=()=>{f(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||0===g.status)&&null!==g.response){let y=g.response;if("json"===u.type)try{y=JSON.parse(g.response)}catch(x){return f(x)}f(null,y,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else f(new N(g.statusText,g.status,u.url))},g.send(u.body),{cancel:()=>g.abort()}}(s,r)},se=function(s,r){return oe(it(s,{type:"arrayBuffer"}),r)},De=function(s,r){return oe(it(s,{method:"POST"}),r)},Me=function(s,r){return oe(it(s,{method:"GET"}),r)};function Oe(s){const r=W.document.createElement("a");return r.href=s,r.protocol===W.document.location.protocol&&r.host===W.document.location.host}const ke="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let je,st;je=[],st=0;const It=function(s,r){if(ar.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),st>=xn.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:s,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return je.push(g),g}st++;let a=!1;const u=()=>{if(!a)for(a=!0,st--;je.length&&st<xn.MAX_PARALLEL_IMAGE_REQUESTS;){const g=je.shift(),{requestParameters:y,callback:x,cancelled:E}=g;E||(g.cancel=It(y,x).cancel)}},f=se(s,(g,y,x,E)=>{u(),g?r(g):y&&(W.createImageBitmap?function(D,I){const A=new W.Blob([new Uint8Array(D)],{type:"image/png"});W.createImageBitmap(A).then(k=>{I(null,k)}).catch(k=>{I(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(D,I)=>r(D,I,x,E)):function(D,I){const A=new W.Image,k=W.URL;A.onload=()=>{I(null,A),k.revokeObjectURL(A.src),A.onload=null,W.requestAnimationFrame(()=>{A.src=ke})},A.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const F=new W.Blob([new Uint8Array(D)],{type:"image/png"});A.src=D.byteLength?k.createObjectURL(F):ke}(y,(D,I)=>r(D,I,x,E)))});return{cancel:()=>{f.cancel(),u()}}};function ot(s,r,a){a[s]&&-1!==a[s].indexOf(r)||(a[s]=a[s]||[],a[s].push(r))}function on(s,r,a){if(a&&a[s]){const u=a[s].indexOf(r);-1!==u&&a[s].splice(u,1)}}class Kt{constructor(r,a={}){it(this,a),this.type=r}}class Yt extends Kt{constructor(r,a={}){super("error",it({error:r},a))}}class rn{on(r,a){return this._listeners=this._listeners||{},ot(r,a,this._listeners),this}off(r,a){return on(r,a,this._listeners),on(r,a,this._oneTimeListeners),this}once(r,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},ot(r,a,this._oneTimeListeners),this):new Promise(u=>this.once(r,u))}fire(r,a){"string"==typeof r&&(r=new Kt(r,a||{}));const u=r.type;if(this.listens(u)){r.target=this;const f=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const x of f)x.call(this,r);const g=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const x of g)on(u,x,this._oneTimeListeners),x.call(this,r);const y=this._eventedParent;y&&(it(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),y.fire(r))}else r instanceof Yt&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,a){return this._eventedParent=r,this._eventedParentData=a,this}}var $e=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function rr(s,...r){for(const a of r)for(const u in a)s[u]=a[u];return s}function Ht(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Kn(s){if(Array.isArray(s))return s.map(Kn);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const r={};for(const a in s)r[a]=Kn(s[a]);return r}return Ht(s)}class Fn extends Error{constructor(r,a){super(a),this.message=a,this.key=r}}class ds{constructor(r,a=[]){this.parent=r,this.bindings={};for(const[u,f]of a)this.bindings[u]=f}concat(r){return new ds(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const Ro={kind:"null"},At={kind:"number"},mn={kind:"string"},nn={kind:"boolean"},Ci={kind:"color"},fs={kind:"object"},Vn={kind:"value"},gn={kind:"collator"},ps={kind:"formatted"},mr={kind:"resolvedImage"};function hi(s,r){return{kind:"array",itemType:s,N:r}}function Sr(s){if("array"===s.kind){const r=Sr(s.itemType);return"number"==typeof s.N?`array<${r}, ${s.N}>`:"value"===s.itemType.kind?"array":`array<${r}>`}return s.kind}const oc=[Ro,At,mn,nn,Ci,ps,fs,hi(Vn),mr];function Yi(s,r){if("error"===r.kind)return null;if("array"===s.kind){if("array"===r.kind&&(0===r.N&&"value"===r.itemType.kind||!Yi(s.itemType,r.itemType))&&("number"!=typeof s.N||s.N===r.N))return null}else{if(s.kind===r.kind)return null;if("value"===s.kind)for(const a of oc)if(!Yi(a,r))return null}return`Expected ${Sr(s)} but found ${Sr(r)} instead.`}function Qs(s,r){return r.some(a=>a.kind===s.kind)}function lo(s,r){return r.some(a=>"null"===a?null===s:"array"===a?Array.isArray(s):"object"===a?s&&!Array.isArray(s)&&"object"==typeof s:a===typeof s)}function Ls(s){var r={exports:{}};return s(r,r.exports),r.exports}var ea=Ls(function(s,r){var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function u(x){return(x=Math.round(x))<0?0:x>255?255:x}function f(x){return u("%"===x[x.length-1]?parseFloat(x)/100*255:parseInt(x))}function g(x){return(E="%"===x[x.length-1]?parseFloat(x)/100:parseFloat(x))<0?0:E>1?1:E;var E}function y(x,E,D){return D<0?D+=1:D>1&&(D-=1),6*D<1?x+(E-x)*D*6:2*D<1?E:3*D<2?x+(E-x)*(2/3-D)*6:x}try{r.parseCSSColor=function(x){var E,D=x.replace(/ /g,"").toLowerCase();if(D in a)return a[D].slice();if("#"===D[0])return 4===D.length?(E=parseInt(D.substr(1),16))>=0&&E<=4095?[(3840&E)>>4|(3840&E)>>8,240&E|(240&E)>>4,15&E|(15&E)<<4,1]:null:7===D.length&&(E=parseInt(D.substr(1),16))>=0&&E<=16777215?[(16711680&E)>>16,(65280&E)>>8,255&E,1]:null;var I=D.indexOf("("),A=D.indexOf(")");if(-1!==I&&A+1===D.length){var k=D.substr(0,I),F=D.substr(I+1,A-(I+1)).split(","),V=1;switch(k){case"rgba":if(4!==F.length)return null;V=g(F.pop());case"rgb":return 3!==F.length?null:[f(F[0]),f(F[1]),f(F[2]),V];case"hsla":if(4!==F.length)return null;V=g(F.pop());case"hsl":if(3!==F.length)return null;var Z=(parseFloat(F[0])%360+360)%360/360,ee=g(F[1]),le=g(F[2]),ve=le<=.5?le*(ee+1):le+ee-le*ee,Pe=2*le-ve;return[u(255*y(Pe,ve,Z+1/3)),u(255*y(Pe,ve,Z)),u(255*y(Pe,ve,Z-1/3)),V];default:return null}}return null}}catch(x){}});class Wn{constructor(r,a,u,f=1){this.r=r,this.g=a,this.b=u,this.a=f}static parse(r){if(!r)return;if(r instanceof Wn)return r;if("string"!=typeof r)return;const a=ea.parseCSSColor(r);return a?new Wn(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){const[r,a,u,f]=this.toArray();return`rgba(${Math.round(r)},${Math.round(a)},${Math.round(u)},${f})`}toArray(){const{r,g:a,b:u,a:f}=this;return 0===f?[0,0,0,0]:[255*r/f,255*a/f,255*u/f,f]}}Wn.black=new Wn(0,0,0,1),Wn.white=new Wn(1,1,1,1),Wn.transparent=new Wn(0,0,0,0),Wn.red=new Wn(1,0,0,1),Wn.blue=new Wn(0,0,1,1);class wn{constructor(r,a,u){this.sensitivity=r?a?"variant":"case":a?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,a){return this.collator.compare(r,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Oo{constructor(r,a,u,f,g){this.text=r.normalize?r.normalize():r,this.image=a,this.scale=u,this.fontStack=f,this.textColor=g}}class Kr{constructor(r){this.sections=r}static fromString(r){return new Kr([new Oo(r,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(r=>0!==r.text.length||r.image&&0!==r.image.name.length)}static factory(r){return r instanceof Kr?r:Kr.fromString(r)}toString(){return 0===this.sections.length?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const a of this.sections){if(a.image){r.push(["image",a.image.name]);continue}r.push(a.text);const u={};a.fontStack&&(u["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(u["font-scale"]=a.scale),a.textColor&&(u["text-color"]=["rgba"].concat(a.textColor.toArray())),r.push(u)}return r}}class Pr{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Pr({name:r,available:!1}):null}serialize(){return["image",this.name]}}function gi(s,r,a,u){return"number"==typeof s&&s>=0&&s<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof a&&a>=0&&a<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[s,r,a,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[s,r,a,u]:[s,r,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Lo(s){if(null===s||"string"==typeof s||"boolean"==typeof s||"number"==typeof s||s instanceof Wn||s instanceof wn||s instanceof Kr||s instanceof Pr)return!0;if(Array.isArray(s)){for(const r of s)if(!Lo(r))return!1;return!0}if("object"==typeof s){for(const r in s)if(!Lo(s[r]))return!1;return!0}return!1}function wr(s){if(null===s)return Ro;if("string"==typeof s)return mn;if("boolean"==typeof s)return nn;if("number"==typeof s)return At;if(s instanceof Wn)return Ci;if(s instanceof wn)return gn;if(s instanceof Kr)return ps;if(s instanceof Pr)return mr;if(Array.isArray(s)){const r=s.length;let a;for(const u of s){const f=wr(u);if(a){if(a===f)continue;a=Vn;break}a=f}return hi(a||Vn,r)}return fs}function oi(s){const r=typeof s;return null===s?"":"string"===r||"number"===r||"boolean"===r?String(s):s instanceof Wn||s instanceof Kr||s instanceof Pr?s.toString():JSON.stringify(s)}class Ko{constructor(r,a){this.type=r,this.value=a}static parse(r,a){if(2!==r.length)return a.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Lo(r[1]))return a.error("invalid value");const u=r[1];let f=wr(u);const g=a.expectedType;return"array"!==f.kind||0!==f.N||!g||"array"!==g.kind||"number"==typeof g.N&&0!==g.N||(f=g),new Ko(f,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Wn?["rgba"].concat(this.value.toArray()):this.value instanceof Kr?this.value.serialize():this.value}}class _i{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const Li={string:mn,number:At,boolean:nn,object:fs};class co{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");let u,f=1;const g=r[0];if("array"===g){let x,E;if(r.length>2){const D=r[1];if("string"!=typeof D||!(D in Li)||"object"===D)return a.error('The item type argument of "array" must be one of string, number, boolean',1);x=Li[D],f++}else x=Vn;if(r.length>3){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return a.error('The length argument to "array" must be a positive integer literal',2);E=r[2],f++}u=hi(x,E)}else u=Li[g];const y=[];for(;f<r.length;f++){const x=a.parse(r[f],f,Vn);if(!x)return null;y.push(x)}return new co(u,y)}evaluate(r){for(let a=0;a<this.args.length;a++){const u=this.args[a].evaluate(r);if(!Yi(this.type,wr(u)))return u;if(a===this.args.length-1)throw new _i(`Expected value to be of type ${Sr(this.type)}, but found ${Sr(wr(u))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,a=[r.kind];if("array"===r.kind){const u=r.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){a.push(u.kind);const f=r.N;("number"==typeof f||this.args.length>1)&&a.push(f)}}return a.concat(this.args.map(u=>u.serialize()))}}class Fs{constructor(r){this.type=ps,this.sections=r}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const u=r[1];if(!Array.isArray(u)&&"object"==typeof u)return a.error("First argument must be an image or text section.");const f=[];let g=!1;for(let y=1;y<=r.length-1;++y){const x=r[y];if(g&&"object"==typeof x&&!Array.isArray(x)){g=!1;let E=null;if(x["font-scale"]&&(E=a.parse(x["font-scale"],1,At),!E))return null;let D=null;if(x["text-font"]&&(D=a.parse(x["text-font"],1,hi(mn)),!D))return null;let I=null;if(x["text-color"]&&(I=a.parse(x["text-color"],1,Ci),!I))return null;const A=f[f.length-1];A.scale=E,A.font=D,A.textColor=I}else{const E=a.parse(r[y],1,Vn);if(!E)return null;const D=E.type.kind;if("string"!==D&&"value"!==D&&"null"!==D&&"resolvedImage"!==D)return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,f.push({content:E,scale:null,font:null,textColor:null})}}return new Fs(f)}evaluate(r){return new Kr(this.sections.map(a=>{const u=a.content.evaluate(r);return wr(u)===mr?new Oo("",u,null,null,null):new Oo(oi(u),null,a.scale?a.scale.evaluate(r):null,a.font?a.font.evaluate(r).join(","):null,a.textColor?a.textColor.evaluate(r):null)}))}eachChild(r){for(const a of this.sections)r(a.content),a.scale&&r(a.scale),a.font&&r(a.font),a.textColor&&r(a.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const a of this.sections){r.push(a.content.serialize());const u={};a.scale&&(u["font-scale"]=a.scale.serialize()),a.font&&(u["text-font"]=a.font.serialize()),a.textColor&&(u["text-color"]=a.textColor.serialize()),r.push(u)}return r}}class ms{constructor(r){this.type=mr,this.input=r}static parse(r,a){if(2!==r.length)return a.error("Expected two arguments.");const u=a.parse(r[1],1,mn);return u?new ms(u):a.error("No image name provided.")}evaluate(r){const a=this.input.evaluate(r),u=Pr.fromString(a);return u&&r.availableImages&&(u.available=r.availableImages.indexOf(a)>-1),u}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Ha={"to-boolean":nn,"to-color":Ci,"to-number":At,"to-string":mn};class Nn{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const u=r[0];if(("to-boolean"===u||"to-string"===u)&&2!==r.length)return a.error("Expected one argument.");const f=Ha[u],g=[];for(let y=1;y<r.length;y++){const x=a.parse(r[y],y,Vn);if(!x)return null;g.push(x)}return new Nn(f,g)}evaluate(r){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(r));if("color"===this.type.kind){let a,u;for(const f of this.args){if(a=f.evaluate(r),u=null,a instanceof Wn)return a;if("string"==typeof a){const g=r.parseColor(a);if(g)return g}else if(Array.isArray(a)&&(u=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:gi(a[0],a[1],a[2],a[3]),!u))return new Wn(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new _i(u||`Could not parse color from value '${"string"==typeof a?a:String(JSON.stringify(a))}'`)}if("number"===this.type.kind){let a=null;for(const u of this.args){if(a=u.evaluate(r),null===a)return 0;const f=Number(a);if(!isNaN(f))return f}throw new _i(`Could not convert ${JSON.stringify(a)} to number.`)}return"formatted"===this.type.kind?Kr.fromString(oi(this.args[0].evaluate(r))):"resolvedImage"===this.type.kind?Pr.fromString(oi(this.args[0].evaluate(r))):oi(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Fs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ms(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(a=>{r.push(a.serialize())}),r}}const sc=["Unknown","Point","LineString","Polygon"];class ac{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?sc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:u,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*a-r[0])+this.featureDistanceData.bearing[1]*(f*a-r[1])}return 0}parseColor(r){let a=this._parseColorCache[r];return a||(a=this._parseColorCache[r]=Wn.parse(r)),a}}class Se{constructor(r,a,u,f){this.name=r,this.type=a,this._evaluate=u,this.args=f}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,a){const u=r[0],f=Se.definitions[u];if(!f)return a.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(f)?f[0]:f.type,y=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,x=y.filter(([D])=>!Array.isArray(D)||D.length===r.length-1);let E=null;for(const[D,I]of x){E=new dt(a.registry,a.path,null,a.scope);const A=[];let k=!1;for(let F=1;F<r.length;F++){const V=r[F],Z=Array.isArray(D)?D[F-1]:D.type,ee=E.parse(V,1+A.length,Z);if(!ee){k=!0;break}A.push(ee)}if(!k)if(Array.isArray(D)&&D.length!==A.length)E.error(`Expected ${D.length} arguments, but found ${A.length} instead.`);else{for(let F=0;F<A.length;F++){const V=Array.isArray(D)?D[F]:D.type,Z=A[F];E.concat(F+1).checkSubtype(V,Z.type)}if(0===E.errors.length)return new Se(u,g,I,A)}}if(1===x.length)a.errors.push(...E.errors);else{const D=(x.length?x:y).map(([A])=>{return k=A,Array.isArray(k)?`(${k.map(Sr).join(", ")})`:`(${Sr(k.type)}...)`;var k}).join(" | "),I=[];for(let A=1;A<r.length;A++){const k=a.parse(r[A],1+I.length);if(!k)return null;I.push(Sr(k.type))}a.error(`Expected arguments of type ${D}, but found (${I.join(", ")}) instead.`)}return null}static register(r,a){Se.definitions=a;for(const u in a)r[u]=Se}}class Ze{constructor(r,a,u){this.type=gn,this.locale=u,this.caseSensitive=r,this.diacriticSensitive=a}static parse(r,a){if(2!==r.length)return a.error("Expected one argument.");const u=r[1];if("object"!=typeof u||Array.isArray(u))return a.error("Collator options argument must be an object.");const f=a.parse(void 0!==u["case-sensitive"]&&u["case-sensitive"],1,nn);if(!f)return null;const g=a.parse(void 0!==u["diacritic-sensitive"]&&u["diacritic-sensitive"],1,nn);if(!g)return null;let y=null;return u.locale&&(y=a.parse(u.locale,1,mn),!y)?null:new Ze(f,g,y)}evaluate(r){return new wn(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const yt=8192;function Pn(s,r){s[0]=Math.min(s[0],r[0]),s[1]=Math.min(s[1],r[1]),s[2]=Math.max(s[2],r[0]),s[3]=Math.max(s[3],r[1])}function Yn(s,r){return!(s[0]<=r[0]||s[2]>=r[2]||s[1]<=r[1]||s[3]>=r[3])}function Yr(s,r){const a=(180+s[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,f=Math.pow(2,r.z);return[Math.round(a*f*yt),Math.round(u*f*yt)]}function yr(s,r,a){const u=s[0]-r[0],f=s[1]-r[1],g=s[0]-a[0],y=s[1]-a[1];return u*y-g*f==0&&u*g<=0&&f*y<=0}function Cr(s,r){let a=!1;for(let y=0,x=r.length;y<x;y++){const E=r[y];for(let D=0,I=E.length;D<I-1;D++){if(yr(s,E[D],E[D+1]))return!1;(f=E[D])[1]>(u=s)[1]!=(g=E[D+1])[1]>u[1]&&u[0]<(g[0]-f[0])*(u[1]-f[1])/(g[1]-f[1])+f[0]&&(a=!a)}}var u,f,g;return a}function bo(s,r){for(let a=0;a<r.length;a++)if(Cr(s,r[a]))return!0;return!1}function Mr(s,r,a,u){const f=u[0]-a[0],g=u[1]-a[1],y=(s[0]-a[0])*g-f*(s[1]-a[1]),x=(r[0]-a[0])*g-f*(r[1]-a[1]);return y>0&&x<0||y<0&&x>0}function Sl(s,r,a){for(const D of a)for(let I=0;I<D.length-1;++I)if((x=[(y=D[I+1])[0]-(g=D[I])[0],y[1]-g[1]])[0]*(E=[(f=r)[0]-(u=s)[0],f[1]-u[1]])[1]-x[1]*E[0]!=0&&Mr(u,f,g,y)&&Mr(g,y,u,f))return!0;var u,f,g,y,x,E;return!1}function ci(s,r){for(let a=0;a<s.length;++a)if(!Cr(s[a],r))return!1;for(let a=0;a<s.length-1;++a)if(Sl(s[a],s[a+1],r))return!1;return!0}function Ml(s,r){for(let a=0;a<r.length;a++)if(ci(s,r[a]))return!0;return!1}function Ns(s,r,a){const u=[];for(let f=0;f<s.length;f++){const g=[];for(let y=0;y<s[f].length;y++){const x=Yr(s[f][y],a);Pn(r,x),g.push(x)}u.push(g)}return u}function qr(s,r,a){const u=[];for(let f=0;f<s.length;f++){const g=Ns(s[f],r,a);u.push(g)}return u}function zs(s,r,a,u){if(s[0]<a[0]||s[0]>a[2]){const f=.5*u;let g=s[0]-a[0]>f?-u:a[0]-s[0]>f?u:0;0===g&&(g=s[0]-a[2]>f?-u:a[2]-s[0]>f?u:0),s[0]+=g}Pn(r,s)}function Yo(s,r,a,u){const f=Math.pow(2,u.z)*yt,g=[u.x*yt,u.y*yt],y=[];if(!s)return y;for(const x of s)for(const E of x){const D=[E.x+g[0],E.y+g[1]];zs(D,r,a,f),y.push(D)}return y}function yn(s,r,a,u){const f=Math.pow(2,u.z)*yt,g=[u.x*yt,u.y*yt],y=[];if(!s)return y;for(const E of s){const D=[];for(const I of E){const A=[I.x+g[0],I.y+g[1]];Pn(r,A),D.push(A)}y.push(D)}if(r[2]-r[0]<=f/2){(x=r)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const E of y)for(const D of E)zs(D,r,a,f)}var x;return y}class Vr{constructor(r,a){this.type=nn,this.geojson=r,this.geometries=a}static parse(r,a){if(2!==r.length)return a.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Lo(r[1])){const u=r[1];if("FeatureCollection"===u.type)for(let f=0;f<u.features.length;++f){const g=u.features[f].geometry.type;if("Polygon"===g||"MultiPolygon"===g)return new Vr(u,u.features[f].geometry)}else if("Feature"===u.type){const f=u.geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new Vr(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new Vr(u,u)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(null!=r.geometry()&&null!=r.canonicalID()){if("Point"===r.geometryType())return function(a,u){const f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if("Polygon"===u.type){const x=Ns(u.coordinates,g,y),E=Yo(a.geometry(),f,g,y);if(!Yn(f,g))return!1;for(const D of E)if(!Cr(D,x))return!1}if("MultiPolygon"===u.type){const x=qr(u.coordinates,g,y),E=Yo(a.geometry(),f,g,y);if(!Yn(f,g))return!1;for(const D of E)if(!bo(D,x))return!1}return!0}(r,this.geometries);if("LineString"===r.geometryType())return function(a,u){const f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if("Polygon"===u.type){const x=Ns(u.coordinates,g,y),E=yn(a.geometry(),f,g,y);if(!Yn(f,g))return!1;for(const D of E)if(!ci(D,x))return!1}if("MultiPolygon"===u.type){const x=qr(u.coordinates,g,y),E=yn(a.geometry(),f,g,y);if(!Yn(f,g))return!1;for(const D of E)if(!Ml(D,x))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function vr(s){if(s instanceof Se&&("get"===s.name&&1===s.args.length||"feature-state"===s.name||"has"===s.name&&1===s.args.length||"properties"===s.name||"geometry-type"===s.name||"id"===s.name||/^filter-/.test(s.name))||s instanceof Vr)return!1;let r=!0;return s.eachChild(a=>{r&&!vr(a)&&(r=!1)}),r}function ji(s){if(s instanceof Se&&"feature-state"===s.name)return!1;let r=!0;return s.eachChild(a=>{r&&!ji(a)&&(r=!1)}),r}function pe(s,r){if(s instanceof Se&&r.indexOf(s.name)>=0)return!1;let a=!0;return s.eachChild(u=>{a&&!pe(u,r)&&(a=!1)}),a}class Ne{constructor(r,a){this.type=a.type,this.name=r,this.boundExpression=a}static parse(r,a){if(2!==r.length||"string"!=typeof r[1])return a.error("'var' expression requires exactly one string literal argument.");const u=r[1];return a.scope.has(u)?new Ne(u,a.scope.get(u)):a.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class dt{constructor(r,a=[],u,f=new ds,g=[]){this.registry=r,this.path=a,this.key=a.map(y=>`[${y}]`).join(""),this.scope=f,this.errors=g,this.expectedType=u}parse(r,a,u,f,g={}){return a?this.concat(a,u,f)._parse(r,g):this._parse(r,g)}_parse(r,a){function u(f,g,y){return"assert"===y?new co(g,[f]):"coerce"===y?new Nn(g,[f]):f}if(null!==r&&"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r||(r=["literal",r]),Array.isArray(r)){if(0===r.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=r[0];if("string"!=typeof f)return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[f];if(g){let y=g.parse(r,this);if(!y)return null;if(this.expectedType){const x=this.expectedType,E=y.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==E.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==E.kind&&"string"!==E.kind){if(this.checkSubtype(x,E))return null}else y=u(y,x,a.typeAnnotation||"coerce");else y=u(y,x,a.typeAnnotation||"assert")}if(!(y instanceof Ko)&&"resolvedImage"!==y.type.kind&&Qt(y)){const x=new ac;try{y=new Ko(y.type,y.evaluate(x))}catch(E){return this.error(E.message),null}}return y}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===r?"'undefined' value invalid. Use null instead.":"object"==typeof r?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,a,u){const f="number"==typeof r?this.path.concat(r):this.path,g=u?this.scope.concat(u):this.scope;return new dt(this.registry,f,a||null,g,this.errors)}error(r,...a){const u=`${this.key}${a.map(f=>`[${f}]`).join("")}`;this.errors.push(new Fn(u,r))}checkSubtype(r,a){const u=Yi(r,a);return u&&this.error(u),u}}function Qt(s){if(s instanceof Ne)return Qt(s.boundExpression);if(s instanceof Se&&"error"===s.name||s instanceof Ze||s instanceof Vr)return!1;const r=s instanceof Nn||s instanceof co;let a=!0;return s.eachChild(u=>{a=r?a&&Qt(u):a&&u instanceof Ko}),!!a&&vr(s)&&pe(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function fr(s,r){const a=s.length-1;let u,f,g=0,y=a,x=0;for(;g<=y;)if(x=Math.floor((g+y)/2),u=s[x],f=s[x+1],u<=r){if(x===a||r<f)return x;g=x+1}else{if(!(u>r))throw new _i("Input is not a number.");y=x-1}return 0}class An{constructor(r,a,u){this.type=r,this.input=a,this.labels=[],this.outputs=[];for(const[f,g]of u)this.labels.push(f),this.outputs.push(g)}static parse(r,a){if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");const u=a.parse(r[1],1,At);if(!u)return null;const f=[];let g=null;a.expectedType&&"value"!==a.expectedType.kind&&(g=a.expectedType);for(let y=1;y<r.length;y+=2){const x=1===y?-1/0:r[y],E=r[y+1],D=y,I=y+1;if("number"!=typeof x)return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(f.length&&f[f.length-1][0]>=x)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const A=a.parse(E,I,g);if(!A)return null;g=g||A.type,f.push([x,A])}return new An(g,u,f)}evaluate(r){const a=this.labels,u=this.outputs;if(1===a.length)return u[0].evaluate(r);const f=this.input.evaluate(r);if(f<=a[0])return u[0].evaluate(r);const g=a.length;return f>=a[g-1]?u[g-1].evaluate(r):u[fr(a,f)].evaluate(r)}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&r.push(this.labels[a]),r.push(this.outputs[a].serialize());return r}}function Pt(s,r,a){return s*(1-a)+r*a}var ir=Object.freeze({__proto__:null,number:Pt,color:function(s,r,a){return new Wn(Pt(s.r,r.r,a),Pt(s.g,r.g,a),Pt(s.b,r.b,a),Pt(s.a,r.a,a))},array:function(s,r,a){return s.map((u,f)=>Pt(u,r[f],a))}});const Ft=4/29,Dn=6/29,qn=3*Dn*Dn,Ur=Math.PI/180,di=180/Math.PI;function Ir(s){return s>.008856451679035631?Math.pow(s,1/3):s/qn+Ft}function ri(s){return s>Dn?s*s*s:qn*(s-Ft)}function gr(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Bs(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function wo(s){const r=Bs(s.r),a=Bs(s.g),u=Bs(s.b),f=Ir((.4124564*r+.3575761*a+.1804375*u)/.95047),g=Ir((.2126729*r+.7151522*a+.072175*u)/1);return{l:116*g-16,a:500*(f-g),b:200*(g-Ir((.0193339*r+.119192*a+.9503041*u)/1.08883)),alpha:s.a}}function On(s){let r=(s.l+16)/116,a=isNaN(s.a)?r:r+s.a/500,u=isNaN(s.b)?r:r-s.b/200;return r=1*ri(r),a=.95047*ri(a),u=1.08883*ri(u),new Wn(gr(3.2404542*a-1.5371385*r-.4985314*u),gr(-.969266*a+1.8760108*r+.041556*u),gr(.0556434*a-.2040259*r+1.0572252*u),s.alpha)}function tu(s,r,a){const u=r-s;return s+a*(u>180||u<-180?u-360*Math.round(u/360):u)}const Vs={forward:wo,reverse:On,interpolate:function(s,r,a){return{l:Pt(s.l,r.l,a),a:Pt(s.a,r.a,a),b:Pt(s.b,r.b,a),alpha:Pt(s.alpha,r.alpha,a)}}},qa={forward:function(s){const{l:r,a,b:u}=wo(s),f=Math.atan2(u,a)*di;return{h:f<0?f+360:f,c:Math.sqrt(a*a+u*u),l:r,alpha:s.a}},reverse:function(s){const r=s.h*Ur,a=s.c;return On({l:s.l,a:Math.cos(r)*a,b:Math.sin(r)*a,alpha:s.alpha})},interpolate:function(s,r,a){return{h:tu(s.h,r.h,a),c:Pt(s.c,r.c,a),l:Pt(s.l,r.l,a),alpha:Pt(s.alpha,r.alpha,a)}}};var Ca=Object.freeze({__proto__:null,lab:Vs,hcl:qa});class Zr{constructor(r,a,u,f,g){this.type=r,this.operator=a,this.interpolation=u,this.input=f,this.labels=[],this.outputs=[];for(const[y,x]of g)this.labels.push(y),this.outputs.push(x)}static interpolationFactor(r,a,u,f){let g=0;if("exponential"===r.name)g=Ta(a,r.base,u,f);else if("linear"===r.name)g=Ta(a,1,u,f);else if("cubic-bezier"===r.name){const y=r.controlPoints;g=new Y(y[0],y[1],y[2],y[3]).solve(Ta(a,1,u,f))}return g}static parse(r,a){let[u,f,g,...y]=r;if(!Array.isArray(f)||0===f.length)return a.error("Expected an interpolation type expression.",1);if("linear"===f[0])f={name:"linear"};else if("exponential"===f[0]){const D=f[1];if("number"!=typeof D)return a.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:D}}else{if("cubic-bezier"!==f[0])return a.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const D=f.slice(1);if(4!==D.length||D.some(I=>"number"!=typeof I||I<0||I>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:D}}}if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(g=a.parse(g,2,At),!g)return null;const x=[];let E=null;"interpolate-hcl"===u||"interpolate-lab"===u?E=Ci:a.expectedType&&"value"!==a.expectedType.kind&&(E=a.expectedType);for(let D=0;D<y.length;D+=2){const I=y[D],A=y[D+1],k=D+3,F=D+4;if("number"!=typeof I)return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(x.length&&x[x.length-1][0]>=I)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const V=a.parse(A,F,E);if(!V)return null;E=E||V.type,x.push([I,V])}return"number"===E.kind||"color"===E.kind||"array"===E.kind&&"number"===E.itemType.kind&&"number"==typeof E.N?new Zr(E,u,f,g,x):a.error(`Type ${Sr(E)} is not interpolatable.`)}evaluate(r){const a=this.labels,u=this.outputs;if(1===a.length)return u[0].evaluate(r);const f=this.input.evaluate(r);if(f<=a[0])return u[0].evaluate(r);const g=a.length;if(f>=a[g-1])return u[g-1].evaluate(r);const y=fr(a,f),x=Zr.interpolationFactor(this.interpolation,f,a[y],a[y+1]),E=u[y].evaluate(r),D=u[y+1].evaluate(r);return"interpolate"===this.operator?ir[this.type.kind.toLowerCase()](E,D,x):"interpolate-hcl"===this.operator?qa.reverse(qa.interpolate(qa.forward(E),qa.forward(D),x)):Vs.reverse(Vs.interpolate(Vs.forward(E),Vs.forward(D),x))}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,r,this.input.serialize()];for(let u=0;u<this.labels.length;u++)a.push(this.labels[u],this.outputs[u].serialize());return a}}function Ta(s,r,a,u){const f=u-a,g=s-a;return 0===f?0:1===r?g/f:(Math.pow(r,g)-1)/(Math.pow(r,f)-1)}class Us{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expectected at least one argument.");let u=null;const f=a.expectedType;f&&"value"!==f.kind&&(u=f);const g=[];for(const x of r.slice(1)){const E=a.parse(x,1+g.length,u,void 0,{typeAnnotation:"omit"});if(!E)return null;u=u||E.type,g.push(E)}const y=f&&g.some(x=>Yi(f,x.type));return new Us(y?Vn:u,g)}evaluate(r){let a,u=null,f=0;for(const g of this.args){if(f++,u=g.evaluate(r),u&&u instanceof Pr&&!u.available&&(a||(a=u),u=null,f===this.args.length))return a;if(null!==u)break}return u}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(a=>{r.push(a.serialize())}),r}}class uo{constructor(r,a){this.type=a.type,this.bindings=[].concat(r),this.result=a}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const a of this.bindings)r(a[1]);r(this.result)}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const u=[];for(let g=1;g<r.length-1;g+=2){const y=r[g];if("string"!=typeof y)return a.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return a.error("Variable names must contain only alphanumeric characters or '_'.",g);const x=a.parse(r[g+1],g+1);if(!x)return null;u.push([y,x])}const f=a.parse(r[r.length-1],r.length-1,a.expectedType,u);return f?new uo(u,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[a,u]of this.bindings)r.push(a,u.serialize());return r.push(this.result.serialize()),r}}class Fr{constructor(r,a,u){this.type=r,this.index=a,this.input=u}static parse(r,a){if(3!==r.length)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=a.parse(r[1],1,At),f=a.parse(r[2],2,hi(a.expectedType||Vn));return u&&f?new Fr(f.type.itemType,u,f):null}evaluate(r){const a=this.index.evaluate(r),u=this.input.evaluate(r);if(a<0)throw new _i(`Array index out of bounds: ${a} < 0.`);if(a>=u.length)throw new _i(`Array index out of bounds: ${a} > ${u.length-1}.`);if(a!==Math.floor(a))throw new _i(`Array index must be an integer, but found ${a} instead.`);return u[a]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class nu{constructor(r,a){this.type=nn,this.needle=r,this.haystack=a}static parse(r,a){if(3!==r.length)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=a.parse(r[1],1,Vn),f=a.parse(r[2],2,Vn);return u&&f?Qs(u.type,[nn,mn,At,Ro,Vn])?new nu(u,f):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Sr(u.type)} instead`):null}evaluate(r){const a=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(null==u)return!1;if(!lo(a,["boolean","string","number","null"]))throw new _i(`Expected first argument to be of type boolean, string, number or null, but found ${Sr(wr(a))} instead.`);if(!lo(u,["string","array"]))throw new _i(`Expected second argument to be of type array or string, but found ${Sr(wr(u))} instead.`);return u.indexOf(a)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ru{constructor(r,a,u){this.type=At,this.needle=r,this.haystack=a,this.fromIndex=u}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=a.parse(r[1],1,Vn),f=a.parse(r[2],2,Vn);if(!u||!f)return null;if(!Qs(u.type,[nn,mn,At,Ro,Vn]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Sr(u.type)} instead`);if(4===r.length){const g=a.parse(r[3],3,At);return g?new ru(u,f,g):null}return new ru(u,f)}evaluate(r){const a=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(!lo(a,["boolean","string","number","null"]))throw new _i(`Expected first argument to be of type boolean, string, number or null, but found ${Sr(wr(a))} instead.`);if(!lo(u,["string","array"]))throw new _i(`Expected second argument to be of type array or string, but found ${Sr(wr(u))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(r);return u.indexOf(a,f)}return u.indexOf(a)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Fo{constructor(r,a,u,f,g,y){this.inputType=r,this.type=a,this.input=u,this.cases=f,this.outputs=g,this.otherwise=y}static parse(r,a){if(r.length<5)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return a.error("Expected an even number of arguments.");let u,f;a.expectedType&&"value"!==a.expectedType.kind&&(f=a.expectedType);const g={},y=[];for(let D=2;D<r.length-1;D+=2){let I=r[D];const A=r[D+1];Array.isArray(I)||(I=[I]);const k=a.concat(D);if(0===I.length)return k.error("Expected at least one branch label.");for(const V of I){if("number"!=typeof V&&"string"!=typeof V)return k.error("Branch labels must be numbers or strings.");if("number"==typeof V&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof V&&Math.floor(V)!==V)return k.error("Numeric branch labels must be integer values.");if(u){if(k.checkSubtype(u,wr(V)))return null}else u=wr(V);if(void 0!==g[String(V)])return k.error("Branch labels must be unique.");g[String(V)]=y.length}const F=a.parse(A,D,f);if(!F)return null;f=f||F.type,y.push(F)}const x=a.parse(r[1],1,Vn);if(!x)return null;const E=a.parse(r[r.length-1],r.length-1,f);return E?"value"!==x.type.kind&&a.concat(1).checkSubtype(u,x.type)?null:new Fo(u,f,x,g,y,E):null}evaluate(r){const a=this.input.evaluate(r);return(wr(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),u=[],f={};for(const y of a){const x=f[this.cases[y]];void 0===x?(f[this.cases[y]]=u.length,u.push([this.cases[y],[y]])):u[x][1].push(y)}const g=y=>"number"===this.inputType.kind?Number(y):y;for(const[y,x]of u)r.push(1===x.length?g(x[0]):x.map(g)),r.push(this.outputs[y].serialize());return r.push(this.otherwise.serialize()),r}}class Eo{constructor(r,a,u){this.type=r,this.branches=a,this.otherwise=u}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return a.error("Expected an odd number of arguments.");let u;a.expectedType&&"value"!==a.expectedType.kind&&(u=a.expectedType);const f=[];for(let y=1;y<r.length-1;y+=2){const x=a.parse(r[y],y,nn);if(!x)return null;const E=a.parse(r[y+1],y+1,u);if(!E)return null;f.push([x,E]),u=u||E.type}const g=a.parse(r[r.length-1],r.length-1,u);return g?new Eo(u,f,g):null}evaluate(r){for(const[a,u]of this.branches)if(a.evaluate(r))return u.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[a,u]of this.branches)r(a),r(u);r(this.otherwise)}outputDefined(){return this.branches.every(([r,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(a=>{r.push(a.serialize())}),r}}class Il{constructor(r,a,u,f){this.type=r,this.input=a,this.beginIndex=u,this.endIndex=f}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=a.parse(r[1],1,Vn),f=a.parse(r[2],2,At);if(!u||!f)return null;if(!Qs(u.type,[hi(Vn),mn,Vn]))return a.error(`Expected first argument to be of type array or string, but found ${Sr(u.type)} instead`);if(4===r.length){const g=a.parse(r[3],3,At);return g?new Il(u.type,u,f,g):null}return new Il(u.type,u,f)}evaluate(r){const a=this.input.evaluate(r),u=this.beginIndex.evaluate(r);if(!lo(a,["string","array"]))throw new _i(`Expected first argument to be of type array or string, but found ${Sr(wr(a))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(r);return a.slice(u,f)}return a.slice(u)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function lc(s,r){return"=="===s||"!="===s?"boolean"===r.kind||"string"===r.kind||"number"===r.kind||"null"===r.kind||"value"===r.kind:"string"===r.kind||"number"===r.kind||"value"===r.kind}function cc(s,r,a,u){return 0===u.compare(r,a)}function Ji(s,r,a){const u="=="!==s&&"!="!==s;return class MD{constructor(g,y,x){this.type=nn,this.lhs=g,this.rhs=y,this.collator=x,this.hasUntypedArgument="value"===g.type.kind||"value"===y.type.kind}static parse(g,y){if(3!==g.length&&4!==g.length)return y.error("Expected two or three arguments.");const x=g[0];let E=y.parse(g[1],1,Vn);if(!E)return null;if(!lc(x,E.type))return y.concat(1).error(`"${x}" comparisons are not supported for type '${Sr(E.type)}'.`);let D=y.parse(g[2],2,Vn);if(!D)return null;if(!lc(x,D.type))return y.concat(2).error(`"${x}" comparisons are not supported for type '${Sr(D.type)}'.`);if(E.type.kind!==D.type.kind&&"value"!==E.type.kind&&"value"!==D.type.kind)return y.error(`Cannot compare types '${Sr(E.type)}' and '${Sr(D.type)}'.`);u&&("value"===E.type.kind&&"value"!==D.type.kind?E=new co(D.type,[E]):"value"!==E.type.kind&&"value"===D.type.kind&&(D=new co(E.type,[D])));let I=null;if(4===g.length){if("string"!==E.type.kind&&"string"!==D.type.kind&&"value"!==E.type.kind&&"value"!==D.type.kind)return y.error("Cannot use collator to compare non-string types.");if(I=y.parse(g[3],3,gn),!I)return null}return new MD(E,D,I)}evaluate(g){const y=this.lhs.evaluate(g),x=this.rhs.evaluate(g);if(u&&this.hasUntypedArgument){const E=wr(y),D=wr(x);if(E.kind!==D.kind||"string"!==E.kind&&"number"!==E.kind)throw new _i(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${E.kind}, ${D.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const E=wr(y),D=wr(x);if("string"!==E.kind||"string"!==D.kind)return r(g,y,x)}return this.collator?a(g,y,x,this.collator.evaluate(g)):r(g,y,x)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[s];return this.eachChild(y=>{g.push(y.serialize())}),g}}}const Wf=Ji("==",function(s,r,a){return r===a},cc),Xm=Ji("!=",function(s,r,a){return r!==a},function(s,r,a,u){return!cc(0,r,a,u)}),yd=Ji("<",function(s,r,a){return r<a},function(s,r,a,u){return u.compare(r,a)<0}),Xf=Ji(">",function(s,r,a){return r>a},function(s,r,a,u){return u.compare(r,a)>0}),Km=Ji("<=",function(s,r,a){return r<=a},function(s,r,a,u){return u.compare(r,a)<=0}),Ym=Ji(">=",function(s,r,a){return r>=a},function(s,r,a,u){return u.compare(r,a)>=0});class vd{constructor(r,a,u,f,g){this.type=mn,this.number=r,this.locale=a,this.currency=u,this.minFractionDigits=f,this.maxFractionDigits=g}static parse(r,a){if(3!==r.length)return a.error("Expected two arguments.");const u=a.parse(r[1],1,At);if(!u)return null;const f=r[2];if("object"!=typeof f||Array.isArray(f))return a.error("NumberFormat options argument must be an object.");let g=null;if(f.locale&&(g=a.parse(f.locale,1,mn),!g))return null;let y=null;if(f.currency&&(y=a.parse(f.currency,1,mn),!y))return null;let x=null;if(f["min-fraction-digits"]&&(x=a.parse(f["min-fraction-digits"],1,At),!x))return null;let E=null;return f["max-fraction-digits"]&&(E=a.parse(f["max-fraction-digits"],1,At),!E)?null:new vd(u,g,y,x,E)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class rh{constructor(r){this.type=At,this.input=r}static parse(r,a){if(2!==r.length)return a.error(`Expected 1 argument, but found ${r.length-1} instead.`);const u=a.parse(r[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?a.error(`Expected argument of type string or array, but found ${Sr(u.type)} instead.`):new rh(u):null}evaluate(r){const a=this.input.evaluate(r);if("string"==typeof a||Array.isArray(a))return a.length;throw new _i(`Expected value to be of type string or array, but found ${Sr(wr(a))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(a=>{r.push(a.serialize())}),r}}const Al={"==":Wf,"!=":Xm,">":Xf,"<":yd,">=":Ym,"<=":Km,array:co,at:Fr,boolean:co,case:Eo,coalesce:Us,collator:Ze,format:Fs,image:ms,in:nu,"index-of":ru,interpolate:Zr,"interpolate-hcl":Zr,"interpolate-lab":Zr,length:rh,let:uo,literal:Ko,match:Fo,number:co,"number-format":vd,object:co,slice:Il,step:An,string:co,"to-boolean":Nn,"to-color":Nn,"to-number":Nn,"to-string":Nn,var:Ne,within:Vr};function xd(s,[r,a,u,f]){r=r.evaluate(s),a=a.evaluate(s),u=u.evaluate(s);const g=f?f.evaluate(s):1,y=gi(r,a,u,g);if(y)throw new _i(y);return new Wn(r/255*g,a/255*g,u/255*g,g)}function Kf(s,r){return s in r}function bd(s,r){const a=r[s];return void 0===a?null:a}function Za(s){return{type:s}}function wd(s){return{result:"success",value:s}}function Pl(s){return{result:"error",value:s}}function uc(s){return"data-driven"===s["property-type"]||"cross-faded-data-driven"===s["property-type"]}function Yf(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function Ed(s){return!!s.expression&&s.expression.interpolated}function pr(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":null===s?"null":typeof s}function ta(s){return"object"==typeof s&&null!==s&&!Array.isArray(s)}function Jf(s){return s}function Cd(s,r){const a="color"===r.type,u=s.stops&&"object"==typeof s.stops[0][0],f=u||!(u||void 0!==s.property),g=s.type||(Ed(r)?"exponential":"interval");if(a&&((s=rr({},s)).stops&&(s.stops=s.stops.map(D=>[D[0],Wn.parse(D[1])])),s.default=Wn.parse(s.default?s.default:r.default)),s.colorSpace&&"rgb"!==s.colorSpace&&!Ca[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let y,x,E;if("exponential"===g)y=Qi;else if("interval"===g)y=Qf;else if("categorical"===g){y=Wa,x=Object.create(null);for(const D of s.stops)x[D[0]]=D[1];E=typeof s.stops[0][0]}else{if("identity"!==g)throw new Error(`Unknown function type "${g}"`);y=ih}if(u){const D={},I=[];for(let F=0;F<s.stops.length;F++){const V=s.stops[F],Z=V[0].zoom;void 0===D[Z]&&(D[Z]={zoom:Z,type:s.type,property:s.property,default:s.default,stops:[]},I.push(Z)),D[Z].stops.push([V[0].value,V[1]])}const A=[];for(const F of I)A.push([D[F].zoom,Cd(D[F],r)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:Zr.interpolationFactor.bind(void 0,k),zoomStops:A.map(F=>F[0]),evaluate:({zoom:F},V)=>Qi({stops:A,base:s.base},r,F).evaluate(F,V)}}if(f){const D="exponential"===g?{name:"exponential",base:void 0!==s.base?s.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:Zr.interpolationFactor.bind(void 0,D),zoomStops:s.stops.map(I=>I[0]),evaluate:({zoom:I})=>y(s,r,I,x,E)}}return{kind:"source",evaluate(D,I){const A=I&&I.properties?I.properties[s.property]:void 0;return void 0===A?iu(s.default,r.default):y(s,r,A,x,E)}}}function iu(s,r,a){return void 0!==s?s:void 0!==r?r:void 0!==a?a:void 0}function Wa(s,r,a,u,f){return iu(typeof a===f?u[a]:void 0,s.default,r.default)}function Qf(s,r,a){if("number"!==pr(a))return iu(s.default,r.default);const u=s.stops.length;if(1===u||a<=s.stops[0][0])return s.stops[0][1];if(a>=s.stops[u-1][0])return s.stops[u-1][1];const f=fr(s.stops.map(g=>g[0]),a);return s.stops[f][1]}function Qi(s,r,a){const u=void 0!==s.base?s.base:1;if("number"!==pr(a))return iu(s.default,r.default);const f=s.stops.length;if(1===f||a<=s.stops[0][0])return s.stops[0][1];if(a>=s.stops[f-1][0])return s.stops[f-1][1];const g=fr(s.stops.map(I=>I[0]),a),y=function(I,A,k,F){const V=F-k,Z=I-k;return 0===V?0:1===A?Z/V:(Math.pow(A,Z)-1)/(Math.pow(A,V)-1)}(a,u,s.stops[g][0],s.stops[g+1][0]),x=s.stops[g][1],E=s.stops[g+1][1];let D=ir[r.type]||Jf;if(s.colorSpace&&"rgb"!==s.colorSpace){const I=Ca[s.colorSpace];D=(A,k)=>I.reverse(I.interpolate(I.forward(A),I.forward(k),y))}return"function"==typeof x.evaluate?{evaluate(...I){const A=x.evaluate.apply(void 0,I),k=E.evaluate.apply(void 0,I);if(void 0!==A&&void 0!==k)return D(A,k,y)}}:D(x,E,y)}function ih(s,r,a){return"color"===r.type?a=Wn.parse(a):"formatted"===r.type?a=Kr.fromString(a.toString()):"resolvedImage"===r.type?a=Pr.fromString(a.toString()):pr(a)===r.type||"enum"===r.type&&r.values[a]||(a=void 0),iu(a,s.default,r.default)}Se.register(Al,{error:[{kind:"error"},[mn],(s,[r])=>{throw new _i(r.evaluate(s))}],typeof:[mn,[Vn],(s,[r])=>Sr(wr(r.evaluate(s)))],"to-rgba":[hi(At,4),[Ci],(s,[r])=>r.evaluate(s).toArray()],rgb:[Ci,[At,At,At],xd],rgba:[Ci,[At,At,At,At],xd],has:{type:nn,overloads:[[[mn],(s,[r])=>Kf(r.evaluate(s),s.properties())],[[mn,fs],(s,[r,a])=>Kf(r.evaluate(s),a.evaluate(s))]]},get:{type:Vn,overloads:[[[mn],(s,[r])=>bd(r.evaluate(s),s.properties())],[[mn,fs],(s,[r,a])=>bd(r.evaluate(s),a.evaluate(s))]]},"feature-state":[Vn,[mn],(s,[r])=>bd(r.evaluate(s),s.featureState||{})],properties:[fs,[],s=>s.properties()],"geometry-type":[mn,[],s=>s.geometryType()],id:[Vn,[],s=>s.id()],zoom:[At,[],s=>s.globals.zoom],pitch:[At,[],s=>s.globals.pitch||0],"distance-from-center":[At,[],s=>s.distanceFromCenter()],"heatmap-density":[At,[],s=>s.globals.heatmapDensity||0],"line-progress":[At,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[At,[],s=>s.globals.skyRadialProgress||0],accumulated:[Vn,[],s=>void 0===s.globals.accumulated?null:s.globals.accumulated],"+":[At,Za(At),(s,r)=>{let a=0;for(const u of r)a+=u.evaluate(s);return a}],"*":[At,Za(At),(s,r)=>{let a=1;for(const u of r)a*=u.evaluate(s);return a}],"-":{type:At,overloads:[[[At,At],(s,[r,a])=>r.evaluate(s)-a.evaluate(s)],[[At],(s,[r])=>-r.evaluate(s)]]},"/":[At,[At,At],(s,[r,a])=>r.evaluate(s)/a.evaluate(s)],"%":[At,[At,At],(s,[r,a])=>r.evaluate(s)%a.evaluate(s)],ln2:[At,[],()=>Math.LN2],pi:[At,[],()=>Math.PI],e:[At,[],()=>Math.E],"^":[At,[At,At],(s,[r,a])=>Math.pow(r.evaluate(s),a.evaluate(s))],sqrt:[At,[At],(s,[r])=>Math.sqrt(r.evaluate(s))],log10:[At,[At],(s,[r])=>Math.log(r.evaluate(s))/Math.LN10],ln:[At,[At],(s,[r])=>Math.log(r.evaluate(s))],log2:[At,[At],(s,[r])=>Math.log(r.evaluate(s))/Math.LN2],sin:[At,[At],(s,[r])=>Math.sin(r.evaluate(s))],cos:[At,[At],(s,[r])=>Math.cos(r.evaluate(s))],tan:[At,[At],(s,[r])=>Math.tan(r.evaluate(s))],asin:[At,[At],(s,[r])=>Math.asin(r.evaluate(s))],acos:[At,[At],(s,[r])=>Math.acos(r.evaluate(s))],atan:[At,[At],(s,[r])=>Math.atan(r.evaluate(s))],min:[At,Za(At),(s,r)=>Math.min(...r.map(a=>a.evaluate(s)))],max:[At,Za(At),(s,r)=>Math.max(...r.map(a=>a.evaluate(s)))],abs:[At,[At],(s,[r])=>Math.abs(r.evaluate(s))],round:[At,[At],(s,[r])=>{const a=r.evaluate(s);return a<0?-Math.round(-a):Math.round(a)}],floor:[At,[At],(s,[r])=>Math.floor(r.evaluate(s))],ceil:[At,[At],(s,[r])=>Math.ceil(r.evaluate(s))],"filter-==":[nn,[mn,Vn],(s,[r,a])=>s.properties()[r.value]===a.value],"filter-id-==":[nn,[Vn],(s,[r])=>s.id()===r.value],"filter-type-==":[nn,[mn],(s,[r])=>s.geometryType()===r.value],"filter-<":[nn,[mn,Vn],(s,[r,a])=>{const u=s.properties()[r.value],f=a.value;return typeof u==typeof f&&u<f}],"filter-id-<":[nn,[Vn],(s,[r])=>{const a=s.id(),u=r.value;return typeof a==typeof u&&a<u}],"filter->":[nn,[mn,Vn],(s,[r,a])=>{const u=s.properties()[r.value],f=a.value;return typeof u==typeof f&&u>f}],"filter-id->":[nn,[Vn],(s,[r])=>{const a=s.id(),u=r.value;return typeof a==typeof u&&a>u}],"filter-<=":[nn,[mn,Vn],(s,[r,a])=>{const u=s.properties()[r.value],f=a.value;return typeof u==typeof f&&u<=f}],"filter-id-<=":[nn,[Vn],(s,[r])=>{const a=s.id(),u=r.value;return typeof a==typeof u&&a<=u}],"filter->=":[nn,[mn,Vn],(s,[r,a])=>{const u=s.properties()[r.value],f=a.value;return typeof u==typeof f&&u>=f}],"filter-id->=":[nn,[Vn],(s,[r])=>{const a=s.id(),u=r.value;return typeof a==typeof u&&a>=u}],"filter-has":[nn,[Vn],(s,[r])=>r.value in s.properties()],"filter-has-id":[nn,[],s=>null!==s.id()&&void 0!==s.id()],"filter-type-in":[nn,[hi(mn)],(s,[r])=>r.value.indexOf(s.geometryType())>=0],"filter-id-in":[nn,[hi(Vn)],(s,[r])=>r.value.indexOf(s.id())>=0],"filter-in-small":[nn,[mn,hi(Vn)],(s,[r,a])=>a.value.indexOf(s.properties()[r.value])>=0],"filter-in-large":[nn,[mn,hi(Vn)],(s,[r,a])=>function(u,f,g,y){for(;g<=y;){const x=g+y>>1;if(f[x]===u)return!0;f[x]>u?y=x-1:g=x+1}return!1}(s.properties()[r.value],a.value,0,a.value.length-1)],all:{type:nn,overloads:[[[nn,nn],(s,[r,a])=>r.evaluate(s)&&a.evaluate(s)],[Za(nn),(s,r)=>{for(const a of r)if(!a.evaluate(s))return!1;return!0}]]},any:{type:nn,overloads:[[[nn,nn],(s,[r,a])=>r.evaluate(s)||a.evaluate(s)],[Za(nn),(s,r)=>{for(const a of r)if(a.evaluate(s))return!0;return!1}]]},"!":[nn,[nn],(s,[r])=>!r.evaluate(s)],"is-supported-script":[nn,[mn],(s,[r])=>{const a=s.globals&&s.globals.isSupportedScript;return!a||a(r.evaluate(s))}],upcase:[mn,[mn],(s,[r])=>r.evaluate(s).toUpperCase()],downcase:[mn,[mn],(s,[r])=>r.evaluate(s).toLowerCase()],concat:[mn,Za(Vn),(s,r)=>r.map(a=>oi(a.evaluate(s))).join("")],"resolved-locale":[mn,[gn],(s,[r])=>r.evaluate(s).resolvedLocale()]});class ou{constructor(r,a){var u;this.expression=r,this._warningHistory={},this._evaluator=new ac,this._defaultValue=a?"color"===(u=a).type&&ta(u.default)?new Wn(0,0,0,0):"color"===u.type?Wn.parse(u.default)||null:void 0===u.default?null:u.default:null,this._enumValues=a&&"enum"===a.type?a.values:null}evaluateWithoutErrorHandling(r,a,u,f,g,y,x,E){return this._evaluator.globals=r,this._evaluator.feature=a,this._evaluator.featureState=u,this._evaluator.canonical=f||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(r,a,u,f,g,y,x,E){this._evaluator.globals=r,this._evaluator.feature=a||null,this._evaluator.featureState=u||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new _i(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,"undefined"!=typeof console&&console.warn(D.message)),this._defaultValue}}}function kl(s){return Array.isArray(s)&&s.length>0&&"string"==typeof s[0]&&s[0]in Al}function Rl(s,r){const a=new dt(Al,[],r?function(f){const g={color:Ci,string:mn,number:At,enum:mn,boolean:nn,formatted:ps,resolvedImage:mr};return"array"===f.type?hi(g[f.value]||Vn,f.length):g[f.type]}(r):void 0),u=a.parse(s,void 0,void 0,void 0,r&&"string"===r.type?{typeAnnotation:"coerce"}:void 0);return u?wd(new ou(u,r)):Pl(a.errors)}class su{constructor(r,a){this.kind=r,this._styleExpression=a,this.isStateDependent="constant"!==r&&!ji(a.expression)}evaluateWithoutErrorHandling(r,a,u,f,g,y){return this._styleExpression.evaluateWithoutErrorHandling(r,a,u,f,g,y)}evaluate(r,a,u,f,g,y){return this._styleExpression.evaluate(r,a,u,f,g,y)}}class oh{constructor(r,a,u,f){this.kind=r,this.zoomStops=u,this._styleExpression=a,this.isStateDependent="camera"!==r&&!ji(a.expression),this.interpolationType=f}evaluateWithoutErrorHandling(r,a,u,f,g,y){return this._styleExpression.evaluateWithoutErrorHandling(r,a,u,f,g,y)}evaluate(r,a,u,f,g,y){return this._styleExpression.evaluate(r,a,u,f,g,y)}interpolationFactor(r,a,u){return this.interpolationType?Zr.interpolationFactor(this.interpolationType,r,a,u):0}}function au(s,r){if("error"===(s=Rl(s,r)).result)return s;const a=s.value.expression,u=vr(a);if(!u&&!uc(r))return Pl([new Fn("","data expressions not supported")]);const f=pe(a,["zoom","pitch","distance-from-center"]);if(!f&&!Yf(r))return Pl([new Fn("","zoom expressions not supported")]);const g=ho(a);return g||f?g instanceof Fn?Pl([g]):g instanceof Zr&&!Ed(r)?Pl([new Fn("",'"interpolate" expressions cannot be used with this property')]):wd(g?new oh(u?"camera":"composite",s.value,g.labels,g instanceof Zr?g.interpolation:void 0):new su(u?"constant":"source",s.value)):Pl([new Fn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class lu{constructor(r,a){this._parameters=r,this._specification=a,rr(this,Cd(this._parameters,this._specification))}static deserialize(r){return new lu(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function ho(s){let r=null;if(s instanceof uo)r=ho(s.result);else if(s instanceof Us){for(const a of s.args)if(r=ho(a),r)break}else(s instanceof An||s instanceof Zr)&&s.input instanceof Se&&"zoom"===s.input.name&&(r=s);return r instanceof Fn||s.eachChild(a=>{const u=ho(a);u instanceof Fn?r=u:!r&&u?r=new Fn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&u&&r!==u&&(r=new Fn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}class Nt{constructor(r,a,u,f){this.message=(r?`${r}: `:"")+u,f&&(this.identifier=f),null!=a&&a.__line__&&(this.line=a.__line__)}}function Jo(s){const r=s.key,a=s.value,u=s.valueSpec||{},f=s.objectElementValidators||{},g=s.style,y=s.styleSpec;let x=[];const E=pr(a);if("object"!==E)return[new Nt(r,a,`object expected, ${E} found`)];for(const D in a){const I=D.split(".")[0],A=u[I]||u["*"];let k;f[I]?k=f[I]:u[I]?k=Ti:f["*"]?k=f["*"]:u["*"]&&(k=Ti),k?x=x.concat(k({key:(r&&`${r}.`)+D,value:a[D],valueSpec:A,style:g,styleSpec:y,object:a,objectKey:D},a)):x.push(new Nt(r,a[D],`unknown property "${D}"`))}for(const D in u)f[D]||u[D].required&&void 0===u[D].default&&void 0===a[D]&&x.push(new Nt(r,a,`missing required property "${D}"`));return x}function Xa(s){const r=s.value,a=s.valueSpec,u=s.style,f=s.styleSpec,g=s.key,y=s.arrayElementValidator||Ti;if("array"!==pr(r))return[new Nt(g,r,`array expected, ${pr(r)} found`)];if(a.length&&r.length!==a.length)return[new Nt(g,r,`array length ${a.length} expected, length ${r.length} found`)];if(a["min-length"]&&r.length<a["min-length"])return[new Nt(g,r,`array length at least ${a["min-length"]} expected, length ${r.length} found`)];let x={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};f.$version<7&&(x.function=a.function),"object"===pr(a.value)&&(x=a.value);let E=[];for(let D=0;D<r.length;D++)E=E.concat(y({array:r,arrayIndex:D,value:r[D],valueSpec:x,style:u,styleSpec:f,key:`${g}[${D}]`}));return E}function Td(s){const r=s.key,a=s.value,u=s.valueSpec;let f=pr(a);if("number"===f&&a!=a&&(f="NaN"),"number"!==f)return[new Nt(r,a,`number expected, ${f} found`)];if("minimum"in u){let g=u.minimum;if("array"===pr(u.minimum)&&(g=u.minimum[s.arrayIndex]),a<g)return[new Nt(r,a,`${a} is less than the minimum value ${g}`)]}if("maximum"in u){let g=u.maximum;if("array"===pr(u.maximum)&&(g=u.maximum[s.arrayIndex]),a>g)return[new Nt(r,a,`${a} is greater than the maximum value ${g}`)]}return[]}function Dd(s){const r=s.valueSpec,a=Ht(s.value.type);let u,f,g,y={};const x="categorical"!==a&&void 0===s.value.property,E=!x,D="array"===pr(s.value.stops)&&"array"===pr(s.value.stops[0])&&"object"===pr(s.value.stops[0][0]),I=Jo({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(F){if("identity"===a)return[new Nt(F.key,F.value,'identity function may not have a "stops" property')];let V=[];const Z=F.value;return V=V.concat(Xa({key:F.key,value:Z,valueSpec:F.valueSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:A})),"array"===pr(Z)&&0===Z.length&&V.push(new Nt(F.key,Z,"array must have at least one stop")),V},default:function(F){return Ti({key:F.key,value:F.value,valueSpec:r,style:F.style,styleSpec:F.styleSpec})}}});return"identity"===a&&x&&I.push(new Nt(s.key,s.value,'missing required property "property"')),"identity"===a||s.value.stops||I.push(new Nt(s.key,s.value,'missing required property "stops"')),"exponential"===a&&s.valueSpec.expression&&!Ed(s.valueSpec)&&I.push(new Nt(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(E&&!uc(s.valueSpec)?I.push(new Nt(s.key,s.value,"property functions not supported")):x&&!Yf(s.valueSpec)&&I.push(new Nt(s.key,s.value,"zoom functions not supported"))),"categorical"!==a&&!D||void 0!==s.value.property||I.push(new Nt(s.key,s.value,'"property" property is required')),I;function A(F){let V=[];const Z=F.value,ee=F.key;if("array"!==pr(Z))return[new Nt(ee,Z,`array expected, ${pr(Z)} found`)];if(2!==Z.length)return[new Nt(ee,Z,`array length 2 expected, length ${Z.length} found`)];if(D){if("object"!==pr(Z[0]))return[new Nt(ee,Z,`object expected, ${pr(Z[0])} found`)];if(void 0===Z[0].zoom)return[new Nt(ee,Z,"object stop key must have zoom")];if(void 0===Z[0].value)return[new Nt(ee,Z,"object stop key must have value")];const le=Ht(Z[0].zoom);if("number"!=typeof le)return[new Nt(ee,Z[0].zoom,"stop zoom values must be numbers")];if(g&&g>le)return[new Nt(ee,Z[0].zoom,"stop zoom values must appear in ascending order")];le!==g&&(g=le,f=void 0,y={}),V=V.concat(Jo({key:`${ee}[0]`,value:Z[0],valueSpec:{zoom:{}},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:Td,value:k}}))}else V=V.concat(k({key:`${ee}[0]`,value:Z[0],valueSpec:{},style:F.style,styleSpec:F.styleSpec},Z));return kl(Kn(Z[1]))?V.concat([new Nt(`${ee}[1]`,Z[1],"expressions are not allowed in function stops.")]):V.concat(Ti({key:`${ee}[1]`,value:Z[1],valueSpec:r,style:F.style,styleSpec:F.styleSpec}))}function k(F,V){const Z=pr(F.value),ee=Ht(F.value),le=null!==F.value?F.value:V;if(u){if(Z!==u)return[new Nt(F.key,le,`${Z} stop domain type must match previous stop domain type ${u}`)]}else u=Z;if("number"!==Z&&"string"!==Z&&"boolean"!==Z&&"number"!=typeof ee&&"string"!=typeof ee&&"boolean"!=typeof ee)return[new Nt(F.key,le,"stop domain value must be a number, string, or boolean")];if("number"!==Z&&"categorical"!==a){let ve=`number expected, ${Z} found`;return uc(r)&&void 0===a&&(ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Nt(F.key,le,ve)]}return"categorical"!==a||"number"!==Z||"number"==typeof ee&&isFinite(ee)&&Math.floor(ee)===ee?"categorical"!==a&&"number"===Z&&"number"==typeof ee&&"number"==typeof f&&void 0!==f&&ee<f?[new Nt(F.key,le,"stop domain values must appear in ascending order")]:(f=ee,"categorical"===a&&ee in y?[new Nt(F.key,le,"stop domain values must be unique")]:(y[ee]=!0,[])):[new Nt(F.key,le,`integer expected, found ${String(ee)}`)]}}function Da(s){const r=("property"===s.expressionContext?au:Rl)(Kn(s.value),s.valueSpec);if("error"===r.result)return r.value.map(u=>new Nt(`${s.key}${u.key}`,s.value,u.message));const a=r.value.expression||r.value._styleExpression.expression;if("property"===s.expressionContext&&"text-font"===s.propertyKey&&!a.outputDefined())return[new Nt(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===s.expressionContext&&"layout"===s.propertyType&&!ji(a))return[new Nt(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===s.expressionContext)return na(a,s);if(s.expressionContext&&0===s.expressionContext.indexOf("cluster")){if(!pe(a,["zoom","feature-state"]))return[new Nt(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===s.expressionContext&&!vr(a))return[new Nt(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function na(s,r){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const f of r.valueSpec.expression.parameters)a.delete(f);if(0===a.size)return[];const u=[];return s instanceof Se&&a.has(s.name)?[new Nt(r.key,r.value,`["${s.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(s.eachChild(f=>{u.push(...na(f,r))}),u)}function Ka(s){const r=s.key,a=s.value,u=s.valueSpec,f=[];return Array.isArray(u.values)?-1===u.values.indexOf(Ht(a))&&f.push(new Nt(r,a,`expected one of [${u.values.join(", ")}], ${JSON.stringify(a)} found`)):-1===Object.keys(u.values).indexOf(Ht(a))&&f.push(new Nt(r,a,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(a)} found`)),f}function Ya(s){if(!0===s||!1===s)return!0;if(!Array.isArray(s)||0===s.length)return!1;switch(s[0]){case"has":return s.length>=2&&"$id"!==s[1]&&"$type"!==s[1];case"in":return s.length>=3&&("string"!=typeof s[1]||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==s.length||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const r of s.slice(1))if(!Ya(r)&&"boolean"!=typeof r)return!1;return!0;default:return!0}}function kr(s,r="fill"){if(null==s)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ya(s)||(s=eo(s));const a=s;let u=!0;try{u=function(D){if(!jr(D))return D;let I=Kn(D);return Sd(I),I=cu(I),I}(a)}catch(D){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(a,null,2)}\n        `)}const f=$e[`filter_${r}`],g=Rl(u,f);let y=null;if("error"===g.result)throw new Error(g.value.map(D=>`${D.key}: ${D.message}`).join(", "));y=(D,I,A)=>g.value.evaluate(D,I,{},A);let x=null,E=null;if(u!==a){const D=Rl(a,f);if("error"===D.result)throw new Error(D.value.map(I=>`${I.key}: ${I.message}`).join(", "));x=(I,A,k,F,V)=>D.value.evaluate(I,A,{},k,void 0,void 0,F,V),E=!vr(D.value.expression)}return y=y,{filter:y,dynamicFilter:x||void 0,needGeometry:Ja(u),needFeature:!!E}}function cu(s){if(!Array.isArray(s))return s;const r=function(a){if(Md.has(a[0]))for(let u=1;u<a.length;u++)if(jr(a[u]))return!0;return a}(s);return!0===r?r:r.map(a=>cu(a))}function Sd(s){let r=!1;const a=[];if("case"===s[0]){for(let u=1;u<s.length-1;u+=2)r=r||jr(s[u]),a.push(s[u+1]);a.push(s[s.length-1])}else if("match"===s[0]){r=r||jr(s[1]);for(let u=2;u<s.length-1;u+=2)a.push(s[u+1]);a.push(s[s.length-1])}else if("step"===s[0]){r=r||jr(s[1]);for(let u=1;u<s.length-1;u+=2)a.push(s[u+1])}r&&(s.length=0,s.push("any",...a));for(let u=1;u<s.length;u++)Sd(s[u])}function jr(s){if(!Array.isArray(s))return!1;if("pitch"===(r=s[0])||"distance-from-center"===r)return!0;var r;for(let a=1;a<s.length;a++)if(jr(s[a]))return!0;return!1}const Md=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Id(s,r){return s<r?-1:s>r?1:0}function Ja(s){if(!Array.isArray(s))return!1;if("within"===s[0])return!0;for(let r=1;r<s.length;r++)if(Ja(s[r]))return!0;return!1}function eo(s){if(!s)return!0;const r=s[0];return s.length<=1?"any"!==r:"=="===r?hc(s[1],s[2],"=="):"!="===r?$i(hc(s[1],s[2],"==")):"<"===r||">"===r||"<="===r||">="===r?hc(s[1],s[2],r):"any"===r?(a=s.slice(1),["any"].concat(a.map(eo))):"all"===r?["all"].concat(s.slice(1).map(eo)):"none"===r?["all"].concat(s.slice(1).map(eo).map($i)):"in"===r?dc(s[1],s.slice(2)):"!in"===r?$i(dc(s[1],s.slice(2))):"has"===r?Sa(s[1]):"!has"===r?$i(Sa(s[1])):"within"!==r||s;var a}function hc(s,r,a){switch(s){case"$type":return[`filter-type-${a}`,r];case"$id":return[`filter-id-${a}`,r];default:return[`filter-${a}`,s,r]}}function dc(s,r){if(0===r.length)return!1;switch(s){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(a=>typeof a!=typeof r[0])?["filter-in-large",s,["literal",r.sort(Id)]]:["filter-in-small",s,["literal",r]]}}function Sa(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function $i(s){return["!",s]}function ra(s){return Ya(Kn(s.value))?Da(rr({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):fc(s)}function fc(s){const r=s.value,a=s.key;if("array"!==pr(r))return[new Nt(a,r,`array expected, ${pr(r)} found`)];const u=s.styleSpec;let f,g=[];if(r.length<1)return[new Nt(a,r,"filter array must have at least 1 element")];switch(g=g.concat(Ka({key:`${a}[0]`,value:r[0],valueSpec:u.filter_operator,style:s.style,styleSpec:s.styleSpec})),Ht(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===Ht(r[1])&&g.push(new Nt(a,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&g.push(new Nt(a,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(f=pr(r[1]),"string"!==f&&g.push(new Nt(`${a}[1]`,r[1],`string expected, ${f} found`)));for(let y=2;y<r.length;y++)f=pr(r[y]),"$type"===Ht(r[1])?g=g.concat(Ka({key:`${a}[${y}]`,value:r[y],valueSpec:u.geometry_type,style:s.style,styleSpec:s.styleSpec})):"string"!==f&&"number"!==f&&"boolean"!==f&&g.push(new Nt(`${a}[${y}]`,r[y],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let y=1;y<r.length;y++)g=g.concat(fc({key:`${a}[${y}]`,value:r[y],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":f=pr(r[1]),2!==r.length?g.push(new Nt(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==f&&g.push(new Nt(`${a}[1]`,r[1],`string expected, ${f} found`));break;case"within":f=pr(r[1]),2!==r.length?g.push(new Nt(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):"object"!==f&&g.push(new Nt(`${a}[1]`,r[1],`object expected, ${f} found`))}return g}function sh(s,r){const a=s.key,u=s.style,f=s.styleSpec,g=s.value,y=s.objectKey,x=f[`${r}_${s.layerType}`];if(!x)return[];const E=y.match(/^(.*)-transition$/);if("paint"===r&&E&&x[E[1]]&&x[E[1]].transition)return Ti({key:a,value:g,valueSpec:f.transition,style:u,styleSpec:f});const D=s.valueSpec||x[y];if(!D)return[new Nt(a,g,`unknown property "${y}"`)];let I;if("string"===pr(g)&&uc(D)&&!D.tokens&&(I=/^{([^}]+)}$/.exec(g)))return[new Nt(a,g,`"${y}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const A=[];return"symbol"===s.layerType&&("text-field"===y&&u&&!u.glyphs&&A.push(new Nt(a,g,'use of "text-field" requires a style "glyphs" property')),"text-font"===y&&ta(Kn(g))&&"identity"===Ht(g.type)&&A.push(new Nt(a,g,'"text-font" does not support identity functions'))),A.concat(Ti({key:s.key,value:g,valueSpec:D,style:u,styleSpec:f,expressionContext:"property",propertyType:r,propertyKey:y}))}function gs(s){return sh(s,"paint")}function uu(s){return sh(s,"layout")}function hu(s){let r=[];const a=s.value,u=s.key,f=s.style,g=s.styleSpec;a.type||a.ref||r.push(new Nt(u,a,'either "type" or "ref" is required'));let y=Ht(a.type);const x=Ht(a.ref);if(a.id){const E=Ht(a.id);for(let D=0;D<s.arrayIndex;D++){const I=f.layers[D];Ht(I.id)===E&&r.push(new Nt(u,a.id,`duplicate layer id "${a.id}", previously used at line ${I.id.__line__}`))}}if("ref"in a){let E;["type","source","source-layer","filter","layout"].forEach(D=>{D in a&&r.push(new Nt(u,a[D],`"${D}" is prohibited for ref layers`))}),f.layers.forEach(D=>{Ht(D.id)===x&&(E=D)}),E?E.ref?r.push(new Nt(u,a.ref,"ref cannot reference another ref layer")):y=Ht(E.type):"string"==typeof x&&r.push(new Nt(u,a.ref,`ref layer "${x}" not found`))}else if("background"!==y&&"sky"!==y)if(a.source){const E=f.sources&&f.sources[a.source],D=E&&Ht(E.type);E?"vector"===D&&"raster"===y?r.push(new Nt(u,a.source,`layer "${a.id}" requires a raster source`)):"raster"===D&&"raster"!==y?r.push(new Nt(u,a.source,`layer "${a.id}" requires a vector source`)):"vector"!==D||a["source-layer"]?"raster-dem"===D&&"hillshade"!==y?r.push(new Nt(u,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==y||!a.paint||!a.paint["line-gradient"]||"geojson"===D&&E.lineMetrics||r.push(new Nt(u,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Nt(u,a,`layer "${a.id}" must specify a "source-layer"`)):r.push(new Nt(u,a.source,`source "${a.source}" not found`))}else r.push(new Nt(u,a,'missing required property "source"'));return r=r.concat(Jo({key:u,value:a,valueSpec:g.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ti({key:`${u}.type`,value:a.type,valueSpec:g.layer.type,style:s.style,styleSpec:s.styleSpec,object:a,objectKey:"type"}),filter:E=>ra(rr({layerType:y},E)),layout:E=>Jo({layer:a,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":D=>uu(rr({layerType:y},D))}}),paint:E=>Jo({layer:a,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":D=>gs(rr({layerType:y},D))}})}})),r}function En(s){const r=s.value,a=s.key,u=pr(r);return"string"!==u?[new Nt(a,r,`string expected, ${u} found`)]:[]}const ep={promoteId:function({key:s,value:r}){if("string"===pr(r))return En({key:s,value:r});{const a=[];for(const u in r)a.push(...En({key:`${s}.${u}`,value:r[u]}));return a}}};function Ad(s){const r=s.value,a=s.key,u=s.styleSpec,f=s.style;if(!r.type)return[new Nt(a,r,'"type" is required')];const g=Ht(r.type);let y;switch(g){case"vector":case"raster":case"raster-dem":return y=Jo({key:a,value:r,valueSpec:u[`source_${g.replace("-","_")}`],style:s.style,styleSpec:u,objectElementValidators:ep}),y;case"geojson":if(y=Jo({key:a,value:r,valueSpec:u.source_geojson,style:f,styleSpec:u,objectElementValidators:ep}),r.cluster)for(const x in r.clusterProperties){const[E,D]=r.clusterProperties[x],I="string"==typeof E?[E,["accumulated"],["get",x]]:E;y.push(...Da({key:`${a}.${x}.map`,value:D,expressionContext:"cluster-map"})),y.push(...Da({key:`${a}.${x}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return y;case"video":return Jo({key:a,value:r,valueSpec:u.source_video,style:f,styleSpec:u});case"image":return Jo({key:a,value:r,valueSpec:u.source_image,style:f,styleSpec:u});case"canvas":return[new Nt(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ka({key:`${a}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:f,styleSpec:u})}}function Pd(s){const r=s.value,a=s.styleSpec,u=a.light,f=s.style;let g=[];const y=pr(r);if(void 0===r)return g;if("object"!==y)return g=g.concat([new Nt("light",r,`object expected, ${y} found`)]),g;for(const x in r){const E=x.match(/^(.*)-transition$/);g=g.concat(E&&u[E[1]]&&u[E[1]].transition?Ti({key:x,value:r[x],valueSpec:a.transition,style:f,styleSpec:a}):u[x]?Ti({key:x,value:r[x],valueSpec:u[x],style:f,styleSpec:a}):[new Nt(x,r[x],`unknown property "${x}"`)])}return g}function kd(s){const r=s.value,a=s.key,u=s.style,f=s.styleSpec,g=f.terrain;let y=[];const x=pr(r);if(void 0===r)return y;if("object"!==x)return y=y.concat([new Nt("terrain",r,`object expected, ${x} found`)]),y;for(const E in r){const D=E.match(/^(.*)-transition$/);y=y.concat(D&&g[D[1]]&&g[D[1]].transition?Ti({key:E,value:r[E],valueSpec:f.transition,style:u,styleSpec:f}):g[E]?Ti({key:E,value:r[E],valueSpec:g[E],style:u,styleSpec:f}):[new Nt(E,r[E],`unknown property "${E}"`)])}if(r.source){const E=u.sources&&u.sources[r.source],D=E&&Ht(E.type);E?"raster-dem"!==D&&y.push(new Nt(a,r.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):y.push(new Nt(a,r.source,`source "${r.source}" not found`))}else y.push(new Nt(a,r,'terrain is missing required property "source"'));return y}function ah(s){const r=s.value,a=s.style,u=s.styleSpec,f=u.fog;let g=[];const y=pr(r);if(void 0===r)return g;if("object"!==y)return g=g.concat([new Nt("fog",r,`object expected, ${y} found`)]),g;for(const x in r){const E=x.match(/^(.*)-transition$/);g=g.concat(E&&f[E[1]]&&f[E[1]].transition?Ti({key:x,value:r[x],valueSpec:u.transition,style:a,styleSpec:u}):f[x]?Ti({key:x,value:r[x],valueSpec:f[x],style:a,styleSpec:u}):[new Nt(x,r[x],`unknown property "${x}"`)])}return g}const pc={"*":()=>[],array:Xa,boolean:function(s){const r=s.value,a=s.key,u=pr(r);return"boolean"!==u?[new Nt(a,r,`boolean expected, ${u} found`)]:[]},number:Td,color:function(s){const r=s.key,a=s.value,u=pr(a);return"string"!==u?[new Nt(r,a,`color expected, ${u} found`)]:null===ea.parseCSSColor(a)?[new Nt(r,a,`color expected, "${a}" found`)]:[]},enum:Ka,filter:ra,function:Dd,layer:hu,object:Jo,source:Ad,light:Pd,terrain:kd,fog:ah,string:En,formatted:function(s){return 0===En(s).length?[]:Da(s)},resolvedImage:function(s){return 0===En(s).length?[]:Da(s)},projection:function(s){const r=s.value,a=s.styleSpec,u=a.projection,f=s.style;let g=[];const y=pr(r);if("object"===y)for(const x in r)g=g.concat(Ti({key:x,value:r[x],valueSpec:u[x],style:f,styleSpec:a}));else"string"!==y&&(g=g.concat([new Nt("projection",r,`object or string expected, ${y} found`)]));return g}};function Ti(s){const r=s.value,a=s.valueSpec,u=s.styleSpec;return a.expression&&ta(Ht(r))?Dd(s):a.expression&&kl(Kn(r))?Da(s):a.type&&pc[a.type]?pc[a.type](s):Jo(rr({},s,{valueSpec:a.type?u[a.type]:a}))}function pt(s){const r=s.value,a=s.key,u=En(s);return u.length||(-1===r.indexOf("{fontstack}")&&u.push(new Nt(a,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&u.push(new Nt(a,r,'"glyphs" url must include a "{range}" token'))),u}function or(s,r=$e){return js(Ti({key:"",value:s,valueSpec:r.$root,styleSpec:r,style:s,objectElementValidators:{glyphs:pt,"*":()=>[]}}))}const tp=s=>js(gs(s)),Di=s=>js(uu(s));function js(s){return s.slice().sort((r,a)=>r.line&&a.line?r.line-a.line:0)}function Ol(s,r){let a=!1;if(r&&r.length)for(const u of r)s.fire(new Yt(new Error(u.message))),a=!0;return a}var Gi=Qo;function Qo(s,r,a){var u=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var f=new Int32Array(this.arrayBuffer);s=f[0],this.d=(r=f[1])+2*(a=f[2]);for(var g=0;g<this.d*this.d;g++){var y=f[3+g],x=f[3+g+1];u.push(y===x?null:f.subarray(y,x))}var E=f[3+u.length+1];this.keys=f.subarray(f[3+u.length],E),this.bboxes=f.subarray(E),this.insert=this._insertReadonly}else{this.d=r+2*a;for(var D=0;D<this.d*this.d;D++)u.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=s,this.padding=a,this.scale=r/s,this.uid=0;var I=a/r*s;this.min=-I,this.max=s+I}Qo.prototype.insert=function(s,r,a,u,f){this._forEachCell(r,a,u,f,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(f)},Qo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Qo.prototype._insertCell=function(s,r,a,u,f,g){this.cells[f].push(g)},Qo.prototype.query=function(s,r,a,u,f){var g=this.min,y=this.max;if(s<=g&&r<=g&&y<=a&&y<=u&&!f)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(s,r,a,u,this._queryCell,x,{},f),x},Qo.prototype._queryCell=function(s,r,a,u,f,g,y,x){var E=this.cells[f];if(null!==E)for(var D=this.keys,I=this.bboxes,A=0;A<E.length;A++){var k=E[A];if(void 0===y[k]){var F=4*k;(x?x(I[F+0],I[F+1],I[F+2],I[F+3]):s<=I[F+2]&&r<=I[F+3]&&a>=I[F+0]&&u>=I[F+1])?(y[k]=!0,g.push(D[k])):y[k]=!1}}},Qo.prototype._forEachCell=function(s,r,a,u,f,g,y,x){for(var E=this._convertToCellCoord(s),D=this._convertToCellCoord(r),I=this._convertToCellCoord(a),A=this._convertToCellCoord(u),k=E;k<=I;k++)for(var F=D;F<=A;F++){var V=this.d*F+k;if((!x||x(this._convertFromCellCoord(k),this._convertFromCellCoord(F),this._convertFromCellCoord(k+1),this._convertFromCellCoord(F+1)))&&f.call(this,s,r,a,u,V,g,y,x))return}},Qo.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},Qo.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},Qo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,r=3+this.cells.length+1+1,a=0,u=0;u<this.cells.length;u++)a+=this.cells[u].length;var f=new Int32Array(r+a+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var g=r,y=0;y<s.length;y++){var x=s[y];f[3+y]=g,f.set(x,g),g+=x.length}return f[3+s.length]=g,f.set(this.keys,g),f[3+s.length+1]=g+=this.keys.length,f.set(this.bboxes,g),g+=this.bboxes.length,f.buffer};const ia={};function $t(s,r={}){ia[s.name]={klass:s,omit:r.omit||[]}}$t(Object),Gi.serialize=function(s,r){const a=s.toArrayBuffer();return r&&r.push(a),{buffer:a}},Gi.deserialize=function(s){return new Gi(s.buffer)},Object.defineProperty(Gi,"name",{value:"Grid"}),$t(Gi),$t(Wn),$t(Error),$t(N),$t(Pr),$t(lu),$t(ou,{omit:["_evaluator"]}),$t(oh),$t(su),$t(Se,{omit:["_evaluate"]});for(const s in Al)ia[Al[s].name]||$t(Al[s]);function Rd(s){return s&&"undefined"!=typeof ArrayBuffer&&(s instanceof ArrayBuffer||s.constructor&&"ArrayBuffer"===s.constructor.name)}function Qa(s){return W.ImageBitmap&&s instanceof W.ImageBitmap}function Ma(s,r){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Rd(s)||Qa(s))return r&&r.push(s),s;if(ArrayBuffer.isView(s)){const a=s;return r&&r.push(a.buffer),a}if(s instanceof W.ImageData)return r&&r.push(s.data.buffer),s;if(Array.isArray(s)){const a=[];for(const u of s)a.push(Ma(u,r));return a}if("object"==typeof s){const a=s.constructor,u=a.name;if(!ia[u])throw new Error(`can't serialize object of unregistered class ${u}`);const f=a.serialize?a.serialize(s,r):{};if(!a.serialize){for(const g in s)s.hasOwnProperty(g)&&(ia[u].omit.indexOf(g)>=0||(f[g]=Ma(s[g],r)));s instanceof Error&&(f.message=s.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(f.$name=u),f}throw new Error("can't serialize object of type "+typeof s)}function vi(s){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Rd(s)||Qa(s)||ArrayBuffer.isView(s)||s instanceof W.ImageData)return s;if(Array.isArray(s))return s.map(vi);if("object"==typeof s){const r=s.$name||"Object",{klass:a}=ia[r];if(!a)throw new Error(`can't deserialize unregistered class ${r}`);if(a.deserialize)return a.deserialize(s);const u=Object.create(a.prototype);for(const f of Object.keys(s))"$name"!==f&&(u[f]=vi(s[f]));return u}throw new Error("can't deserialize object of type "+typeof s)}class _s{constructor(){this.first=!0}update(r,a){const u=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=a),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=u,!0))}}const lh=s=>s>=1536&&s<=1791,oa=s=>s>=1872&&s<=1919,No=s=>s>=2208&&s<=2303,ch=s=>s>=11904&&s<=12031,uh=s=>s>=12032&&s<=12255,hh=s=>s>=12272&&s<=12287,du=s=>s>=12288&&s<=12351,el=s=>s>=12352&&s<=12447,Ll=s=>s>=12448&&s<=12543,dh=s=>s>=12544&&s<=12591,fu=s=>s>=12704&&s<=12735,Od=s=>s>=12736&&s<=12783,pu=s=>s>=12784&&s<=12799,mc=s=>s>=12800&&s<=13055,fh=s=>s>=13056&&s<=13311,ph=s=>s>=13312&&s<=19903,mu=s=>s>=19968&&s<=40959,mh=s=>s>=40960&&s<=42127,gc=s=>s>=42128&&s<=42191,Ld=s=>s>=44032&&s<=55215,_c=s=>s>=63744&&s<=64255,Hi=s=>s>=64336&&s<=65023,sa=s=>s>=65040&&s<=65055,$r=s=>s>=65072&&s<=65103,Fd=s=>s>=65104&&s<=65135,gu=s=>s>=65136&&s<=65279,gh=s=>s>=65280&&s<=65519;function _u(s){for(const r of s)if(tl(r.charCodeAt(0)))return!0;return!1}function Nd(s){for(const r of s)if(!zd(r.charCodeAt(0)))return!1;return!0}function zd(s){return!(lh(s)||oa(s)||No(s)||Hi(s)||gu(s))}function tl(s){return!(746!==s&&747!==s&&(s<4352||!(fu(s)||dh(s)||$r(s)&&!(s>=65097&&s<=65103)||_c(s)||fh(s)||ch(s)||Od(s)||!(!du(s)||s>=12296&&s<=12305||s>=12308&&s<=12319||12336===s)||ph(s)||mu(s)||mc(s)||(r=s,r>=12592&&r<=12687)||(r=>r>=43360&&r<=43391)(s)||(r=>r>=55216&&r<=55295)(s)||(r=>r>=4352&&r<=4607)(s)||Ld(s)||el(s)||hh(s)||(r=>r>=12688&&r<=12703)(s)||uh(s)||pu(s)||Ll(s)&&12540!==s||!(!gh(s)||65288===s||65289===s||65293===s||s>=65306&&s<=65310||65339===s||65341===s||65343===s||s>=65371&&s<=65503||65507===s||s>=65512&&s<=65519)||!(!Fd(s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||(r=>r>=5120&&r<=5759)(s)||(r=>r>=6320&&r<=6399)(s)||sa(s)||(r=>r>=19904&&r<=19967)(s)||mh(s)||gc(s))));var r}function nl(s){return!(tl(s)||(r=s,(a=r)>=128&&a<=255&&(167===r||169===r||174===r||177===r||188===r||189===r||190===r||215===r||247===r)||(a=>a>=8192&&a<=8303)(r)&&(8214===r||8224===r||8225===r||8240===r||8241===r||8251===r||8252===r||8258===r||8263===r||8264===r||8265===r||8273===r)||(a=>a>=8448&&a<=8527)(r)||(a=>a>=8528&&a<=8591)(r)||(a=>a>=8960&&a<=9215)(r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||9003===r||r>=9085&&r<=9114||r>=9150&&r<=9165||9167===r||r>=9169&&r<=9179||r>=9186&&r<=9215)||(a=>a>=9216&&a<=9279)(r)&&9251!==r||(a=>a>=9280&&a<=9311)(r)||(a=>a>=9312&&a<=9471)(r)||(a=>a>=9632&&a<=9727)(r)||(a=>a>=9728&&a<=9983)(r)&&!(r>=9754&&r<=9759)||(a=>a>=11008&&a<=11263)(r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||du(r)||Ll(r)||(a=>a>=57344&&a<=63743)(r)||$r(r)||Fd(r)||gh(r)||8734===r||8756===r||8757===r||r>=9984&&r<=10087||r>=10102&&r<=10131||65532===r||65533===r));var r,a}function rl(s){return s>=1424&&s<=2303||Hi(s)||gu(s)}function _h(s,r){return!(!r&&rl(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||(a=s,a>=6016&&a<=6143));var a}function Bd(s){for(const r of s)if(rl(r.charCodeAt(0)))return!0;return!1}const yh="deferred",es="loading",il="loaded";let vh=null,Co="unavailable",qi=null;const ol=function(s){s&&"string"==typeof s&&s.indexOf("NetworkError")>-1&&(Co="error"),vh&&vh(s)};function sl(){xh.fire(new Kt("pluginStateChange",{pluginStatus:Co,pluginURL:qi}))}const xh=new rn,bh=function(){return Co},yc=function(){if(Co!==yh||!qi)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Co=es,sl(),qi&&se({url:qi},s=>{s?ol(s):(Co=il,sl())})},fo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Co===il||null!=fo.applyArabicShaping,isLoading:()=>Co===es,setState(s){Co=s.pluginStatus,qi=s.pluginURL},isParsed:()=>null!=fo.applyArabicShaping&&null!=fo.processBidirectionalText&&null!=fo.processStyledBidirectionalText,getPluginURL:()=>qi};class Rr{constructor(r,a){this.zoom=r,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition,this.pitch=a.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new _s,this.transition={},this.pitch=0)}isSupportedScript(r){return function(a,u){for(const f of a)if(!_h(f.charCodeAt(0),u))return!1;return!0}(r,fo.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,a=r-Math.floor(r),u=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*a}}}class al{constructor(r,a){this.property=r,this.value=a,this.expression=function(u,f){if(ta(u))return new lu(u,f);if(kl(u)){const g=au(u,f);if("error"===g.result)throw new Error(g.value.map(y=>`${y.key}: ${y.message}`).join(", "));return g.value}{let g=u;return"string"==typeof u&&"color"===f.type&&(g=Wn.parse(u)),{kind:"constant",evaluate:()=>g}}}(void 0===a?r.specification.default:a,r.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(r,a,u){return this.property.possiblyEvaluate(this,r,a,u)}}class aa{constructor(r){this.property=r,this.value=new al(r,void 0)}transitioned(r,a){return new o(this.property,this.value,a,it({},r.transition,this.transition),r.now)}untransitioned(){return new o(this.property,this.value,null,{},0)}}class m{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return an(this._values[r].value.value)}setValue(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new aa(this._values[r].property)),this._values[r].value=new al(this._values[r].property,null===a?void 0:an(a))}getTransition(r){return an(this._values[r].transition)}setTransition(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new aa(this._values[r].property)),this._values[r].transition=an(a)||void 0}serialize(){const r={};for(const a of Object.keys(this._values)){const u=this.getValue(a);void 0!==u&&(r[a]=u);const f=this.getTransition(a);void 0!==f&&(r[`${a}-transition`]=f)}return r}transitioned(r,a){const u=new d(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].transitioned(r,a._values[f]);return u}untransitioned(){const r=new d(this._properties);for(const a of Object.keys(this._values))r._values[a]=this._values[a].untransitioned();return r}}class o{constructor(r,a,u,f,g){const y=f.delay||0,x=f.duration||0;g=g||0,this.property=r,this.value=a,this.begin=g+y,this.end=this.begin+x,r.specification.transition&&(f.delay||f.duration)&&(this.prior=u)}possiblyEvaluate(r,a,u){const f=r.now||0,g=this.value.possiblyEvaluate(r,a,u),y=this.prior;if(y){if(f>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(f<this.begin)return y.possiblyEvaluate(r,a,u);{const x=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(r,a,u),g,Q(x))}}return g}}class d{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,a,u){const f=new w(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(r,a,u);return f}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class _{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return an(this._values[r].value)}setValue(r,a){this._values[r]=new al(this._values[r].property,null===a?void 0:an(a))}serialize(){const r={};for(const a of Object.keys(this._values)){const u=this.getValue(a);void 0!==u&&(r[a]=u)}return r}possiblyEvaluate(r,a,u){const f=new w(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(r,a,u);return f}}class b{constructor(r,a,u){this.property=r,this.value=a,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(r){return"constant"===this.value.kind?this.value.value:r}evaluate(r,a,u,f){return this.property.evaluate(this.value,this.parameters,r,a,u,f)}}class w{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class T{constructor(r){this.specification=r}possiblyEvaluate(r,a){return r.expression.evaluate(a)}interpolate(r,a,u){const f=ir[this.specification.type];return f?f(r,a,u):r}}class M{constructor(r,a){this.specification=r,this.overrides=a}possiblyEvaluate(r,a,u,f){return new b(this,"constant"===r.expression.kind||"camera"===r.expression.kind?{kind:"constant",value:r.expression.evaluate(a,null,{},u,f)}:r.expression,a)}interpolate(r,a,u){if("constant"!==r.value.kind||"constant"!==a.value.kind)return r;if(void 0===r.value.value||void 0===a.value.value)return new b(this,{kind:"constant",value:void 0},r.parameters);const f=ir[this.specification.type];return f?new b(this,{kind:"constant",value:f(r.value.value,a.value.value,u)},r.parameters):r}evaluate(r,a,u,f,g,y){return"constant"===r.kind?r.value:r.evaluate(a,u,f,g,y)}}class P extends M{possiblyEvaluate(r,a,u,f){if(void 0===r.value)return new b(this,{kind:"constant",value:void 0},a);if("constant"===r.expression.kind){const g=r.expression.evaluate(a,null,{},u,f),y="resolvedImage"===r.property.specification.type&&"string"!=typeof g?g.name:g,x=this._calculate(y,y,y,a);return new b(this,{kind:"constant",value:x},a)}if("camera"===r.expression.kind){const g=this._calculate(r.expression.evaluate({zoom:a.zoom-1}),r.expression.evaluate({zoom:a.zoom}),r.expression.evaluate({zoom:a.zoom+1}),a);return new b(this,{kind:"constant",value:g},a)}return new b(this,r.expression,a)}evaluate(r,a,u,f,g,y){if("source"===r.kind){const x=r.evaluate(a,u,f,g,y);return this._calculate(x,x,x,a)}return"composite"===r.kind?this._calculate(r.evaluate({zoom:Math.floor(a.zoom)-1},u,f),r.evaluate({zoom:Math.floor(a.zoom)},u,f),r.evaluate({zoom:Math.floor(a.zoom)+1},u,f),a):r.value}_calculate(r,a,u,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:r,to:a,other:u}:{from:u,to:a,other:r}}interpolate(r){return r}}class O{constructor(r){this.specification=r}possiblyEvaluate(r,a,u,f){if(void 0!==r.value){if("constant"===r.expression.kind){const g=r.expression.evaluate(a,null,{},u,f);return this._calculate(g,g,g,a)}return this._calculate(r.expression.evaluate(new Rr(Math.floor(a.zoom-1),a)),r.expression.evaluate(new Rr(Math.floor(a.zoom),a)),r.expression.evaluate(new Rr(Math.floor(a.zoom+1),a)),a)}}_calculate(r,a,u,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:r,to:a}:{from:u,to:a}}interpolate(r){return r}}class L{constructor(r){this.specification=r}possiblyEvaluate(r,a,u,f){return!!r.expression.evaluate(a,null,{},u,f)}interpolate(){return!1}}class B{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const a in r){const u=r[a];u.specification.overridable&&this.overridableProperties.push(a);const f=this.defaultPropertyValues[a]=new al(u,void 0),g=this.defaultTransitionablePropertyValues[a]=new aa(u);this.defaultTransitioningPropertyValues[a]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=f.possiblyEvaluate({})}}}function H(s,r){return 256*(s=J(Math.floor(s),0,255))+J(Math.floor(r),0,255)}$t(M),$t(T),$t(P),$t(O),$t(L);const te={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class X{constructor(r,a){this._structArray=r,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class G{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,a){return r._trim(),a&&(r.isTransferred=!0,a.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const a=Object.create(this.prototype);return a.arrayBuffer=r.arrayBuffer,a.length=r.length,a.capacity=r.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function _e(s,r=1){let a=0,u=0;return{members:s.map(f=>{const g=te[f.type].BYTES_PER_ELEMENT,y=a=ae(a,Math.max(r,g)),x=f.components||1;return u=Math.max(u,g),a+=g*x,{name:f.name,type:f.type,components:x,offset:y}}),size:ae(a,Math.max(u,r)),alignment:r}}function ae(s,r){return Math.ceil(s/r)*r}class fe extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a){const u=this.length;return this.resize(u+1),this.emplace(u,r,a)}emplace(r,a,u){const f=2*r;return this.int16[f+0]=a,this.int16[f+1]=u,r}}fe.prototype.bytesPerElement=4,$t(fe);class ye extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,r,a,u)}emplace(r,a,u,f){const g=3*r;return this.int16[g+0]=a,this.int16[g+1]=u,this.int16[g+2]=f,r}}ye.prototype.bytesPerElement=6,$t(ye);class xe extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,u,f)}emplace(r,a,u,f,g){const y=4*r;return this.int16[y+0]=a,this.int16[y+1]=u,this.int16[y+2]=f,this.int16[y+3]=g,r}}xe.prototype.bytesPerElement=8,$t(xe);class he extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,f,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,a,u,f,g,y,x)}emplace(r,a,u,f,g,y,x,E){const D=6*r,I=12*r,A=3*r;return this.int16[D+0]=a,this.int16[D+1]=u,this.uint8[I+4]=f,this.uint8[I+5]=g,this.uint8[I+6]=y,this.uint8[I+7]=x,this.float32[A+2]=E,r}}he.prototype.bytesPerElement=12,$t(he);class Te extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,r,a,u)}emplace(r,a,u,f){const g=3*r;return this.float32[g+0]=a,this.float32[g+1]=u,this.float32[g+2]=f,r}}Te.prototype.bytesPerElement=12,$t(Te);class Ue extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u,f,g,y,x,E,D,I){const A=this.length;return this.resize(A+1),this.emplace(A,r,a,u,f,g,y,x,E,D,I)}emplace(r,a,u,f,g,y,x,E,D,I,A){const k=10*r;return this.uint16[k+0]=a,this.uint16[k+1]=u,this.uint16[k+2]=f,this.uint16[k+3]=g,this.uint16[k+4]=y,this.uint16[k+5]=x,this.uint16[k+6]=E,this.uint16[k+7]=D,this.uint16[k+8]=I,this.uint16[k+9]=A,r}}Ue.prototype.bytesPerElement=20,$t(Ue);class We extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u,f,g,y,x,E){const D=this.length;return this.resize(D+1),this.emplace(D,r,a,u,f,g,y,x,E)}emplace(r,a,u,f,g,y,x,E,D){const I=8*r;return this.uint16[I+0]=a,this.uint16[I+1]=u,this.uint16[I+2]=f,this.uint16[I+3]=g,this.uint16[I+4]=y,this.uint16[I+5]=x,this.uint16[I+6]=E,this.uint16[I+7]=D,r}}We.prototype.bytesPerElement=16,$t(We);class et extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u,f,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,r,a,u,f,g,y)}emplace(r,a,u,f,g,y,x){const E=6*r;return this.int16[E+0]=a,this.int16[E+1]=u,this.int16[E+2]=f,this.int16[E+3]=g,this.int16[E+4]=y,this.int16[E+5]=x,r}}et.prototype.bytesPerElement=12,$t(et);class Je extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u,f,g,y,x,E,D,I,A,k,F,V,Z,ee){const le=this.length;return this.resize(le+1),this.emplace(le,r,a,u,f,g,y,x,E,D,I,A,k,F,V,Z,ee)}emplace(r,a,u,f,g,y,x,E,D,I,A,k,F,V,Z,ee,le){const ve=16*r;return this.int16[ve+0]=a,this.int16[ve+1]=u,this.int16[ve+2]=f,this.int16[ve+3]=g,this.uint16[ve+4]=y,this.uint16[ve+5]=x,this.uint16[ve+6]=E,this.uint16[ve+7]=D,this.int16[ve+8]=I,this.int16[ve+9]=A,this.int16[ve+10]=k,this.int16[ve+11]=F,this.int16[ve+12]=V,this.int16[ve+13]=Z,this.int16[ve+14]=ee,this.int16[ve+15]=le,r}}Je.prototype.bytesPerElement=32,$t(Je);class Dt extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint32[1*r+0]=a,r}}Dt.prototype.bytesPerElement=4,$t(Dt);class Ve extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u,f,g,y,x,E,D,I,A,k,F){const V=this.length;return this.resize(V+1),this.emplace(V,r,a,u,f,g,y,x,E,D,I,A,k,F)}emplace(r,a,u,f,g,y,x,E,D,I,A,k,F,V){const Z=20*r,ee=10*r;return this.int16[Z+0]=a,this.int16[Z+1]=u,this.int16[Z+2]=f,this.int16[Z+3]=g,this.int16[Z+4]=y,this.float32[ee+3]=x,this.float32[ee+4]=E,this.float32[ee+5]=D,this.float32[ee+6]=I,this.int16[Z+14]=A,this.uint32[ee+8]=k,this.uint16[Z+18]=F,this.uint16[Z+19]=V,r}}Ve.prototype.bytesPerElement=40,$t(Ve);class vt extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u,f,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,a,u,f,g,y,x)}emplace(r,a,u,f,g,y,x,E){const D=8*r;return this.int16[D+0]=a,this.int16[D+1]=u,this.int16[D+2]=f,this.int16[D+4]=g,this.int16[D+5]=y,this.int16[D+6]=x,this.int16[D+7]=E,r}}vt.prototype.bytesPerElement=16,$t(vt);class ht extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,u,f,g)}emplace(r,a,u,f,g,y){const x=4*r,E=8*r;return this.float32[x+0]=a,this.float32[x+1]=u,this.float32[x+2]=f,this.int16[E+6]=g,this.int16[E+7]=y,r}}ht.prototype.bytesPerElement=16,$t(ht);class qt extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,u,f)}emplace(r,a,u,f,g){const y=12*r,x=3*r;return this.uint8[y+0]=a,this.uint8[y+1]=u,this.float32[x+1]=f,this.float32[x+2]=g,r}}qt.prototype.bytesPerElement=12,$t(qt);class Ke extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,r,a,u)}emplace(r,a,u,f){const g=3*r;return this.uint16[g+0]=a,this.uint16[g+1]=u,this.uint16[g+2]=f,r}}Ke.prototype.bytesPerElement=6,$t(Ke);class Jt extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,u,f,g,y,x,E,D,I,A,k,F,V,Z,ee,le,ve,Pe,Re,Le){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,r,a,u,f,g,y,x,E,D,I,A,k,F,V,Z,ee,le,ve,Pe,Re,Le)}emplace(r,a,u,f,g,y,x,E,D,I,A,k,F,V,Z,ee,le,ve,Pe,Re,Le,Fe){const Ye=30*r,Qe=15*r,at=60*r;return this.int16[Ye+0]=a,this.int16[Ye+1]=u,this.int16[Ye+2]=f,this.float32[Qe+2]=g,this.float32[Qe+3]=y,this.uint16[Ye+8]=x,this.uint16[Ye+9]=E,this.uint32[Qe+5]=D,this.uint32[Qe+6]=I,this.uint32[Qe+7]=A,this.uint16[Ye+16]=k,this.uint16[Ye+17]=F,this.uint16[Ye+18]=V,this.float32[Qe+10]=Z,this.float32[Qe+11]=ee,this.uint8[at+48]=le,this.uint8[at+49]=ve,this.uint8[at+50]=Pe,this.uint32[Qe+13]=Re,this.int16[Ye+28]=Le,this.uint8[at+58]=Fe,r}}Jt.prototype.bytesPerElement=60,$t(Jt);class en extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,u,f,g,y,x,E,D,I,A,k,F,V,Z,ee,le,ve,Pe,Re,Le,Fe,Ye,Qe,at,ft,qe,tt,mt,Tt){const wt=this.length;return this.resize(wt+1),this.emplace(wt,r,a,u,f,g,y,x,E,D,I,A,k,F,V,Z,ee,le,ve,Pe,Re,Le,Fe,Ye,Qe,at,ft,qe,tt,mt,Tt)}emplace(r,a,u,f,g,y,x,E,D,I,A,k,F,V,Z,ee,le,ve,Pe,Re,Le,Fe,Ye,Qe,at,ft,qe,tt,mt,Tt,wt){const St=38*r,vn=19*r;return this.int16[St+0]=a,this.int16[St+1]=u,this.int16[St+2]=f,this.float32[vn+2]=g,this.float32[vn+3]=y,this.int16[St+8]=x,this.int16[St+9]=E,this.int16[St+10]=D,this.int16[St+11]=I,this.int16[St+12]=A,this.int16[St+13]=k,this.uint16[St+14]=F,this.uint16[St+15]=V,this.uint16[St+16]=Z,this.uint16[St+17]=ee,this.uint16[St+18]=le,this.uint16[St+19]=ve,this.uint16[St+20]=Pe,this.uint16[St+21]=Re,this.uint16[St+22]=Le,this.uint16[St+23]=Fe,this.uint16[St+24]=Ye,this.uint16[St+25]=Qe,this.uint16[St+26]=at,this.uint16[St+27]=ft,this.uint16[St+28]=qe,this.uint32[vn+15]=tt,this.float32[vn+16]=mt,this.float32[vn+17]=Tt,this.float32[vn+18]=wt,r}}en.prototype.bytesPerElement=76,$t(en);class Ut extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.float32[1*r+0]=a,r}}Ut.prototype.bytesPerElement=4,$t(Ut);class Zt extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,f,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,a,u,f,g,y,x)}emplace(r,a,u,f,g,y,x,E){const D=7*r;return this.float32[D+0]=a,this.float32[D+1]=u,this.float32[D+2]=f,this.float32[D+3]=g,this.float32[D+4]=y,this.float32[D+5]=x,this.float32[D+6]=E,r}}Zt.prototype.bytesPerElement=28,$t(Zt);class ln extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,u,f,g)}emplace(r,a,u,f,g,y){const x=5*r;return this.float32[x+0]=a,this.float32[x+1]=u,this.float32[x+2]=f,this.float32[x+3]=g,this.float32[x+4]=y,r}}ln.prototype.bytesPerElement=20,$t(ln);class Tn extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,u,f)}emplace(r,a,u,f,g){const y=6*r;return this.uint32[3*r+0]=a,this.uint16[y+2]=u,this.uint16[y+3]=f,this.uint16[y+4]=g,r}}Tn.prototype.bytesPerElement=12,$t(Tn);class tn extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a){const u=this.length;return this.resize(u+1),this.emplace(u,r,a)}emplace(r,a,u){const f=2*r;return this.uint16[f+0]=a,this.uint16[f+1]=u,r}}tn.prototype.bytesPerElement=4,$t(tn);class bn extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint16[1*r+0]=a,r}}bn.prototype.bytesPerElement=2,$t(bn);class Xt extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a){const u=this.length;return this.resize(u+1),this.emplace(u,r,a)}emplace(r,a,u){const f=2*r;return this.float32[f+0]=a,this.float32[f+1]=u,r}}Xt.prototype.bytesPerElement=8,$t(Xt);class ii extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,u,f)}emplace(r,a,u,f,g){const y=4*r;return this.float32[y+0]=a,this.float32[y+1]=u,this.float32[y+2]=f,this.float32[y+3]=g,r}}ii.prototype.bytesPerElement=16,$t(ii);class po extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,f,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,a,u,f,g,y,x)}emplace(r,a,u,f,g,y,x,E){const D=8*r,I=4*r;return this.int16[D+0]=a,this.int16[D+1]=u,this.int16[D+2]=f,this.int16[D+3]=g,this.int16[D+4]=y,this.int16[D+5]=x,this.float32[I+3]=E,r}}po.prototype.bytesPerElement=16,$t(po);class mo extends X{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}mo.prototype.size=12;class ts extends et{get(r){return new mo(this,r)}}$t(ts);class $s extends X{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}$s.prototype.size=40;class Ia extends Ve{get(r){return new $s(this,r)}}$t(Ia);class ll extends X{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}ll.prototype.size=60;class zo extends Jt{get(r){return new ll(this,r)}}$t(zo);class si extends X{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}si.prototype.size=76;class Xn extends en{get(r){return new si(this,r)}}$t(Xn);class cr extends Ut{getoffsetX(r){return this.float32[1*r+0]}}$t(cr);class Jr extends ye{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}$t(Jr);class ns extends X{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ns.prototype.size=12;class Qr extends Tn{get(r){return new ns(this,r)}}$t(Qr);class ai extends X{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}ai.prototype.size=4;class To extends tn{get(r){return new ai(this,r)}}$t(To);class Do extends X{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}get a_scale(){return this._structArray.float32[this._pos4+3]}}Do.prototype.size=16;class Gs extends po{get(r){return new Do(this,r)}}$t(Gs);const Fl=_e([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),yu=_e([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Nl=Ls(function(s){s.exports=function(r,a){var u,f,g,y,x,E,D,I;for(f=r.length-(u=3&r.length),g=a,x=3432918353,E=461845907,I=0;I<f;)D=255&r.charCodeAt(I)|(255&r.charCodeAt(++I))<<8|(255&r.charCodeAt(++I))<<16|(255&r.charCodeAt(++I))<<24,++I,g=27492+(65535&(y=5*(65535&(g=(g^=D=(65535&(D=(D=(65535&D)*x+(((D>>>16)*x&65535)<<16)&4294967295)<<15|D>>>17))*E+(((D>>>16)*E&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(D=0,u){case 3:D^=(255&r.charCodeAt(I+2))<<16;case 2:D^=(255&r.charCodeAt(I+1))<<8;case 1:g^=D=(65535&(D=(D=(65535&(D^=255&r.charCodeAt(I)))*x+(((D>>>16)*x&65535)<<16)&4294967295)<<15|D>>>17))*E+(((D>>>16)*E&65535)<<16)&4294967295}return g^=r.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}}),np=Ls(function(s){s.exports=function(r,a){for(var u,f=r.length,g=a^f,y=0;f>=4;)u=1540483477*(65535&(u=255&r.charCodeAt(y)|(255&r.charCodeAt(++y))<<8|(255&r.charCodeAt(++y))<<16|(255&r.charCodeAt(++y))<<24))+((1540483477*(u>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++y;switch(f){case 3:g^=(255&r.charCodeAt(y+2))<<16;case 2:g^=(255&r.charCodeAt(y+1))<<8;case 1:g=1540483477*(65535&(g^=255&r.charCodeAt(y)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}}),cl=Nl,Vd=np;cl.murmur3=Nl,cl.murmur2=Vd;class wh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,a,u,f){this.ids.push(rs(r)),this.positions.push(a,u,f)}getPositions(r){const a=rs(r);let u=0,f=this.ids.length-1;for(;u<f;){const y=u+f>>1;this.ids[y]>=a?f=y:u=y+1}const g=[];for(;this.ids[u]===a;)g.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return g}static serialize(r,a){const u=new Float64Array(r.ids),f=new Uint32Array(r.positions);return Eh(u,f,0,u.length-1),a&&a.push(u.buffer,f.buffer),{ids:u,positions:f}}static deserialize(r){const a=new wh;return a.ids=r.ids,a.positions=r.positions,a.indexed=!0,a}}function rs(s){const r=+s;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:cl(String(s))}function Eh(s,r,a,u){for(;a<u;){const f=s[a+u>>1];let g=a-1,y=u+1;for(;;){do{g++}while(s[g]<f);do{y--}while(s[y]>f);if(g>=y)break;ul(s,g,y),ul(r,3*g,3*y),ul(r,3*g+1,3*y+1),ul(r,3*g+2,3*y+2)}y-a<u-y?(Eh(s,r,a,y),a=y+1):(Eh(s,r,y+1,u),u=y)}}function ul(s,r,a){const u=s[r];s[r]=s[a],s[a]=u}$t(wh);class zl{constructor(r,a){this.gl=r.gl,this.location=a}}class Ch extends zl{constructor(r,a){super(r,a),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Jm extends zl{constructor(r,a){super(r,a),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class Qm extends zl{constructor(r,a){super(r,a),this.current=Wn.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const ky=new Float32Array(16),Ry=new Float32Array(9),Oy=new Float32Array(4);function Ud(s){return[H(255*s.r,255*s.g),H(255*s.b,255*s.a)]}class vc{constructor(r,a,u){this.value=r,this.uniformNames=a.map(f=>`u_${f}`),this.type=u}setUniform(r,a,u){r.set(u.constantOr(this.value))}getBinding(r,a,u){return"color"===this.type?new Qm(r,a):new Ch(r,a)}}class hl{constructor(r,a){this.uniformNames=a.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,a){this.pixelRatioFrom=a.pixelRatio||1,this.pixelRatioTo=r.pixelRatio||1,this.patternFrom=a.tl.concat(a.br),this.patternTo=r.tl.concat(r.br)}setUniform(r,a,u,f){const g="u_pattern_to"===f||"u_dash_to"===f?this.patternTo:"u_pattern_from"===f||"u_dash_from"===f?this.patternFrom:"u_pixel_ratio_to"===f?this.pixelRatioTo:"u_pixel_ratio_from"===f?this.pixelRatioFrom:null;g&&r.set(g)}getBinding(r,a,u){return"u_pattern_from"===u||"u_pattern_to"===u||"u_dash_from"===u||"u_dash_to"===u?new Jm(r,a):new Ch(r,a)}}class Bl{constructor(r,a,u,f){this.expression=r,this.type=u,this.maxValue=0,this.paintVertexAttributes=a.map(g=>({name:`a_${g}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(r,a,u,f,g,y){const x=this.paintVertexArray.length,E=this.expression.evaluate(new Rr(0),a,{},g,f,y);this.paintVertexArray.resize(r),this._setPaintValue(x,r,E)}updatePaintArray(r,a,u,f,g){const y=this.expression.evaluate({zoom:0},u,f,void 0,g);this._setPaintValue(r,a,y)}_setPaintValue(r,a,u){if("color"===this.type){const f=Ud(u);for(let g=r;g<a;g++)this.paintVertexArray.emplace(g,f[0],f[1])}else{for(let f=r;f<a;f++)this.paintVertexArray.emplace(f,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Bo{constructor(r,a,u,f,g,y){this.expression=r,this.uniformNames=a.map(x=>`u_${x}_t`),this.type=u,this.useIntegerZoom=f,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=a.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(r,a,u,f,g,y){const x=this.expression.evaluate(new Rr(this.zoom),a,{},g,f,y),E=this.expression.evaluate(new Rr(this.zoom+1),a,{},g,f,y),D=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(D,r,x,E)}updatePaintArray(r,a,u,f,g){const y=this.expression.evaluate({zoom:this.zoom},u,f,void 0,g),x=this.expression.evaluate({zoom:this.zoom+1},u,f,void 0,g);this._setPaintValue(r,a,y,x)}_setPaintValue(r,a,u,f){if("color"===this.type){const g=Ud(u),y=Ud(f);for(let x=r;x<a;x++)this.paintVertexArray.emplace(x,g[0],g[1],y[0],y[1])}else{for(let g=r;g<a;g++)this.paintVertexArray.emplace(g,u,f);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(f))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,a){const u=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,f=J(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);r.set(f)}getBinding(r,a,u){return new Ch(r,a)}}class Aa{constructor(r,a,u,f,g,y,x){this.expression=r,this.type=u,this.useIntegerZoom=f,this.zoom=g,this.layerId=x,this.paintVertexAttributes=("array"===u?yu:Fl).members;for(let E=0;E<a.length;++E);this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(r,a,u){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(f,r,a.patterns&&a.patterns[this.layerId],u)}updatePaintArray(r,a,u,f,g,y){this._setPaintValues(r,a,u.patterns&&u.patterns[this.layerId],y)}_setPaintValues(r,a,u,f){if(!f||!u)return;const{min:g,mid:y,max:x}=u,E=f[g],D=f[y],I=f[x];if(E&&D&&I)for(let A=r;A<a;A++)this._setPaintValue(this.zoomInPaintVertexArray,A,D,E),this._setPaintValue(this.zoomOutPaintVertexArray,A,D,I)}_setPaintValue(r,a,u,f){r.emplace(a,u.tl[0],u.tl[1],u.br[0],u.br[1],f.tl[0],f.tl[1],f.br[0],f.br[1],u.pixelRatio,f.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class la{constructor(r,a,u=(()=>!0)){this.binders={},this._buffers=[];const f=[];for(const g in r.paint._values){if(!u(g))continue;const y=r.paint.get(g);if(!(y instanceof b&&uc(y.property.specification)))continue;const x=Fy(g,r.type),E=y.value,D=y.property.specification.type,I=y.property.useIntegerZoom,A=y.property.specification["property-type"],k="cross-faded"===A||"cross-faded-data-driven"===A,F="line-dasharray"===String(g)&&"constant"!==r.layout.get("line-cap").value.kind;if("constant"!==E.kind||F)if("source"===E.kind||F||k){const V=vu(g,D,"source");this.binders[g]=k?new Aa(E,x,D,I,a,V,r.id):new Bl(E,x,D,V),f.push(`/a_${g}`)}else{const V=vu(g,D,"composite");this.binders[g]=new Bo(E,x,D,I,a,V),f.push(`/z_${g}`)}else this.binders[g]=k?new hl(E.value,x):new vc(E.value,x,D),f.push(`/u_${g}`)}this.cacheKey=f.sort().join("")}getMaxValue(r){const a=this.binders[r];return a instanceof Bl||a instanceof Bo?a.maxValue:0}populatePaintArrays(r,a,u,f,g,y){for(const x in this.binders){const E=this.binders[x];(E instanceof Bl||E instanceof Bo||E instanceof Aa)&&E.populatePaintArray(r,a,u,f,g,y)}}setConstantPatternPositions(r,a){for(const u in this.binders){const f=this.binders[u];f instanceof hl&&f.setConstantPatternPositions(r,a)}}updatePaintArrays(r,a,u,f,g,y){let x=!1;for(const E in r){const D=a.getPositions(E);for(const I of D){const A=u.feature(I.index);for(const k in this.binders){const F=this.binders[k];if((F instanceof Bl||F instanceof Bo||F instanceof Aa)&&!0===F.expression.isStateDependent){const V=f.paint.get(k);F.expression=V.value,F.updatePaintArray(I.start,I.end,A,r[E],g,y),x=!0}}}}return x}defines(){const r=[];for(const a in this.binders){const u=this.binders[a];(u instanceof vc||u instanceof hl)&&r.push(...u.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return r}getBinderAttributes(){const r=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof Bl||u instanceof Bo||u instanceof Aa)for(let f=0;f<u.paintVertexAttributes.length;f++)r.push(u.paintVertexAttributes[f].name)}return r}getBinderUniforms(){const r=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof vc||u instanceof hl||u instanceof Bo)for(const f of u.uniformNames)r.push(f)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,a){const u=[];for(const f in this.binders){const g=this.binders[f];if(g instanceof vc||g instanceof hl||g instanceof Bo)for(const y of g.uniformNames)if(a[y]){const x=g.getBinding(r,a[y],y);u.push({name:y,property:f,binding:x})}}return u}setUniforms(r,a,u,f){for(const{name:g,property:y,binding:x}of a)this.binders[y].setUniform(x,f,u.get(y),g)}updatePaintBuffers(r){this._buffers=[];for(const a in this.binders){const u=this.binders[a];if(r&&u instanceof Aa){const f=2===r.fromScale?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(u instanceof Bl||u instanceof Bo)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(r){for(const a in this.binders){const u=this.binders[a];(u instanceof Bl||u instanceof Bo||u instanceof Aa)&&u.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const a=this.binders[r];(a instanceof Bl||a instanceof Bo||a instanceof Aa)&&a.destroy()}}}class xc{constructor(r,a,u=(()=>!0)){this.programConfigurations={};for(const f of r)this.programConfigurations[f.id]=new la(f,a,u);this.needsUpload=!1,this._featureMap=new wh,this._bufferOffset=0}populatePaintArrays(r,a,u,f,g,y,x){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(r,a,f,g,y,x);void 0!==a.id&&this._featureMap.add(a.id,u,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,a,u,f,g){for(const y of u)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(r,this._featureMap,a,y,f,g)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const Ly={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Fy(s,r){return Ly[s]||[s.replace(`${r}-`,"").replace(/-/g,"_")]}const eg={"line-pattern":{source:Ue,composite:Ue},"fill-pattern":{source:Ue,composite:Ue},"fill-extrusion-pattern":{source:Ue,composite:Ue},"line-dasharray":{source:We,composite:We}},Ny={color:{source:Xt,composite:ii},number:{source:Ut,composite:Xt}};function vu(s,r,a){const u=eg[s];return u&&u[a]||Ny[r][a]}$t(vc),$t(hl),$t(Bl),$t(Aa),$t(Bo),$t(la,{omit:["_buffers"]}),$t(xc);const Th="-transition";class ca extends rn{constructor(r,a){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==r.type&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,"background"!==r.type&&"sky"!==r.type&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),a.layout&&(this._unevaluatedLayout=new _(a.layout)),a.paint)){this._transitionablePaint=new m(a.paint);for(const u in r.paint)this.setPaintProperty(u,r.paint[u],{validate:!1});for(const u in r.layout)this.setLayoutProperty(u,r.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new w(a.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return"visibility"===r?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,a,u={}){null!=a&&this._validate(Di,`layers.${this.id}.layout.${r}`,r,a,u)||("visibility"!==r?this._unevaluatedLayout.setValue(r,a):this.visibility=a)}getPaintProperty(r){return rt(r,Th)?this._transitionablePaint.getTransition(r.slice(0,-Th.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,a,u={}){if(null!=a&&this._validate(tp,`layers.${this.id}.paint.${r}`,r,a,u))return!1;if(rt(r,Th))return this._transitionablePaint.setTransition(r.slice(0,-Th.length),a||void 0),!1;{const f=this._transitionablePaint._values[r],g="cross-faded-data-driven"===f.property.specification["property-type"],y=f.value.isDataDriven(),x=f.value;this._transitionablePaint.setValue(r,a),this._handleSpecialPaintPropertyUpdate(r);const E=this._transitionablePaint._values[r].value;return E.isDataDriven()||y||g||this._handleOverridablePaintPropertyUpdate(r,x,E)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,a,u){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||"none"===this.visibility}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,a){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,a)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Cn(r,(a,u)=>!(void 0===a||"layout"===u&&!Object.keys(a).length||"paint"===u&&!Object.keys(a).length))}_validate(r,a,u,f,g={}){return(!g||!1!==g.validate)&&Ol(this,r.call(or,{key:a,layerType:this.type,objectKey:u,value:f,styleSpec:$e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const a=this.paint.get(r);if(a instanceof b&&uc(a.property.specification)&&("source"===a.value.kind||"composite"===a.value.kind)&&a.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=kr(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const dn=_e([{name:"a_pos",components:2,type:"Int16"}],4),tg=_e([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"},{name:"a_scale",components:1,type:"Float32"}]);class li{constructor(r=[]){this.segments=r}prepareSegment(r,a,u,f){let g=this.segments[this.segments.length-1];return r>li.MAX_VERTEX_ARRAY_LENGTH&&hn(`Max vertices per segment is ${li.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!g||g.vertexLength+r>li.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==f)&&(g={vertexOffset:a.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},void 0!==f&&(g.sortKey=f),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const r of this.segments)for(const a in r.vaos)r.vaos[a].destroy()}static simpleSegment(r,a,u,f){return new li([{vertexOffset:r,primitiveOffset:a,vertexLength:u,primitiveLength:f,vaos:{},sortKey:0}])}}li.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,$t(li);var In=8192;class Hs{constructor(r,a){r&&(a?this.setSouthWest(r).setNorthEast(a):4===r.length?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof Tr?new Tr(r.lng,r.lat):Tr.convert(r),this}setSouthWest(r){return this._sw=r instanceof Tr?new Tr(r.lng,r.lat):Tr.convert(r),this}extend(r){const a=this._sw,u=this._ne;let f,g;if(r instanceof Tr)f=r,g=r;else{if(!(r instanceof Hs))return Array.isArray(r)?4===r.length||r.every(Array.isArray)?this.extend(Hs.convert(r)):this.extend(Tr.convert(r)):this;if(f=r._sw,g=r._ne,!f||!g)return this}return a||u?(a.lng=Math.min(f.lng,a.lng),a.lat=Math.min(f.lat,a.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new Tr(f.lng,f.lat),this._ne=new Tr(g.lng,g.lat)),this}getCenter(){return new Tr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Tr(this.getWest(),this.getNorth())}getSouthEast(){return new Tr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:a,lat:u}=Tr.convert(r);let f=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&f}static convert(r){return!r||r instanceof Hs?r:new Hs(r)}}const rp=6371008.8;class Tr{constructor(r,a){if(isNaN(r)||isNaN(a))throw new Error(`Invalid LngLat object: (${r}, ${a})`);if(this.lng=+r,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Tr(Ie(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const a=Math.PI/180,u=this.lat*a,f=r.lat*a,g=Math.sin(u)*Math.sin(f)+Math.cos(u)*Math.cos(f)*Math.cos((r.lng-this.lng)*a);return rp*Math.acos(Math.min(g,1))}toBounds(r=0){const a=360*r/40075017,u=a/Math.cos(Math.PI/180*this.lat);return new Hs(new Tr(this.lng-u,this.lat-a),new Tr(this.lng+u,this.lat+a))}static convert(r){if(r instanceof Tr)return r;if(Array.isArray(r)&&(2===r.length||3===r.length))return new Tr(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&"object"==typeof r&&null!==r)return new Tr(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ng=2*Math.PI*rp;function xu(s){return ng*Math.cos(s*Math.PI/180)}function qs(s){return(180+s)/360}function bc(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Pa(s,r){return s/xu(r)}function Zs(s){return 360*s-180}function Zi(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function jd(s,r){return s*xu(Zi(r))}const ys=85.051129;class Dh{constructor(r,a,u=0){this.x=+r,this.y=+a,this.z=+u}static fromLngLat(r,a=0){const u=Tr.convert(r);return new Dh(qs(u.lng),bc(u.lat),Pa(a,u.lat))}toLngLat(){return new Tr(Zs(this.x),Zi(this.y))}toAltitude(){return jd(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ng*(r=Zi(this.y),1/Math.cos(r*Math.PI/180));var r}}function ip(s,r,a,u,f,g,y,x,E){const D=(r+u)/2,I=(a+f)/2,A=new $(D,I);x(A),function(k,F,V,Z,ee,le){const ve=V-ee,Pe=Z-le;return Math.abs((Z-F)*ve-(V-k)*Pe)/Math.hypot(ve,Pe)}(A.x,A.y,g.x,g.y,y.x,y.y)>=E?(ip(s,r,a,D,I,g,A,x,E),ip(s,D,I,u,f,A,y,x,E)):s.push(y)}function zy(s,r,a){let u=s[0],f=u.x,g=u.y;r(u);const y=[u];for(let x=1;x<s.length;x++){const E=s[x],{x:D,y:I}=E;r(E),ip(y,f,g,D,I,u,E,r,a),f=D,g=I,u=E}return y}const Vl=Math.pow(2,14)-1,bu=-Vl-1;function By(s,r){const a=Math.round(s.x*r),u=Math.round(s.y*r);return s.x=J(a,bu,Vl),s.y=J(u,bu,Vl),(a<s.x||a>s.x+1||u<s.y||u>s.y+1)&&hn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function Ul(s,r,a){const u=s.loadGeometry(),f=s.extent,g=In/f;if(r&&a&&a.projection.isReprojectedInTileSpace){const y=1<<r.z,{scale:x,x:E,y:D,projection:I}=a,A=k=>{const F=Zs((r.x+k.x/f)/y),V=Zi((r.y+k.y/f)/y),Z=I.project(F,V);k.x=(Z.x*x-E)*f,k.y=(Z.y*x-D)*f};for(let k=0;k<u.length;k++)if(1!==s.type)u[k]=zy(u[k],A,1);else{const F=[];for(const V of u[k])V.x<0||V.x>=f||V.y<0||V.y>=f||(A(V),F.push(V));u[k]=F}}for(const y of u)for(const x of y)By(x,g);return u}function jl(s,r){return{type:s.type,id:s.id,properties:s.properties,geometry:r?Ul(s):[]}}function $d(s,r,a,u,f){s.emplaceBack(2*r+(u+1)/2,2*a+(f+1)/2)}function op(s,r,a,u){s.emplaceBack(r.x,r.y,r.z,16384*a[0],16384*a[1],16384*a[2],u)}class sp{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new fe,this.indexArray=new Ke,this.segments=new li,this.programConfigurations=new xc(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,u,f){const g=this.layers[0],y=[];let x=null;"circle"===g.type&&(x=g.layout.get("circle-sort-key"));for(const{feature:D,id:I,index:A,sourceLayerIndex:k}of r){const F=this.layers[0]._featureFilter.needGeometry,V=jl(D,F);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom),V,u))continue;const Z=x?x.evaluate(V,{},u):void 0,ee={id:I,properties:D.properties,type:D.type,sourceLayerIndex:k,index:A,geometry:F?V.geometry:Ul(D,u,f),patterns:{},sortKey:Z};y.push(ee)}x&&y.sort((D,I)=>D.sortKey-I.sortKey);let E=null;"globe"===f.projection.name&&(this.globeExtVertexArray=new Gs,E=f.projection);for(const D of y){const{geometry:I,index:A,sourceLayerIndex:k}=D,F=r[A].feature;this.addFeature(D,I,A,a.availableImages,u,E),a.featureIndex.insert(F,I,A,k,this.index)}}update(r,a,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,dn.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,tg.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,a,u,f,g,y){for(const x of a)for(const E of x){const D=E.x,I=E.y;if(D<0||D>=In||I<0||I>=In)continue;if(y){const F=y.projectTilePoint(D,I,g),V=y.upVector(g,D,I),Z=Zi((I/In+g.y)/(1<<g.z)),ee=y.pixelsPerMeter(Z,1)/Pa(1,Z),le=this.globeExtVertexArray;op(le,F,V,ee),op(le,F,V,ee),op(le,F,V,ee),op(le,F,V,ee)}const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),k=A.vertexLength;$d(this.layoutVertexArray,D,I,-1,-1),$d(this.layoutVertexArray,D,I,1,-1),$d(this.layoutVertexArray,D,I,1,1),$d(this.layoutVertexArray,D,I,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+3,k+2),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,{},f,g)}}function rg(s,r){for(let a=0;a<s.length;a++)if(Gl(r,s[a]))return!0;for(let a=0;a<r.length;a++)if(Gl(s,r[a]))return!0;return!!$l(s,r)}function Vy(s,r,a){return!!Gl(s,r)||!!lp(r,s,a)}function Sh(s,r){if(1===s.length)return Mh(r,s[0]);for(let a=0;a<r.length;a++){const u=r[a];for(let f=0;f<u.length;f++)if(Gl(s,u[f]))return!0}for(let a=0;a<s.length;a++)if(Mh(r,s[a]))return!0;for(let a=0;a<r.length;a++)if($l(s,r[a]))return!0;return!1}function ap(s,r,a){if(s.length>1){if($l(s,r))return!0;for(let u=0;u<r.length;u++)if(lp(r[u],s,a))return!0}for(let u=0;u<s.length;u++)if(lp(s[u],r,a))return!0;return!1}function $l(s,r){if(0===s.length||0===r.length)return!1;for(let a=0;a<s.length-1;a++){const u=s[a],f=s[a+1];for(let g=0;g<r.length-1;g++)if(Uy(u,f,r[g],r[g+1]))return!0}return!1}function Uy(s,r,a,u){return Bn(s,a,u)!==Bn(r,a,u)&&Bn(s,r,a)!==Bn(s,r,u)}function lp(s,r,a){const u=a*a;if(1===r.length)return s.distSqr(r[0])<u;for(let f=1;f<r.length;f++)if(jy(s,r[f-1],r[f])<u)return!0;return!1}function jy(s,r,a){const u=r.distSqr(a);if(0===u)return s.distSqr(r);const f=((s.x-r.x)*(a.x-r.x)+(s.y-r.y)*(a.y-r.y))/u;return s.distSqr(f<0?r:f>1?a:a.sub(r)._mult(f)._add(r))}function Mh(s,r){let a,u,f,g=!1;for(let y=0;y<s.length;y++){a=s[y];for(let x=0,E=a.length-1;x<a.length;E=x++)u=a[x],f=a[E],u.y>r.y!=f.y>r.y&&r.x<(f.x-u.x)*(r.y-u.y)/(f.y-u.y)+u.x&&(g=!g)}return g}function Gl(s,r){let a=!1;for(let u=0,f=s.length-1;u<s.length;f=u++){const g=s[u],y=s[f];g.y>r.y!=y.y>r.y&&r.x<(y.x-g.x)*(r.y-g.y)/(y.y-g.y)+g.x&&(a=!a)}return a}function cp(s,r,a,u,f){for(const y of s)if(r<=y.x&&a<=y.y&&u>=y.x&&f>=y.y)return!0;const g=[new $(r,a),new $(r,f),new $(u,f),new $(u,a)];if(s.length>2)for(const y of g)if(Gl(s,y))return!0;for(let y=0;y<s.length-1;y++)if(ig(s[y],s[y+1],g))return!0;return!1}function ig(s,r,a){const u=a[0],f=a[2];if(s.x<u.x&&r.x<u.x||s.x>f.x&&r.x>f.x||s.y<u.y&&r.y<u.y||s.y>f.y&&r.y>f.y)return!1;const g=Bn(s,r,a[0]);return g!==Bn(s,r,a[1])||g!==Bn(s,r,a[2])||g!==Bn(s,r,a[3])}function wc(s,r,a){const u=r.paint.get(s).value;return"constant"===u.kind?u.value:a.programConfigurations.get(r.id).getMaxValue(s)}function Ih(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function og(s,r,a,u,f){if(!r[0]&&!r[1])return s;const g=$.convert(r)._mult(f);"viewport"===a&&g._rotate(-u);const y=[];for(let x=0;x<s.length;x++)y.push(s[x].sub(g));return y}function sg(s,r,a,u){const f=$.convert(s)._mult(u);return"viewport"===r&&f._rotate(-a),f}$t(sp,{omit:["layers"]});const $y=new B({"circle-sort-key":new M($e.layout_circle["circle-sort-key"])});var Gy={paint:new B({"circle-radius":new M($e.paint_circle["circle-radius"]),"circle-color":new M($e.paint_circle["circle-color"]),"circle-blur":new M($e.paint_circle["circle-blur"]),"circle-opacity":new M($e.paint_circle["circle-opacity"]),"circle-translate":new T($e.paint_circle["circle-translate"]),"circle-translate-anchor":new T($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new T($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new T($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new M($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new M($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new M($e.paint_circle["circle-stroke-opacity"])}),layout:$y},up=1e-6,Si="undefined"!=typeof Float32Array?Float32Array:Array;function wu(){var s=new Si(9);return Si!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function ka(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function ag(s,r,a){var u=r[0],f=r[1],g=r[2],y=r[3],x=r[4],E=r[5],D=r[6],I=r[7],A=r[8],k=r[9],F=r[10],V=r[11],Z=r[12],ee=r[13],le=r[14],ve=r[15],Pe=a[0],Re=a[1],Le=a[2],Fe=a[3];return s[0]=Pe*u+Re*x+Le*A+Fe*Z,s[1]=Pe*f+Re*E+Le*k+Fe*ee,s[2]=Pe*g+Re*D+Le*F+Fe*le,s[3]=Pe*y+Re*I+Le*V+Fe*ve,s[4]=(Pe=a[4])*u+(Re=a[5])*x+(Le=a[6])*A+(Fe=a[7])*Z,s[5]=Pe*f+Re*E+Le*k+Fe*ee,s[6]=Pe*g+Re*D+Le*F+Fe*le,s[7]=Pe*y+Re*I+Le*V+Fe*ve,s[8]=(Pe=a[8])*u+(Re=a[9])*x+(Le=a[10])*A+(Fe=a[11])*Z,s[9]=Pe*f+Re*E+Le*k+Fe*ee,s[10]=Pe*g+Re*D+Le*F+Fe*le,s[11]=Pe*y+Re*I+Le*V+Fe*ve,s[12]=(Pe=a[12])*u+(Re=a[13])*x+(Le=a[14])*A+(Fe=a[15])*Z,s[13]=Pe*f+Re*E+Le*k+Fe*ee,s[14]=Pe*g+Re*D+Le*F+Fe*le,s[15]=Pe*y+Re*I+Le*V+Fe*ve,s}function Eu(s,r,a){var u,f,g,y,x,E,D,I,A,k,F,V,Z=a[0],ee=a[1],le=a[2];return r===s?(s[12]=r[0]*Z+r[4]*ee+r[8]*le+r[12],s[13]=r[1]*Z+r[5]*ee+r[9]*le+r[13],s[14]=r[2]*Z+r[6]*ee+r[10]*le+r[14],s[15]=r[3]*Z+r[7]*ee+r[11]*le+r[15]):(f=r[1],g=r[2],y=r[3],x=r[4],E=r[5],D=r[6],I=r[7],A=r[8],k=r[9],F=r[10],V=r[11],s[0]=u=r[0],s[1]=f,s[2]=g,s[3]=y,s[4]=x,s[5]=E,s[6]=D,s[7]=I,s[8]=A,s[9]=k,s[10]=F,s[11]=V,s[12]=u*Z+x*ee+A*le+r[12],s[13]=f*Z+E*ee+k*le+r[13],s[14]=g*Z+D*ee+F*le+r[14],s[15]=y*Z+I*ee+V*le+r[15]),s}function Ec(s,r,a){var u=a[0],f=a[1],g=a[2];return s[0]=r[0]*u,s[1]=r[1]*u,s[2]=r[2]*u,s[3]=r[3]*u,s[4]=r[4]*f,s[5]=r[5]*f,s[6]=r[6]*f,s[7]=r[7]*f,s[8]=r[8]*g,s[9]=r[9]*g,s[10]=r[10]*g,s[11]=r[11]*g,s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15],s}function lg(s,r,a){var u=Math.sin(a),f=Math.cos(a),g=r[4],y=r[5],x=r[6],E=r[7],D=r[8],I=r[9],A=r[10],k=r[11];return r!==s&&(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[4]=g*f+D*u,s[5]=y*f+I*u,s[6]=x*f+A*u,s[7]=E*f+k*u,s[8]=D*f-g*u,s[9]=I*f-y*u,s[10]=A*f-x*u,s[11]=k*f-E*u,s}function cg(s,r,a){var u=Math.sin(a),f=Math.cos(a),g=r[0],y=r[1],x=r[2],E=r[3],D=r[8],I=r[9],A=r[10],k=r[11];return r!==s&&(s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=g*f-D*u,s[1]=y*f-I*u,s[2]=x*f-A*u,s[3]=E*f-k*u,s[8]=g*u+D*f,s[9]=y*u+I*f,s[10]=x*u+A*f,s[11]=E*u+k*f,s}Math.hypot||(Math.hypot=function(){for(var s=0,r=arguments.length;r--;)s+=arguments[r]*arguments[r];return Math.sqrt(s)});var ug=ag;function hp(){var s=new Si(3);return Si!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function hg(s){var r=new Si(3);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r}function dg(s){return Math.hypot(s[0],s[1],s[2])}function Ah(s,r,a){var u=new Si(3);return u[0]=s,u[1]=r,u[2]=a,u}function Hy(s,r,a){return s[0]=r[0]+a[0],s[1]=r[1]+a[1],s[2]=r[2]+a[2],s}function fg(s,r,a){return s[0]=r[0]-a[0],s[1]=r[1]-a[1],s[2]=r[2]-a[2],s}function Ph(s,r,a){return s[0]=r[0]*a[0],s[1]=r[1]*a[1],s[2]=r[2]*a[2],s}function Gd(s,r,a){return s[0]=Math.min(r[0],a[0]),s[1]=Math.min(r[1],a[1]),s[2]=Math.min(r[2],a[2]),s}function Ws(s,r,a){return s[0]=Math.max(r[0],a[0]),s[1]=Math.max(r[1],a[1]),s[2]=Math.max(r[2],a[2]),s}function dl(s,r,a){return s[0]=r[0]*a,s[1]=r[1]*a,s[2]=r[2]*a,s}function Hd(s,r,a,u){return s[0]=r[0]+a[0]*u,s[1]=r[1]+a[1]*u,s[2]=r[2]+a[2]*u,s}function Cu(s,r){var a=r[0],u=r[1],f=r[2],g=a*a+u*u+f*f;return g>0&&(g=1/Math.sqrt(g)),s[0]=r[0]*g,s[1]=r[1]*g,s[2]=r[2]*g,s}function Tu(s,r){return s[0]*r[0]+s[1]*r[1]+s[2]*r[2]}function qy(s,r,a){var u=r[0],f=r[1],g=r[2],y=a[0],x=a[1],E=a[2];return s[0]=f*E-g*x,s[1]=g*y-u*E,s[2]=u*x-f*y,s}function Du(s,r,a){var u=r[0],f=r[1],g=r[2],y=a[3]*u+a[7]*f+a[11]*g+a[15];return s[0]=(a[0]*u+a[4]*f+a[8]*g+a[12])/(y=y||1),s[1]=(a[1]*u+a[5]*f+a[9]*g+a[13])/y,s[2]=(a[2]*u+a[6]*f+a[10]*g+a[14])/y,s}function Zy(s,r,a){var u=a[0],f=a[1],g=a[2],y=r[0],x=r[1],E=r[2],D=f*E-g*x,I=g*y-u*E,A=u*x-f*y,k=f*A-g*I,F=g*D-u*A,V=u*I-f*D,Z=2*a[3];return I*=Z,A*=Z,F*=2,V*=2,s[0]=y+(D*=Z)+(k*=2),s[1]=x+I+F,s[2]=E+A+V,s}var Cc,Hl=fg,dp=Ph,Eb=dg;function kh(s,r,a){var u=r[0],f=r[1],g=r[2],y=r[3];return s[0]=a[0]*u+a[4]*f+a[8]*g+a[12]*y,s[1]=a[1]*u+a[5]*f+a[9]*g+a[13]*y,s[2]=a[2]*u+a[6]*f+a[10]*g+a[14]*y,s[3]=a[3]*u+a[7]*f+a[11]*g+a[15]*y,s}function fp(){var s=new Si(4);return Si!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function pg(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function mg(s,r,a){a*=.5;var u=r[0],f=r[1],g=r[2],y=r[3],x=Math.sin(a),E=Math.cos(a);return s[0]=u*E+y*x,s[1]=f*E+g*x,s[2]=g*E-f*x,s[3]=y*E-u*x,s}hp(),Cc=new Si(4),Si!=Float32Array&&(Cc[0]=0,Cc[1]=0,Cc[2]=0,Cc[3]=0),hp(),Ah(1,0,0),Ah(0,1,0),fp(),fp(),wu();class pp{constructor(r,a){this.points=r,this.planes=a}static fromInvProjectionMatrix(r,a,u,f){const g=Math.pow(2,u),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const D=kh([],E,r),I=1/D[3]/a*g;return(A=D)[0]=(k=D)[0]*(F=[I,I,f?1/D[3]:I,I])[0],A[1]=k[1]*F[1],A[2]=k[2]*F[2],A[3]=k[3]*F[3],A;var A,k,F}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const D=Cu([],qy([],Hl([],y[E[0]],y[E[1]]),Hl([],y[E[2]],y[E[1]]))),I=-Tu(D,y[E[1]]);return D.concat(I)});return new pp(y,x)}}class vs{constructor(r,a){this.min=r,this.max=a,this.center=dl([],Hy([],this.min,this.max),.5)}quadrant(r){const a=[r%2==0,r<2],u=hg(this.min),f=hg(this.max);for(let g=0;g<a.length;g++)u[g]=a[g]?this.min[g]:this.center[g],f[g]=a[g]?this.center[g]:this.max[g];return f[2]=this.max[2],new vs(u,f)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,a=this.max;return[[r[0],r[1],r[2]],[a[0],r[1],r[2]],[a[0],a[1],r[2]],[r[0],a[1],r[2]],[r[0],r[1],a[2]],[a[0],r[1],a[2]],[a[0],a[1],a[2]],[r[0],a[1],a[2]]]}intersects(r){const a=this.getCorners();let u=!0;for(let f=0;f<r.planes.length;f++){const g=r.planes[f];let y=0;for(let x=0;x<a.length;x++)y+=Tu(g,a[x])+g[3]>=0;if(0===y)return 0;y!==a.length&&(u=!1)}if(u)return 2;for(let f=0;f<3;f++){let g=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let x=0;x<r.points.length;x++){const E=r.points[x][f]-this.min[f];g=Math.min(g,E),y=Math.max(y,E)}if(y<0||g>this.max[f]-this.min[f])return 0}return 1}}function mp(s,r,a,u,f,g,y,x,E){if(g&&s.queryGeometry.isAboveHorizon)return!1;g&&(E*=s.pixelToTileUnitsFactor);for(const D of r)for(const I of D){const A=I.add(x),k=f&&a.elevation?a.elevation.exaggeration()*f.getElevationAt(A.x,A.y,!0):0,F=g?A:qd(A,k,u),V=g?s.tilespaceRays.map(ee=>Wy(ee,k)):s.queryGeometry.screenGeometry,Z=kh([],[I.x,I.y,k,1],u);if(!y&&g?E*=Z[3]/a.cameraToCenterDistance:y&&!g&&(E*=a.cameraToCenterDistance/Z[3]),Vy(V,F,E))return!0}return!1}function qd(s,r,a){const u=kh([],[s.x,s.y,r,1],a);return new $(u[0]/u[3],u[1]/u[3])}const gg=Ah(0,0,0),gp=Ah(0,0,1);function Wy(s,r){const a=hp();return gg[2]=r,s.intersectsPlane(gg,gp,a),new $(a[0],a[1])}class Mi extends sp{}function _g(s,{width:r,height:a},u,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==r*a*u)throw new RangeError("mismatched image size")}else f=new Uint8Array(r*a*u);return s.width=r,s.height=a,s.data=f,s}function yg(s,r,a){const{width:u,height:f}=r;u===s.width&&f===s.height||(Rh(s,r,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,u),height:Math.min(s.height,f)},a),s.width=u,s.height=f,s.data=r.data)}function Rh(s,r,a,u,f,g){if(0===f.width||0===f.height)return r;if(f.width>s.width||f.height>s.height||a.x>s.width-f.width||a.y>s.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>r.width||f.height>r.height||u.x>r.width-f.width||u.y>r.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const y=s.data,x=r.data;for(let E=0;E<f.height;E++){const D=((a.y+E)*s.width+a.x)*g,I=((u.y+E)*r.width+u.x)*g;for(let A=0;A<f.width*g;A++)x[I+A]=y[D+A]}return r}$t(Mi,{omit:["layers"]});class Ra{constructor(r,a){_g(this,r,1,a)}resize(r){yg(this,new Ra(r),1)}clone(){return new Ra({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,u,f,g){Rh(r,a,u,f,g,1)}}class is{constructor(r,a){_g(this,r,4,a)}resize(r){yg(this,new is(r),4)}replace(r,a){a?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new is({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,u,f,g){Rh(r,a,u,f,g,4)}}$t(Ra),$t(is);var Xy={paint:new B({"heatmap-radius":new M($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new M($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new T($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new L($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new T($e.paint_heatmap["heatmap-opacity"])})};function _p(s){const r={},a=s.resolution||256,u=s.clips?s.clips.length:1,f=s.image||new is({width:a,height:u}),g=(y,x,E)=>{r[s.evaluationKey]=E;const D=s.expression.evaluate(r);f.data[y+x+0]=Math.floor(255*D.r/D.a),f.data[y+x+1]=Math.floor(255*D.g/D.a),f.data[y+x+2]=Math.floor(255*D.b/D.a),f.data[y+x+3]=Math.floor(255*D.a)};if(s.clips)for(let y=0,x=0;y<u;++y,x+=4*a)for(let E=0,D=0;E<a;E++,D+=4){const I=E/(a-1),{start:A,end:k}=s.clips[y];g(x,D,A*(1-I)+k*I)}else for(let y=0,x=0;y<a;y++,x+=4)g(0,x,y/(a-1));return f}var Ky={paint:new B({"hillshade-illumination-direction":new T($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new T($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new T($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new T($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new T($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new T($e.paint_hillshade["hillshade-accent-color"])})};const Yy=_e([{name:"a_pos",components:2,type:"Int16"}],4),{members:Cb}=Yy;var yp=to,Oh=to;function to(s,r,a){a=a||2;var u,f,g,y,x,E,D,I=r&&r.length,A=I?r[0]*a:s.length,k=Zd(s,0,A,a,!0),F=[];if(!k||k.next===k.prev)return F;if(I&&(k=function(Z,ee,le,ve){var Pe,Re,Le,Fe=[];for(Pe=0,Re=ee.length;Pe<Re;Pe++)(Le=Zd(Z,ee[Pe]*ve,Pe<Re-1?ee[Pe+1]*ve:Z.length,ve,!1))===Le.next&&(Le.steiner=!0),Fe.push(tv(Le));for(Fe.sort(Qy),Pe=0;Pe<Fe.length;Pe++)le=fl(le=vg(Fe[Pe],le),le.next);return le}(s,r,k,a)),s.length>80*a){u=g=s[0],f=y=s[1];for(var V=a;V<A;V+=a)(x=s[V])<u&&(u=x),(E=s[V+1])<f&&(f=E),x>g&&(g=x),E>y&&(y=E);D=0!==(D=Math.max(g-u,y-f))?1/D:0}return Su(k,F,a,u,f,D),F}function Zd(s,r,a,u,f){var g,y;if(f===bp(s,r,a,u)>0)for(g=r;g<a;g+=u)y=Au(g,s[g],s[g+1],y);else for(g=a-u;g>=r;g-=u)y=Au(g,s[g],s[g+1],y);return y&&Mu(y,y.next)&&(Nh(y),y=y.next),y}function fl(s,r){if(!s)return s;r||(r=s);var a,u=s;do{if(a=!1,u.steiner||!Mu(u,u.next)&&0!==fi(u.prev,u,u.next))u=u.next;else{if(Nh(u),(u=r=u.prev)===u.next)break;a=!0}}while(a||u!==r);return r}function Su(s,r,a,u,f,g,y){if(s){!y&&g&&function(I,A,k,F){var V=I;do{null===V.z&&(V.z=Wd(V.x,V.y,A,k,F)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next}while(V!==I);V.prevZ.nextZ=null,V.prevZ=null,function(Z){var ee,le,ve,Pe,Re,Le,Fe,Ye,Qe=1;do{for(le=Z,Z=null,Re=null,Le=0;le;){for(Le++,ve=le,Fe=0,ee=0;ee<Qe&&(Fe++,ve=ve.nextZ);ee++);for(Ye=Qe;Fe>0||Ye>0&&ve;)0!==Fe&&(0===Ye||!ve||le.z<=ve.z)?(Pe=le,le=le.nextZ,Fe--):(Pe=ve,ve=ve.nextZ,Ye--),Re?Re.nextZ=Pe:Z=Pe,Pe.prevZ=Re,Re=Pe;le=ve}Re.nextZ=null,Qe*=2}while(Le>1)}(V)}(s,u,f,g);for(var x,E,D=s;s.prev!==s.next;)if(x=s.prev,E=s.next,g?Lh(s,u,f,g):So(s))r.push(x.i/a),r.push(s.i/a),r.push(E.i/a),Nh(s),s=E.next,D=E.next;else if((s=E)===D){y?1===y?Su(s=vp(fl(s),r,a),r,a,u,f,g,2):2===y&&Jy(s,r,a,u,f,g):Su(fl(s),r,a,u,f,g,1);break}}}function So(s){var r=s.prev,a=s,u=s.next;if(fi(r,a,u)>=0)return!1;for(var f=s.next.next;f!==s.prev;){if(Tc(r.x,r.y,a.x,a.y,u.x,u.y,f.x,f.y)&&fi(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Lh(s,r,a,u){var f=s.prev,g=s,y=s.next;if(fi(f,g,y)>=0)return!1;for(var x=f.x>g.x?f.x>y.x?f.x:y.x:g.x>y.x?g.x:y.x,E=f.y>g.y?f.y>y.y?f.y:y.y:g.y>y.y?g.y:y.y,D=Wd(f.x<g.x?f.x<y.x?f.x:y.x:g.x<y.x?g.x:y.x,f.y<g.y?f.y<y.y?f.y:y.y:g.y<y.y?g.y:y.y,r,a,u),I=Wd(x,E,r,a,u),A=s.prevZ,k=s.nextZ;A&&A.z>=D&&k&&k.z<=I;){if(A!==s.prev&&A!==s.next&&Tc(f.x,f.y,g.x,g.y,y.x,y.y,A.x,A.y)&&fi(A.prev,A,A.next)>=0||(A=A.prevZ,k!==s.prev&&k!==s.next&&Tc(f.x,f.y,g.x,g.y,y.x,y.y,k.x,k.y)&&fi(k.prev,k,k.next)>=0))return!1;k=k.nextZ}for(;A&&A.z>=D;){if(A!==s.prev&&A!==s.next&&Tc(f.x,f.y,g.x,g.y,y.x,y.y,A.x,A.y)&&fi(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;k&&k.z<=I;){if(k!==s.prev&&k!==s.next&&Tc(f.x,f.y,g.x,g.y,y.x,y.y,k.x,k.y)&&fi(k.prev,k,k.next)>=0)return!1;k=k.nextZ}return!0}function vp(s,r,a){var u=s;do{var f=u.prev,g=u.next.next;!Mu(f,g)&&xg(f,u,u.next,g)&&Fh(f,g)&&Fh(g,f)&&(r.push(f.i/a),r.push(u.i/a),r.push(g.i/a),Nh(u),Nh(u.next),u=s=g),u=u.next}while(u!==s);return fl(u)}function Jy(s,r,a,u,f,g){var y=s;do{for(var x=y.next.next;x!==y.prev;){if(y.i!==x.i&&nv(y,x)){var E=bg(y,x);return y=fl(y,y.next),E=fl(E,E.next),Su(y,r,a,u,f,g),void Su(E,r,a,u,f,g)}x=x.next}y=y.next}while(y!==s)}function Qy(s,r){return s.x-r.x}function vg(s,r){var a=function(g,y){var x,E=y,D=g.x,I=g.y,A=-1/0;do{if(I<=E.y&&I>=E.next.y&&E.next.y!==E.y){var k=E.x+(I-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(k<=D&&k>A){if(A=k,k===D){if(I===E.y)return E;if(I===E.next.y)return E.next}x=E.x<E.next.x?E:E.next}}E=E.next}while(E!==y);if(!x)return null;if(D===A)return x;var F,V=x,Z=x.x,ee=x.y,le=1/0;E=x;do{D>=E.x&&E.x>=Z&&D!==E.x&&Tc(I<ee?D:A,I,Z,ee,I<ee?A:D,I,E.x,E.y)&&(F=Math.abs(I-E.y)/(D-E.x),Fh(E,g)&&(F<le||F===le&&(E.x>x.x||E.x===x.x&&ev(x,E)))&&(x=E,le=F)),E=E.next}while(E!==V);return x}(s,r);if(!a)return r;var u=bg(a,s),f=fl(a,a.next);return fl(u,u.next),r===a?f:r}function ev(s,r){return fi(s.prev,s,r.prev)<0&&fi(r.next,s,s.next)<0}function Wd(s,r,a,u,f){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-a)*f)|s<<8))|s<<4))|s<<2))|s<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-u)*f)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function tv(s){var r=s,a=s;do{(r.x<a.x||r.x===a.x&&r.y<a.y)&&(a=r),r=r.next}while(r!==s);return a}function Tc(s,r,a,u,f,g,y,x){return(f-y)*(r-x)-(s-y)*(g-x)>=0&&(s-y)*(u-x)-(a-y)*(r-x)>=0&&(a-y)*(g-x)-(f-y)*(u-x)>=0}function nv(s,r){return s.next.i!==r.i&&s.prev.i!==r.i&&!function(a,u){var f=a;do{if(f.i!==a.i&&f.next.i!==a.i&&f.i!==u.i&&f.next.i!==u.i&&xg(f,f.next,a,u))return!0;f=f.next}while(f!==a);return!1}(s,r)&&(Fh(s,r)&&Fh(r,s)&&function(a,u){var f=a,g=!1,y=(a.x+u.x)/2,x=(a.y+u.y)/2;do{f.y>x!=f.next.y>x&&f.next.y!==f.y&&y<(f.next.x-f.x)*(x-f.y)/(f.next.y-f.y)+f.x&&(g=!g),f=f.next}while(f!==a);return g}(s,r)&&(fi(s.prev,s,r.prev)||fi(s,r.prev,r))||Mu(s,r)&&fi(s.prev,s,s.next)>0&&fi(r.prev,r,r.next)>0)}function fi(s,r,a){return(r.y-s.y)*(a.x-r.x)-(r.x-s.x)*(a.y-r.y)}function Mu(s,r){return s.x===r.x&&s.y===r.y}function xg(s,r,a,u){var f=Iu(fi(s,r,a)),g=Iu(fi(s,r,u)),y=Iu(fi(a,u,s)),x=Iu(fi(a,u,r));return f!==g&&y!==x||!(0!==f||!Xd(s,a,r))||!(0!==g||!Xd(s,u,r))||!(0!==y||!Xd(a,s,u))||!(0!==x||!Xd(a,r,u))}function Xd(s,r,a){return r.x<=Math.max(s.x,a.x)&&r.x>=Math.min(s.x,a.x)&&r.y<=Math.max(s.y,a.y)&&r.y>=Math.min(s.y,a.y)}function Iu(s){return s>0?1:s<0?-1:0}function Fh(s,r){return fi(s.prev,s,s.next)<0?fi(s,r,s.next)>=0&&fi(s,s.prev,r)>=0:fi(s,r,s.prev)<0||fi(s,s.next,r)<0}function bg(s,r){var a=new xp(s.i,s.x,s.y),u=new xp(r.i,r.x,r.y),f=s.next,g=r.prev;return s.next=r,r.prev=s,a.next=f,f.prev=a,u.next=a,a.prev=u,g.next=u,u.prev=g,u}function Au(s,r,a,u){var f=new xp(s,r,a);return u?(f.next=u.next,f.prev=u,u.next.prev=f,u.next=f):(f.prev=f,f.next=f),f}function Nh(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function xp(s,r,a){this.i=s,this.x=r,this.y=a,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function bp(s,r,a,u){for(var f=0,g=r,y=a-u;g<a;g+=u)f+=(s[y]-s[g])*(s[g+1]+s[y+1]),y=g;return f}function rv(s,r,a,u,f){wg(s,r,a||0,u||s.length-1,f||iv)}function wg(s,r,a,u,f){for(;u>a;){if(u-a>600){var g=u-a+1,y=r-a+1,x=Math.log(g),E=.5*Math.exp(2*x/3),D=.5*Math.sqrt(x*E*(g-E)/g)*(y-g/2<0?-1:1);wg(s,r,Math.max(a,Math.floor(r-y*E/g+D)),Math.min(u,Math.floor(r+(g-y)*E/g+D)),f)}var I=s[r],A=a,k=u;for(Pu(s,a,r),f(s[u],I)>0&&Pu(s,a,u);A<k;){for(Pu(s,A,k),A++,k--;f(s[A],I)<0;)A++;for(;f(s[k],I)>0;)k--}0===f(s[a],I)?Pu(s,a,k):Pu(s,++k,u),k<=r&&(a=k+1),r<=k&&(u=k-1)}}function Pu(s,r,a){var u=s[r];s[r]=s[a],s[a]=u}function iv(s,r){return s<r?-1:s>r?1:0}function wp(s,r){const a=s.length;if(a<=1)return[s];const u=[];let f,g;for(let y=0;y<a;y++){const x=sr(s[y]);0!==x&&(s[y].area=Math.abs(x),void 0===g&&(g=x<0),g===x<0?(f&&u.push(f),f=[s[y]]):f.push(s[y]))}if(f&&u.push(f),r>1)for(let y=0;y<u.length;y++)u[y].length<=r||(rv(u[y],r,1,u[y].length-1,ov),u[y]=u[y].slice(0,r));return u}function ov(s,r){return r.area-s.area}function Ep(s,r,a){const u=a.patternDependencies;let f=!1;for(const g of r){const y=g.paint.get(`${s}-pattern`);y.isConstant()||(f=!0);const x=y.constantOr(null);x&&(f=!0,u[x.to]=!0,u[x.from]=!0)}return f}function Cp(s,r,a,u,f){const g=f.patternDependencies;for(const y of r){const x=y.paint.get(`${s}-pattern`).value;if("constant"!==x.kind){let E=x.evaluate({zoom:u-1},a,{},f.availableImages),D=x.evaluate({zoom:u},a,{},f.availableImages),I=x.evaluate({zoom:u+1},a,{},f.availableImages);E=E&&E.name?E.name:E,D=D&&D.name?D.name:D,I=I&&I.name?I.name:I,g[E]=!0,g[D]=!0,g[I]=!0,a.patterns[y.id]={min:E,mid:D,max:I}}}return a}to.deviation=function(s,r,a,u){var f=r&&r.length,g=Math.abs(bp(s,0,f?r[0]*a:s.length,a));if(f)for(var y=0,x=r.length;y<x;y++)g-=Math.abs(bp(s,r[y]*a,y<x-1?r[y+1]*a:s.length,a));var E=0;for(y=0;y<u.length;y+=3){var D=u[y]*a,I=u[y+1]*a,A=u[y+2]*a;E+=Math.abs((s[D]-s[A])*(s[I+1]-s[D+1])-(s[D]-s[I])*(s[A+1]-s[D+1]))}return 0===g&&0===E?0:Math.abs((E-g)/g)},to.flatten=function(s){for(var r=s[0][0].length,a={vertices:[],holes:[],dimensions:r},u=0,f=0;f<s.length;f++){for(var g=0;g<s[f].length;g++)for(var y=0;y<r;y++)a.vertices.push(s[f][g][y]);f>0&&a.holes.push(u+=s[f-1].length)}return a},yp.default=Oh;class Kd{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new fe,this.indexArray=new Ke,this.indexArray2=new tn,this.programConfigurations=new xc(r.layers,r.zoom),this.segments=new li,this.segments2=new li,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=r.projection}populate(r,a,u,f){this.hasPattern=Ep("fill",this.layers,a);const g=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:x,id:E,index:D,sourceLayerIndex:I}of r){const A=this.layers[0]._featureFilter.needGeometry,k=jl(x,A);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom),k,u))continue;const F=g?g.evaluate(k,{},u,a.availableImages):void 0,V={id:E,properties:x.properties,type:x.type,sourceLayerIndex:I,index:D,geometry:A?k.geometry:Ul(x,u,f),patterns:{},sortKey:F};y.push(V)}g&&y.sort((x,E)=>x.sortKey-E.sortKey);for(const x of y){const{geometry:E,index:D,sourceLayerIndex:I}=x;if(this.hasPattern){const A=Cp("fill",this.layers,x,this.zoom,a);this.patternFeatures.push(A)}else this.addFeature(x,E,D,u,{},a.availableImages);a.featureIndex.insert(r[D].feature,E,D,I,this.index)}}update(r,a,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,u,f)}addFeatures(r,a,u,f,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,a,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Cb),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,a,u,f,g,y=[]){for(const x of wp(a,500)){let E=0;for(const V of x)E+=V.length;const D=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),I=D.vertexLength,A=[],k=[];for(const V of x){if(0===V.length)continue;V!==x[0]&&k.push(A.length/2);const Z=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),ee=Z.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(ee+V.length-1,ee),A.push(V[0].x),A.push(V[0].y);for(let le=1;le<V.length;le++)this.layoutVertexArray.emplaceBack(V[le].x,V[le].y),this.indexArray2.emplaceBack(ee+le-1,ee+le),A.push(V[le].x),A.push(V[le].y);Z.vertexLength+=V.length,Z.primitiveLength+=V.length}const F=yp(A,k);for(let V=0;V<F.length;V+=3)this.indexArray.emplaceBack(I+F[V],I+F[V+1],I+F[V+2]);D.vertexLength+=E,D.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,g,y,f)}}$t(Kd,{omit:["layers","patternFeatures"]});const sv=new B({"fill-sort-key":new M($e.layout_fill["fill-sort-key"])});var av={paint:new B({"fill-antialias":new T($e.paint_fill["fill-antialias"]),"fill-opacity":new M($e.paint_fill["fill-opacity"]),"fill-color":new M($e.paint_fill["fill-color"]),"fill-outline-color":new M($e.paint_fill["fill-outline-color"]),"fill-translate":new T($e.paint_fill["fill-translate"]),"fill-translate-anchor":new T($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new P($e.paint_fill["fill-pattern"])}),layout:sv};const ku=_e([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Oa=_e([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Tb=_e([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Db}=ku;var Tp=zh;function zh(s,r,a,u,f){this.properties={},this.extent=a,this.type=0,this._pbf=s,this._geometry=-1,this._keys=u,this._values=f,s.readFields(xs,this,r)}function xs(s,r,a){1==s?r.id=a.readVarint():2==s?function(u,f){for(var g=u.readVarint()+u.pos;u.pos<g;){var y=f._keys[u.readVarint()],x=f._values[u.readVarint()];f.properties[y]=x}}(a,r):3==s?r.type=a.readVarint():4==s&&(r._geometry=a.pos)}function Dp(s){for(var r,a,u=0,f=0,g=s.length,y=g-1;f<g;y=f++)u+=((a=s[y]).x-(r=s[f]).x)*(r.y+a.y);return u}zh.types=["Unknown","Point","LineString","Polygon"],zh.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var r,a=s.readVarint()+s.pos,u=1,f=0,g=0,y=0,x=[];s.pos<a;){if(f<=0){var E=s.readVarint();u=7&E,f=E>>3}if(f--,1===u||2===u)g+=s.readSVarint(),y+=s.readSVarint(),1===u&&(r&&x.push(r),r=[]),r.push(new $(g,y));else{if(7!==u)throw new Error("unknown command "+u);r&&r.push(r[0].clone())}}return r&&x.push(r),x},zh.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var r=s.readVarint()+s.pos,a=1,u=0,f=0,g=0,y=1/0,x=-1/0,E=1/0,D=-1/0;s.pos<r;){if(u<=0){var I=s.readVarint();a=7&I,u=I>>3}if(u--,1===a||2===a)(f+=s.readSVarint())<y&&(y=f),f>x&&(x=f),(g+=s.readSVarint())<E&&(E=g),g>D&&(D=g);else if(7!==a)throw new Error("unknown command "+a)}return[y,E,x,D]},zh.prototype.toGeoJSON=function(s,r,a){var u,f,g=this.extent*Math.pow(2,a),y=this.extent*s,x=this.extent*r,E=this.loadGeometry(),D=zh.types[this.type];function I(F){for(var V=0;V<F.length;V++){var Z=F[V];F[V]=[360*(Z.x+y)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(Z.y+x)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(u=0;u<E.length;u++)A[u]=E[u][0];I(E=A);break;case 2:for(u=0;u<E.length;u++)I(E[u]);break;case 3:for(E=function(F){var V=F.length;if(V<=1)return[F];for(var Z,ee,le=[],ve=0;ve<V;ve++){var Pe=Dp(F[ve]);0!==Pe&&(void 0===ee&&(ee=Pe<0),ee===Pe<0?(Z&&le.push(Z),Z=[F[ve]]):Z.push(F[ve]))}return Z&&le.push(Z),le}(E),u=0;u<E.length;u++)for(f=0;f<E[u].length;f++)I(E[u][f])}1===E.length?E=E[0]:D="Multi"+D;var k={type:"Feature",geometry:{type:D,coordinates:E},properties:this.properties};return"id"in this&&(k.id=this.id),k};var Yd=Eg;function Eg(s,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(Cg,this,r),this.length=this._features.length}function Cg(s,r,a){15===s?r.version=a.readVarint():1===s?r.name=a.readString():5===s?r.extent=a.readVarint():2===s?r._features.push(a.pos):3===s?r._keys.push(a.readString()):4===s&&r._values.push(function(u){for(var f=null,g=u.readVarint()+u.pos;u.pos<g;){var y=u.readVarint()>>3;f=1===y?u.readString():2===y?u.readFloat():3===y?u.readDouble():4===y?u.readVarint64():5===y?u.readVarint():6===y?u.readSVarint():7===y?u.readBoolean():null}return f}(a))}function Bh(s,r,a){if(3===s){var u=new Yd(a,a.readVarint()+a.pos);u.length&&(r[u.name]=u)}}Eg.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var r=this._pbf.readVarint()+this._pbf.pos;return new Tp(this._pbf,r,this.extent,this._keys,this._values)};var ql={VectorTile:function(s,r){this.layers=s.readFields(Bh,{},r)},VectorTileFeature:Tp,VectorTileLayer:Yd};function Vh(s,r,a,u){const f=[],g=0===u?(y,x,E,D,I,A)=>{y.push(new $(A,E+(A-x)/(D-x)*(I-E)))}:(y,x,E,D,I,A)=>{y.push(new $(x+(A-E)/(I-E)*(D-x),A))};for(const y of s){const x=[];for(const E of y){if(E.length<=2)continue;const D=[];for(let k=0;k<E.length-1;k++){const F=E[k].x,V=E[k].y,Z=E[k+1].x,ee=E[k+1].y,le=0===u?F:V,ve=0===u?Z:ee;le<r?ve>r&&g(D,F,V,Z,ee,r):le>a?ve<a&&g(D,F,V,Z,ee,a):D.push(E[k]),ve<r&&le>=r&&g(D,F,V,Z,ee,r),ve>a&&le<=a&&g(D,F,V,Z,ee,a)}let I=E[E.length-1];const A=0===u?I.x:I.y;A>=r&&A<=a&&D.push(I),D.length&&(I=D[D.length-1],D[0].x===I.x&&D[0].y===I.y||D.push(D[0]),x.push(D))}x.length&&f.push(x)}return f}const Sp=ql.VectorTileFeature.types,Mp=Math.pow(2,13);function Ru(s,r,a,u,f,g,y,x){s.emplaceBack((r<<1)+y,(a<<1)+g,(Math.floor(u*Mp)<<1)+f,Math.round(x))}function Jd(s,r,a){s.emplaceBack(r.x,r.y,r.z,16384*a[0],16384*a[1],16384*a[2])}class Dc{constructor(){this.acc=new $(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new $(r.x,r.y),this.max=new $(r.x,r.y))}append(r,a){this.currentPolyCount.edges++,this.acc._add(r);const u=this.min,f=this.max;r.x<u.x?u.x=r.x:r.x>f.x&&(f.x=r.x),r.y<u.y?u.y=r.y:r.y>f.y&&(f.y=r.y),((0===r.x||r.x===In)&&r.x===a.x)!=((0===r.y||r.y===In)&&r.y===a.y)&&this.processBorderOverlap(r,a),a.x<0!=r.x<0&&this.addBorderIntersection(0,Pt(a.y,r.y,(0-a.x)/(r.x-a.x))),a.x>In!=r.x>In&&this.addBorderIntersection(1,Pt(a.y,r.y,(In-a.x)/(r.x-a.x))),a.y<0!=r.y<0&&this.addBorderIntersection(2,Pt(a.x,r.x,(0-a.y)/(r.y-a.y))),a.y>In!=r.y>In&&this.addBorderIntersection(3,Pt(a.x,r.x,(In-a.y)/(r.y-a.y)))}addBorderIntersection(r,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[r];a<u[0]&&(u[0]=a),a>u[1]&&(u[1]=a)}processBorderOverlap(r,a){if(r.x===a.x){if(r.y===a.y)return;const u=0===r.x?0:1;this.addBorderIntersection(u,a.y),this.addBorderIntersection(u,r.y)}else{const u=0===r.y?2:3;this.addBorderIntersection(u,a.x),this.addBorderIntersection(u,r.x)}}centroid(){const r=this.polyCount.reduce((a,u)=>a+u.edges,0);return 0!==r?this.acc.div(r)._round():new $(0,0)}span(){return new $(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,a)=>r+ +(a[0]!==Number.MAX_VALUE),0)}}class Sc{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new xe,this.centroidVertexArray=new To,this.indexArray=new Ke,this.programConfigurations=new xc(r.layers,r.zoom),this.segments=new li,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.enableTerrain=r.enableTerrain}populate(r,a,u,f){this.features=[],this.hasPattern=Ep("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(g){const y=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*y/(y*y+1)/In/(1<<g.z)}(u);for(const{feature:g,id:y,index:x,sourceLayerIndex:E}of r){const D=this.layers[0]._featureFilter.needGeometry,I=jl(g,D);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom),I,u))continue;const A={id:y,sourceLayerIndex:E,index:x,geometry:D?I.geometry:Ul(g,u,f),properties:g.properties,type:g.type,patterns:{}},k=this.layoutVertexArray.length;this.hasPattern?this.features.push(Cp("fill-extrusion",this.layers,A,this.zoom,a)):this.addFeature(A,A.geometry,x,u,{},a.availableImages,f),a.featureIndex.insert(g,A.geometry,x,E,this.index,k)}this.sortBorders()}addFeatures(r,a,u,f,g){for(const y of this.features){const{geometry:x}=y;this.addFeature(y,x,y.index,a,u,f,g)}this.sortBorders()}update(r,a,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Db),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,Tb.members,!0))),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,Oa.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,a,u,f,g,y,x){const E=[new $(0,0),new $(In,In)],D=x.projection,I="globe"===D.name,A=this.enableTerrain&&!I?new Dc:null;I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ts);const k=wp(a,500);for(let Z=k.length-1;Z>=0;Z--){const ee=k[Z];(0===ee.length||(F=ee[0]).every(le=>le.x<=0)||F.every(le=>le.x>=In)||F.every(le=>le.y<=0)||F.every(le=>le.y>=In))&&k.splice(Z,1)}var F;let V;if(I){const ee=1<<f.z,le=Zs(f.x/ee),ve=Zs((f.x+1)/ee),Pe=Zi(f.y/ee),Re=Zi((f.y+1)/ee);V=function(Le,Fe,Ye,Qe,at=0,ft){const qe=[];if(!Le.length||!Ye||!Qe)return qe;const tt=(_n,cn)=>{for(const Wt of _n)qe.push({polygon:Wt,bounds:cn})},mt=Math.ceil(Math.log2(Ye)),Tt=Math.ceil(Math.log2(Qe)),wt=mt-Tt,St=[];for(let _n=0;_n<Math.abs(wt);_n++)St.push(wt>0?0:1);for(let _n=0;_n<Math.min(mt,Tt);_n++)St.push(0),St.push(1);let vn=Le;if(vn=Vh(vn,Fe[0].y-at,Fe[1].y+at,1),vn=Vh(vn,Fe[0].x-at,Fe[1].x+at,0),!vn.length)return qe;const Sn=[];for(St.length?Sn.push({polygons:vn,bounds:Fe,depth:0}):tt(vn,Fe);Sn.length;){const _n=Sn.pop(),cn=_n.depth,Wt=St[cn],zt=_n.bounds[0],Mn=_n.bounds[1],Hn=0===Wt?zt.x:zt.y,ei=0===Wt?Mn.x:Mn.y,xr=ft?ft(Wt,Hn,ei):.5*(Hn+ei),ti=Vh(_n.polygons,Hn-at,xr+at,Wt),Jn=Vh(_n.polygons,xr-at,ei+at,Wt);if(ti.length){const jn=[zt,new $(0===Wt?xr:Mn.x,1===Wt?xr:Mn.y)];St.length>cn+1?Sn.push({polygons:ti,bounds:jn,depth:cn+1}):tt(ti,jn)}if(Jn.length){const jn=[new $(0===Wt?xr:zt.x,1===Wt?xr:zt.y),Mn];St.length>cn+1?Sn.push({polygons:Jn,bounds:jn,depth:cn+1}):tt(Jn,jn)}}return qe}(k,E,Math.ceil((ve-le)/11.25),Math.ceil((Pe-Re)/11.25),1,(Le,Fe,Ye)=>{if(0===Le)return.5*(Fe+Ye);{const Qe=Zi((f.y+Fe/In)/ee);return(bc(.5*(Zi((f.y+Ye/In)/ee)+Qe))*ee-f.y)*In}})}else{V=[];for(const Z of k)V.push({polygon:Z,bounds:E})}for(const Z of V){const ee=Z.polygon;let le=0,ve=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let Ye=0;Ye<ee.length;Ye++){const Qe=ee[Ye];if(0===Qe.length)continue;le+=Qe.length;let at=0;A&&A.startRing(Qe[0]);for(let ft=0;ft<Qe.length;ft++){const qe=Qe[ft];if(ft>=1){const tt=Qe[ft-1];if(!Tg(qe,tt,Z.bounds)){A&&A.append(qe,tt),ve.vertexLength+4>li.MAX_VERTEX_ARRAY_LENGTH&&(ve=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const mt=qe.sub(tt)._perp(),Tt=mt.x/(Math.abs(mt.x)+Math.abs(mt.y)),wt=mt.y>0?1:0,St=tt.dist(qe);at+St>32768&&(at=0),Ru(this.layoutVertexArray,qe.x,qe.y,Tt,wt,0,0,at),Ru(this.layoutVertexArray,qe.x,qe.y,Tt,wt,0,1,at),at+=St,Ru(this.layoutVertexArray,tt.x,tt.y,Tt,wt,0,0,at),Ru(this.layoutVertexArray,tt.x,tt.y,Tt,wt,0,1,at);const vn=ve.vertexLength;if(this.indexArray.emplaceBack(vn,vn+2,vn+1),this.indexArray.emplaceBack(vn+1,vn+2,vn+3),ve.vertexLength+=4,ve.primitiveLength+=2,I){const Sn=this.layoutVertexExtArray,_n=D.projectTilePoint(qe.x,qe.y,f),cn=D.projectTilePoint(tt.x,tt.y,f),Wt=D.upVector(f,qe.x,qe.y),zt=D.upVector(f,tt.x,tt.y);Jd(Sn,_n,Wt),Jd(Sn,_n,Wt),Jd(Sn,cn,zt),Jd(Sn,cn,zt)}}}}}if(ve.vertexLength+le>li.MAX_VERTEX_ARRAY_LENGTH&&(ve=this.segments.prepareSegment(le,this.layoutVertexArray,this.indexArray)),"Polygon"!==Sp[r.type])continue;const Pe=[],Re=[],Le=ve.vertexLength;for(let Ye=0;Ye<ee.length;Ye++){const Qe=ee[Ye];if(0!==Qe.length){Qe!==ee[0]&&Re.push(Pe.length/2);for(let at=0;at<Qe.length;at++){const ft=Qe[at];Ru(this.layoutVertexArray,ft.x,ft.y,0,0,1,1,0),Pe.push(ft.x),Pe.push(ft.y),A&&A.currentPolyCount.top++,I&&Jd(this.layoutVertexExtArray,D.projectTilePoint(ft.x,ft.y,f),D.upVector(f,ft.x,ft.y))}}}const Fe=yp(Pe,Re);for(let Ye=0;Ye<Fe.length;Ye+=3)this.indexArray.emplaceBack(Le+Fe[Ye],Le+Fe[Ye+2],Le+Fe[Ye+1]);ve.primitiveLength+=Fe.length/3,ve.vertexLength+=le}if(A&&A.polyCount.length>0){if(A.borders){A.vertexArrayOffset=this.centroidVertexArray.length;const Z=A.borders,ee=this.featuresOnBorder.push(A)-1;for(let le=0;le<4;le++)Z[le][0]!==Number.MAX_VALUE&&this.borders[le].push(ee)}this.encodeCentroid(A.borders?void 0:A.centroid(),A)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,g,y,f)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((a,u)=>this.featuresOnBorder[a].borders[r][0]-this.featuresOnBorder[u].borders[r][0])}encodeCentroid(r,a,u=!0){let f,g;if(r)if(0!==r.y){const x=a.span()._mult(this.tileToMeter);f=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(x.x/10)),g=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else f=Math.ceil(7*(r.x+450)),g=0;else f=0,g=+u;let y=u?this.centroidVertexArray.length:a.vertexArrayOffset;for(const x of a.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let E=0;E<2*x.edges;E++)this.centroidVertexArray.emplace(y++,0,g),this.centroidVertexArray.emplace(y++,f,g);for(let E=0;E<x.top;E++)this.centroidVertexArray.emplace(y++,f,g)}}}function Tg(s,r,a){return s.x===r.x&&(s.x<a[0].x||s.x>a[1].x)||s.y===r.y&&(s.y<a[0].y||s.y>a[1].y)}$t(Sc,{omit:["layers","features"]}),$t(Dc);var lv={paint:new B({"fill-extrusion-opacity":new T($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new M($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new T($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new T($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new P($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new M($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new M($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new T($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Mc(s,r){return s.x*r.x+s.y*r.y}function Dg(s,r){if(1===s.length){let a=0;const u=r[a++];let f;for(;!f||u.equals(f);)if(f=r[a++],!f)return 1/0;for(;a<r.length;a++){const g=r[a],y=s[0],x=f.sub(u),E=g.sub(u),D=y.sub(u),I=Mc(x,x),A=Mc(x,E),k=Mc(E,E),F=Mc(D,x),V=Mc(D,E),Z=I*k-A*A,ee=(k*F-A*V)/Z,le=(I*V-A*F)/Z,ve=u.z*(1-ee-le)+f.z*ee+g.z*le;if(isFinite(ve))return ve}return 1/0}{let a=1/0;for(const u of r)a=Math.min(a,u.z);return a}}function Sg(s){const r=new $(s[0],s[1]);return r.z=s[2],r}function cv(s,r,a,u,f,g,y,x){const E=y*f.getElevationAt(s,r,!0,!0),D=0!==g[0],I=D?0===g[1]?y*(g[0]/7-450):y*function(A,k,F){const V=Math.floor(k[0]/8),Z=Math.floor(k[1]/8),ee=10*(k[0]-8*V),le=10*(k[1]-8*Z),ve=A.getElevationAt(V,Z,!0,!0),Pe=A.getMeterToDEM(F),Re=Math.floor(.5*(ee*Pe-1)),Le=Math.floor(.5*(le*Pe-1)),Fe=A.tileCoordToPixel(V,Z),Ye=2*Re+1,Qe=2*Le+1,at=(Sn=Ye,_n=Qe,[(wt=A).getElevationAtPixel(St=Fe.x-Re,vn=Fe.y-Le,!0),wt.getElevationAtPixel(St+_n,vn,!0),wt.getElevationAtPixel(St,vn+_n,!0),wt.getElevationAtPixel(St+Sn,vn+_n,!0)]),ft=Math.abs(at[0]-at[1]),qe=Math.abs(at[2]-at[3]),tt=Math.abs(at[0]-at[2])+Math.abs(at[1]-at[3]),mt=Math.min(.25,.5*Pe*(ft+qe)/Ye),Tt=Math.min(.25,.5*Pe*tt/Qe);var wt,St,vn,Sn,_n;return ve+Math.max(mt*ee,Tt*le)}(f,g,x):E;return{base:E+(0===a)?-1:a,top:D?Math.max(I+u,E+a+2):E+u}}const uv=_e([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:hv}=uv,dv=_e([{name:"a_packed",components:3,type:"Float32"}]),{members:Mg}=dv,Ip=ql.VectorTileFeature.types,Ig=Math.cos(Math.PI/180*37.5);class Ou{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new he,this.layoutVertexArray2=new Te,this.indexArray=new Ke,this.programConfigurations=new xc(r.layers,r.zoom),this.segments=new li,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,u,f){this.hasPattern=Ep("line",this.layers,a);const g=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:I,id:A,index:k,sourceLayerIndex:F}of r){const V=this.layers[0]._featureFilter.needGeometry,Z=jl(I,V);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom),Z,u))continue;const ee=g?g.evaluate(Z,{},u):void 0,le={id:A,properties:I.properties,type:I.type,sourceLayerIndex:F,index:k,geometry:V?Z.geometry:Ul(I,u,f),patterns:{},sortKey:ee};y.push(le)}g&&y.sort((I,A)=>I.sortKey-A.sortKey);const{lineAtlas:x,featureIndex:E}=a,D=this.addConstantDashes(x);for(const I of y){const{geometry:A,index:k,sourceLayerIndex:F}=I;if(D&&this.addFeatureDashes(I,x),this.hasPattern){const V=Cp("line",this.layers,I,this.zoom,a);this.patternFeatures.push(V)}else this.addFeature(I,A,k,u,x.positions,a.availableImages);E.insert(r[k].feature,A,k,F,this.index)}}addConstantDashes(r){let a=!1;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if("constant"!==f.kind||"constant"!==g.kind)a=!0;else{const y=g.value,x=f.value;if(!x)continue;r.addDash(x.from,y),r.addDash(x.to,y),x.other&&r.addDash(x.other,y)}}return a}addFeatureDashes(r,a){const u=this.zoom;for(const f of this.layers){const g=f.paint.get("line-dasharray").value,y=f.layout.get("line-cap").value;if("constant"===g.kind&&"constant"===y.kind)continue;let x,E,D,I,A,k;if("constant"===g.kind){const ee=g.value;if(!ee)continue;x=ee.other||ee.to,E=ee.to,D=ee.from}else x=g.evaluate({zoom:u-1},r),E=g.evaluate({zoom:u},r),D=g.evaluate({zoom:u+1},r);"constant"===y.kind?I=A=k=y.value:(I=y.evaluate({zoom:u-1},r),A=y.evaluate({zoom:u},r),k=y.evaluate({zoom:u+1},r)),a.addDash(x,I),a.addDash(E,A),a.addDash(D,k);const F=a.getKey(x,I),V=a.getKey(E,A),Z=a.getKey(D,k);r.patterns[f.id]={min:F,mid:V,max:Z}}}update(r,a,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,u,f)}addFeatures(r,a,u,f,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,a,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,Mg)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,hv),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,a,u,f,g,y){const x=this.layers[0].layout,E=x.get("line-join").evaluate(r,{}),D=x.get("line-cap").evaluate(r,{}),I=x.get("line-miter-limit"),A=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const k of a)this.addLine(k,r,E,D,I,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,g,y,f)}addLine(r,a,u,f,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let le=0;le<r.length-1;le++)this.totalDistance+=r[le].dist(r[le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===Ip[a.type];let E=r.length;for(;E>=2&&r[E-1].equals(r[E-2]);)E--;let D=0;for(;D<E-1&&r[D].equals(r[D+1]);)D++;if(E<(x?3:2))return;"bevel"===u&&(g=1.05);const I=this.overscaling<=16?122880/(512*this.overscaling):0,A=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let k,F,V,Z,ee;this.e1=this.e2=-1,x&&(k=r[E-2],ee=r[D].sub(k)._unit()._perp());for(let le=D;le<E;le++){if(V=le===E-1?x?r[D+1]:void 0:r[le+1],V&&r[le].equals(V))continue;ee&&(Z=ee),k&&(F=k),k=r[le],ee=V?V.sub(k)._unit()._perp():Z,Z=Z||ee;let ve=Z.add(ee);0===ve.x&&0===ve.y||ve._unit();const Pe=Z.x*ee.x+Z.y*ee.y,Re=ve.x*ee.x+ve.y*ee.y,Le=0!==Re?1/Re:1/0,Fe=2*Math.sqrt(2-2*Re),Ye=Re<Ig&&F&&V,Qe=Z.x*ee.y-Z.y*ee.x>0;if(Ye&&le>D){const qe=k.dist(F);if(qe>2*I){const tt=k.sub(k.sub(F)._mult(I/qe)._round());this.updateDistance(F,tt),this.addCurrentVertex(tt,Z,0,0,A),F=tt}}const at=F&&V;let ft=at?u:x?"butt":f;if(at&&"round"===ft&&(Le<y?ft="miter":Le<=2&&(ft="fakeround")),"miter"===ft&&Le>g&&(ft="bevel"),"bevel"===ft&&(Le>2&&(ft="flipbevel"),Le<g&&(ft="miter")),F&&this.updateDistance(F,k),"miter"===ft)ve._mult(Le),this.addCurrentVertex(k,ve,0,0,A);else if("flipbevel"===ft){if(Le>100)ve=ee.mult(-1);else{const qe=Le*Z.add(ee).mag()/Z.sub(ee).mag();ve._perp()._mult(qe*(Qe?-1:1))}this.addCurrentVertex(k,ve,0,0,A),this.addCurrentVertex(k,ve.mult(-1),0,0,A)}else if("bevel"===ft||"fakeround"===ft){const qe=-Math.sqrt(Le*Le-1),tt=Qe?qe:0,mt=Qe?0:qe;if(F&&this.addCurrentVertex(k,Z,tt,mt,A),"fakeround"===ft){const Tt=Math.round(180*Fe/Math.PI/20);for(let wt=1;wt<Tt;wt++){let St=wt/Tt;if(.5!==St){const Sn=St-.5;St+=St*Sn*(St-1)*((1.0904+Pe*(Pe*(3.55645-1.43519*Pe)-3.2452))*Sn*Sn+(.848013+Pe*(.215638*Pe-1.06021)))}const vn=ee.sub(Z)._mult(St)._add(Z)._unit()._mult(Qe?-1:1);this.addHalfVertex(k,vn.x,vn.y,!1,Qe,0,A)}}V&&this.addCurrentVertex(k,ee,-tt,-mt,A)}else if("butt"===ft)this.addCurrentVertex(k,ve,0,0,A);else if("square"===ft){const qe=F?1:-1;F||this.addCurrentVertex(k,ve,qe,qe,A),this.addCurrentVertex(k,ve,0,0,A),F&&this.addCurrentVertex(k,ve,qe,qe,A)}else"round"===ft&&(F&&(this.addCurrentVertex(k,Z,0,0,A),this.addCurrentVertex(k,Z,1,1,A,!0)),V&&(this.addCurrentVertex(k,ee,-1,-1,A,!0),this.addCurrentVertex(k,ee,0,0,A)));if(Ye&&le<E-1){const qe=k.dist(V);if(qe>2*I){const tt=k.add(V.sub(k)._mult(I/qe)._round());this.updateDistance(k,tt),this.addCurrentVertex(tt,ee,0,0,A),k=tt}}}}addCurrentVertex(r,a,u,f,g,y=!1){const x=a.y*f-a.x,E=-a.y-a.x*f;this.addHalfVertex(r,a.x+a.y*u,a.y-a.x*u,y,!1,u,g),this.addHalfVertex(r,x,E,y,!0,-f,g)}addHalfVertex({x:r,y:a},u,f,g,y,x,E){this.layoutVertexArray.emplaceBack((r<<1)+(g?1:0),(a<<1)+(y?1:0),Math.round(63*u)+128,Math.round(63*f)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const D=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),E.primitiveLength++),y?this.e2=D:this.e1=D}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,a){this.distance+=r.dist(a),this.updateScaledDistance()}}$t(Ou,{omit:["layers","patternFeatures"]});const fv=new B({"line-cap":new M($e.layout_line["line-cap"]),"line-join":new M($e.layout_line["line-join"]),"line-miter-limit":new T($e.layout_line["line-miter-limit"]),"line-round-limit":new T($e.layout_line["line-round-limit"]),"line-sort-key":new M($e.layout_line["line-sort-key"])});var Ag={paint:new B({"line-opacity":new M($e.paint_line["line-opacity"]),"line-color":new M($e.paint_line["line-color"]),"line-translate":new T($e.paint_line["line-translate"]),"line-translate-anchor":new T($e.paint_line["line-translate-anchor"]),"line-width":new M($e.paint_line["line-width"]),"line-gap-width":new M($e.paint_line["line-gap-width"]),"line-offset":new M($e.paint_line["line-offset"]),"line-blur":new M($e.paint_line["line-blur"]),"line-dasharray":new P($e.paint_line["line-dasharray"]),"line-pattern":new P($e.paint_line["line-pattern"]),"line-gradient":new L($e.paint_line["line-gradient"])}),layout:fv};const Ap=new class extends M{possiblyEvaluate(s,r){return r=new Rr(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(s,r)}evaluate(s,r,a,u){return r=it({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(s,r,a,u)}}(Ag.paint.properties["line-width"].specification);function Pp(s,r){return r>0?r+2*s:s}Ap.useIntegerZoom=!0;const Ic=_e([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),Pg=_e([{name:"a_projected_pos",components:3,type:"Float32"}],4);_e([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const kg=_e([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),pv=_e([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);_e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Uh=_e([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),mv=_e([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);_e([{name:"triangle",components:3,type:"Uint16"}]),_e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),_e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),_e([{type:"Float32",name:"offsetX"}]),_e([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const ua=128;function Qd(s,r){const{expression:a}=r;if("constant"===a.kind)return{kind:"constant",layoutSize:a.evaluate(new Rr(s+1))};if("source"===a.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:f}=a;let g=0;for(;g<u.length&&u[g]<=s;)g++;g=Math.max(0,g-1);let y=g;for(;y<u.length&&u[y]<s+1;)y++;y=Math.min(u.length-1,y);const x=u[g],E=u[y];return"composite"===a.kind?{kind:"composite",minZoom:x,maxZoom:E,interpolationType:f}:{kind:"camera",minZoom:x,maxZoom:E,minSize:a.evaluate(new Rr(x)),maxSize:a.evaluate(new Rr(E)),interpolationType:f}}}function Lu(s,{uSize:r,uSizeT:a},{lowerSize:u,upperSize:f}){return"source"===s.kind?u/ua:"composite"===s.kind?Pt(u/ua,f/ua,a):r}function Ac(s,r){let a=0,u=0;if("constant"===s.kind)u=s.layoutSize;else if("source"!==s.kind){const{interpolationType:f,minZoom:g,maxZoom:y}=s,x=f?J(Zr.interpolationFactor(f,r,g,y),0,1):0;"camera"===s.kind?u=Pt(s.minSize,s.maxSize,x):a=x}return{uSizeT:a,uSize:u}}var ef=Object.freeze({__proto__:null,getSizeData:Qd,evaluateSizeForFeature:Lu,evaluateSizeForZoom:Ac,SIZE_PACK_FACTOR:ua});function tf(s,r,a){return s.sections.forEach(u=>{u.text=function(f,g,y){const x=g.layout.get("text-transform").evaluate(y,{});return"uppercase"===x?f=f.toLocaleUpperCase():"lowercase"===x&&(f=f.toLocaleLowerCase()),fo.applyArabicShaping&&(f=fo.applyArabicShaping(f)),f}(u.text,r,a)}),s}const Fu={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function kp(s){return"\ufe36"===s||"\ufe48"===s||"\ufe38"===s||"\ufe44"===s||"\ufe42"===s||"\ufe3e"===s||"\ufe3c"===s||"\ufe3a"===s||"\ufe18"===s||"\ufe40"===s||"\ufe10"===s||"\ufe13"===s||"\ufe14"===s||"\uff40"===s||"\uffe3"===s||"\ufe11"===s||"\ufe12"===s}function Rg(s){return"\ufe35"===s||"\ufe47"===s||"\ufe37"===s||"\ufe43"===s||"\ufe41"===s||"\ufe3d"===s||"\ufe3b"===s||"\ufe39"===s||"\ufe17"===s||"\ufe3f"===s}var nf=function(s,r,a,u,f){var g,y,x=8*f-u-1,E=(1<<x)-1,D=E>>1,I=-7,A=a?f-1:0,k=a?-1:1,F=s[r+A];for(A+=k,g=F&(1<<-I)-1,F>>=-I,I+=x;I>0;g=256*g+s[r+A],A+=k,I-=8);for(y=g&(1<<-I)-1,g>>=-I,I+=u;I>0;y=256*y+s[r+A],A+=k,I-=8);if(0===g)g=1-D;else{if(g===E)return y?NaN:1/0*(F?-1:1);y+=Math.pow(2,u),g-=D}return(F?-1:1)*y*Math.pow(2,g-u)},Nu=function(s,r,a,u,f,g){var y,x,E,D=8*g-f-1,I=(1<<D)-1,A=I>>1,k=23===f?Math.pow(2,-24)-Math.pow(2,-77):0,F=u?0:g-1,V=u?1:-1,Z=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(x=isNaN(r)?1:0,y=I):(y=Math.floor(Math.log(r)/Math.LN2),r*(E=Math.pow(2,-y))<1&&(y--,E*=2),(r+=y+A>=1?k/E:k*Math.pow(2,1-A))*E>=2&&(y++,E/=2),y+A>=I?(x=0,y=I):y+A>=1?(x=(r*E-1)*Math.pow(2,f),y+=A):(x=r*Math.pow(2,A-1)*Math.pow(2,f),y=0));f>=8;s[a+F]=255&x,F+=V,x/=256,f-=8);for(y=y<<f|x,D+=f;D>0;s[a+F]=255&y,F+=V,y/=256,D-=8);s[a+F-V]|=128*Z},jh=Ar;function Ar(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Ar.Varint=0,Ar.Fixed64=1,Ar.Bytes=2,Ar.Fixed32=5;var Rp=4294967296,Og=1/Rp,Op="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function ha(s){return s.type===Ar.Bytes?s.readVarint()+s.pos:s.pos+1}function gv(s,r,a){var u=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));a.realloc(u);for(var f=a.pos-1;f>=s;f--)a.buf[f+u]=a.buf[f]}function Lg(s,r){for(var a=0;a<s.length;a++)r.writeVarint(s[a])}function _v(s,r){for(var a=0;a<s.length;a++)r.writeSVarint(s[a])}function Fg(s,r){for(var a=0;a<s.length;a++)r.writeFloat(s[a])}function yv(s,r){for(var a=0;a<s.length;a++)r.writeDouble(s[a])}function vv(s,r){for(var a=0;a<s.length;a++)r.writeBoolean(s[a])}function da(s,r){for(var a=0;a<s.length;a++)r.writeFixed32(s[a])}function xv(s,r){for(var a=0;a<s.length;a++)r.writeSFixed32(s[a])}function Ng(s,r){for(var a=0;a<s.length;a++)r.writeFixed64(s[a])}function bv(s,r){for(var a=0;a<s.length;a++)r.writeSFixed64(s[a])}function rf(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+16777216*s[r+3]}function zu(s,r,a){s[a]=r,s[a+1]=r>>>8,s[a+2]=r>>>16,s[a+3]=r>>>24}function zg(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+(s[r+3]<<24)}function Bg(s,r,a){r.glyphs=[],1===s&&a.readMessage(wv,r)}function wv(s,r,a){if(3===s){const{id:u,bitmap:f,width:g,height:y,left:x,top:E,advance:D}=a.readMessage(Ev,{});r.glyphs.push({id:u,bitmap:new Ra({width:g+6,height:y+6},f),metrics:{width:g,height:y,left:x,top:E,advance:D}})}else 4===s?r.ascender=a.readSVarint():5===s&&(r.descender=a.readSVarint())}function Ev(s,r,a){1===s?r.id=a.readVarint():2===s?r.bitmap=a.readBytes():3===s?r.width=a.readVarint():4===s?r.height=a.readVarint():5===s?r.left=a.readSVarint():6===s?r.top=a.readSVarint():7===s&&(r.advance=a.readVarint())}function Lp(s){let r=0,a=0;for(const y of s)r+=y.w*y.h,a=Math.max(a,y.w);s.sort((y,x)=>x.h-y.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),a),h:1/0}];let f=0,g=0;for(const y of s)for(let x=u.length-1;x>=0;x--){const E=u[x];if(!(y.w>E.w||y.h>E.h)){if(y.x=E.x,y.y=E.y,g=Math.max(g,y.y+y.h),f=Math.max(f,y.x+y.w),y.w===E.w&&y.h===E.h){const D=u.pop();x<u.length&&(u[x]=D)}else y.h===E.h?(E.x+=y.w,E.w-=y.w):y.w===E.w?(E.y+=y.h,E.h-=y.h):(u.push({x:E.x+y.w,y:E.y,w:E.w-y.w,h:y.h}),E.y+=y.h,E.h-=y.h);break}}return{w:f,h:g,fill:r/(f*g)||0}}Ar.prototype={destroy:function(){this.buf=null},readFields:function(s,r,a){for(a=a||this.length;this.pos<a;){var u=this.readVarint(),f=u>>3,g=this.pos;this.type=7&u,s(f,r,this),this.pos===g&&this.skip(u)}return r},readMessage:function(s,r){return this.readFields(s,r,this.readVarint()+this.pos)},readFixed32:function(){var s=rf(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=zg(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=rf(this.buf,this.pos)+rf(this.buf,this.pos+4)*Rp;return this.pos+=8,s},readSFixed64:function(){var s=rf(this.buf,this.pos)+zg(this.buf,this.pos+4)*Rp;return this.pos+=8,s},readFloat:function(){var s=nf(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=nf(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var r,a,u=this.buf;return r=127&(a=u[this.pos++]),a<128?r:(r|=(127&(a=u[this.pos++]))<<7,a<128?r:(r|=(127&(a=u[this.pos++]))<<14,a<128?r:(r|=(127&(a=u[this.pos++]))<<21,a<128?r:function(f,g,y){var x,E,D=y.buf;if(x=(112&(E=D[y.pos++]))>>4,E<128||(x|=(127&(E=D[y.pos++]))<<3,E<128)||(x|=(127&(E=D[y.pos++]))<<10,E<128)||(x|=(127&(E=D[y.pos++]))<<17,E<128)||(x|=(127&(E=D[y.pos++]))<<24,E<128)||(x|=(1&(E=D[y.pos++]))<<31,E<128))return function Pc(s,r,a){return a?4294967296*r+(s>>>0):4294967296*(r>>>0)+(s>>>0)}(f,x,g);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(a=u[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var s=this.readVarint()+this.pos,r=this.pos;return this.pos=s,s-r>=12&&Op?Op.decode(this.buf.subarray(r,s)):function(a,u,f){for(var g="",y=u;y<f;){var x,E,D,I=a[y],A=null,k=I>239?4:I>223?3:I>191?2:1;if(y+k>f)break;1===k?I<128&&(A=I):2===k?128==(192&(x=a[y+1]))&&(A=(31&I)<<6|63&x)<=127&&(A=null):3===k?(E=a[y+2],128==(192&(x=a[y+1]))&&128==(192&E)&&((A=(15&I)<<12|(63&x)<<6|63&E)<=2047||A>=55296&&A<=57343)&&(A=null)):4===k&&(E=a[y+2],D=a[y+3],128==(192&(x=a[y+1]))&&128==(192&E)&&128==(192&D)&&((A=(15&I)<<18|(63&x)<<12|(63&E)<<6|63&D)<=65535||A>=1114112)&&(A=null)),null===A?(A=65533,k=1):A>65535&&(A-=65536,g+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),g+=String.fromCharCode(A),y+=k}return g}(this.buf,r,s)},readBytes:function(){var s=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,s);return this.pos=s,r},readPackedVarint:function(s,r){if(this.type!==Ar.Bytes)return s.push(this.readVarint(r));var a=ha(this);for(s=s||[];this.pos<a;)s.push(this.readVarint(r));return s},readPackedSVarint:function(s){if(this.type!==Ar.Bytes)return s.push(this.readSVarint());var r=ha(this);for(s=s||[];this.pos<r;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Ar.Bytes)return s.push(this.readBoolean());var r=ha(this);for(s=s||[];this.pos<r;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Ar.Bytes)return s.push(this.readFloat());var r=ha(this);for(s=s||[];this.pos<r;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Ar.Bytes)return s.push(this.readDouble());var r=ha(this);for(s=s||[];this.pos<r;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Ar.Bytes)return s.push(this.readFixed32());var r=ha(this);for(s=s||[];this.pos<r;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Ar.Bytes)return s.push(this.readSFixed32());var r=ha(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Ar.Bytes)return s.push(this.readFixed64());var r=ha(this);for(s=s||[];this.pos<r;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Ar.Bytes)return s.push(this.readSFixed64());var r=ha(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed64());return s},skip:function(s){var r=7&s;if(r===Ar.Varint)for(;this.buf[this.pos++]>127;);else if(r===Ar.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Ar.Fixed32)this.pos+=4;else{if(r!==Ar.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(s,r){this.writeVarint(s<<3|r)},realloc:function(s){for(var r=this.length||16;r<this.pos+s;)r*=2;if(r!==this.length){var a=new Uint8Array(r);a.set(this.buf),this.buf=a,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),zu(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),zu(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),zu(this.buf,-1&s,this.pos),zu(this.buf,Math.floor(s*Og),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),zu(this.buf,-1&s,this.pos),zu(this.buf,Math.floor(s*Og),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(r,a){var u,f,g,x;if(r>=0?(u=r%4294967296|0,f=r/4294967296|0):(f=~(-r/4294967296),4294967295^(u=~(-r%4294967296))?u=u+1|0:(u=0,f=f+1|0)),r>=0x10000000000000000||r<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),g=u,(x=a).buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,x.buf[x.pos]=127&(g>>>=7),function(g,y){var x=(7&g)<<4;y.buf[y.pos++]|=x|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(f,a)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(Boolean(s))},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var r=this.pos;this.pos=function(u,f,g){for(var y,x,E=0;E<f.length;E++){if((y=f.charCodeAt(E))>55295&&y<57344){if(!x){y>56319||E+1===f.length?(u[g++]=239,u[g++]=191,u[g++]=189):x=y;continue}if(y<56320){u[g++]=239,u[g++]=191,u[g++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(u[g++]=239,u[g++]=191,u[g++]=189,x=null);y<128?u[g++]=y:(y<2048?u[g++]=y>>6|192:(y<65536?u[g++]=y>>12|224:(u[g++]=y>>18|240,u[g++]=y>>12&63|128),u[g++]=y>>6&63|128),u[g++]=63&y|128)}return g}(this.buf,s,this.pos);var a=this.pos-r;a>=128&&gv(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeFloat:function(s){this.realloc(4),Nu(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Nu(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var r=s.length;this.writeVarint(r),this.realloc(r);for(var a=0;a<r;a++)this.buf[this.pos++]=s[a]},writeRawMessage:function(s,r){this.pos++;var a=this.pos;s(r,this);var u=this.pos-a;u>=128&&gv(a,u,this),this.pos=a-1,this.writeVarint(u),this.pos+=u},writeMessage:function(s,r,a){this.writeTag(s,Ar.Bytes),this.writeRawMessage(r,a)},writePackedVarint:function(s,r){r.length&&this.writeMessage(s,Lg,r)},writePackedSVarint:function(s,r){r.length&&this.writeMessage(s,_v,r)},writePackedBoolean:function(s,r){r.length&&this.writeMessage(s,vv,r)},writePackedFloat:function(s,r){r.length&&this.writeMessage(s,Fg,r)},writePackedDouble:function(s,r){r.length&&this.writeMessage(s,yv,r)},writePackedFixed32:function(s,r){r.length&&this.writeMessage(s,da,r)},writePackedSFixed32:function(s,r){r.length&&this.writeMessage(s,xv,r)},writePackedFixed64:function(s,r){r.length&&this.writeMessage(s,Ng,r)},writePackedSFixed64:function(s,r){r.length&&this.writeMessage(s,bv,r)},writeBytesField:function(s,r){this.writeTag(s,Ar.Bytes),this.writeBytes(r)},writeFixed32Field:function(s,r){this.writeTag(s,Ar.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(s,r){this.writeTag(s,Ar.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(s,r){this.writeTag(s,Ar.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(s,r){this.writeTag(s,Ar.Fixed64),this.writeSFixed64(r)},writeVarintField:function(s,r){this.writeTag(s,Ar.Varint),this.writeVarint(r)},writeSVarintField:function(s,r){this.writeTag(s,Ar.Varint),this.writeSVarint(r)},writeStringField:function(s,r){this.writeTag(s,Ar.Bytes),this.writeString(r)},writeFloatField:function(s,r){this.writeTag(s,Ar.Fixed32),this.writeFloat(r)},writeDoubleField:function(s,r){this.writeTag(s,Ar.Fixed64),this.writeDouble(r)},writeBooleanField:function(s,r){this.writeVarintField(s,Boolean(r))}};class Gn{constructor(r,{pixelRatio:a,version:u,stretchX:f,stretchY:g,content:y}){this.paddedRect=r,this.pixelRatio=a,this.stretchX=f,this.stretchY=g,this.content=y,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class fa{constructor(r,a){const u={},f={};this.haveRenderCallbacks=[];const g=[];this.addImages(r,u,g),this.addImages(a,f,g);const{w:y,h:x}=Lp(g),E=new is({width:y||1,height:x||1});for(const D in r){const I=r[D],A=u[D].paddedRect;is.copy(I.data,E,{x:0,y:0},{x:A.x+1,y:A.y+1},I.data)}for(const D in a){const I=a[D],A=f[D].paddedRect,k=A.x+1,F=A.y+1,V=I.data.width,Z=I.data.height;is.copy(I.data,E,{x:0,y:0},{x:k,y:F},I.data),is.copy(I.data,E,{x:0,y:Z-1},{x:k,y:F-1},{width:V,height:1}),is.copy(I.data,E,{x:0,y:0},{x:k,y:F+Z},{width:V,height:1}),is.copy(I.data,E,{x:V-1,y:0},{x:k-1,y:F},{width:1,height:Z}),is.copy(I.data,E,{x:0,y:0},{x:k+V,y:F},{width:1,height:Z})}this.image=E,this.iconPositions=u,this.patternPositions=f}addImages(r,a,u){for(const f in r){const g=r[f],y={x:0,y:0,w:g.data.width+2,h:g.data.height+2};u.push(y),a[f]=new Gn(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(r,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>r.hasImage(u)),r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in r.updatedImages)this.patchUpdatedImage(this.iconPositions[u],r.getImage(u),a),this.patchUpdatedImage(this.patternPositions[u],r.getImage(u),a)}patchUpdatedImage(r,a,u){if(!r||!a||r.version===a.version)return;r.version=a.version;const[f,g]=r.tl;u.update(a.data,void 0,{x:f,y:g})}}$t(Gn),$t(fa);const os={horizontal:1,vertical:2,horizontalOnly:3};class Bu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,a){const u=new Bu;return u.scale=r||1,u.fontStack=a,u}static forImage(r){const a=new Bu;return a.imageName=r,a}}class pl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,a){const u=new pl;for(let f=0;f<r.sections.length;f++){const g=r.sections[f];g.image?u.addImageSection(g):u.addTextSection(g,a)}return u}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(a,u){let f="";for(let g=0;g<a.length;g++){const y=a.charCodeAt(g+1)||null,x=a.charCodeAt(g-1)||null;f+=!u&&(y&&nl(y)&&!Fu[a[g+1]]||x&&nl(x)&&!Fu[a[g-1]])||!Fu[a[g]]?a[g]:Fu[a[g]]}return f}(this.text,r)}trim(){let r=0;for(let u=0;u<this.text.length&&$h[this.text.charCodeAt(u)];u++)r++;let a=this.text.length;for(let u=this.text.length-1;u>=0&&u>=r&&$h[this.text.charCodeAt(u)];u--)a--;this.text=this.text.substring(r,a),this.sectionIndex=this.sectionIndex.slice(r,a)}substring(r,a){const u=new pl;return u.text=this.text.substring(r,a),u.sectionIndex=this.sectionIndex.slice(r,a),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,a)=>Math.max(r,this.sections[a].scale),0)}addTextSection(r,a){this.text+=r.text,this.sections.push(Bu.forText(r.scale,r.fontStack||a));const u=this.sections.length-1;for(let f=0;f<r.text.length;++f)this.sectionIndex.push(u)}addImageSection(r){const a=r.image?r.image.name:"";if(0===a.length)return void hn("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(Bu.forImage(a)),this.sectionIndex.push(this.sections.length-1)):hn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function bs(s,r,a,u,f,g,y,x,E,D,I,A,k,F,V,Z){const ee=pl.fromFeature(s,f);let le;A===os.vertical&&ee.verticalizePunctuation(k);const{processBidirectionalText:ve,processStyledBidirectionalText:Pe}=fo;if(ve&&1===ee.sections.length){le=[];const Fe=ve(ee.toString(),Vg(ee,D,g,r,u,F,V));for(const Ye of Fe){const Qe=new pl;Qe.text=Ye,Qe.sections=ee.sections;for(let at=0;at<Ye.length;at++)Qe.sectionIndex.push(0);le.push(Qe)}}else if(Pe){le=[];const Fe=Pe(ee.text,ee.sectionIndex,Vg(ee,D,g,r,u,F,V));for(const Ye of Fe){const Qe=new pl;Qe.text=Ye[0],Qe.sectionIndex=Ye[1],Qe.sections=ee.sections,le.push(Qe)}}else le=function(Fe,Ye){const Qe=[],at=Fe.text;let ft=0;for(const qe of Ye)Qe.push(Fe.substring(ft,qe)),ft=qe;return ft<at.length&&Qe.push(Fe.substring(ft,at.length)),Qe}(ee,Vg(ee,D,g,r,u,F,V));const Re=[],Le={positionedLines:Re,text:ee.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Fe,Ye,Qe,at,ft,qe,tt,mt,Tt,wt,St,vn){let Sn=0,_n=0,cn=0;const Wt="right"===mt?1:"left"===mt?0:.5;let zt=!1;for(const Jn of ft){const jn=Jn.getSections();for(const hr of jn){if(hr.imageName)continue;const Or=Ye[hr.fontStack];if(Or&&(zt=void 0!==Or.ascender&&void 0!==Or.descender,!zt))break}if(!zt)break}let Mn=0;for(const Jn of ft){Jn.trim();const jn=Jn.getMaxScale(),hr=24*(jn-1),Or={positionedGlyphs:[],lineOffset:0};Fe.positionedLines[Mn]=Or;const Nr=Or.positionedGlyphs;let ni=0;if(!Jn.length()){_n+=qe,++Mn;continue}let Ii=0,Vo=0;for(let Dr=0;Dr<Jn.length();Dr++){const go=Jn.getSection(Dr),Uo=Jn.getSectionIndex(Dr),Ni=Jn.getCharCode(Dr);let Ai=go.scale,Gr=null,zr=null,jo=null,Ao=24,pi=0;const _o=!(Tt===os.horizontal||!St&&!tl(Ni)||St&&($h[Ni]||(Hn=Ni,lh(Hn)||oa(Hn)||No(Hn)||Hi(Hn)||gu(Hn))));if(go.imageName){const yo=at[go.imageName];if(!yo)continue;jo=go.imageName,Fe.iconsInText=Fe.iconsInText||!0,zr=yo.paddedRect;const zi=yo.displaySize;Ai=24*Ai/vn,Gr={width:zi[0],height:zi[1],left:1,top:-3,advance:_o?zi[1]:zi[0],localGlyph:!1},pi=zt?-Gr.height*Ai:24*jn-17-zi[1]*Ai,Ao=Gr.advance;const Ds=(_o?zi[0]:zi[1])*Ai-24*jn;Ds>0&&Ds>ni&&(ni=Ds)}else{const yo=Qe[go.fontStack];if(!yo)continue;yo[Ni]&&(zr=yo[Ni]);const zi=Ye[go.fontStack];if(!zi)continue;const Ds=zi.glyphs[Ni];if(!Ds)continue;if(Gr=Ds.metrics,Ao=8203!==Ni?24:0,zt){const Jl=void 0!==zi.ascender?Math.abs(zi.ascender):0,Hu=void 0!==zi.descender?Math.abs(zi.descender):0,td=(Jl+Hu)*Ai;Ii<td&&(Ii=td,Vo=(Jl-Hu)/2*Ai),pi=-Jl*Ai}else pi=24*(jn-Ai)-17}_o?(Fe.verticalizable=!0,Nr.push({glyph:Ni,imageName:jo,x:Sn,y:_n+pi,vertical:_o,scale:Ai,localGlyph:Gr.localGlyph,fontStack:go.fontStack,sectionIndex:Uo,metrics:Gr,rect:zr}),Sn+=Ao*Ai+wt):(Nr.push({glyph:Ni,imageName:jo,x:Sn,y:_n+pi,vertical:_o,scale:Ai,localGlyph:Gr.localGlyph,fontStack:go.fontStack,sectionIndex:Uo,metrics:Gr,rect:zr}),Sn+=Gr.advance*Ai+wt)}0!==Nr.length&&(cn=Math.max(Sn-wt,cn),zt?Tv(Nr,Wt,ni,Vo,qe*jn/2):Tv(Nr,Wt,ni,0,qe/2)),Sn=0;const Io=qe*jn+ni;Or.lineOffset=Math.max(ni,hr),_n+=Io,++Mn}var Hn;const ei=_n,{horizontalAlign:xr,verticalAlign:ti}=af(tt);(function(Jn,jn,hr,Or,Nr,ni){const Ii=(jn-hr)*Nr,Vo=-ni*Or;for(const Io of Jn)for(const Dr of Io.positionedGlyphs)Dr.x+=Ii,Dr.y+=Vo})(Fe.positionedLines,Wt,xr,ti,cn,ei),Fe.top+=-ti*ei,Fe.bottom=Fe.top+ei,Fe.left+=-xr*cn,Fe.right=Fe.left+cn,Fe.hasBaseline=zt}(Le,r,a,u,le,y,x,E,A,D,k,Z),!function(Fe){for(const Ye of Fe)if(0!==Ye.positionedGlyphs.length)return!1;return!0}(Re)&&Le}const $h={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Cv={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function of(s,r,a,u,f,g){if(r.imageName){const y=u[r.imageName];return y?y.displaySize[0]*r.scale*24/g+f:0}{const y=a[r.fontStack],x=y&&y.glyphs[s];return x?x.metrics.advance*r.scale+f:0}}function La(s,r,a,u){const f=Math.pow(s-r,2);return u?s<r?f/2:2*f:f+Math.abs(a)*a}function Fp(s,r,a){let u=0;return 10===s&&(u-=1e4),a&&(u+=150),40!==s&&65288!==s||(u+=50),41!==r&&65289!==r||(u+=50),u}function Np(s,r,a,u,f,g){let y=null,x=La(r,a,f,g);for(const E of u){const D=La(r-E.x,a,f,g)+E.badness;D<=x&&(y=E,x=D)}return{index:s,x:r,priorBreak:y,badness:x}}function sf(s){return s?sf(s.priorBreak).concat(s.index):[]}function Vg(s,r,a,u,f,g,y){if("point"!==g)return[];if(!s)return[];const x=[],E=function(k,F,V,Z,ee,le){let ve=0;for(let Pe=0;Pe<k.length();Pe++){const Re=k.getSection(Pe);ve+=of(k.getCharCode(Pe),Re,Z,ee,F,le)}return ve/Math.max(1,Math.ceil(ve/V))}(s,r,a,u,f,y),D=s.text.indexOf("\u200b")>=0;let I=0;for(let k=0;k<s.length();k++){const F=s.getSection(k),V=s.getCharCode(k);if($h[V]||(I+=of(V,F,u,f,r,y)),k<s.length()-1){const Z=!((A=V)<11904||!(fu(A)||dh(A)||$r(A)||_c(A)||fh(A)||ch(A)||Od(A)||du(A)||ph(A)||mu(A)||mc(A)||gh(A)||el(A)||hh(A)||uh(A)||pu(A)||Ll(A)||sa(A)||gc(A)||mh(A)));(Cv[V]||Z||F.imageName)&&x.push(Np(k+1,I,E,x,Fp(V,s.getCharCode(k+1),Z&&D),!1))}}var A;return sf(Np(s.length(),I,E,x,0,!0))}function af(s){let r=.5,a=.5;switch(s){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:r,verticalAlign:a}}function Tv(s,r,a,u,f){if(!(r||a||u||f))return;const g=s.length-1,y=s[g],x=(y.x+y.metrics.advance*y.scale)*r;for(let E=0;E<=g;E++)s[E].x-=x,s[E].y+=a+u+f}function lf(s,r,a){const{horizontalAlign:u,verticalAlign:f}=af(a),g=r[0]-s.displaySize[0]*u,y=r[1]-s.displaySize[1]*f;return{image:s,top:y,bottom:y+s.displaySize[1],left:g,right:g+s.displaySize[0]}}function Gh(s,r,a,u,f,g){const y=s.image;let x;if(y.content){const ee=y.content,le=y.pixelRatio||1;x=[ee[0]/le,ee[1]/le,y.displaySize[0]-ee[2]/le,y.displaySize[1]-ee[3]/le]}const E=r.left*g,D=r.right*g;let I,A,k,F;"width"===a||"both"===a?(F=f[0]+E-u[3],A=f[0]+D+u[1]):(F=f[0]+(E+D-y.displaySize[0])/2,A=F+y.displaySize[0]);const V=r.top*g,Z=r.bottom*g;return"height"===a||"both"===a?(I=f[1]+V-u[0],k=f[1]+Z+u[2]):(I=f[1]+(V+Z-y.displaySize[1])/2,k=I+y.displaySize[1]),{image:y,top:I,right:A,bottom:k,left:F,collisionPadding:x}}class pa extends ${constructor(r,a,u,f,g){super(r,a),this.angle=f,this.z=u,void 0!==g&&(this.segment=g)}clone(){return new pa(this.x,this.y,this.z,this.angle,this.segment)}}function cf(s,r,a,u,f){if(void 0===r.segment)return!0;let g=r,y=r.segment+1,x=0;for(;x>-a/2;){if(y--,y<0)return!1;x-=s[y].dist(g),g=s[y]}x+=s[y].dist(s[y+1]),y++;const E=[];let D=0;for(;x<a/2;){const I=s[y],A=s[y+1];if(!A)return!1;let k=s[y-1].angleTo(I)-I.angleTo(A);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:x,angleDelta:k}),D+=k;x-E[0].distance>u;)D-=E.shift().angleDelta;if(D>f)return!1;y++,x+=I.dist(A)}return!0}function uf(s){let r=0;for(let a=0;a<s.length-1;a++)r+=s[a].dist(s[a+1]);return r}function Dv(s,r,a){return s?.6*r*a:0}function Ug(s,r){return Math.max(s?s.right-s.left:0,r?r.right-r.left:0)}function Sv(s,r,a,u,f,g){const y=Dv(a,f,g),x=Ug(a,u)*g;let E=0;const D=uf(s)/2;for(let I=0;I<s.length-1;I++){const A=s[I],k=s[I+1],F=A.dist(k);if(E+F>D){const V=(D-E)/F,Z=Pt(A.x,k.x,V),ee=Pt(A.y,k.y,V),le=new pa(Z,ee,0,k.angleTo(A),I);return!y||cf(s,le,x,y,r)?le:void 0}E+=F}}function Mv(s,r,a,u,f,g,y,x,E){const D=Dv(u,g,y),I=Ug(u,f),A=I*y,k=0===s[0].x||s[0].x===E||0===s[0].y||s[0].y===E;return r-A<r/4&&(r=A+r/4),jg(s,k?r/2*x%r:(I/2+2*g)*y*x%r,r,D,a,A,k,!1,E)}function jg(s,r,a,u,f,g,y,x,E){const D=g/2,I=uf(s);let A=0,k=r-a,F=[];for(let V=0;V<s.length-1;V++){const Z=s[V],ee=s[V+1],le=Z.dist(ee),ve=ee.angleTo(Z);for(;k+a<A+le;){k+=a;const Pe=(k-A)/le,Re=Pt(Z.x,ee.x,Pe),Le=Pt(Z.y,ee.y,Pe);if(Re>=0&&Re<E&&Le>=0&&Le<E&&k-D>=0&&k+D<=I){const Fe=new pa(Re,Le,0,ve,V);Fe._round(),u&&!cf(s,Fe,g,u,f)||F.push(Fe)}}A+=le}return x||F.length||y||(F=jg(s,A/2,a,u,f,g,y,!0,E)),F}function zp(s,r,a,u,f){const g=[];for(let y=0;y<s.length;y++){const x=s[y];let E;for(let D=0;D<x.length-1;D++){let I=x[D],A=x[D+1];I.x<r&&A.x<r||(I.x<r?I=new $(r,I.y+(r-I.x)/(A.x-I.x)*(A.y-I.y))._round():A.x<r&&(A=new $(r,I.y+(r-I.x)/(A.x-I.x)*(A.y-I.y))._round()),I.y<a&&A.y<a||(I.y<a?I=new $(I.x+(a-I.y)/(A.y-I.y)*(A.x-I.x),a)._round():A.y<a&&(A=new $(I.x+(a-I.y)/(A.y-I.y)*(A.x-I.x),a)._round()),I.x>=u&&A.x>=u||(I.x>=u?I=new $(u,I.y+(u-I.x)/(A.x-I.x)*(A.y-I.y))._round():A.x>=u&&(A=new $(u,I.y+(u-I.x)/(A.x-I.x)*(A.y-I.y))._round()),I.y>=f&&A.y>=f||(I.y>=f?I=new $(I.x+(f-I.y)/(A.y-I.y)*(A.x-I.x),f)._round():A.y>=f&&(A=new $(I.x+(f-I.y)/(A.y-I.y)*(A.x-I.x),f)._round()),E&&I.equals(E[E.length-1])||(E=[I],g.push(E)),E.push(A)))))}}return g}$t(pa);const hf=1e20;function $g(s,r,a,u,f,g,y,x,E){for(let D=r;D<r+u;D++)Iv(s,a*g+D,g,f,y,x,E);for(let D=a;D<a+f;D++)Iv(s,D*g+r,1,u,y,x,E)}function Iv(s,r,a,u,f,g,y){g[0]=0,y[0]=-hf,y[1]=hf,f[0]=s[r];for(let x=1,E=0,D=0;x<u;x++){f[x]=s[r+x*a];const I=x*x;do{const A=g[E];D=(f[x]-f[A]+I-A*A)/(x-A)/2}while(D<=y[E]&&--E>-1);E++,g[E]=x,y[E]=D,y[E+1]=hf}for(let x=0,E=0;x<u;x++){for(;y[E+1]<x;)E++;const D=g[E],I=x-D;s[r+x*a]=f[D]+I*I}}const df={none:0,ideographs:1,all:2};class kc{constructor(r,a,u){this.requestManager=r,this.localGlyphMode=a,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,a){const u=[];for(const f in r)for(const g of r[f])u.push({stack:f,id:g});Be(u,({stack:f,id:g},y)=>{let x=this.entries[f];x||(x=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=x.glyphs[g];if(void 0!==E)return void y(null,{stack:f,id:g,glyph:E});if(E=this._tinySDF(x,f,g),E)return x.glyphs[g]=E,void y(null,{stack:f,id:g,glyph:E});const D=Math.floor(g/256);if(256*D>65535)return void y(new Error("glyphs > 65535 not supported"));if(x.ranges[D])return void y(null,{stack:f,id:g,glyph:E});let I=x.requests[D];I||(I=x.requests[D]=[],kc.loadGlyphRange(f,D,this.url,this.requestManager,(A,k)=>{if(k){x.ascender=k.ascender,x.descender=k.descender;for(const F in k.glyphs)this._doesCharSupportLocalGlyph(+F)||(x.glyphs[+F]=k.glyphs[+F]);x.ranges[D]=!0}for(const F of I)F(A,k);delete x.requests[D]})),I.push((A,k)=>{A?y(A):k&&y(null,{stack:f,id:g,glyph:k.glyphs[g]||null})})},(f,g)=>{if(f)a(f);else if(g){const y={};for(const{stack:x,id:E,glyph:D}of g)void 0===y[x]&&(y[x]={}),void 0===y[x].glyphs&&(y[x].glyphs={}),y[x].glyphs[E]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},y[x].ascender=this.entries[x].ascender,y[x].descender=this.entries[x].descender;a(null,y)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==df.none&&(this.localGlyphMode===df.all?!!this.localFontFamily:!!this.localFontFamily&&(mu(r)||Ld(r)||el(r)||Ll(r)||du(r)))}_tinySDF(r,a,u){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(u))return;let g=r.tinySDF;if(!g){let Z="400";/bold/i.test(a)?Z="900":/medium/i.test(a)?Z="500":/light/i.test(a)&&(Z="200"),g=r.tinySDF=new kc.TinySDF({fontFamily:f,fontWeight:Z,fontSize:48,buffer:6,radius:16}),g.fontWeight=Z}if(this.localGlyphs[g.fontWeight][u])return this.localGlyphs[g.fontWeight][u];const y=String.fromCharCode(u),{data:x,width:E,height:D,glyphWidth:I,glyphHeight:A,glyphLeft:k,glyphTop:F,glyphAdvance:V}=g.draw(y);return this.localGlyphs[g.fontWeight][u]={id:u,bitmap:new Ra({width:E,height:D},x),metrics:{width:I/2,height:A/2,left:k/2,top:F/2-27,advance:V/2,localGlyph:!0}}}}function Gg(s,r,a,u){const f=[],g=s.image,y=g.pixelRatio,x=g.paddedRect.w-2,E=g.paddedRect.h-2,D=s.right-s.left,I=s.bottom-s.top,A=g.stretchX||[[0,x]],k=g.stretchY||[[0,E]],F=(qe,tt)=>qe+tt[1]-tt[0],V=A.reduce(F,0),Z=k.reduce(F,0),ee=x-V,le=E-Z;let ve=0,Pe=V,Re=0,Le=Z,Fe=0,Ye=ee,Qe=0,at=le;if(g.content&&u){const qe=g.content;ve=Vu(A,0,qe[0]),Re=Vu(k,0,qe[1]),Pe=Vu(A,qe[0],qe[2]),Le=Vu(k,qe[1],qe[3]),Fe=qe[0]-ve,Qe=qe[1]-Re,Ye=qe[2]-qe[0]-Pe,at=qe[3]-qe[1]-Le}const ft=(qe,tt,mt,Tt)=>{const wt=Bp(qe.stretch-ve,Pe,D,s.left),St=Vp(qe.fixed-Fe,Ye,qe.stretch,V),vn=Bp(tt.stretch-Re,Le,I,s.top),Sn=Vp(tt.fixed-Qe,at,tt.stretch,Z),_n=Bp(mt.stretch-ve,Pe,D,s.left),cn=Vp(mt.fixed-Fe,Ye,mt.stretch,V),Wt=Bp(Tt.stretch-Re,Le,I,s.top),zt=Vp(Tt.fixed-Qe,at,Tt.stretch,Z),Mn=new $(wt,vn),Hn=new $(_n,vn),ei=new $(_n,Wt),xr=new $(wt,Wt),ti=new $(St/y,Sn/y),Jn=new $(cn/y,zt/y),jn=r*Math.PI/180;if(jn){const Nr=Math.sin(jn),ni=Math.cos(jn),Ii=[ni,-Nr,Nr,ni];Mn._matMult(Ii),Hn._matMult(Ii),xr._matMult(Ii),ei._matMult(Ii)}const hr=qe.stretch+qe.fixed,Or=tt.stretch+tt.fixed;return{tl:Mn,tr:Hn,bl:xr,br:ei,tex:{x:g.paddedRect.x+1+hr,y:g.paddedRect.y+1+Or,w:mt.stretch+mt.fixed-hr,h:Tt.stretch+Tt.fixed-Or},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ti,pixelOffsetBR:Jn,minFontScaleX:Ye/y/D,minFontScaleY:at/y/I,isSDF:a}};if(u&&(g.stretchX||g.stretchY)){const qe=Av(A,ee,V),tt=Av(k,le,Z);for(let mt=0;mt<qe.length-1;mt++){const Tt=qe[mt],wt=qe[mt+1];for(let St=0;St<tt.length-1;St++)f.push(ft(Tt,tt[St],wt,tt[St+1]))}}else f.push(ft({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:E+1}));return f}function Vu(s,r,a){let u=0;for(const f of s)u+=Math.max(r,Math.min(a,f[1]))-Math.max(r,Math.min(a,f[0]));return u}function Av(s,r,a){const u=[{fixed:-1,stretch:0}];for(const[f,g]of s){const y=u[u.length-1];u.push({fixed:f-y.stretch,stretch:y.stretch}),u.push({fixed:f-y.stretch,stretch:y.stretch+(g-f)})}return u.push({fixed:r+1,stretch:a}),u}function Bp(s,r,a,u){return s/r*a+u}function Vp(s,r,a,u){return s-r*a/u}function Sb(s,r,a,u){const f=r+s.positionedLines[u].lineOffset;return 0===u?a+f/2:a+(f+(r+s.positionedLines[u-1].lineOffset))/2}kc.loadGlyphRange=function(s,r,a,u,f){const g=256*r,y=g+255,x=u.transformRequest(u.normalizeGlyphsURL(a).replace("{fontstack}",s).replace("{range}",`${g}-${y}`),ne.Glyphs);se(x,(E,D)=>{if(E)f(E);else if(D){const I={},A=new jh(D).readFields(Bg,{});for(const k of A.glyphs)I[k.id]=k;f(null,{glyphs:I,ascender:A.ascender,descender:A.descender})}})},kc.TinySDF=class{constructor({fontSize:s=24,buffer:r=3,radius:a=8,cutoff:u=.25,fontFamily:f="sans-serif",fontWeight:g="normal",fontStyle:y="normal"}){this.buffer=r,this.cutoff=u,this.radius=a;const x=this.size=s+4*r,E=this._createCanvas(x),D=this.ctx=E.getContext("2d",{willReadFrequently:!0});D.font=`${y} ${g} ${s}px ${f}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(s){const r=document.createElement("canvas");return r.width=r.height=s,r}draw(s){const{width:r,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:f,actualBoundingBoxRight:g}=this.ctx.measureText(s),y=Math.floor(a),x=Math.min(this.size-this.buffer,Math.ceil(g-f)),E=Math.min(this.size-this.buffer,Math.ceil(a)+Math.ceil(u)),D=x+2*this.buffer,I=E+2*this.buffer,A=D*I,k=new Uint8ClampedArray(A),F={data:k,width:D,height:I,glyphWidth:x,glyphHeight:E,glyphTop:y,glyphLeft:0,glyphAdvance:r};if(0===x||0===E)return F;const{ctx:V,buffer:Z,gridInner:ee,gridOuter:le}=this;V.clearRect(Z,Z,x,E),V.fillText(s,Z,Z+y+1);const ve=V.getImageData(Z,Z,x,E);le.fill(hf,0,A),ee.fill(0,0,A);for(let Pe=0;Pe<E;Pe++)for(let Re=0;Re<x;Re++){const Le=ve.data[4*(Pe*x+Re)+3]/255;if(0===Le)continue;const Fe=(Pe+Z)*D+Re+Z;if(1===Le)le[Fe]=0,ee[Fe]=hf;else{const Ye=.5-Le;le[Fe]=Ye>0?Ye*Ye:0,ee[Fe]=Ye<0?Ye*Ye:0}}$g(le,0,0,D,I,D,this.f,this.v,this.z),$g(ee,Z,Z,x,E,D,this.f,this.v,this.z);for(let Pe=0;Pe<A;Pe++){const Re=Math.sqrt(le[Pe])-Math.sqrt(ee[Pe]);k[Pe]=Math.round(255-255*(Re/this.radius+this.cutoff))}return F}};class Mb{constructor(r=[],a=Ib){if(this.data=r,this.length=this.data.length,this.compare=a,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const r=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:a,compare:u}=this,f=a[r];for(;r>0;){const g=r-1>>1,y=a[g];if(u(f,y)>=0)break;a[r]=y,r=g}a[r]=f}_down(r){const{data:a,compare:u}=this,f=this.length>>1,g=a[r];for(;r<f;){let y=1+(r<<1),x=a[y];const E=y+1;if(E<this.length&&u(a[E],x)<0&&(y=E,x=a[E]),u(x,g)>=0)break;a[r]=x,r=y}a[r]=g}}function Ib(s,r){return s<r?-1:s>r?1:0}function Ab(s,r=1,a=!1){let u=1/0,f=1/0,g=-1/0,y=-1/0;const x=s[0];for(let F=0;F<x.length;F++){const V=x[F];(!F||V.x<u)&&(u=V.x),(!F||V.y<f)&&(f=V.y),(!F||V.x>g)&&(g=V.x),(!F||V.y>y)&&(y=V.y)}const E=Math.min(g-u,y-f);let D=E/2;const I=new Mb([],Pb);if(0===E)return new $(u,f);for(let F=u;F<g;F+=E)for(let V=f;V<y;V+=E)I.push(new Hh(F+D,V+D,D,s));let A=function(F){let V=0,Z=0,ee=0;const le=F[0];for(let ve=0,Pe=le.length,Re=Pe-1;ve<Pe;Re=ve++){const Le=le[ve],Fe=le[Re],Ye=Le.x*Fe.y-Fe.x*Le.y;Z+=(Le.x+Fe.x)*Ye,ee+=(Le.y+Fe.y)*Ye,V+=3*Ye}return new Hh(Z/V,ee/V,0,F)}(s),k=I.length;for(;I.length;){const F=I.pop();(F.d>A.d||!A.d)&&(A=F,a&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,k)),F.max-A.d<=r||(D=F.h/2,I.push(new Hh(F.p.x-D,F.p.y-D,D,s)),I.push(new Hh(F.p.x+D,F.p.y-D,D,s)),I.push(new Hh(F.p.x-D,F.p.y+D,D,s)),I.push(new Hh(F.p.x+D,F.p.y+D,D,s)),k+=4)}return a&&(console.log(`num probes: ${k}`),console.log(`best distance: ${A.d}`)),A.p}function Pb(s,r){return r.max-s.max}function Hh(s,r,a,u){this.p=new $(s,r),this.h=a,this.d=function(f,g){let y=!1,x=1/0;for(let E=0;E<g.length;E++){const D=g[E];for(let I=0,A=D.length,k=A-1;I<A;k=I++){const F=D[I],V=D[k];F.y>f.y!=V.y>f.y&&f.x<(V.x-F.x)*(f.y-F.y)/(V.y-F.y)+F.x&&(y=!y),x=Math.min(x,jy(f,F,V))}}return(y?1:-1)*Math.sqrt(x)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}const Hg=Number.POSITIVE_INFINITY,Zl=Math.sqrt(2);function ff(s,r){return r[1]!==Hg?function(a,u,f){let g=0,y=0;switch(u=Math.abs(u),f=Math.abs(f),a){case"top-right":case"top-left":case"top":y=f-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-f}switch(a){case"top-right":case"bottom-right":case"right":g=-u;break;case"top-left":case"bottom-left":case"left":g=u}return[g,y]}(s,r[0],r[1]):function(a,u){let f=0,g=0;u<0&&(u=0);const y=u/Zl;switch(a){case"top-right":case"top-left":g=y-7;break;case"bottom-right":case"bottom-left":g=7-y;break;case"bottom":g=7-u;break;case"top":g=u-7}switch(a){case"top-right":case"bottom-right":f=-y;break;case"top-left":case"bottom-left":f=y;break;case"left":f=u;break;case"right":f=-u}return[f,g]}(s,r[0])}function Pv(s,r,a,u,f,g,y,x,E,D){s.createArrays(),s.tilePixelRatio=In/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const I=s.layers[0].layout,A=s.layers[0]._unevaluatedLayout._values,k={};if("composite"===s.textSizeData.kind){const{minZoom:Z,maxZoom:ee}=s.textSizeData;k.compositeTextSizes=[A["text-size"].possiblyEvaluate(new Rr(Z),x),A["text-size"].possiblyEvaluate(new Rr(ee),x)]}if("composite"===s.iconSizeData.kind){const{minZoom:Z,maxZoom:ee}=s.iconSizeData;k.compositeIconSizes=[A["icon-size"].possiblyEvaluate(new Rr(Z),x),A["icon-size"].possiblyEvaluate(new Rr(ee),x)]}k.layoutTextSize=A["text-size"].possiblyEvaluate(new Rr(E+1),x),k.layoutIconSize=A["icon-size"].possiblyEvaluate(new Rr(E+1),x),k.textMaxSize=A["text-size"].possiblyEvaluate(new Rr(18),x);const F="map"===I.get("text-rotation-alignment")&&"point"!==I.get("symbol-placement"),V=I.get("text-size");for(const Z of s.features){const ee=I.get("text-font").evaluate(Z,{},x).join(","),le=V.evaluate(Z,{},x),ve=k.layoutTextSize.evaluate(Z,{},x),Pe=(k.layoutIconSize.evaluate(Z,{},x),{horizontal:{},vertical:void 0}),Re=Z.text;let Le,Fe=[0,0];if(Re){const at=Re.toString(),ft=24*I.get("text-letter-spacing").evaluate(Z,{},x),qe=24*I.get("text-line-height").evaluate(Z,{},x),tt=Nd(at)?ft:0,mt=I.get("text-anchor").evaluate(Z,{},x),Tt=I.get("text-variable-anchor");if(!Tt){const cn=I.get("text-radial-offset").evaluate(Z,{},x);Fe=cn?ff(mt,[24*cn,Hg]):I.get("text-offset").evaluate(Z,{},x).map(Wt=>24*Wt)}let wt=F?"center":I.get("text-justify").evaluate(Z,{},x);const St=I.get("symbol-placement"),vn="point"===St,Sn="point"===St?24*I.get("text-max-width").evaluate(Z,{},x):0,_n=cn=>{s.allowVerticalPlacement&&_u(at)&&(Pe.vertical=bs(Re,r,a,f,ee,Sn,qe,mt,cn,tt,Fe,os.vertical,!0,St,ve,le))};if(!F&&Tt){const cn="auto"===wt?Tt.map(zt=>pf(zt)):[wt];let Wt=!1;for(let zt=0;zt<cn.length;zt++){const Mn=cn[zt];if(!Pe.horizontal[Mn])if(Wt)Pe.horizontal[Mn]=Pe.horizontal[0];else{const Hn=bs(Re,r,a,f,ee,Sn,qe,"center",Mn,tt,Fe,os.horizontal,!1,St,ve,le);Hn&&(Pe.horizontal[Mn]=Hn,Wt=1===Hn.positionedLines.length)}}_n("left")}else{if("auto"===wt&&(wt=pf(mt)),vn||I.get("text-writing-mode").indexOf("horizontal")>=0||!_u(at)){const cn=bs(Re,r,a,f,ee,Sn,qe,mt,wt,tt,Fe,os.horizontal,!1,St,ve,le);cn&&(Pe.horizontal[wt]=cn)}_n("point"===St?"left":wt)}}let Ye=!1;if(Z.icon&&Z.icon.name){const at=u[Z.icon.name];at&&(Le=lf(f[Z.icon.name],I.get("icon-offset").evaluate(Z,{},x),I.get("icon-anchor").evaluate(Z,{},x)),Ye=at.sdf,void 0===s.sdfIcons?s.sdfIcons=at.sdf:s.sdfIcons!==at.sdf&&hn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(at.pixelRatio!==s.pixelRatio||0!==I.get("icon-rotate").constantOr(1))&&(s.iconsNeedLinear=!0))}const Qe=qg(Pe.horizontal)||Pe.vertical;s.iconsInText||(s.iconsInText=!!Qe&&Qe.iconsInText),(Qe||Le)&&Up(s,Z,Pe,Le,u,k,ve,0,Fe,Ye,y,x,D)}g&&s.generateCollisionDebugBuffers(E,s.collisionBoxArray)}function pf(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Up(s,r,a,u,f,g,y,x,E,D,I,A,k){let F=g.textMaxSize.evaluate(r,{},A);void 0===F&&(F=y);const V=s.layers[0].layout,Z=V.get("icon-offset").evaluate(r,{},A),ee=qg(a.horizontal)||a.vertical,le=y/24,ve=s.tilePixelRatio*F/24,Pe=(qe=s.overscaling,s.zoom>18&&qe>2&&(qe>>=1),Math.max(In/(512*qe),1)*V.get("symbol-spacing")),Re=V.get("text-padding")*s.tilePixelRatio,Le=V.get("icon-padding")*s.tilePixelRatio,Fe=ue(V.get("text-max-angle")),Ye="map"===V.get("text-rotation-alignment")&&"point"!==V.get("symbol-placement"),Qe="map"===V.get("icon-rotation-alignment")&&"point"!==V.get("symbol-placement"),at=V.get("symbol-placement"),ft=Pe/2;var qe;const tt=V.get("icon-text-fit");let mt;u&&"none"!==tt&&(s.allowVerticalPlacement&&a.vertical&&(mt=Gh(u,a.vertical,tt,V.get("icon-text-fit-padding"),Z,le)),ee&&(u=Gh(u,ee,tt,V.get("icon-text-fit-padding"),Z,le)));const Tt=(wt,St,vn)=>{if(St.x<0||St.x>=In||St.y<0||St.y>=In)return;const{x:Sn,y:_n,z:cn}=k.projectTilePoint(St.x,St.y,vn),Wt=new pa(Sn,_n,cn,0,void 0);!function(zt,Mn,Hn,ei,xr,ti,Jn,jn,hr,Or,Nr,ni,Ii,Vo,Io,Dr,go,Uo,Ni,Ai,Gr,zr,jo,Ao,pi){const _o=zt.addToLineVertexArray(Mn,ei);let yo,zi,Ds,Jl,Hu,td,g_,Wv=0,__=0,Mf=0,If=0,um=-1,y_=-1;const vl={};let Xv=cl(""),hm=0,Af=0;if(void 0===hr._unevaluatedLayout.getValue("text-radial-offset")?[hm,Af]=hr.layout.get("text-offset").evaluate(Gr,{},pi).map(ls=>24*ls):(hm=24*hr.layout.get("text-radial-offset").evaluate(Gr,{},pi),Af=Hg),zt.allowVerticalPlacement&&xr.vertical){const ls=xr.vertical;if(Io)td=gf(ls),jn&&(g_=gf(jn));else{const $o=hr.layout.get("text-rotate").evaluate(Gr,{},pi)+90;Ds=ma(Or,Hn,Mn,Nr,ni,Ii,ls,Vo,$o,Dr),jn&&(Jl=ma(Or,Hn,Mn,Nr,ni,Ii,jn,Uo,$o))}}if(ti){const ls=hr.layout.get("icon-rotate").evaluate(Gr,{},pi),$o="none"!==hr.layout.get("icon-text-fit"),nd=Gg(ti,ls,jo,$o),Pf=jn?Gg(jn,ls,jo,$o):void 0;zi=ma(Or,Hn,Mn,Nr,ni,Ii,ti,Uo,ls),Wv=4*nd.length;const rd=zt.iconSizeData;let jc=null;"source"===rd.kind?(jc=[ua*hr.layout.get("icon-size").evaluate(Gr,{},pi)],jc[0]>ml&&hn(`${zt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===rd.kind&&(jc=[ua*zr.compositeIconSizes[0].evaluate(Gr,{},pi),ua*zr.compositeIconSizes[1].evaluate(Gr,{},pi)],(jc[0]>ml||jc[1]>ml)&&hn(`${zt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),zt.addSymbols(zt.icon,nd,jc,Ai,Ni,Gr,!1,Hn,Mn,_o.lineStartIndex,_o.lineLength,-1,Ao,pi),um=zt.icon.placedSymbolArray.length-1,Pf&&(__=4*Pf.length,zt.addSymbols(zt.icon,Pf,jc,Ai,Ni,Gr,os.vertical,Hn,Mn,_o.lineStartIndex,_o.lineLength,-1,Ao,pi),y_=zt.icon.placedSymbolArray.length-1)}for(const ls in xr.horizontal){const $o=xr.horizontal[ls];yo||(Xv=cl($o.text),Io?Hu=gf($o):yo=ma(Or,Hn,Mn,Nr,ni,Ii,$o,Vo,hr.layout.get("text-rotate").evaluate(Gr,{},pi),Dr));const nd=1===$o.positionedLines.length;if(Mf+=mf(zt,Hn,Mn,$o,Jn,hr,Io,Gr,Dr,_o,xr.vertical?os.horizontal:os.horizontalOnly,nd?Object.keys(xr.horizontal):[ls],vl,um,zr,Ao,pi),nd)break}xr.vertical&&(If+=mf(zt,Hn,Mn,xr.vertical,Jn,hr,Io,Gr,Dr,_o,os.vertical,["vertical"],vl,y_,zr,Ao,pi));let Uc=-1;const dm=(ls,$o)=>ls?Math.max(ls,$o):$o;Uc=dm(Hu,Uc),Uc=dm(td,Uc),Uc=dm(g_,Uc);const qu=Uc>-1?1:0;zt.glyphOffsetArray.length>=Fa.MAX_GLYPHS&&hn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Gr.sortKey&&zt.addToSortKeyRanges(zt.symbolInstances.length,Gr.sortKey),zt.symbolInstances.emplaceBack(Hn.x,Hn.y,Hn.z,Mn.x,Mn.y,vl.right>=0?vl.right:-1,vl.center>=0?vl.center:-1,vl.left>=0?vl.left:-1,vl.vertical>=0?vl.vertical:-1,um,y_,Xv,void 0!==yo?yo:zt.collisionBoxArray.length,void 0!==yo?yo+1:zt.collisionBoxArray.length,void 0!==Ds?Ds:zt.collisionBoxArray.length,void 0!==Ds?Ds+1:zt.collisionBoxArray.length,void 0!==zi?zi:zt.collisionBoxArray.length,void 0!==zi?zi+1:zt.collisionBoxArray.length,Jl||zt.collisionBoxArray.length,Jl?Jl+1:zt.collisionBoxArray.length,Nr,Mf,If,Wv,__,qu,0,hm,Af,Uc)}(s,St,Wt,wt,a,u,f,mt,s.layers[0],s.collisionBoxArray,r.index,r.sourceLayerIndex,s.index,Re,Ye,E,0,Le,Qe,Z,r,g,D,I,A)};if("line"===at)for(const wt of zp(r.geometry,0,0,In,In)){const St=Mv(wt,Pe,Fe,a.vertical||ee,u,24,ve,s.overscaling,In);for(const vn of St){const Sn=ee;Sn&&kv(s,Sn.text,ft,vn)||Tt(wt,vn,A)}}else if("line-center"===at){for(const wt of r.geometry)if(wt.length>1){const St=Sv(wt,Fe,a.vertical||ee,u,24,ve);St&&Tt(wt,St,A)}}else if("Polygon"===r.type)for(const wt of wp(r.geometry,0)){const St=Ab(wt,16);Tt(wt[0],new pa(St.x,St.y,0,0,void 0),A)}else if("LineString"===r.type)for(const wt of r.geometry)Tt(wt,new pa(wt[0].x,wt[0].y,0,0,void 0),A);else if("Point"===r.type)for(const wt of r.geometry)for(const St of wt)Tt([St],new pa(St.x,St.y,0,0,void 0),A)}const ml=32640;function mf(s,r,a,u,f,g,y,x,E,D,I,A,k,F,V,Z,ee){const le=function(Re,Le,Fe,Ye,Qe,at,ft,qe){const tt=[];if(0===Le.positionedLines.length)return tt;const mt=Ye.layout.get("text-rotate").evaluate(at,{})*Math.PI/180,Tt=function(_n){const cn=_n[0],Wt=_n[1],zt=cn*Wt;return zt>0?[cn,-Wt]:zt<0?[-cn,Wt]:0===cn?[Wt,cn]:[Wt,-cn]}(Fe);let wt=Math.abs(Le.top-Le.bottom);for(const _n of Le.positionedLines)wt-=_n.lineOffset;const St=Le.positionedLines.length,vn=wt/St;let Sn=Le.top-Fe[1];for(let _n=0;_n<St;++_n){const cn=Le.positionedLines[_n];Sn=Sb(Le,vn,Sn,_n);for(const Wt of cn.positionedGlyphs){if(!Wt.rect)continue;const zt=Wt.rect||{};let Mn=4,Hn=!0,ei=1,xr=0;if(Wt.imageName){const zr=ft[Wt.imageName];if(!zr)continue;if(zr.sdf){hn("SDF images are not supported in formatted text and will be ignored.");continue}Hn=!1,ei=zr.pixelRatio,Mn=1/ei}const ti=(Qe||qe)&&Wt.vertical,Jn=Wt.metrics.advance*Wt.scale/2,jn=Wt.metrics,hr=Wt.rect;if(null===hr)continue;qe&&Le.verticalizable&&(xr=Wt.imageName?Jn-Wt.metrics.width*Wt.scale/2:0);const Or=Qe?[Wt.x+Jn,Wt.y]:[0,0];let Nr=[0,0],ni=[0,0],Ii=!1;Qe||(ti?(ni=[Wt.x+Jn+Tt[0],Wt.y+Tt[1]-xr],Ii=!0):Nr=[Wt.x+Jn+Fe[0],Wt.y+Fe[1]-xr]);const Vo=hr.w*Wt.scale/(ei*(Wt.localGlyph?2:1)),Io=hr.h*Wt.scale/(ei*(Wt.localGlyph?2:1));let Dr,go,Uo,Ni;if(ti){const zr=Wt.y-Sn,jo=new $(-Jn,Jn-zr),Ao=-Math.PI/2,pi=new $(...ni);Dr=new $(-Jn+Nr[0],Nr[1]),Dr._rotateAround(Ao,jo)._add(pi),Dr.x+=-zr+Jn,Dr.y-=(jn.left-Mn)*Wt.scale;const _o=Wt.imageName?jn.advance*Wt.scale:24*Wt.scale,yo=String.fromCharCode(Wt.glyph);kp(yo)?Dr.x+=(1-Mn)*Wt.scale:Rg(yo)?Dr.x+=_o-jn.height*Wt.scale+(-Mn-1)*Wt.scale:Dr.x+=Wt.imageName||jn.width+2*Mn===hr.w&&jn.height+2*Mn===hr.h?(_o-Io)/2:(_o-(jn.height+2*Mn)*Wt.scale)/2,go=new $(Dr.x,Dr.y-Vo),Uo=new $(Dr.x+Io,Dr.y),Ni=new $(Dr.x+Io,Dr.y-Vo)}else{const zr=(jn.left-Mn)*Wt.scale-Jn+Nr[0],jo=(-jn.top-Mn)*Wt.scale+Nr[1],Ao=zr+Vo,pi=jo+Io;Dr=new $(zr,jo),go=new $(Ao,jo),Uo=new $(zr,pi),Ni=new $(Ao,pi)}if(mt){let zr;zr=Qe?new $(0,0):Ii?new $(Tt[0],Tt[1]):new $(Fe[0],Fe[1]),Dr._rotateAround(mt,zr),go._rotateAround(mt,zr),Uo._rotateAround(mt,zr),Ni._rotateAround(mt,zr)}const Ai=new $(0,0),Gr=new $(0,0);tt.push({tl:Dr,tr:go,bl:Uo,br:Ni,tex:zt,writingMode:Le.writingMode,glyphOffset:Or,sectionIndex:Wt.sectionIndex,isSDF:Hn,pixelOffsetTL:Ai,pixelOffsetBR:Gr,minFontScaleX:0,minFontScaleY:0})}}return tt}(0,u,E,g,y,x,f,s.allowVerticalPlacement),ve=s.textSizeData;let Pe=null;"source"===ve.kind?(Pe=[ua*g.layout.get("text-size").evaluate(x,{},ee)],Pe[0]>ml&&hn(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ve.kind&&(Pe=[ua*V.compositeTextSizes[0].evaluate(x,{},ee),ua*V.compositeTextSizes[1].evaluate(x,{},ee)],(Pe[0]>ml||Pe[1]>ml)&&hn(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),s.addSymbols(s.text,le,Pe,E,y,x,I,r,a,D.lineStartIndex,D.lineLength,F,Z,ee);for(const Re of A)k[Re]=s.text.placedSymbolArray.length-1;return 4*le.length}function qg(s){for(const r in s)return s[r];return null}function ma(s,r,a,u,f,g,y,x,E,D){let I=y.top,A=y.bottom,k=y.left,F=y.right;const V=y.collisionPadding;if(V&&(k-=V[0],I-=V[1],F+=V[2],A+=V[3]),E){const Z=new $(k,I),ee=new $(F,I),le=new $(k,A),ve=new $(F,A),Pe=ue(E);let Re=new $(0,0);D&&(Re=new $(D[0],D[1])),Z._rotateAround(Pe,Re),ee._rotateAround(Pe,Re),le._rotateAround(Pe,Re),ve._rotateAround(Pe,Re),k=Math.min(Z.x,ee.x,le.x,ve.x),F=Math.max(Z.x,ee.x,le.x,ve.x),I=Math.min(Z.y,ee.y,le.y,ve.y),A=Math.max(Z.y,ee.y,le.y,ve.y)}return s.emplaceBack(r.x,r.y,r.z,a.x,a.y,k,I,F,A,x,u,f,g),s.length-1}function gf(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const r=s.bottom-s.top;return r>0?Math.max(10,r):null}function kv(s,r,a,u){const f=s.compareText;if(r in f){const g=f[r];for(let y=g.length-1;y>=0;y--)if(u.dist(g[y])<a)return!0}else f[r]=[];return f[r].push(u),!1}const jp=ql.VectorTileFeature.types,Rv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function qh(s,r,a,u,f,g,y,x,E,D,I,A,k,F,V,Z){const ee=I?Math.min(ml,Math.round(I[0])):0,le=I?Math.min(ml,Math.round(I[1])):0;s.emplaceBack(r,a,Math.round(32*y),Math.round(32*x),E,D,(ee<<1)+(A?1:0),le,16*k,16*F,256*V,256*Z,u,f,g,0)}function $p(s,r,a){s.emplaceBack(r.x,r.y,a),s.emplaceBack(r.x,r.y,a),s.emplaceBack(r.x,r.y,a),s.emplaceBack(r.x,r.y,a)}function Ov(s){for(const r of s.sections)if(Bd(r.text))return!0;return!1}class Rc{constructor(r){this.layoutVertexArray=new Je,this.indexArray=new Ke,this.programConfigurations=r,this.segments=new li,this.dynamicLayoutVertexArray=new Te,this.opacityVertexArray=new Dt,this.placedSymbolArray=new zo}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(r,a,u,f){this.isEmpty()||(u&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Ic.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,Pg.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,Rv,!0),this.opacityVertexBuffer.itemSize=1),(u||f)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}$t(Rc);class Wl{constructor(r,a,u){this.layoutVertexArray=new r,this.layoutAttributes=a,this.indexArray=new u,this.segments=new li,this.collisionVertexArray=new qt,this.collisionVertexArrayExt=new Te}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,kg.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,pv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}$t(Wl);class Fa{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(y=>y.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ka([]),this.placementViewportMatrix=ka([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Qd(this.zoom,a["text-size"]),this.iconSizeData=Qd(this.zoom,a["icon-size"]);const u=this.layers[0].layout,f=u.get("symbol-sort-key"),g=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==g&&void 0!==f.constantOr(1),this.sortFeaturesByY=("viewport-y"===g||"auto"===g&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(y=>os[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=r.sourceID,this.projection=r.projection}createArrays(){this.text=new Rc(new xc(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new Rc(new xc(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new cr,this.lineVertexArray=new Jr,this.symbolInstances=new Xn}calculateGlyphDependencies(r,a,u,f,g){for(let y=0;y<r.length;y++)if(a[r.charCodeAt(y)]=!0,f&&g){const x=Fu[r.charAt(y)];x&&(a[x.charCodeAt(0)]=!0)}}populate(r,a,u,f){const g=this.layers[0],y=g.layout,x=y.get("text-font"),E=y.get("text-field"),D=y.get("icon-image"),I=("constant"!==E.value.kind||E.value.value instanceof Kr&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==x.value.kind||x.value.value.length>0),A="constant"!==D.value.kind||!!D.value.value||Object.keys(D.parameters).length>0,k=y.get("symbol-sort-key");if(this.features=[],!I&&!A)return;const F=a.iconDependencies,V=a.glyphDependencies,Z=a.availableImages,ee=new Rr(this.zoom);for(const{feature:le,id:ve,index:Pe,sourceLayerIndex:Re}of r){const Le=g._featureFilter.needGeometry,Fe=jl(le,Le);if(!g._featureFilter.filter(ee,Fe,u))continue;let Ye,Qe;if(Le||(Fe.geometry=Ul(le,u,f)),I){const ft=g.getValueAndResolveTokens("text-field",Fe,u,Z),qe=Kr.factory(ft);Ov(qe)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===bh()||this.hasRTLText&&fo.isParsed())&&(Ye=tf(qe,g,Fe))}if(A){const ft=g.getValueAndResolveTokens("icon-image",Fe,u,Z);Qe=ft instanceof Pr?ft:Pr.fromString(ft)}if(!Ye&&!Qe)continue;const at=this.sortFeaturesByKey?k.evaluate(Fe,{},u):void 0;if(this.features.push({id:ve,text:Ye,icon:Qe,index:Pe,sourceLayerIndex:Re,geometry:Fe.geometry,properties:le.properties,type:jp[le.type],sortKey:at}),Qe&&(F[Qe.name]=!0),Ye){const ft=x.evaluate(Fe,{},u).join(","),qe="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(os.vertical)>=0;for(const tt of Ye.sections)if(tt.image)F[tt.image.name]=!0;else{const mt=_u(Ye.toString()),Tt=tt.fontStack||ft,wt=V[Tt]=V[Tt]||{};this.calculateGlyphDependencies(tt.text,wt,qe,this.allowVerticalPlacement,mt)}}}"line"===y.get("symbol-placement")&&(this.features=function(le){const ve={},Pe={},Re=[];let Le=0;function Fe(ft){Re.push(le[ft]),Le++}function Ye(ft,qe,tt){const mt=Pe[ft];return delete Pe[ft],Pe[qe]=mt,Re[mt].geometry[0].pop(),Re[mt].geometry[0]=Re[mt].geometry[0].concat(tt[0]),mt}function Qe(ft,qe,tt){const mt=ve[qe];return delete ve[qe],ve[ft]=mt,Re[mt].geometry[0].shift(),Re[mt].geometry[0]=tt[0].concat(Re[mt].geometry[0]),mt}function at(ft,qe,tt){const mt=tt?qe[0][qe[0].length-1]:qe[0][0];return`${ft}:${mt.x}:${mt.y}`}for(let ft=0;ft<le.length;ft++){const qe=le[ft],tt=qe.geometry,mt=qe.text?qe.text.toString():null;if(!mt){Fe(ft);continue}const Tt=at(mt,tt),wt=at(mt,tt,!0);if(Tt in Pe&&wt in ve&&Pe[Tt]!==ve[wt]){const St=Qe(Tt,wt,tt),vn=Ye(Tt,wt,Re[St].geometry);delete ve[Tt],delete Pe[wt],Pe[at(mt,Re[vn].geometry,!0)]=vn,Re[St].geometry=null}else Tt in Pe?Ye(Tt,wt,tt):wt in ve?Qe(Tt,wt,tt):(Fe(ft),ve[Tt]=Le-1,Pe[wt]=Le-1)}return Re.filter(ft=>ft.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((le,ve)=>le.sortKey-ve.sortKey)}update(r,a,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,a,this.layers,u,f),this.icon.programConfigurations.updatePaintArrays(r,a,this.layers,u,f))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,a){const u=this.lineVertexArray.length,f=r.segment;if(void 0!==f){let g=r.dist(a[f+1]),y=r.dist(a[f]);const x={};for(let E=f+1;E<a.length;E++)x[E]={x:a[E].x,y:a[E].y,tileUnitDistanceFromAnchor:g},E<a.length-1&&(g+=a[E+1].dist(a[E]));for(let E=f||0;E>=0;E--)x[E]={x:a[E].x,y:a[E].y,tileUnitDistanceFromAnchor:y},E>0&&(y+=a[E-1].dist(a[E]));for(let E=0;E<a.length;E++){const D=x[E];this.lineVertexArray.emplaceBack(D.x,D.y,D.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(r,a,u,f,g,y,x,E,D,I,A,k,F,V){const Z=r.indexArray,ee=r.layoutVertexArray,le=r.segments.prepareSegment(4*a.length,ee,Z,this.canOverlap?y.sortKey:void 0),ve=this.glyphOffsetArray.length,Pe=le.vertexLength,Re=this.allowVerticalPlacement&&x===os.vertical?Math.PI/2:0,Le=y.text&&y.text.sections;for(let Fe=0;Fe<a.length;Fe++){const{tl:Ye,tr:Qe,bl:at,br:ft,tex:qe,pixelOffsetTL:tt,pixelOffsetBR:mt,minFontScaleX:Tt,minFontScaleY:wt,glyphOffset:St,isSDF:vn,sectionIndex:Sn}=a[Fe],_n=le.vertexLength,cn=St[1];qh(ee,E.x,E.y,E.z,D.x,D.y,Ye.x,cn+Ye.y,qe.x,qe.y,u,vn,tt.x,tt.y,Tt,wt),qh(ee,E.x,E.y,E.z,D.x,D.y,Qe.x,cn+Qe.y,qe.x+qe.w,qe.y,u,vn,mt.x,tt.y,Tt,wt),qh(ee,E.x,E.y,E.z,D.x,D.y,at.x,cn+at.y,qe.x,qe.y+qe.h,u,vn,tt.x,mt.y,Tt,wt),qh(ee,E.x,E.y,E.z,D.x,D.y,ft.x,cn+ft.y,qe.x+qe.w,qe.y+qe.h,u,vn,mt.x,mt.y,Tt,wt),$p(r.dynamicLayoutVertexArray,E,Re),Z.emplaceBack(_n,_n+1,_n+2),Z.emplaceBack(_n+1,_n+2,_n+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(St[0]),Fe!==a.length-1&&Sn===a[Fe+1].sectionIndex||r.programConfigurations.populatePaintArrays(ee.length,y,y.index,{},F,V,Le&&Le[Sn])}r.placedSymbolArray.emplaceBack(E.x,E.y,E.z,D.x,D.y,ve,this.glyphOffsetArray.length-ve,Pe,I,A,D.segment,u?u[0]:0,u?u[1]:0,f[0],f[1],x,0,!1,0,k,0)}_commitLayoutVertex(r,a,u,f,g,y,x){r.emplaceBack(a,u,f,g,y,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(r,a,u,f,g,y,x){const E=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),D=E.vertexLength,I=x.tileAnchorX,A=x.tileAnchorY;for(let F=0;F<4;F++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(a,-r.padding,-r.padding),u.collisionVertexArrayExt.emplaceBack(a,r.padding,-r.padding),u.collisionVertexArrayExt.emplaceBack(a,r.padding,r.padding),u.collisionVertexArrayExt.emplaceBack(a,-r.padding,r.padding),this._commitLayoutVertex(u.layoutVertexArray,f,g,y,I,A,new $(r.x1,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,g,y,I,A,new $(r.x2,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,g,y,I,A,new $(r.x2,r.y2)),this._commitLayoutVertex(u.layoutVertexArray,f,g,y,I,A,new $(r.x1,r.y2)),E.vertexLength+=4;const k=u.indexArray;k.emplaceBack(D,D+1),k.emplaceBack(D+1,D+2),k.emplaceBack(D+2,D+3),k.emplaceBack(D+3,D),E.primitiveLength+=4}_addTextDebugCollisionBoxes(r,a,u,f,g,y){for(let x=f;x<g;x++){const E=u.get(x),D=this.getSymbolInstanceTextSize(r,y,a,x);this._addCollisionDebugVertices(E,D,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(r,a,u,f,g,y){for(let x=f;x<g;x++){const E=u.get(x),D=this.getSymbolInstanceIconSize(r,a,x);this._addCollisionDebugVertices(E,D,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}generateCollisionDebugBuffers(r,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Wl(vt,Uh.members,tn),this.iconCollisionBox=new Wl(vt,Uh.members,tn);const u=Ac(this.iconSizeData,r),f=Ac(this.textSizeData,r);for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(f,r,a,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(f,r,a,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,r,a,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,r,a,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(r,a,u,f){const g=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:f),y=Lu(this.textSizeData,r,g)/24;return this.tilePixelRatio*y}getSymbolInstanceIconSize(r,a,u){const f=this.icon.placedSymbolArray.get(u),g=Lu(this.iconSizeData,r,f);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(r,a,u){r.emplaceBack(a,-u,-u),r.emplaceBack(a,u,-u),r.emplaceBack(a,u,u),r.emplaceBack(a,-u,u)}_updateTextDebugCollisionBoxes(r,a,u,f,g,y){for(let x=f;x<g;x++){const E=u.get(x),D=this.getSymbolInstanceTextSize(r,y,a,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,E.padding)}}_updateIconDebugCollisionBoxes(r,a,u,f,g){for(let y=f;y<g;y++){const x=u.get(y),E=this.getSymbolInstanceIconSize(r,a,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,x.padding)}}updateCollisionDebugBuffers(r,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=Ac(this.iconSizeData,r),f=Ac(this.textSizeData,r);for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(f,r,a,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(f,r,a,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(u,r,a,y.iconBoxStartIndex,y.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(u,r,a,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,a,u,f,g,y,x,E,D){const I={};for(let A=a;A<u;A++){const k=r.get(A);I.textBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},I.textFeatureIndex=k.featureIndex;break}for(let A=f;A<g;A++){const k=r.get(A);I.verticalTextBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},I.verticalTextFeatureIndex=k.featureIndex;break}for(let A=y;A<x;A++){const k=r.get(A);I.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},I.iconFeatureIndex=k.featureIndex;break}for(let A=E;A<D;A++){const k=r.get(A);I.verticalIconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},I.verticalIconFeatureIndex=k.featureIndex;break}return I}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const u=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,a){const u=r.placedSymbolArray.get(a),f=u.vertexStartIndex+4*u.numGlyphs;for(let g=u.vertexStartIndex;g<f;g+=4)r.indexArray.emplaceBack(g,g+1,g+2),r.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const a=Math.sin(r),u=Math.cos(r),f=[],g=[],y=[];for(let x=0;x<this.symbolInstances.length;++x){y.push(x);const E=this.symbolInstances.get(x);f.push(0|Math.round(a*E.tileAnchorX+u*E.tileAnchorY)),g.push(E.featureIndex)}return y.sort((x,E)=>f[x]-f[E]||g[E]-g[x]),y}addToSortKeyRanges(r,a){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===a?u.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const u=this.symbolInstances.get(a);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((f,g,y)=>{f>=0&&y.indexOf(f)===g&&this.addIndicesForPlacedSymbol(this.text,f)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}$t(Fa,{omit:["layers","collisionBoxArray","features","compareText"]}),Fa.MAX_GLYPHS=65535,Fa.addDynamicAttributes=$p;const Uu=new B({"symbol-placement":new T($e.layout_symbol["symbol-placement"]),"symbol-spacing":new T($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new T($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new M($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new T($e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new T($e.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new T($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new T($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new T($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new M($e.layout_symbol["icon-size"]),"icon-text-fit":new T($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new T($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new M($e.layout_symbol["icon-image"]),"icon-rotate":new M($e.layout_symbol["icon-rotate"]),"icon-padding":new T($e.layout_symbol["icon-padding"]),"icon-keep-upright":new T($e.layout_symbol["icon-keep-upright"]),"icon-offset":new M($e.layout_symbol["icon-offset"]),"icon-anchor":new M($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new T($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new T($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new T($e.layout_symbol["text-rotation-alignment"]),"text-field":new M($e.layout_symbol["text-field"]),"text-font":new M($e.layout_symbol["text-font"]),"text-size":new M($e.layout_symbol["text-size"]),"text-max-width":new M($e.layout_symbol["text-max-width"]),"text-line-height":new M($e.layout_symbol["text-line-height"]),"text-letter-spacing":new M($e.layout_symbol["text-letter-spacing"]),"text-justify":new M($e.layout_symbol["text-justify"]),"text-radial-offset":new M($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new T($e.layout_symbol["text-variable-anchor"]),"text-anchor":new M($e.layout_symbol["text-anchor"]),"text-max-angle":new T($e.layout_symbol["text-max-angle"]),"text-writing-mode":new T($e.layout_symbol["text-writing-mode"]),"text-rotate":new M($e.layout_symbol["text-rotate"]),"text-padding":new T($e.layout_symbol["text-padding"]),"text-keep-upright":new T($e.layout_symbol["text-keep-upright"]),"text-transform":new M($e.layout_symbol["text-transform"]),"text-offset":new M($e.layout_symbol["text-offset"]),"text-allow-overlap":new T($e.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new T($e.layout_symbol["text-ignore-placement"]),"text-optional":new T($e.layout_symbol["text-optional"])});var Oc={paint:new B({"icon-opacity":new M($e.paint_symbol["icon-opacity"]),"icon-color":new M($e.paint_symbol["icon-color"]),"icon-halo-color":new M($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new M($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new M($e.paint_symbol["icon-halo-blur"]),"icon-translate":new T($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new T($e.paint_symbol["icon-translate-anchor"]),"text-opacity":new M($e.paint_symbol["text-opacity"]),"text-color":new M($e.paint_symbol["text-color"],{runtimeType:Ci,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new M($e.paint_symbol["text-halo-color"]),"text-halo-width":new M($e.paint_symbol["text-halo-width"]),"text-halo-blur":new M($e.paint_symbol["text-halo-blur"]),"text-translate":new T($e.paint_symbol["text-translate"]),"text-translate-anchor":new T($e.paint_symbol["text-translate-anchor"])}),layout:Uu};class Lc{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:Ro,this.defaultValue=r}evaluate(r){if(r.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(r.formattedSection))return a.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}$t(Lc,{omit:["defaultValue"]});class _f extends ca{constructor(r){super(r,Oc)}recalculate(r,a){super.recalculate(r,a),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const f=[];for(const g of u)f.indexOf(g)<0&&f.push(g);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,a,u,f){const g=this.layout.get(r).evaluate(a,{},u,f),y=this._unevaluatedLayout._values[r];return y.isDataDriven()||kl(y.value)||!g?g:(x=a.properties,g.replace(/{([^{}]+)}/g,(D,I)=>I in x?String(x[I]):""));var x}createBucket(r){return new Fa(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of Oc.paint.overridableProperties){if(!_f.hasPaintOverride(this.layout,r))continue;const a=this.paint.get(r),u=new Lc(a),f=new ou(u,a.property.specification);let g=null;g="constant"===a.value.kind||"source"===a.value.kind?new su("source",f):new oh("composite",f,a.value.zoomStops,a.value._interpolationType),this.paint._values[r]=new b(a.property,g,a.parameters)}}_handleOverridablePaintPropertyUpdate(r,a,u){return!(!this.layout||a.isDataDriven()||u.isDataDriven())&&_f.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,a){const u=r.get("text-field"),f=Oc.paint.properties[a];let g=!1;const y=x=>{for(const E of x)if(f.overrides&&f.overrides.hasOverride(E))return void(g=!0)};if("constant"===u.value.kind&&u.value.value instanceof Kr)y(u.value.value.sections);else if("source"===u.value.kind){const x=D=>{g||(D instanceof Ko&&wr(D.value)===ps?y(D.value.sections):D instanceof Fs?y(D.sections):D.eachChild(x))},E=u.value;E._styleExpression&&x(E._styleExpression.expression)}return g}getProgramConfiguration(r){return new la(this,r)}}var Zg={paint:new B({"background-color":new T($e.paint_background["background-color"]),"background-pattern":new O($e.paint_background["background-pattern"]),"background-opacity":new T($e.paint_background["background-opacity"])})},Wg={paint:new B({"raster-opacity":new T($e.paint_raster["raster-opacity"]),"raster-hue-rotate":new T($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new T($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new T($e.paint_raster["raster-brightness-max"]),"raster-saturation":new T($e.paint_raster["raster-saturation"]),"raster-contrast":new T($e.paint_raster["raster-contrast"]),"raster-resampling":new T($e.paint_raster["raster-resampling"]),"raster-fade-duration":new T($e.paint_raster["raster-fade-duration"])})};class Gp extends ca{constructor(r){super(r,{}),this.implementation=r}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var Hp={paint:new B({"sky-type":new T($e.paint_sky["sky-type"]),"sky-atmosphere-sun":new T($e.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new T($e.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new T($e.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new T($e.paint_sky["sky-gradient-radius"]),"sky-gradient":new L($e.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new T($e.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new T($e.paint_sky["sky-atmosphere-color"]),"sky-opacity":new T($e.paint_sky["sky-opacity"])})};function yf(s,r,a){const u=[0,0,1],f=pg([]);return function(g,y,x){x*=.5;var E=y[0],D=y[1],I=y[2],A=y[3],k=Math.sin(x),F=Math.cos(x);g[0]=E*F-I*k,g[1]=D*F+A*k,g[2]=I*F+E*k,g[3]=A*F-D*k}(f,f,a?-ue(s)+Math.PI:ue(s)),mg(f,f,-ue(r)),Zy(u,u,f),Cu(u,u)}const vf={circle:class extends ca{constructor(s){super(s,Gy)}createBucket(s){return new sp(s)}queryRadius(s){const r=s;return wc("circle-radius",this,r)+wc("circle-stroke-width",this,r)+Ih(this.paint.get("circle-translate"))}queryIntersectsFeature(s,r,a,u,f,g,y,x){const E=sg(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,s.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a);return mp(s,u,g,y,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),E,D)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new la(this,s)}},heatmap:class extends ca{createBucket(s){return new Mi(s)}constructor(s){super(s,Xy),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"heatmap-color"===s&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=_p({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return wc("heatmap-radius",this,s)}queryIntersectsFeature(s,r,a,u,f,g,y,x){const E=this.paint.get("heatmap-radius").evaluate(r,a);return mp(s,u,g,y,x,!0,!0,new $(0,0),E)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new la(this,s)}},hillshade:class extends ca{constructor(s){super(s,Ky)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ca{constructor(s){super(s,av)}getProgramIds(){const s=this.paint.get("fill-pattern"),r=s&&s.constantOr(1),a=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getProgramConfiguration(s){return new la(this,s)}recalculate(s,r){super.recalculate(s,r);const a=this.paint._values["fill-outline-color"];"constant"===a.value.kind&&void 0===a.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new Kd(s)}queryRadius(){return Ih(this.paint.get("fill-translate"))}queryIntersectsFeature(s,r,a,u,f,g){return!s.queryGeometry.isAboveHorizon&&Sh(og(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,s.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends ca{constructor(s){super(s,lv)}createBucket(s){return new Sc(s)}queryRadius(){return Ih(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new la(this,s)}queryIntersectsFeature(s,r,a,u,f,g,y,x,E){const D=sg(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,s.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(r,a),A=this.paint.get("fill-extrusion-base").evaluate(r,a),k=[0,0],F=x&&g.elevation,V=g.elevation?g.elevation.exaggeration():1,Z=s.tile.getBucket(this);if(F&&Z instanceof Sc){const ve=Z.centroidVertexArray,Pe=E+1;if(Pe<ve.length){const Re=ve.get(Pe);k[0]=Re.a_centroid_pos0,k[1]=Re.a_centroid_pos1}}if(0===k[0]&&1===k[1])return!1;const ee=(ve=u,Pe=A,Re=I,Le=D,Fe=y,(Ye=F?x:null)?function(qe,tt,mt,Tt,wt,St,vn,Sn,_n){const cn=[],Wt=[],zt=[0,0,0,1];for(const Mn of qe){const Hn=[],ei=[];for(const xr of Mn){const ti=xr.x+Tt.x,Jn=xr.y+Tt.y,jn=cv(ti,Jn,tt,mt,St,vn,Sn,_n);zt[0]=ti,zt[1]=Jn,zt[2]=jn.base,zt[3]=1,kh(zt,zt,wt),zt[3]=Math.max(zt[3],1e-5);const hr=Sg([zt[0]/zt[3],zt[1]/zt[3],zt[2]/zt[3]]);zt[0]=ti,zt[1]=Jn,zt[2]=jn.top,zt[3]=1,kh(zt,zt,wt),zt[3]=Math.max(zt[3],1e-5);const Or=Sg([zt[0]/zt[3],zt[1]/zt[3],zt[2]/zt[3]]);Hn.push(hr),ei.push(Or)}cn.push(Hn),Wt.push(ei)}return[cn,Wt]}(ve,Pe,Re,Le,Fe,Ye,k,V,g.center.lat):function(qe,tt,mt,Tt,wt){const St=[],vn=[],Sn=wt[8]*tt,_n=wt[9]*tt,cn=wt[10]*tt,Wt=wt[11]*tt,zt=wt[8]*mt,Mn=wt[9]*mt,Hn=wt[10]*mt,ei=wt[11]*mt;for(const xr of qe){const ti=[],Jn=[];for(const jn of xr){const hr=jn.x+Tt.x,Or=jn.y+Tt.y,Nr=wt[0]*hr+wt[4]*Or+wt[12],ni=wt[1]*hr+wt[5]*Or+wt[13],Ii=wt[2]*hr+wt[6]*Or+wt[14],Vo=wt[3]*hr+wt[7]*Or+wt[15],Io=Nr+Sn,Dr=ni+_n,go=Ii+cn,Uo=Math.max(Vo+Wt,1e-5),Ni=Nr+zt,Ai=ni+Mn,Gr=Ii+Hn,zr=Math.max(Vo+ei,1e-5),jo=new $(Io/Uo,Dr/Uo);jo.z=go/Uo,ti.push(jo);const Ao=new $(Ni/zr,Ai/zr);Ao.z=Gr/zr,Jn.push(Ao)}St.push(ti),vn.push(Jn)}return[St,vn]}(ve,Pe,Re,Le,Fe)),le=s.queryGeometry;var ve,Pe,Re,Le,Fe,Ye;return function(ve,Pe,Re){let Le=1/0;Sh(Re,Pe)&&(Le=Dg(Re,Pe[0]));for(let Fe=0;Fe<Pe.length;Fe++){const Ye=Pe[Fe],Qe=ve[Fe];for(let at=0;at<Ye.length-1;at++){const ft=Ye[at],qe=[ft,Ye[at+1],Qe[at+1],Qe[at],ft];rg(Re,qe)&&(Le=Math.min(Le,Dg(Re,qe)))}}return Le!==1/0&&Le}(ee[0],ee[1],le.isPointQuery()?le.screenBounds:le.screenGeometry)}},line:class extends ca{constructor(s){super(s,Ag),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if("line-gradient"===s){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof An,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,r){super.recalculate(s,r),this.paint._values["line-floorwidth"]=Ap.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new Ou(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new la(this,s)}queryRadius(s){const r=s,a=Pp(wc("line-width",this,r),wc("line-gap-width",this,r)),u=wc("line-offset",this,r);return a/2+Math.abs(u)+Ih(this.paint.get("line-translate"))}queryIntersectsFeature(s,r,a,u,f,g){if(s.queryGeometry.isAboveHorizon)return!1;const y=og(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,s.pixelToTileUnitsFactor),x=s.pixelToTileUnitsFactor/2*Pp(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),E=this.paint.get("line-offset").evaluate(r,a);return E&&(u=function(D,I){const A=[],k=new $(0,0);for(let F=0;F<D.length;F++){const V=D[F],Z=[];for(let ee=0;ee<V.length;ee++){const le=V[ee-1],ve=V[ee],Pe=V[ee+1],Re=0===ee?k:ve.sub(le)._unit()._perp(),Le=ee===V.length-1?k:Pe.sub(ve)._unit()._perp(),Fe=Re._add(Le)._unit();Fe._mult(1/(Fe.x*Le.x+Fe.y*Le.y)),Z.push(Fe._mult(I)._add(ve))}A.push(Z)}return A}(u,E*s.pixelToTileUnitsFactor)),function(D,I,A){for(let k=0;k<I.length;k++){const F=I[k];if(D.length>=3)for(let V=0;V<F.length;V++)if(Gl(D,F[V]))return!0;if(ap(D,F,A))return!0}return!1}(y,u,x)}isTileClipped(){return!0}},symbol:_f,background:class extends ca{constructor(s){super(s,Zg)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ca{constructor(s){super(s,Wg)}getProgramIds(){return["raster"]}},sky:class extends ca{constructor(s){super(s,Hp),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"sky-gradient"===s?this._updateColorRamp():"sky-atmosphere-sun"!==s&&"sky-atmosphere-halo-color"!==s&&"sky-atmosphere-color"!==s&&"sky-atmosphere-sun-intensity"!==s||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=_p({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(s,r){if("atmosphere"===this.paint.get("sky-type")){const u=this.paint.get("sky-atmosphere-sun"),f=!u,g=s.style.light,y=g.properties.get("position");return f&&"viewport"===g.properties.get("anchor")&&hn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?yf(y.azimuthal,90-y.polar,r):yf(u[0],90-u[1],r)}const a=this.paint.get("sky-gradient-center");return yf(a[0],90-a[1],r)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return"atmosphere"===s?["skyboxCapture","skybox"]:"gradient"===s?["skyboxGradient"]:null}}};class Zh{constructor(r,a,u,f){this.context=r,this.format=u,this.texture=r.gl.createTexture(),this.update(a,f)}update(r,a,u){const{width:f,height:g}=r,{context:y}=this,{gl:x}=y,{HTMLImageElement:E,HTMLCanvasElement:D,HTMLVideoElement:I,ImageData:A,ImageBitmap:k}=W;if(x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!a||!1!==a.premultiply)),u||this.size&&this.size[0]===f&&this.size[1]===g){const{x:F,y:V}=u||{x:0,y:0};r instanceof E||r instanceof D||r instanceof I||r instanceof A||k&&r instanceof k?x.texSubImage2D(x.TEXTURE_2D,0,F,V,x.RGBA,x.UNSIGNED_BYTE,r):x.texSubImage2D(x.TEXTURE_2D,0,F,V,f,g,x.RGBA,x.UNSIGNED_BYTE,r.data)}else this.size=[f,g],r instanceof E||r instanceof D||r instanceof I||r instanceof A||k&&r instanceof k?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,r):x.texImage2D(x.TEXTURE_2D,0,this.format,f,g,0,this.format,x.UNSIGNED_BYTE,r.data);this.useMipmap=Boolean(a&&a.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(r,a){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),r!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,r),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?r===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:r),this.filter=r),a!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,a),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class xf{constructor(r,a){this.width=r,this.height=a,this.nextRow=0,this.image=new Ra({width:r,height:a}),this.positions={},this.uploaded=!1}getDash(r,a){const u=this.getKey(r,a);return this.positions[u]}trim(){const r=this.width,a=this.height=Et(this.nextRow);this.image.resize({width:r,height:a})}getKey(r,a){return r.join(",")+a}getDashRanges(r,a,u){const f=[];let g=r.length%2==1?-r[r.length-1]*u:0,y=r[0]*u,x=!0;f.push({left:g,right:y,isDash:x,zeroLength:0===r[0]});let E=r[0];for(let D=1;D<r.length;D++){x=!x;const I=r[D];g=E*u,E+=I,y=E*u,f.push({left:g,right:y,isDash:x,zeroLength:0===I})}return f}addRoundDash(r,a,u){const f=a/2;for(let g=-u;g<=u;g++){const y=this.width*(this.nextRow+u+g);let x=0,E=r[x];for(let D=0;D<this.width;D++){D/E.right>1&&(E=r[++x]);const I=Math.abs(D-E.left),A=Math.abs(D-E.right),k=Math.min(I,A);let F;const V=g/u*(f+1);if(E.isDash){const Z=f-Math.abs(V);F=Math.sqrt(k*k+Z*Z)}else F=f-Math.sqrt(k*k+V*V);this.image.data[y+D]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(r,a){for(let E=r.length-1;E>=0;--E){const D=r[E],I=r[E+1];D.zeroLength?r.splice(E,1):I&&I.isDash===D.isDash&&(I.left=D.left,r.splice(E,1))}const u=r[0],f=r[r.length-1];u.isDash===f.isDash&&(u.left=f.left-this.width,f.right=u.right+this.width);const g=this.width*this.nextRow;let y=0,x=r[y];for(let E=0;E<this.width;E++){E/x.right>1&&(x=r[++y]);const D=Math.abs(E-x.left),I=Math.abs(E-x.right),A=Math.min(D,I);this.image.data[g+E]=Math.max(0,Math.min(255,(x.isDash?A:-A)+a+128))}}addDash(r,a){const u=this.getKey(r,a);if(this.positions[u])return this.positions[u];const f="round"===a,g=f?7:0,y=2*g+1;if(this.nextRow+y>this.height)return hn("LineAtlas out of space"),null;0===r.length&&r.push(1);let x=0;for(let I=0;I<r.length;I++)r[I]<0&&(hn("Negative value is found in line dasharray, replacing values with 0"),r[I]=0),x+=r[I];if(0!==x){const I=this.width/x,A=this.getDashRanges(r,this.width,I);f?this.addRoundDash(A,I,g):this.addRegularDash(A,"square"===a?.5*I:0)}const E=this.nextRow+g;this.nextRow+=y;const D={tl:[E,g],br:[x,0]};return this.positions[u]=D,D}}$t(xf);class kb{constructor(r){this._callback=r,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}const Xg=W.performance;function qp(s){const r=s?s.url.toString():void 0;return Xg.getEntriesByName(r)}class Lv{constructor(){this.tasks={},this.taskQueue=[],ut(["process"],this),this.invoker=new kb(this.process),this.nextId=0}add(r,a){const u=this.nextId++,f=function({type:g,isSymbolTile:y,zoom:x}){return x=x||0,"message"===g?0:"maybePrepare"!==g||y?"parseTile"!==g||y?"parseTile"===g&&y?300-x:"maybePrepare"===g&&y?400-x:500:200-x:100-x}(a);if(0===f){Rt();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:r,metadata:a,priority:f,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){Rt();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const r=this.pick();if(null===r)return;const a=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let r=null,a=1/0;for(let f=0;f<this.taskQueue.length;f++){const g=this.tasks[this.taskQueue[f]];g.priority<a&&(a=g.priority,r=f)}if(null===r)return null;const u=this.taskQueue[r];return this.taskQueue.splice(r,1),u}remove(){this.invoker.remove()}}const Kg=_e([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),Fv=_e([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Yg}=Kg,ss=_e([{name:"a_pos_3",components:3,type:"Int16"}]);var Wh=_e([{name:"a_pos",type:"Int16",components:2}]);const ju=In/Math.PI/2,ws=-ju,Es=ju,Jg=[new vs([ws,ws,ws],[Es,Es,Es]),new vs([ws,ws,ws],[0,0,Es]),new vs([0,ws,ws],[Es,0,Es]),new vs([ws,0,ws],[0,Es,Es]),new vs([0,0,ws],[Es,Es,Es])];class Rb{constructor(r,a,u){this.a=Hl([],r,u),this.b=Hl([],a,u),this.center=u;const f=Cu([],this.a),g=Cu([],this.b);this.angle=Math.acos(Tu(f,g))}}function Zp(s,r){if(0===s.angle)return null;let a;return a=0===s.a[r]?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[r]/s.a[r]/Math.sin(s.angle)-1/Math.tan(s.angle)),a<0||a>1?null:function(u,f,g,y){const x=Math.sin(g);return u*(Math.sin((1-y)*g)/x)+f*(Math.sin(y*g)/x)}(s.a[r],s.b[r],s.angle,J(a,0,1))+s.center[r]}function Fc(s){if(s.z<=1)return Jg[s.z+2*s.y+s.x];const[r,a]=Wp(s),u=[gl(r[0],r[1]),gl(r[0],a[1]),gl(a[0],r[1]),gl(a[0],a[1])],f=[Es,Es,Es],g=[ws,ws,ws];for(const y of u)f[0]=Math.min(f[0],y[0]),f[1]=Math.min(f[1],y[1]),f[2]=Math.min(f[2],y[2]),g[0]=Math.max(g[0],y[0]),g[1]=Math.max(g[1],y[1]),g[2]=Math.max(g[2],y[2]);return new vs(f,g)}function Wp(s){const r=1<<s.z,a=s.x/r,u=(s.x+1)/r,f=(s.y+1)/r;return[[Zi(s.y/r),Zs(a)],[Zi(f),Zs(u)]]}function e_(s,r,a,u=ju){return a=ue(a),[s*Math.sin(a)*u,-r*u,s*Math.cos(a)*u]}function gl(s,r,a){return e_(Math.cos(ue(s)),Math.sin(ue(s)),r,a)}function Xp(s,r,a){const u=Math.pow(2,a.z),f=(s/In+a.x)/u;return gl(Zi((r/In+a.y)/u),Zs(f))}function Kp(s){return 16383/Math.max(...Hl([],s.max,s.min))}function Yp(s){const r=ka(new Float64Array(16)),a=Kp(s);var u,f;return Ec(r,r,[a,a,a]),Eu(r,r,((u=[])[0]=-(f=s.min)[0],u[1]=-f[1],u[2]=-f[2],u)),r}function t_(s,r,a,u,f){const g=function(E){const D=In/(2*Math.PI);return E/(2*Math.PI)/D}(a),y=[s,r,-a/(2*Math.PI)],x=ka(new Float64Array(16));return Eu(x,x,y),Ec(x,x,[g,g,g]),lg(x,x,ue(-f)),cg(x,x,ue(-u)),x}function n_(s){const{x:r,y:a}=s.point,{lng:u,lat:f}=s._center;return t_(r,a,s.worldSize,u,f)}const Jp=ue(85),r_=Math.cos(Jp),Nv=Math.sin(Jp);function ga(s,r,a){var u=2*Math.PI*6378137/256/Math.pow(2,a);return[s*u-2*Math.PI*6378137/2,r*u-2*Math.PI*6378137/2]}class $u{constructor(r,a,u){this.z=r,this.x=a,this.y=u,this.key=bf(0,r,r,a,u)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,a){const u=(y=this.y,x=this.z,E=ga(256*(g=this.x),256*(y=Math.pow(2,x)-y-1),x),D=ga(256*(g+1),256*(y+1),x),E[0]+","+E[1]+","+D[0]+","+D[1]),f=function(g,y,x){let E,D="";for(let I=g;I>0;I--)E=1<<I-1,D+=(y&E?1:0)+(x&E?2:0);return D}(this.z,this.x,this.y);var g,y,x,E,D;return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===a?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class i_{constructor(r,a){this.wrap=r,this.canonical=a,this.key=bf(r,a.z,a.z,a.x,a.y)}}class Mo{constructor(r,a,u,f,g){this.overscaledZ=r,this.wrap=a,this.canonical=new $u(u,+f,+g),this.key=0===a&&r===u?this.canonical.key:bf(a,r,u,f,g)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const a=this.canonical.z-r;return r>this.canonical.z?new Mo(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Mo(r,this.wrap,r,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(r,a=!0){if(this.overscaledZ===r&&a)return this.key;if(r>this.canonical.z)return bf(this.wrap*+a,r,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-r;return bf(this.wrap*+a,r,r,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const a=this.canonical.z-r.canonical.z;return 0===r.overscaledZ||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>a&&r.canonical.y===this.canonical.y>>a}children(r){if(this.overscaledZ>=r)return[new Mo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,u=2*this.canonical.x,f=2*this.canonical.y;return[new Mo(a,this.wrap,a,u,f),new Mo(a,this.wrap,a,u+1,f),new Mo(a,this.wrap,a,u,f+1),new Mo(a,this.wrap,a,u+1,f+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Mo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Mo(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new i_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function bf(s,r,a,u,f){const g=1<<Math.min(a,22);let y=g*(f%g)+u%g;return s&&a<22&&(y+=g*g*((s<0?-2*s-1:2*s)%(1<<2*(22-a)))),16*(32*y+a)+(r-a)}function Xl(s,r){if(!r.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:r};const a=Math.pow(2,-s.z),u=s.x*a,f=(s.x+1)*a,g=s.y*a,y=(s.y+1)*a,x=Zs(u),E=Zs(f),D=Zi(g),I=Zi(y),A=r.project(x,D),k=r.project(E,D),F=r.project(E,I),V=r.project(x,I);let Z=Math.min(A.x,k.x,F.x,V.x),ee=Math.min(A.y,k.y,F.y,V.y),le=Math.max(A.x,k.x,F.x,V.x),ve=Math.max(A.y,k.y,F.y,V.y);const Pe=a/16;function Re(Fe,Ye,Qe,at,ft,qe){const tt=(Qe+ft)/2,mt=(at+qe)/2,Tt=r.project(Zs(tt),Zi(mt)),wt=Math.max(0,Z-Tt.x,ee-Tt.y,Tt.x-le,Tt.y-ve);Z=Math.min(Z,Tt.x),le=Math.max(le,Tt.x),ee=Math.min(ee,Tt.y),ve=Math.max(ve,Tt.y),wt>Pe&&(Re(Fe,Tt,Qe,at,tt,mt),Re(Tt,Ye,tt,mt,ft,qe))}Re(A,k,u,g,f,g),Re(k,F,f,g,f,y),Re(F,V,f,y,u,y),Re(V,A,u,y,u,g),Z-=Pe,ee-=Pe,le+=Pe,ve+=Pe;const Le=1/Math.max(le-Z,ve-ee);return{scale:Le,x:Z*Le,y:ee*Le,x2:le*Le,y2:ve*Le,projection:r}}$t($u),$t(Mo,{omit:["projMatrix"]});class o_{constructor(r){this._stringToNumber={},this._numberToString=[];for(let a=0;a<r.length;a++){const u=r[a];this._stringToNumber[u]=a,this._numberToString[a]=u}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const zv=["tile","layer","source","sourceLayer","state"];class s_{constructor(r,a,u,f,g){this.type="Feature",this._vectorTileFeature=r,this._z=a,this._x=u,this._y=f,this.properties=r.properties,this.id=g}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(r.id=this.id);for(const a of zv)void 0!==this[a]&&(r[a]=this[a]);return r}}const Kl=new Uint16Array(8184);for(let s=0;s<2046;s++){let r=s+2,a=0,u=0,f=0,g=0,y=0,x=0;for(1&r?f=g=y=32:a=u=x=32;(r>>=1)>1;){const D=a+f>>1,I=u+g>>1;1&r?(f=a,g=u,a=y,u=x):(a=f,u=g,f=y,g=x),y=D,x=I}const E=4*s;Kl[E+0]=a,Kl[E+1]=u,Kl[E+2]=f,Kl[E+3]=g}const Cs=new Uint16Array(2178),za=new Uint8Array(1089),wf=new Uint16Array(1089);function Ef(s){return 0===s?-.03125:32===s?.03125:0}var Cf=_e([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Qp={type:2,extent:In,loadGeometry:()=>[[new $(0,0),new $(8193,0),new $(8193,8193),new $(0,8193),new $(0,0)]]};class em{constructor(r,a,u,f,g){this.tileID=r,this.uid=kt(),this.uses=0,this.tileSize=a,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(r){const a=r+this.timeAdded;a<dr.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Xl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,a,u){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(f,g){const y={};if(!g)return y;for(const x of f){const E=x.layerIds.map(D=>g.getLayer(D)).filter(Boolean);if(0!==E.length){x.layers=E,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(D=>E.filter(I=>I.id===D)[0]));for(const D of E)y[D.id]=x}}return y}(r.buckets,a.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const g=this.buckets[f];if(g instanceof Fa){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const g=this.buckets[f];if(g instanceof Fa&&g.hasRTLText){this.hasRTLText=!0,fo.isLoading()||fo.isLoaded()||"deferred"!==bh()||yc();break}}this.queryPadding=0;for(const f in this.buckets){const g=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(f).queryRadius(g))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new Ia}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const u in this.buckets){const f=this.buckets[u];f.uploadPending()&&f.upload(r)}const a=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Zh(r,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Zh(r,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Zh(r,this.lineAtlas.image,a.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,a,u,f,g,y,x,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:x,transform:y,params:g,tileTransform:this.tileTransform},r,a,u):{}}querySourceFeatures(r,a){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const f=u.loadVTLayers(),g=a?a.sourceLayer:"",y=f._geojsonTileLayer||f[g];if(!y)return;const x=kr(a&&a.filter),{z:E,x:D,y:I}=this.tileID.canonical,A={z:E,x:D,y:I};for(let k=0;k<y.length;k++){const F=y.feature(k);if(x.needGeometry){const ee=jl(F,!0);if(!x.filter(new Rr(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!x.filter(new Rr(this.tileID.overscaledZ),F))continue;const V=u.getId(F,g),Z=new s_(F,E,D,I,V);Z.tile=A,r.push(Z)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const a=this.expirationTime;if(r.cacheControl){const u=kn(r.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const u=Date.now();let f=!1;if(this.expirationTime>u)f=!1;else if(a)if(this.expirationTime<a)f=!0;else{const g=this.expirationTime-a;g?this.expirationTime=u+Math.max(g,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(r,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(r).length||!a)return;const u=this.latestFeatureIndex.loadVTLayers(),f=a.style.listImages();for(const g in this.buckets){if(!a.style.hasLayer(g))continue;const y=this.buckets[g],x=y.layers[0].sourceLayer||"_geojsonTileLayer",E=u[x],D=r[x];if(!E||!D||0===Object.keys(D).length)continue;if(y.update(D,E,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof Ou||y instanceof Kd){const A=a.style._getSourceCache(y.layers[0].source);a._terrain&&a._terrain.enabled&&A&&y.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(A.id,this.tileID)}const I=a&&a.style&&a.style.getLayer(g);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(y)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<dr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=dr.now()+r}setTexture(r,a){const u=a.context,f=u.gl;this.texture=a.getTileTexture(r.width),this.texture?this.texture.update(r,{useMipmap:!0}):(this.texture=new Zh(u,r,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),u.extTextureFilterAnisotropic&&f.texParameterf(f.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax))}setDependencies(r,a){const u={};for(const f of a)u[f]=!0;this.dependencies[r]=u}hasDependency(r,a){for(const u of r){const f=this.dependencies[u];if(f)for(const g of a)if(f[g])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,a){if(!a||"mercator"===a.name||this._tileDebugBuffer)return;const u=Ul(Qp,this.tileID.canonical,this.tileTransform)[0],f=new fe,g=new bn;for(let y=0;y<u.length;y++){const{x,y:E}=u[y];f.emplaceBack(x,E),g.emplaceBack(y)}g.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(g),this._tileDebugBuffer=r.createVertexBuffer(f,Wh.members),this._tileDebugSegments=li.simpleSegment(0,0,f.length,g.length)}_makeTileBoundsBuffers(r,a){if(this._tileBoundsBuffer||!a||"mercator"===a.name)return;const u=Ul(Qp,this.tileID.canonical,this.tileTransform)[0];let f,g;if(this.isRaster){const y=function(x,E){const D=Xl(x,E),I=Math.pow(2,x.z);for(let ee=0;ee<33;ee++)for(let le=0;le<33;le++){const ve=Zs((x.x+(le+Ef(le))/32)/I),Pe=Zi((x.y+(ee+Ef(ee))/32)/I),Re=E.project(ve,Pe),Le=33*ee+le;Cs[2*Le+0]=Math.round((Re.x*D.scale-D.x)*In),Cs[2*Le+1]=Math.round((Re.y*D.scale-D.y)*In)}za.fill(0),wf.fill(0);for(let ee=2045;ee>=0;ee--){const le=4*ee,ve=Kl[le+0],Pe=Kl[le+1],Re=Kl[le+2],Le=Kl[le+3],Fe=ve+Re>>1,Ye=Pe+Le>>1,Qe=Fe+Ye-Pe,at=Ye+ve-Fe,ft=33*Pe+ve,qe=33*Le+Re,tt=33*Ye+Fe,mt=Math.hypot((Cs[2*ft+0]+Cs[2*qe+0])/2-Cs[2*tt+0],(Cs[2*ft+1]+Cs[2*qe+1])/2-Cs[2*tt+1])>=16;if(za[tt]=za[tt]||(mt?1:0),ee<1022){const Tt=33*(Pe+at>>1)+(ve+Qe>>1),wt=33*(Le+at>>1)+(Re+Qe>>1);za[tt]=za[tt]||za[Tt]||za[wt]}}const A=new xe,k=new Ke;let F=0;function V(ee,le){const ve=33*le+ee;return 0===wf[ve]&&(A.emplaceBack(Cs[2*ve+0],Cs[2*ve+1],ee*In/32,le*In/32),wf[ve]=++F),wf[ve]-1}function Z(ee,le,ve,Pe,Re,Le){const Fe=ee+ve>>1,Ye=le+Pe>>1;if(Math.abs(ee-Re)+Math.abs(le-Le)>1&&za[33*Ye+Fe])Z(Re,Le,ee,le,Fe,Ye),Z(ve,Pe,Re,Le,Fe,Ye);else{const Qe=V(ee,le),at=V(ve,Pe),ft=V(Re,Le);k.emplaceBack(Qe,at,ft)}}return Z(0,0,32,32,32,0),Z(32,32,0,0,0,32),{vertices:A,indices:k}}(this.tileID.canonical,a);f=y.vertices,g=y.indices}else{f=new xe,g=new Ke;for(const{x,y:E}of u)f.emplaceBack(x,E,0,0);const y=yp(f.int16,void 0,4);for(let x=0;x<y.length;x+=3)g.emplaceBack(y[x],y[x+1],y[x+2])}this._tileBoundsBuffer=r.createVertexBuffer(f,Cf.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(g),this._tileBoundsSegments=li.simpleSegment(0,0,f.length,g.length)}_makeGlobeTileDebugBuffers(r,a){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!a||"globe"!==a.name)return;const u=this.tileID.canonical,f=Yp(Fc(u));this._makeGlobeTileDebugBorderBuffer(r,u,f),this._makeGlobeTileDebugTextBuffer(r,u,f)}_makeGlobeTileDebugBorderBuffer(r,a,u){const f=new fe,g=new bn,y=new ye,x=(D,I,A,k,F)=>{const V=(A-D)/(F-1),Z=(k-I)/(F-1),ee=f.length;for(let le=0;le<F;le++){const ve=D+le*V,Pe=I+le*Z;f.emplaceBack(ve,Pe);const Re=Xp(ve,Pe,a),Le=Du(Re,Re,u);y.emplaceBack(Le[0],Le[1],Le[2]),g.emplaceBack(ee+le)}},E=In;x(0,0,E,0,16),x(E,0,E,E,16),x(E,E,0,E,16),x(0,E,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(g),this._tileDebugBuffer=r.createVertexBuffer(f,Wh.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(y,ss.members),this._tileDebugSegments=li.simpleSegment(0,0,f.length,g.length)}_makeGlobeTileDebugTextBuffer(r,a,u){const f=new fe,g=new Ke,y=new ye,x=25;g.reserve(32),f.reserve(x),y.reserve(x);const E=(D,I)=>x*D+I;for(let D=0;D<x;D++){const I=2048*D;for(let A=0;A<x;A++){const k=2048*A;f.emplaceBack(k,I);const F=Xp(k,I,a),V=Du(F,F,u);y.emplaceBack(V[0],V[1],V[2])}}for(let D=0;D<4;D++)for(let I=0;I<4;I++){const A=E(D,I),k=E(D,I+1),F=E(D+1,I),V=E(D+1,I+1);g.emplaceBack(A,k,F),g.emplaceBack(F,k,V)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(g),this._tileDebugTextBuffer=r.createVertexBuffer(f,Wh.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(y,ss.members),this._tileDebugTextSegments=li.simpleSegment(0,0,x,32)}}class Bv{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,a,u){const f=String(a);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][f]=this.stateChanges[r][f]||{},it(this.stateChanges[r][f],u),null===this.deletedStates[r]){this.deletedStates[r]={};for(const g in this.state[r])g!==f&&(this.deletedStates[r][g]=null)}else if(this.deletedStates[r]&&null===this.deletedStates[r][f]){this.deletedStates[r][f]={};for(const g in this.state[r][f])u[g]||(this.deletedStates[r][f][g]=null)}else for(const g in u)this.deletedStates[r]&&this.deletedStates[r][f]&&null===this.deletedStates[r][f][g]&&delete this.deletedStates[r][f][g]}removeFeatureState(r,a,u){if(null===this.deletedStates[r])return;const f=String(a);if(this.deletedStates[r]=this.deletedStates[r]||{},u&&void 0!==a)null!==this.deletedStates[r][f]&&(this.deletedStates[r][f]=this.deletedStates[r][f]||{},this.deletedStates[r][f][u]=null);else if(void 0!==a)if(this.stateChanges[r]&&this.stateChanges[r][f])for(u in this.deletedStates[r][f]={},this.stateChanges[r][f])this.deletedStates[r][f][u]=null;else this.deletedStates[r][f]=null;else this.deletedStates[r]=null}getState(r,a){const u=String(a),f=it({},(this.state[r]||{})[u],(this.stateChanges[r]||{})[u]);if(null===this.deletedStates[r])return{};if(this.deletedStates[r]){const g=this.deletedStates[r][a];if(null===g)return{};for(const y in g)delete f[y]}return f}initializeTileState(r,a){r.setFeatureState(this.state,a)}coalesceChanges(r,a){const u={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const g={};for(const y in this.stateChanges[f])this.state[f][y]||(this.state[f][y]={}),it(this.state[f][y],this.stateChanges[f][y]),g[y]=this.state[f][y];u[f]=g}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const g={};if(null===this.deletedStates[f])for(const y in this.state[f])g[y]={},this.state[f][y]={};else for(const y in this.deletedStates[f]){if(null===this.deletedStates[f][y])this.state[f][y]={};else for(const x of Object.keys(this.deletedStates[f][y]))delete this.state[f][y][x];g[y]=this.state[f][y]}u[f]=u[f]||{},it(u[f],g)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(u).length)for(const f in r)r[f].setFeatureState(u,a)}}class Tf{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,a){const u=this.toIdx(r,a);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(r,a){return this.leaves[this.toIdx(r,a)]}toIdx(r,a){return a*this.size+r}}function Vv(s,r,a,u){let f=0,g=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(u[y])<1e-15){if(a[y]<s[y]||a[y]>r[y])return null}else{const x=1/u[y];let E=(s[y]-a[y])*x,D=(r[y]-a[y])*x;if(E>D){const I=E;E=D,D=I}if(E>f&&(f=E),D<g&&(g=D),f>g)return null}return f}function a_(s,r,a,u,f,g,y,x,E,D,I){const A=u-s,k=f-r,F=g-a,V=y-s,Z=x-r,ee=E-a,le=I[1]*ee-I[2]*Z,ve=I[2]*V-I[0]*ee,Pe=I[0]*Z-I[1]*V,Re=A*le+k*ve+F*Pe;if(Math.abs(Re)<1e-15)return null;const Le=1/Re,Fe=D[0]-s,Ye=D[1]-r,Qe=D[2]-a,at=(Fe*le+Ye*ve+Qe*Pe)*Le;if(at<0||at>1)return null;const ft=Ye*F-Qe*k,qe=Qe*A-Fe*F,tt=Fe*k-Ye*A,mt=(I[0]*ft+I[1]*qe+I[2]*tt)*Le;return mt<0||at+mt>1?null:(V*ft+Z*qe+ee*tt)*Le}function tm(s,r,a){return(s-r)/(a-r)}function nm(s,r,a,u,f,g,y,x,E){const D=1<<a,I=g-u,A=y-f,k=(s+1)/D*I+u,F=(r+0)/D*A+f,V=(r+1)/D*A+f;x[0]=(s+0)/D*I+u,x[1]=F,E[0]=k,E[1]=V}class rm{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(g){const y=Math.ceil(Math.log2(g.dim/8)),x=[];let E=Math.ceil(Math.pow(2,y));const D=1/E,I=(F,V,Z,ee,le)=>{const ve=ee?1:0,Pe=(F+1)*Z-ve,Re=V*Z,Le=(V+1)*Z-ve;le[0]=F*Z,le[1]=Re,le[2]=Pe,le[3]=Le};let A=new Tf(E);const k=[];for(let F=0;F<E*E;F++){I(F%E,Math.floor(F/E),D,!1,k);const V=_l(k[0],k[1],g),Z=_l(k[2],k[1],g),ee=_l(k[2],k[3],g),le=_l(k[0],k[3],g);A.minimums.push(Math.min(V,Z,ee,le)),A.maximums.push(Math.max(V,Z,ee,le)),A.leaves.push(1)}for(x.push(A),E/=2;E>=1;E/=2){const F=x[x.length-1];A=new Tf(E);for(let V=0;V<E*E;V++){I(V%E,Math.floor(V/E),2,!0,k);const Z=F.getElevation(k[0],k[1]),ee=F.getElevation(k[2],k[1]),le=F.getElevation(k[2],k[3]),ve=F.getElevation(k[0],k[3]),Pe=F.isLeaf(k[0],k[1]),Re=F.isLeaf(k[2],k[1]),Le=F.isLeaf(k[2],k[3]),Fe=F.isLeaf(k[0],k[3]),Ye=Math.min(Z.min,ee.min,le.min,ve.min),Qe=Math.max(Z.max,ee.max,le.max,ve.max),at=Pe&&Re&&Le&&Fe;A.maximums.push(Qe),A.minimums.push(Ye),A.leaves.push(Qe-Ye<=5&&at?1:0)}x.push(A)}return x}(this.dem),u=a.length-1,f=a[u];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(a,0,0,u,0)}raycastRoot(r,a,u,f,g,y,x=1){return Vv([r,a,-100],[u,f,this.maximums[0]*x],g,y)}raycast(r,a,u,f,g,y,x=1){if(!this.nodeCount)return null;const E=this.raycastRoot(r,a,u,f,g,y,x);if(null==E)return null;const D=[],I=[],A=[],k=[],F=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;F.length>0;){const{idx:V,t:Z,nodex:ee,nodey:le,depth:ve}=F.pop();if(this.leaves[V]){nm(ee,le,ve,r,a,u,f,A,k);const Re=1<<ve,Le=(ee+0)/Re,Fe=(ee+1)/Re,Ye=(le+0)/Re,Qe=(le+1)/Re,at=_l(Le,Ye,this.dem)*x,ft=_l(Fe,Ye,this.dem)*x,qe=_l(Fe,Qe,this.dem)*x,tt=_l(Le,Qe,this.dem)*x,mt=a_(A[0],A[1],at,k[0],A[1],ft,k[0],k[1],qe,g,y),Tt=a_(k[0],k[1],qe,A[0],k[1],tt,A[0],A[1],at,g,y),wt=Math.min(null!==mt?mt:Number.MAX_VALUE,null!==Tt?Tt:Number.MAX_VALUE);if(wt!==Number.MAX_VALUE)return wt;{const St=Hd([],g,y,Z);if(im(at,ft,tt,qe,tm(St[0],A[0],k[0]),tm(St[1],A[1],k[1]))>=St[2])return Z}continue}let Pe=0;for(let Re=0;Re<this._siblingOffset.length;Re++){nm((ee<<1)+this._siblingOffset[Re][0],(le<<1)+this._siblingOffset[Re][1],ve+1,r,a,u,f,A,k),A[2]=-100,k[2]=this.maximums[this.childOffsets[V]+Re]*x;const Le=Vv(A,k,g,y);if(null!=Le){const Fe=Le;D[Re]=Fe;let Ye=!1;for(let Qe=0;Qe<Pe&&!Ye;Qe++)Fe>=D[I[Qe]]&&(I.splice(Qe,0,Re),Ye=!0);Ye||(I[Pe]=Re),Pe++}}for(let Re=0;Re<Pe;Re++){const Le=I[Re];F.push({idx:this.childOffsets[V]+Le,t:D[Le],nodex:(ee<<1)+this._siblingOffset[Le][0],nodey:(le<<1)+this._siblingOffset[Le][1],depth:ve+1})}}return null}_addNode(r,a,u){return this.minimums.push(r),this.maximums.push(a),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(r,a,u,f,g){if(1===r[f].isLeaf(a,u))return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const y=f-1,x=r[y];let E=0,D=0;for(let I=0;I<this._siblingOffset.length;I++){const A=2*a+this._siblingOffset[I][0],k=2*u+this._siblingOffset[I][1],F=x.getElevation(A,k),V=x.isLeaf(A,k),Z=this._addNode(F.min,F.max,V);V&&(E|=1<<I),D||(D=Z)}for(let I=0;I<this._siblingOffset.length;I++)E&1<<I||this._construct(r,2*a+this._siblingOffset[I][0],2*u+this._siblingOffset[I][1],y,D+I)}}function im(s,r,a,u,f,g){return Pt(Pt(s,a,g),Pt(r,u,g),f)}function _l(s,r,a){const u=a.dim,f=J(s*u-.5,0,u-1),g=J(r*u-.5,0,u-1),y=Math.floor(f),x=Math.floor(g),E=Math.min(y+1,u-1),D=Math.min(x+1,u-1);return im(a.get(y,x),a.get(E,x),a.get(y,D),a.get(E,D),f-y,g-x)}const Ba={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Nc{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,a,u,f=!1,g=!1){if(this.uid=r,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return hn(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const y=this.dim=a.height-2,x=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.encoding=u||"mapbox",this.borderReady=f,!f){for(let E=0;E<y;E++)x[this._idx(-1,E)]=x[this._idx(0,E)],x[this._idx(y,E)]=x[this._idx(y-1,E)],x[this._idx(E,-1)]=x[this._idx(E,0)],x[this._idx(E,y)]=x[this._idx(E,y-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(y,-1)]=x[this._idx(y-1,0)],x[this._idx(-1,y)]=x[this._idx(0,y-1)],x[this._idx(y,y)]=x[this._idx(y-1,y-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new rm(this)}get(r,a,u=!1){u&&(r=J(r,-1,this.dim),a=J(a,-1,this.dim));const f=4*this._idx(r,a);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[f],this.pixels[f+1],this.pixels[f+2])}static getUnpackVector(r){return Ba[r]}get unpackVector(){return Ba[this.encoding]}_idx(r,a){if(r<-1||r>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(r+1)}_unpackMapbox(r,a,u){return(256*r*256+256*a+u)/10-1e4}_unpackTerrarium(r,a,u){return 256*r+a+u/256-32768}static pack(r,a){const u=[0,0,0,0],f=Nc.getUnpackVector(a);let g=Math.floor((r+f[3])/f[2]);return u[2]=g%256,g=Math.floor(g/256),u[1]=g%256,g=Math.floor(g/256),u[0]=g,u}getPixels(){return new is({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,a,u){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let f=a*this.dim,g=a*this.dim+this.dim,y=u*this.dim,x=u*this.dim+this.dim;switch(a){case-1:f=g-1;break;case 1:g=f+1}switch(u){case-1:y=x-1;break;case 1:x=y+1}const E=-a*this.dim,D=-u*this.dim;for(let I=y;I<x;I++)for(let A=f;A<g;A++){const k=4*this._idx(A,I),F=4*this._idx(A+E,I+D);this.pixels[k+0]=r.pixels[F+0],this.pixels[k+1]=r.pixels[F+1],this.pixels[k+2]=r.pixels[F+2],this.pixels[k+3]=r.pixels[F+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}$t(Nc),$t(rm,{omit:["dem"]});class Uv{constructor(r,a){this.max=r,this.onRemove=a,this.reset()}reset(){for(const r in this.data)for(const a of this.data[r])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(r,a,u){const f=r.wrapped().key;void 0===this.data[f]&&(this.data[f]=[]);const g={value:a,timeout:void 0};if(void 0!==u&&(g.timeout=setTimeout(()=>{this.remove(r,g)},u)),this.data[f].push(g),this.order.push(f),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const a=this.data[r].shift();return a.timeout&&clearTimeout(a.timeout),0===this.data[r].length&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),a.value}getByKey(r){const a=this.data[r];return a?a[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,a){if(!this.has(r))return this;const u=r.wrapped().key,f=void 0===a?0:this.data[u].indexOf(a),g=this.data[u][f];return this.data[u].splice(f,1),g.timeout&&clearTimeout(g.timeout),0===this.data[u].length&&delete this.data[u],this.onRemove(g.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(r){const a=[];for(const u in this.data)for(const f of this.data[u])r(f.value)||a.push(f);for(const u of a)this.remove(u.value.tileID,u)}}class Gu{constructor(r,a,u){this.func=r,this.mask=a,this.range=u}}Gu.ReadOnly=!1,Gu.ReadWrite=!0,Gu.disabled=new Gu(519,Gu.ReadOnly,[0,1]);class Xh{constructor(r,a,u,f,g,y){this.test=r,this.ref=a,this.mask=u,this.fail=f,this.depthFail=g,this.pass=y}}Xh.disabled=new Xh({func:519,mask:0},0,0,7680,7680,7680);class _a{constructor(r,a,u){this.blendFunction=r,this.blendColor=a,this.mask=u}}_a.Replace=[1,0],_a.disabled=new _a(_a.Replace,Wn.transparent,[!1,!1,!1,!1]),_a.unblended=new _a(_a.Replace,Wn.transparent,[!0,!0,!0,!0]),_a.alphaBlended=new _a([1,771],Wn.transparent,[!0,!0,!0,!0]);class ya{constructor(r,a,u){this.enable=r,this.mode=a,this.frontFace=u}}ya.disabled=new ya(!1,1029,2305),ya.backCCW=new ya(!0,1029,2305),ya.backCW=new ya(!0,1029,2304),ya.frontCW=new ya(!0,1028,2304),ya.frontCCW=new ya(!0,1028,2305);class yl extends rn{constructor(r,a,u){super(),this.id=r,this._onlySymbols=u,a.on("data",f=>{"source"===f.dataType&&"metadata"===f.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===f.dataType&&"content"===f.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new Uv(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Bv,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(r){this.map=r,this._minTileCacheSize=void 0===this._minTileCacheSize&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const a=this._tiles[r];if("loaded"!==a.state&&"errored"!==a.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,a){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,a)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const a in this._tiles){const u=this._tiles[a];this._source.prepareTile(u)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,u.tileID),u.upload(r),u.prepare(this.map.style.imageManager)}else for(const a in this._tiles){const u=this._tiles[a];u.upload(r),u.prepare(this.map.style.imageManager)}}getIds(){return He(this._tiles).map(r=>r.tileID).sort(om).map(r=>r.key)}getRenderableIds(r){const a=[];for(const u in this._tiles)this._isIdRenderable(+u,r)&&a.push(this._tiles[u]);return r?a.sort((u,f)=>{const g=u.tileID,y=f.tileID,x=new $(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),E=new $(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-y.overscaledZ||E.y-x.y||E.x-x.x}).map(u=>u.tileID.key):a.map(u=>u.tileID).sort(om).map(u=>u.key)}hasRenderableParent(r){const a=this.findLoadedParent(r,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(r,a){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(a||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)"errored"!==this._tiles[r].state&&this._reloadTile(+r,"reloading")}}_reloadTile(r,a){const u=this._tiles[r];u&&("loading"!==u.state&&(u.state=a),this._loadTile(u,this._tileLoaded.bind(this,u,r,a)))}_tileLoaded(r,a,u,f){if(f)if(r.state="errored",404!==f.status)this._source.fire(new Yt(f,{tile:r}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=dr.now(),"expired"===u&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(a,r),"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new Kt("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const a=this.getRenderableIds();for(let f=0;f<a.length;f++){const g=a[f];if(r.neighboringTiles&&r.neighboringTiles[g]){const y=this.getTileByID(g);u(r,y),u(y,r)}}function u(f,g){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let y=g.tileID.canonical.x-f.tileID.canonical.x;const x=g.tileID.canonical.y-f.tileID.canonical.y,E=Math.pow(2,f.tileID.canonical.z),D=g.tileID.key;0===y&&0===x||Math.abs(x)>1||(Math.abs(y)>1&&(1===Math.abs(y+E)?y+=E:1===Math.abs(y-E)&&(y-=E)),g.dem&&f.dem&&(f.dem.backfillBorder(g.dem,y,x),f.neighboringTiles&&f.neighboringTiles[D]&&(f.neighboringTiles[D].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,a,u,f){for(const g in this._tiles){let y=this._tiles[g];if(f[g]||!y.hasData()||y.tileID.overscaledZ<=a||y.tileID.overscaledZ>u)continue;let x=y.tileID;for(;y&&y.tileID.overscaledZ>a+1;){const D=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[D.key],y&&y.hasData()&&(x=D)}let E=x;for(;E.overscaledZ>a;)if(E=E.scaledTo(E.overscaledZ-1),r[E.key]){f[x.key]=x;break}}}findLoadedParent(r,a){if(r.key in this._loadedParentTiles){const u=this._loadedParentTiles[r.key];return u&&u.tileID.overscaledZ>=a?u:null}for(let u=r.overscaledZ-1;u>=a;u--){const f=r.scaledTo(u),g=this._getLoadedTile(f);if(g)return g}}_getLoadedTile(r){const a=this._tiles[r.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,a){a=a||this._source.tileSize;const u=Math.ceil(r.width/a)+1,f=Math.ceil(r.height/a)+1,g=Math.floor(u*f*5),y="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,g):g,x="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(x)}handleWrapJump(r){const a=Math.round((r-(void 0===this._prevLng?r:this._prevLng))/360);if(this._prevLng=r,a){const u={};for(const f in this._tiles){const g=this._tiles[f];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+a),u[g.tileID.key]=g}this._tiles=u;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(r,a,u){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let f;this.updateCacheSize(r,a),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new Mo(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(f=r.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(x=>this._source.hasTile(x)))):f=[];const g=this._updateRetainedTiles(f);if(sm(this._source.type)&&0!==f.length){const x={},E={},D=Object.keys(g);for(const A of D){const k=g[A],F=this._tiles[A];if(!F||F.fadeEndTime&&F.fadeEndTime<=dr.now())continue;const V=this.findLoadedParent(k,Math.max(k.overscaledZ-yl.maxOverzooming,this._source.minzoom));V&&(this._addTile(V.tileID),x[V.tileID.key]=V.tileID),E[A]=k}const I=f[f.length-1].overscaledZ;for(const A in this._tiles){const k=this._tiles[A];if(g[A]||!k.hasData())continue;let F=k.tileID;for(;F.overscaledZ>I;){F=F.scaledTo(F.overscaledZ-1);const V=this._tiles[F.key];if(V&&V.hasData()&&E[F.key]){g[A]=k.tileID;break}}}for(const A in x)g[A]||(this._coveredTiles[A]=!0,g[A]=x[A])}for(const x in g)this._tiles[x].clearFadeHold();const y=function(x,E){const D=[];for(const I in x)I in E||D.push(I);return D}(this._tiles,g);for(const x of y){const E=this._tiles[x];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const a={};if(0===r.length)return a;const u={},f=r.reduce((D,I)=>Math.min(D,I.overscaledZ),1/0),g=r[0].overscaledZ,y=Math.max(g-yl.maxOverzooming,this._source.minzoom),x=Math.max(g+yl.maxUnderzooming,this._source.minzoom),E={};for(const D of r){const I=this._addTile(D);a[D.key]=D,I.hasData()||f<this._source.maxzoom&&(E[D.key]=D)}this._retainLoadedChildren(E,f,x,a);for(const D of r){let I=this._tiles[D.key];if(I.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const k=D.children(this._source.maxzoom)[0],F=this.getTile(k);if(F&&F.hasData()){a[k.key]=k;continue}}else{const k=D.children(this._source.maxzoom);if(a[k[0].key]&&a[k[1].key]&&a[k[2].key]&&a[k[3].key])continue}let A=I.wasRequested();for(let k=D.overscaledZ-1;k>=y;--k){const F=D.scaledTo(k);if(u[F.key]||(u[F.key]=!0,I=this.getTile(F),!I&&A&&(I=this._addTile(F)),I&&(a[F.key]=F,A=I.wasRequested(),I.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const a=[];let u,f=this._tiles[r].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){u=this._loadedParentTiles[f.key];break}a.push(f.key);const g=f.scaledTo(f.overscaledZ-1);if(u=this._getLoadedTile(g),u)break;f=g}for(const g of a)this._loadedParentTiles[g]=u}}_addTile(r){let a=this._tiles[r.key];if(a)return this._source.prepareTile&&this._source.prepareTile(a),a;a=this._cache.getAndRemove(r),a&&(this._setTileReloadTimer(r.key,a),a.tileID=r,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,a)));const u=Boolean(a);if(!u){const f=this.map?this.map.painter:null;a=new em(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,f,this._isRaster),this._source.prepareTile&&this._source.prepareTile(a)||this._loadTile(a,this._tileLoaded.bind(this,a,r.key,a.state))}return a?(a.uses++,this._tiles[r.key]=a,u||this._source.fire(new Kt("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(r,a){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const u=a.getExpiryTimeout();u&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},u))}_removeTile(r){const a=this._tiles[r];a&&(a.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),a.uses>0||(a.hasData()&&"reloading"!==a.state?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,a,u){const f=[],g=this.transform;if(!g)return f;for(const y in this._tiles){const x=this._tiles[y];if(u&&x.clearQueryDebugViz(),x.holdingForFade())continue;const E=r.containsTile(x,g,a);E&&f.push(E)}return f}getVisibleCoordinates(r){const a=this.getRenderableIds(r).map(u=>this._tiles[u].tileID);for(const u of a)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(sm(this._source.type))for(const r in this._tiles){const a=this._tiles[r];if(void 0!==a.fadeEndTime&&a.fadeEndTime>=dr.now())return!0}return!1}setFeatureState(r,a,u){this._state.updateState(r=r||"_geojsonTileLayer",a,u)}removeFeatureState(r,a,u){this._state.removeFeatureState(r=r||"_geojsonTileLayer",a,u)}getFeatureState(r,a){return this._state.getState(r=r||"_geojsonTileLayer",a)}setDependencies(r,a,u){const f=this._tiles[r];f&&f.setDependencies(a,u)}reloadTilesForDependencies(r,a){for(const u in this._tiles)this._tiles[u].hasDependency(r,a)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(r,a))}_preloadTiles(r,a){const u=new Map,f=Array.isArray(r)?r:[r],g=this.map.painter.terrain,y=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const x of f){const E=x.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of E)u.set(D.key,D);this.usedForTerrain&&x.updateElevation(!1)}Be(Array.from(u.values()),(x,E)=>{const D=new em(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(D,I=>{"raster-dem"===this._source.type&&D.dem&&this._backfillDEM(D),E(I,D)})},a)}}function om(s,r){const a=Math.abs(2*s.wrap)-+(s.wrap<0),u=Math.abs(2*r.wrap)-+(r.wrap<0);return s.overscaledZ-r.overscaledZ||u-a||r.canonical.y-s.canonical.y||r.canonical.x-s.canonical.x}function sm(s){return"raster"===s||"image"===s||"video"===s}yl.maxOverzooming=10,yl.maxUnderzooming=3;class Yh{constructor(r,a,u){this._demTile=r,this._dem=this._demTile.dem,this._scale=a,this._offset=u}static create(r,a,u){const f=u||r.findDEMTileFor(a);if(!f||!f.dem)return;const g=f.dem,y=f.tileID,x=1<<a.canonical.z-y.canonical.z;return new Yh(f,f.tileSize/In/x,[(a.canonical.x/x-y.canonical.x)*g.dim,(a.canonical.y/x-y.canonical.y)*g.dim])}tileCoordToPixel(r,a){const u=a*this._scale+this._offset[1],f=Math.floor(r*this._scale+this._offset[0]),g=Math.floor(u);return new $(f,g)}getElevationAt(r,a,u,f){const g=r*this._scale+this._offset[0],y=a*this._scale+this._offset[1],x=Math.floor(g),E=Math.floor(y),D=this._dem;return f=!!f,u?Pt(Pt(D.get(x,E,f),D.get(x,E+1,f),y-E),Pt(D.get(x+1,E,f),D.get(x+1,E+1,f),y-E),g-x):D.get(x,E,f)}getElevationAtPixel(r,a,u){return this._dem.get(r,a,!!u)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Pa(1,r)*this._dem.stride}}class c_{constructor(r,a){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Gi(In,16,0),this.featureIndexArray=new Qr,this.promoteId=a}insert(r,a,u,f,g,y=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,f,g,y);const E=this.grid;for(let D=0;D<a.length;D++){const I=a[D],A=[1/0,1/0,-1/0,-1/0];for(let k=0;k<I.length;k++){const F=I[k];A[0]=Math.min(A[0],F.x),A[1]=Math.min(A[1],F.y),A[2]=Math.max(A[2],F.x),A[3]=Math.max(A[3],F.y)}A[0]<In&&A[1]<In&&A[2]>=0&&A[3]>=0&&E.insert(x,A[0],A[1],A[2],A[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ql.VectorTile(new jh(this.rawTileData)).layers,this.sourceLayerCoder=new o_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,a,u,f){this.loadVTLayers();const g=r.params||{},y=kr(g.filter),x=r.tileResult,E=r.transform,D=x.bufferedTilespaceBounds,I=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(V,Z,ee,le)=>cp(x.bufferedTilespaceGeometry,V,Z,ee,le));I.sort(jv);let A=null;E.elevation&&I.length>0&&(A=Yh.create(E.elevation,this.tileID));const k={};let F;for(let V=0;V<I.length;V++){const Z=I[V];if(Z===F)continue;F=Z;const ee=this.featureIndexArray.get(Z);let le=null;this.loadMatchingFeature(k,ee,y,g.layers,g.availableImages,a,u,f,(ve,Pe,Re,Le=0)=>(le||(le=Ul(ve,this.tileID.canonical,r.tileTransform)),Pe.queryIntersectsFeature(x,ve,Re,le,this.z,r.transform,r.pixelPosMatrix,A,Le)))}return k}loadMatchingFeature(r,a,u,f,g,y,x,E,D){const{featureIndex:I,bucketIndex:A,sourceLayerIndex:k,layoutVertexArrayOffset:F}=a,V=this.bucketLayerIDs[A];if(f&&!function(ve,Pe){for(let Re=0;Re<ve.length;Re++)if(Pe.indexOf(ve[Re])>=0)return!0;return!1}(f,V))return;const Z=this.sourceLayerCoder.decode(k),ee=this.vtLayers[Z].feature(I);if(u.needGeometry){const ve=jl(ee,!0);if(!u.filter(new Rr(this.tileID.overscaledZ),ve,this.tileID.canonical))return}else if(!u.filter(new Rr(this.tileID.overscaledZ),ee))return;const le=this.getId(ee,Z);for(let ve=0;ve<V.length;ve++){const Pe=V[ve];if(f&&f.indexOf(Pe)<0)continue;const Re=y[Pe];if(!Re)continue;let Le={};void 0!==le&&E&&(Le=E.getState(Re.sourceLayer||"_geojsonTileLayer",le));const Fe=it({},x[Pe]);Fe.paint=Df(Fe.paint,Re.paint,ee,Le,g),Fe.layout=Df(Fe.layout,Re.layout,ee,Le,g);const Ye=!D||D(ee,Re,Le,F);if(!Ye)continue;const Qe=new s_(ee,this.z,this.x,this.y,le);Qe.layer=Fe;let at=r[Pe];void 0===at&&(at=r[Pe]=[]),at.push({featureIndex:I,feature:Qe,intersectionZ:Ye})}}lookupSymbolFeatures(r,a,u,f,g,y,x,E){const D={};this.loadVTLayers();const I=kr(g);for(const A of r)this.loadMatchingFeature(D,{bucketIndex:u,sourceLayerIndex:f,featureIndex:A,layoutVertexArrayOffset:0},I,y,x,E,a);return D}loadFeature(r){const{featureIndex:a,sourceLayerIndex:u}=r;this.loadVTLayers();const f=this.sourceLayerCoder.decode(u),g=this.vtFeatures[f];if(g[a])return g[a];const y=this.vtLayers[f].feature(a);return g[a]=y,y}hasLayer(r){for(const a of this.bucketLayerIDs)for(const u of a)if(r===u)return!0;return!1}getId(r,a){let u=r.id;return this.promoteId&&(u=r.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[a]],"boolean"==typeof u&&(u=Number(u))),u}}function Df(s,r,a,u,f){return un(s,(g,y)=>{const x=r instanceof w?r.get(y):null;return x&&x.evaluate?x.evaluate(a,u,f):x})}function jv(s,r){return r-s}$t(c_,{omit:["rawTileData","sourceLayerCoder"]});class u_{constructor(r){const a={},u=[];for(const x in r){const E=r[x],D=a[x]={};for(const I in E.glyphs){const A=E.glyphs[+I];if(!A||0===A.bitmap.width||0===A.bitmap.height)continue;const k=A.metrics.localGlyph?2:1,F={x:0,y:0,w:A.bitmap.width+2*k,h:A.bitmap.height+2*k};u.push(F),D[I]=F}}const{w:f,h:g}=Lp(u),y=new Ra({width:f||1,height:g||1});for(const x in r){const E=r[x];for(const D in E.glyphs){const I=E.glyphs[+D];if(!I||0===I.bitmap.width||0===I.bitmap.height)continue;const A=a[x][D],k=I.metrics.localGlyph?2:1;Ra.copy(I.bitmap,y,{x:0,y:0},{x:A.x+k,y:A.y+k},I.bitmap)}}this.image=y,this.positions=a}}$t(u_);class h_{constructor(r){this.tileID=new Mo(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=Xl(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,a,u,f,g){this.status="parsing",this.data=r,this.collisionBoxArray=new Ia;const y=new o_(Object.keys(r.layers).sort()),x=new c_(this.tileID,this.promoteId);x.bucketLayerIDs=[];const E={},D=new xf(256,256),I={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:D,availableImages:u},A=a.familiesBySource[this.source];for(const Le in A){const Fe=r.layers[Le];if(!Fe)continue;let Ye=!1,Qe=!1;for(const qe of A[Le])"symbol"===qe[0].type?Ye=!0:Qe=!0;if(!0===this.isSymbolTile&&!Ye||!1===this.isSymbolTile&&!Qe)continue;1===Fe.version&&hn(`Vector tile source "${this.source}" layer "${Le}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const at=y.encode(Le),ft=[];for(let qe=0;qe<Fe.length;qe++){const tt=Fe.feature(qe),mt=x.getId(tt,Le);ft.push({feature:tt,id:mt,index:qe,sourceLayerIndex:at})}for(const qe of A[Le]){const tt=qe[0];void 0!==this.isSymbolTile&&"symbol"===tt.type!==this.isSymbolTile||tt.minzoom&&this.zoom<Math.floor(tt.minzoom)||tt.maxzoom&&this.zoom>=tt.maxzoom||"none"!==tt.visibility&&(Yl(qe,this.zoom,u),(E[tt.id]=tt.createBucket({index:x.bucketLayerIDs.length,layers:qe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:at,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.name,availableImages:u})).populate(ft,I,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(qe.map(mt=>mt.id)))}}let k,F,V,Z;D.trim();const ee={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},le=un(I.glyphDependencies,Le=>Object.keys(Le).map(Number));Object.keys(le).length?f.send("getGlyphs",{uid:this.uid,stacks:le},(Le,Fe)=>{k||(k=Le,F=Fe,Re.call(this))},void 0,!1,ee):F={};const ve=Object.keys(I.iconDependencies);ve.length?f.send("getImages",{icons:ve,source:this.source,tileID:this.tileID,type:"icons"},(Le,Fe)=>{k||(k=Le,V=Fe,Re.call(this))},void 0,!1,ee):V={};const Pe=Object.keys(I.patternDependencies);function Re(){if(k)return g(k);if(F&&V&&Z){const Le=new u_(F),Fe=new fa(V,Z);for(const Ye in E){const Qe=E[Ye];Qe instanceof Fa?(Yl(Qe.layers,this.zoom,u),Pv(Qe,F,Le.positions,V,Fe.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):Qe.hasPattern&&(Qe instanceof Ou||Qe instanceof Kd||Qe instanceof Sc)&&(Yl(Qe.layers,this.zoom,u),Qe.addFeatures(I,this.tileID.canonical,Fe.patternPositions,u,this.tileTransform))}this.status="done",g(null,{buckets:He(E).filter(Ye=>!Ye.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Le.image,lineAtlas:D,imageAtlas:Fe,glyphMap:this.returnDependencies?F:null,iconMap:this.returnDependencies?V:null,glyphPositions:this.returnDependencies?Le.positions:null})}}Pe.length?f.send("getImages",{icons:Pe,source:this.source,tileID:this.tileID,type:"patterns"},(Le,Fe)=>{k||(k=Le,Z=Fe,Re.call(this))},void 0,!1,ee):Z={},Re.call(this)}}function Yl(s,r,a){const u=new Rr(r);for(const f of s)f.recalculate(u,a)}class am{constructor(r){this.entries={},this.scheduler=r}request(r,a,u,f){const g=this.entries[r]=this.entries[r]||{callbacks:[]};if(g.result){const[y,x]=g.result;return this.scheduler?this.scheduler.add(()=>{f(y,x)},a):f(y,x),()=>{}}return g.callbacks.push(f),g.cancel||(g.cancel=u((y,x)=>{g.result=[y,x];for(const E of g.callbacks)this.scheduler?this.scheduler.add(()=>{E(y,x)},a):E(y,x);setTimeout(()=>delete this.entries[r],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(y=>y!==f),g.callbacks.length||(g.cancel(),delete this.entries[r]))}}}function d_(s,r,a){const u=JSON.stringify(s.request);return s.data&&(this.deduped.entries[u]={result:[null,s.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},f=>{const g=se(s.request,(y,x,E,D)=>{y?f(y):x&&f(null,{vectorTile:a?void 0:new ql.VectorTile(new jh(x)),rawData:x,cacheControl:E,expires:D})});return()=>{g.cancel(),f()}},r)}const $v=ka(new Float32Array(16));class Ts{constructor(r){this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,a){return{x:0,y:0,z:0}}unproject(r,a){return new Tr(0,0)}projectTilePoint(r,a,u){return{x:r,y:a,z:0}}locationPoint(r,a){return r._coordinatePoint(r.locationCoordinate(a),!1)}pixelsPerMeter(r,a){return Pa(1,r)*a}farthestPixelDistance(r){return function(a,u){const f=a.fovAboveCenter,g=a.elevation?a.elevation.getMinElevationBelowMSL()*u:0,y=(a._camera.position[2]*a.worldSize-g)/Math.cos(a._pitch),x=Math.sin(f)*y/Math.sin(Math.max(Math.PI/2-a._pitch-f,.01)),E=Math.sin(a._pitch)*x+y;return Math.min(1.01*E,y*(1/a._horizonShift))}(r,r.pixelsPerMeter)}pointCoordinate(r,a,u,f){const g=r.horizonLineFromTop(!1),y=new $(a,Math.max(g,u));return r.rayIntersectionCoordinate(r.pointRayIntersection(y,f))}createInversionMatrix(r,a){return $v}createTileMatrix(r,a,u){let f,g,y;const x=u.canonical,E=ka(new Float64Array(16));if(this.isReprojectedInTileSpace){const D=Xl(x,this);f=1,g=D.x+u.wrap*D.scale,y=D.y,Ec(E,E,[f/D.scale,f/D.scale,r.pixelsPerMeter/a])}else f=a/r.zoomScale(x.z),g=(x.x+Math.pow(2,x.z)*u.wrap)*f,y=x.y*f;return Eu(E,E,[g,y,0]),Ec(E,E,[f/In,f/In,1]),E}upVector(r,a,u){return[0,0,1]}upVectorScale(r,a,u){return{metersToTile:1,metersToLabelSpace:1}}}class Gv extends Ts{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,a){return{x:qs(r),y:bc(a),z:0}}unproject(r,a){const u=Zs(r),f=Zi(a);return new Tr(u,f)}}class Hv extends Ts{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[a,u]=this.parallels=r.parallels||[29.5,45.5],f=Math.sin(ue(a));this.n=(f+Math.sin(ue(u)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(r,a){const{n:u,c:f,r0:g}=this,y=ue(r-this.center[0]),x=ue(a),E=Math.sqrt(f-2*u*Math.sin(x))/u;return{x:E*Math.sin(y*u),y:E*Math.cos(y*u)-g,z:0}}unproject(r,a){const{n:u,c:f,r0:g}=this,y=g+a;let x=Math.atan2(r,Math.abs(y))*Math.sign(y);y*u<0&&(x-=Math.PI*Math.sign(r)*Math.sign(y));const E=ue(this.center[0])*u;x=Ie(x,-Math.PI-E,Math.PI-E);const D=Ce(x/u)+this.center[0],I=Math.asin(J((f-(r*r+y*y)*u*u)/(2*u),-1,1)),A=J(Ce(I),-85.051129,ys);return new Tr(D,A)}}const Jh=1.340264,Qh=-.081106,Fi=893e-6,Bc=.003796,ed=Math.sqrt(3)/2;class f_ extends Ts{project(r,a){a=a/180*Math.PI,r=r/180*Math.PI;const u=Math.asin(ed*Math.sin(a)),f=u*u,g=f*f*f;return{x:.5*(r*Math.cos(u)/(ed*(Jh+3*Qh*f+g*(7*Fi+9*Bc*f)))/Math.PI+.5),y:1-.5*(u*(Jh+Qh*f+g*(Fi+Bc*f))/Math.PI+1),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,f=u*u,g=f*f*f;for(let I,A,k,F=0;F<12&&(A=u*(Jh+Qh*f+g*(Fi+Bc*f))-a,k=Jh+3*Qh*f+g*(7*Fi+9*Bc*f),I=A/k,u=J(u-I,-Math.PI/3,Math.PI/3),f=u*u,g=f*f*f,!(Math.abs(I)<1e-12));++F);const y=ed*r*(Jh+3*Qh*f+g*(7*Fi+9*Bc*f))/Math.cos(u),x=Math.asin(Math.sin(u)/ed),E=J(180*y/Math.PI,-180,180),D=J(180*x/Math.PI,-85.051129,ys);return new Tr(E,D)}}class p_ extends Ts{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,a){return{x:.5+r/360,y:.5-a/360,z:0}}unproject(r,a){const u=360*(r-.5),f=J(360*(.5-a),-85.051129,ys);return new Tr(u,f)}}const Vc=Math.PI/2;function Sf(s){return Math.tan((Vc+s)/2)}class qv extends Ts{constructor(r){super(r),this.center=r.center||[0,30];const[a,u]=this.parallels=r.parallels||[30,30],f=ue(a),g=ue(u),y=Math.cos(f);this.n=f===g?Math.sin(f):Math.log(y/Math.cos(g))/Math.log(Sf(g)/Sf(f)),this.f=y*Math.pow(Sf(f),this.n)/this.n}project(r,a){a=ue(a),r=ue(r-this.center[0]);const u=1e-6,{n:f,f:g}=this;g>0?a<-Vc+u&&(a=-Vc+u):a>Vc-u&&(a=Vc-u);const y=g/Math.pow(Sf(a),f),x=y*Math.sin(f*r),E=g-y*Math.cos(f*r);return{x:.5*(x/Math.PI+.5),y:1-.5*(E/Math.PI+.5),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI,a=(2*(1-a)-.5)*Math.PI;const{n:u,f}=this,g=f-a,y=Math.sign(g),x=Math.sign(u)*Math.sqrt(r*r+g*g);let E=Math.atan2(r,Math.abs(g))*y;g*u<0&&(E-=Math.PI*Math.sign(r)*y);const D=J(Ce(E/u)+this.center[0],-180,180),I=J(Ce(2*Math.atan(Math.pow(f/x,1/u))-Vc),-85.051129,ys);return new Tr(D,I)}}const m_=ue(ys);class Zv extends Ts{project(r,a){const u=(a=ue(a))*a,f=u*u;return{x:.5*((r=ue(r))*(.8707-.131979*u+f*(f*(.003971*u-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+u*(.015085+f*(.028874*u-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,f=25,g=0,y=u*u;do{y=u*u;const D=y*y;g=(u*(1.007226+y*(.015085+D*(.028874*y-.044475-.005916*D)))-a)/(1.007226+y*(.045255+D*(.259866*y-.311325-.005916*11*D))),u=J(u-g,-m_,m_)}while(Math.abs(g)>1e-6&&--f>0);y=u*u;const x=J(Ce(r/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),E=Ce(u);return new Tr(x,E)}}const lm=ue(ys);class Ob extends Ts{project(r,a){a=ue(a),r=ue(r);const u=Math.cos(a),f=2/Math.PI,g=Math.acos(u*Math.cos(r/2)),y=Math.sin(g)/g,x=.5*(r*f+2*u*Math.sin(r/2)/y)||0,E=.5*(a+Math.sin(a)/y)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(r,a){let u=r=(2*r-.5)*Math.PI,f=a=(2*(1-a)-1)*Math.PI,g=25;const y=1e-6;let x=0,E=0;do{const D=Math.cos(f),I=Math.sin(f),A=2*I*D,k=I*I,F=D*D,V=Math.cos(u/2),Z=Math.sin(u/2),ee=2*V*Z,le=Z*Z,ve=1-F*V*V,Pe=ve?1/ve:0,Re=ve?Math.acos(D*V)*Math.sqrt(1/ve):0,Le=.5*(2*Re*D*Z+2*u/Math.PI)-r,Fe=.5*(Re*I+f)-a,Ye=.5*Pe*(F*le+Re*D*V*k)+1/Math.PI,Qe=Pe*(ee*A/4-Re*I*Z),at=.125*Pe*(A*Z-Re*I*F*ee),ft=.5*Pe*(k*V+Re*le*D)+.5,qe=Qe*at-ft*Ye;x=(Fe*Qe-Le*ft)/qe,E=(Le*at-Fe*Ye)/qe,u=J(u-x,-Math.PI,Math.PI),f=J(f-E,-lm,lm)}while((Math.abs(x)>y||Math.abs(E)>y)&&--g>0);return new Tr(Ce(u),Ce(f))}}class cm extends Ts{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ue(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,a){const{scale:u,cosPhi:f}=this;return{x:ue(r)*f*u+.5,y:-Math.sin(ue(a))/f*u+.5,z:0}}unproject(r,a){const{scale:u,cosPhi:f}=this,g=-(a-.5)/u,y=J(Ce((r-.5)/u)/f,-180,180),x=Math.asin(J(g*f,-1,1)),E=J(Ce(x),-85.051129,ys);return new Tr(y,E)}}h.ARRAY_TYPE=Si,h.AUTH_ERR_MSG=oo,h.Aabb=vs,h.Actor=class{constructor(s,r,a){this.target=s,this.parent=r,this.mapId=a,this.callbacks={},this.cancelCallbacks={},ut(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Rt()?s:W,this.scheduler=new Lv}send(s,r,a,u,f=!1,g){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=g,this.callbacks[y]=a);const x=Rn(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:s,hasCallback:!!a,targetMapId:u,mustQueue:f,sourceMapId:this.mapId,data:Ma(r,x)},x),{cancel:()=>{a&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(s){const r=s.data,a=r.id;if(a&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){const u=this.cancelCallbacks[a];delete this.cancelCallbacks[a],u&&u.cancel()}else if(r.mustQueue||Rt()){const u=this.callbacks[a];this.cancelCallbacks[a]=this.scheduler.add(()=>this.processTask(a,r),u&&u.metadata||{type:"message"})}else this.processTask(a,r)}processTask(s,r){if("<response>"===r.type){const a=this.callbacks[s];delete this.callbacks[s],a&&(r.error?a(vi(r.error)):a(null,vi(r.data)))}else{const a=Rn(this.globalScope)?void 0:[],u=r.hasCallback?(g,y)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:g?Ma(g):null,data:Ma(y,a)},a)}:g=>{},f=vi(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,f,u);else if(this.parent.getWorkerSource){const g=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,g[0],f.source)[g[1]](f,u)}else u(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},h.CanonicalTileID=$u,h.Color=Wn,h.ColorMode=_a,h.CullFaceMode=ya,h.DEMData=Nc,h.DataConstantProperty=T,h.DedupedRequest=am,h.DepthMode=Gu,h.EXTENT=In,h.Elevation=class{isDataAvailableAtPoint(s){const r=this._source();if(!r||s.y<0||s.y>1)return!1;const a=r.getSource().maxzoom,u=1<<a,f=Math.floor(s.x),g=Math.floor((s.x-f)*u),y=Math.floor(s.y*u),x=this.findDEMTileFor(new Mo(a,f,a,g,y));return!(!x||!x.dem)}getAtPointOrZero(s,r=0){return this.getAtPoint(s,r)||0}getAtPoint(s,r,a=!0){null==r&&(r=null);const u=this._source();if(!u||s.y<0||s.y>1)return r;const f=u.getSource().maxzoom,g=1<<f,y=Math.floor(s.x),x=s.x-y,E=new Mo(f,y,f,Math.floor(x*g),Math.floor(s.y*g)),D=this.findDEMTileFor(E);if(!D||!D.dem)return r;const I=D.dem,A=1<<D.tileID.canonical.z,k=(x*A-D.tileID.canonical.x)*I.dim,F=(s.y*A-D.tileID.canonical.y)*I.dim,V=Math.floor(k),Z=Math.floor(F);return(a?this.exaggeration():1)*Pt(Pt(I.get(V,Z),I.get(V,Z+1),F-Z),Pt(I.get(V+1,Z),I.get(V+1,Z+1),F-Z),k-V)}getAtTileOffset(s,r,a){const u=1<<s.canonical.z;return this.getAtPointOrZero(new Dh(s.wrap+(s.canonical.x+r/In)/u,(s.canonical.y+a/In)/u))}getAtTileOffsetFunc(s,r,a,u){return f=>{const g=this.getAtTileOffset(s,f.x,f.y),y=u.upVector(s.canonical,f.x,f.y);return dl(y,y,g*u.upVectorScale(s.canonical,r,a).metersToTile),y}}getForTilePoints(s,r,a,u){const f=Yh.create(this,s,u);return!!f&&(r.forEach(g=>{g[2]=this.exaggeration()*f.getElevationAt(g[0],g[1],a)}),!0)}getMinMaxForTile(s){const r=this.findDEMTileFor(s);if(!r||!r.dem)return null;const a=r.dem.tree,u=r.tileID,f=1<<s.canonical.z-u.canonical.z;let g=s.canonical.x/f-u.canonical.x,y=s.canonical.y/f-u.canonical.y,x=0;for(let E=0;E<s.canonical.z-u.canonical.z&&!a.leaves[x];E++){g*=2,y*=2;const D=2*Math.floor(y)+Math.floor(g);x=a.childOffsets[x]+D,g%=1,y%=1}return{min:this.exaggeration()*a.minimums[x],max:this.exaggeration()*a.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,r,a){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},h.ErrorEvent=Yt,h.EvaluationParameters=Rr,h.Event=Kt,h.Evented=rn,h.FillExtrusionBucket=Sc,h.Frustum=pp,h.GLOBE_RADIUS=ju,h.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s),this._createAtmosphere(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();this._gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this._wireframeIndexBuffer&&(this._wireframeIndexBuffer.destroy(),this._wireframeSegments.destroy())}_createGrid(s){const r=new fe,a=new Ke,u=65;for(let f=0;f<u;f++)for(let g=0;g<u;g++)r.emplaceBack(g,f);for(let f=0;f<64;f++)for(let g=0;g<64;g++){const y=f*u+g;a.emplaceBack(y+1,y,y+u),a.emplaceBack(y+u,y+u+1,y+1)}this._gridBuffer=s.createVertexBuffer(r,Wh.members),this._gridIndexBuffer=s.createIndexBuffer(a,!0),this._gridSegments=li.simpleSegment(0,0,4225,8192)}_createPoles(s){const r=new Ke;for(let f=0;f<=64;f++)r.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=s.createIndexBuffer(r,!0);const a=new Zt,u=new Zt;this._poleSegments=[];for(let f=0,g=0;f<5;f++){const y=1<<f,x=512*y/Math.PI/2,E=360/y;a.emplaceBack(0,-x,0,0,0,.5,0),u.emplaceBack(0,-x,0,0,0,.5,1);for(let D=0;D<=64;D++){const I=D/64,A=Pt(0,E,I),[k,F,V]=e_(r_,Nv,A,x);a.emplaceBack(k,F,V,0,0,I,0),u.emplaceBack(k,F,V,0,0,I,1)}this._poleSegments.push(li.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(a,Yg,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(u,Yg,!1)}_createAtmosphere(s){const r=new ln;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const a=new Ke;a.emplaceBack(0,1,2),a.emplaceBack(2,3,0),this.atmosphereVertexBuffer=s.createVertexBuffer(r,Fv.members),this.atmosphereIndexBuffer=s.createIndexBuffer(a),this.atmosphereSegments=li.simpleSegment(0,0,4,2)}getGridBuffers(){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s){if(!this._wireframeSegments){const r=new tn,a=64,u=a+1;for(let f=0;f<a;f++)for(let g=0;g<a;g++){const y=f*u+g;r.emplaceBack(y,y+1),r.emplaceBack(y,y+u),r.emplaceBack(y,y+u+1)}this._wireframeIndexBuffer=s.createIndexBuffer(r),this._wireframeSegments=li.simpleSegment(0,0,a*a,r.length)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments]}},h.GlyphManager=kc,h.ImagePosition=Gn,h.LineAtlas=xf,h.LngLat=Tr,h.LngLatBounds=Hs,h.LocalGlyphMode=df,h.MAX_MERCATOR_LATITUDE=ys,h.MercatorCoordinate=Dh,h.ONE_EM=24,h.OverscaledTileID=Mo,h.Properties=B,h.RGBAImage=is,h.Ray=class{constructor(s,r){this.pos=s,this.dir=r}intersectsPlane(s,r,a){const u=Tu(r,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((s[0]-this.pos[0])*r[0]+(s[1]-this.pos[1])*r[1]+(s[2]-this.pos[2])*r[2])/u;return a[0]=this.pos[0]+this.dir[0]*f,a[1]=this.pos[1]+this.dir[1]*f,a[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(s,r,a){if(V=(k=this.pos)[0],Z=k[1],ee=k[2],le=(F=s)[0],ve=F[1],Pe=F[2],Math.abs(V-le)<=up*Math.max(1,Math.abs(V),Math.abs(le))&&Math.abs(Z-ve)<=up*Math.max(1,Math.abs(Z),Math.abs(ve))&&Math.abs(ee-Pe)<=up*Math.max(1,Math.abs(ee),Math.abs(Pe))||0===r)return a[0]=a[1]=a[2]=0,!1;var k,F,V,Z,ee,le,ve,Pe;const[u,f,g]=this.dir,y=this.pos[0]-s[0],x=this.pos[1]-s[1],E=this.pos[2]-s[2],D=u*u+f*f+g*g,I=2*(y*u+x*f+E*g),A=I*I-4*D*(y*y+x*x+E*E-r*r);if(A<0){const k=Math.max(-I/2,0),F=y+u*k,V=x+f*k,Z=E+g*k,ee=Math.hypot(F,V,Z);return a[0]=F*r/ee,a[1]=V*r/ee,a[2]=Z*r/ee,!1}{const k=(-I-Math.sqrt(A))/(2*D);if(k<0){const F=Math.hypot(y,x,E);return a[0]=y*r/F,a[1]=x*r/F,a[2]=E*r/F,!1}return a[0]=y+u*k,a[1]=x+f*k,a[2]=E+g*k,!0}}},h.RequestManager=class{constructor(s,r,a){this._transformRequestFn=s,this._customAccessToken=r,this._silenceAuthErrors=!!a,this._createSkuToken()}_createSkuToken(){const s=function(){let r="";for(let a=0;a<10;a++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Br,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,r){return this._transformRequestFn&&this._transformRequestFn(s,r)||{url:s}}normalizeStyleURL(s,r){if(!Ki(s))return s;const a=Ri(s);return a.path=`/styles/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeGlyphsURL(s,r){if(!Ki(s))return s;const a=Ri(s);return a.path=`/fonts/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeSourceURL(s,r){if(!Ki(s))return s;const a=Ri(s);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),this._makeAPIURL(a,this._customAccessToken||r)}normalizeSpriteURL(s,r,a,u){const f=Ri(s);return Ki(s)?(f.path=`/styles/v1${f.path}/sprite${r}${a}`,this._makeAPIURL(f,this._customAccessToken||u)):(f.path+=`${r}${a}`,so(f))}normalizeTileURL(s,r,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Ki(s))return s;const u=Ri(s);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||a&&"raster"!==u.authority&&512===a?"@2x":""}${ar.supported?".webp":"$1"}`),"raster"===u.authority?u.path=`/${xn.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${xn.TILE_URL_VERSION}${u.path}`);const f=this._customAccessToken||function(g){for(const y of g){const x=y.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(u.params)||xn.ACCESS_TOKEN;return xn.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,f)}canonicalizeTileURL(s,r){const a=Ri(s);if(!a.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!a.path.match(/\.[\w]+$/))return s;let u="mapbox://";a.path.match(/^\/raster\/v1\//)?u+=`raster/${a.path.replace(`/${xn.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${a.path.replace(`/${xn.TILE_URL_VERSION}/`,"")}`;let f=a.params;return r&&(f=f.filter(g=>!g.match(/^access_token=/))),f.length&&(u+=`?${f.join("&")}`),u}canonicalizeTileset(s,r){const a=!!r&&Ki(r),u=[];for(const f of s.tiles||[])Zo(f)?u.push(this.canonicalizeTileURL(f,a)):u.push(f);return u}_makeAPIURL(s,r){const a="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",u=Ri(xn.API_URL);if(s.protocol=u.protocol,s.authority=u.authority,"http"===s.protocol){const f=s.params.indexOf("secure");f>=0&&s.params.splice(f,1)}if("/"!==u.path&&(s.path=`${u.path}${s.path}`),!xn.REQUIRE_ACCESS_TOKEN)return so(s);if(r=r||xn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${a}`);if("s"===r[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${a}`)}return s.params=s.params.filter(f=>-1===f.indexOf("access_token")),s.params.push(`access_token=${r||""}`),so(s)}},h.ResourceType=ne,h.SegmentVector=li,h.SourceCache=yl,h.StencilMode=Xh,h.StructArrayLayout1ui2=bn,h.StructArrayLayout2f1f2i16=ht,h.StructArrayLayout2i4=fe,h.StructArrayLayout2ui4=tn,h.StructArrayLayout3f12=Te,h.StructArrayLayout3ui6=Ke,h.StructArrayLayout4i8=xe,h.Texture=Zh,h.Tile=em,h.Transitionable=m,h.Uniform1f=Ch,h.Uniform1i=class extends zl{constructor(s,r){super(s,r),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},h.Uniform2f=class extends zl{constructor(s,r){super(s,r),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},h.Uniform3f=class extends zl{constructor(s,r){super(s,r),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},h.Uniform4f=Jm,h.UniformColor=Qm,h.UniformMatrix2f=class extends zl{constructor(s,r){super(s,r),this.current=Oy}set(s){for(let r=0;r<4;r++)if(s[r]!==this.current[r]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}},h.UniformMatrix3f=class extends zl{constructor(s,r){super(s,r),this.current=Ry}set(s){for(let r=0;r<9;r++)if(s[r]!==this.current[r]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}},h.UniformMatrix4f=class extends zl{constructor(s,r){super(s,r),this.current=ky}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let r=1;r<16;r++)if(s[r]!==this.current[r]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},h.UnwrappedTileID=i_,h.ValidationError=Nt,h.VectorTileWorkerSource=class extends rn{constructor(s,r,a,u,f){super(),this.actor=s,this.layerIndex=r,this.availableImages=a,this.loadVectorData=f||d_,this.loading={},this.loaded={},this.deduped=new am(s.scheduler),this.isSpriteLoaded=u,this.scheduler=s.scheduler}loadTile(s,r){const a=s.uid,u=s&&s.request,f=u&&u.collectResourceTiming,g=this.loading[a]=new h_(s);g.abort=this.loadVectorData(s,(y,x)=>{const E=!this.loading[a];if(delete this.loading[a],E||y||!x)return g.status="done",E||(this.loaded[a]=g),r(y);const D=x.rawData,I={};x.expires&&(I.expires=x.expires),x.cacheControl&&(I.cacheControl=x.cacheControl),g.vectorTile=x.vectorTile||new ql.VectorTile(new jh(D));const A=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,(k,F)=>{if(k||!F)return r(k);const V={};if(f){const Z=qp(u);Z.length>0&&(V.resourceTiming=JSON.parse(JSON.stringify(Z)))}r(null,it({rawTileData:D.slice(0)},F,I,V))})};this.isSpriteLoaded?A():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(A,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):A()}),this.loaded=this.loaded||{},this.loaded[a]=g})}reloadTile(s,r){const a=this.loaded,u=s.uid,f=this;if(a&&a[u]){const g=a[u];g.showCollisionBoxes=s.showCollisionBoxes,g.enableTerrain=!!s.enableTerrain,g.projection=s.projection,g.tileTransform=Xl(s.tileID.canonical,s.projection);const y=(x,E)=>{const D=g.reloadCallback;D&&(delete g.reloadCallback,g.parse(g.vectorTile,f.layerIndex,this.availableImages,f.actor,D)),r(x,E)};"parsing"===g.status?g.reloadCallback=y:"done"===g.status&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(s,r){const a=s.uid,u=this.loading[a];u&&(u.abort&&u.abort(),delete this.loading[a]),r()}removeTile(s,r){const a=this.loaded,u=s.uid;a&&a[u]&&delete a[u],r()}},h.WritingMode=os,h.ZoomHistory=_s,h.add=Hy,h.addDynamicAttributes=$p,h.adjoint=function(s,r){var a=r[0],u=r[1],f=r[2],g=r[3],y=r[4],x=r[5],E=r[6],D=r[7],I=r[8];return s[0]=y*I-x*D,s[1]=f*D-u*I,s[2]=u*x-f*y,s[3]=x*E-g*I,s[4]=a*I-f*E,s[5]=f*g-a*x,s[6]=g*D-y*E,s[7]=u*E-a*D,s[8]=a*y-u*g,s},h.asyncAll=Be,h.bezier=Ee,h.bindAll=ut,h.boundsAttributes=Cf,h.bufferConvexPolygon=function(s,r){const a=[];for(let u=0;u<s.length;u++){const f=Ie(u-1,-1,s.length-1),g=Ie(u+1,-1,s.length-1),y=s[u],x=s[g],E=s[f].sub(y).unit(),D=x.sub(y).unit(),I=D.angleWithSep(E.x,E.y),A=E.add(D).unit().mult(-1*r/Math.sin(I/2));a.push(y.add(A))}return a},h.cacheEntryPossiblyAdded=function(s){Xo++,Xo>ao&&(s.getActor().send("enforceCacheSizeLimit",Qn),Xo=0)},h.calculateGlobeLabelMatrix=function(s,r){const{lng:a,lat:u}=s._center,f=t_(0,0,s.worldSize/s._projectionScaler,a,u);return ag(f,f,function(g){const y=ka(new Float64Array(16)),x=1/Kp(g);return Eu(y,y,g.min),Ec(y,y,[x,x,x]),y}(Fc(r)))},h.calculateGlobeMatrix=n_,h.calculateGlobeMercatorMatrix=function(s){const r=s.worldSize,a=s.point,u=Pa(1,s.center.lat)*r,f=s.pixelsPerMeter,g=r/(u/s.pixelsPerMeter),y=ka(new Float64Array(16));return Eu(y,y,[a.x,a.y,0]),Ec(y,y,[g,g,f]),Float32Array.from(y)},h.circumferenceAtLatitude=xu,h.clamp=J,h.clearTileCache=function(s){const r=W.caches.delete(Os);s&&r.catch(s).then(()=>s())},h.clipLine=zp,h.clone=function(s){var r=new Si(16);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=s[3],r[4]=s[4],r[5]=s[5],r[6]=s[6],r[7]=s[7],r[8]=s[8],r[9]=s[9],r[10]=s[10],r[11]=s[11],r[12]=s[12],r[13]=s[13],r[14]=s[14],r[15]=s[15],r},h.clone$1=an,h.collisionCircleLayout=mv,h.config=xn,h.conjugate=function(s,r){return s[0]=-r[0],s[1]=-r[1],s[2]=-r[2],s[3]=r[3],s},h.create=function(){var s=new Si(16);return Si!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},h.create$1=wu,h.createExpression=Rl,h.createLayout=_e,h.createStyleLayer=function(s){return"custom"===s.type?new Gp(s):new vf[s.type](s)},h.cross=qy,h.degToRad=ue,h.div=function(s,r,a){return s[0]=r[0]/a[0],s[1]=r[1]/a[1],s[2]=r[2]/a[2],s},h.dot=Tu,h.earthRadius=rp,h.ease=Ae,h.easeCubicInOut=Q,h.emitValidationErrors=Ol,h.endsWith=rt,h.enforceCacheSizeLimit=function(s){nr(),Ei&&Ei.then(r=>{r.keys().then(a=>{for(let u=0;u<a.length-s;u++)r.delete(a[u])})})},h.evaluateSizeForFeature=Lu,h.evaluateSizeForZoom=Ac,h.evaluateVariableOffset=ff,h.evented=xh,h.exactEquals=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]&&s[3]===r[3]},h.exactEquals$1=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]},h.exported=dr,h.exported$1=ar,h.extend=it,h.extend$1=rr,h.filterObject=Cn,h.fromMat4=function(s,r){return s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[4],s[4]=r[5],s[5]=r[6],s[6]=r[8],s[7]=r[9],s[8]=r[10],s},h.fromQuat=function(s,r){var a=r[0],u=r[1],f=r[2],g=r[3],y=a+a,x=u+u,E=f+f,D=a*y,I=u*y,A=u*x,k=f*y,F=f*x,V=f*E,Z=g*y,ee=g*x,le=g*E;return s[0]=1-A-V,s[1]=I+le,s[2]=k-ee,s[3]=0,s[4]=I-le,s[5]=1-D-V,s[6]=F+Z,s[7]=0,s[8]=k+ee,s[9]=F-Z,s[10]=1-D-A,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},h.fromRotation=function(s,r){var a=Math.sin(r),u=Math.cos(r);return s[0]=u,s[1]=a,s[2]=0,s[3]=-a,s[4]=u,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},h.fromScaling=function(s,r){return s[0]=r[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=r[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=r[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},h.furthestTileCorner=function(s){const r=Math.round((s+45+360)%360/90)%4;return ze[r]},h.getAABBPointSquareDist=function(s,r,a){let u=0;for(let f=0;f<2;++f){const g=a?a[f]:0;s[f]>g&&(u+=(s[f]-g)*(s[f]-g)),r[f]<g&&(u+=(g-r[f])*(g-r[f]))}return u},h.getAnchorAlignment=af,h.getAnchorJustification=pf,h.getBounds=function(s){let r=1/0,a=1/0,u=-1/0,f=-1/0;for(const g of s)r=Math.min(r,g.x),a=Math.min(a,g.y),u=Math.max(u,g.x),f=Math.max(f,g.y);return{min:new $(r,a),max:new $(u,f)}},h.getColumn=function(s,r){return[s[4*r],s[4*r+1],s[4*r+2],s[4*r+3]]},h.getGridMatrix=function(s,r){const[a,u]=r,f=.015625;return[0,(u[1]-a[1])*f,1<<s.z,(u[0]-a[0])*f,0,s.y,a[0],a[1],f]},h.getImage=It,h.getJSON=function(s,r){return oe(it(s,{type:"json"}),r)},h.getMapSessionAPI=Js,h.getPerformanceMeasurement=qp,h.getProjection=function(s){const r=s.parallels,a=!!r&&Math.abs(r[0]+r[1])<.01;switch(s.name){case"mercator":return new Gv(s);case"equirectangular":return new p_(s);case"naturalEarth":return new Zv(s);case"equalEarth":return new f_(s);case"winkelTripel":return new Ob(s);case"albers":return a?new cm(s):new Hv(s);case"lambertConformalConic":return a?new cm(s):new qv(s)}throw new Error(`Invalid projection name: ${s.name}`)},h.getRTLTextPluginStatus=bh,h.getReferrer=j,h.getTilePoint=function(s,{x:r,y:a},u=0){return new $(((r-u)*s.scale-s.x)*In,(a*s.scale-s.y)*In)},h.getTileVec3=function(s,r,a=0){return Ah(((r.x-a)*s.scale-s.x)*In,(r.y*s.scale-s.y)*In,jd(r.z,r.y))},h.getVideo=function(s,r){const a=W.document.createElement("video");a.muted=!0,a.onloadstart=function(){r(null,a)};for(let u=0;u<s.length;u++){const f=W.document.createElement("source");Oe(s[u])||(a.crossOrigin="Anonymous"),f.src=s[u],a.appendChild(f)}return{cancel:()=>{}}},h.globeECEFOrigin=function(s,r){const a=[0,0,0];return Du(a,a,Yp(Fc(r.canonical))),Du(a,a,s),a},h.globePixelsToTileUnits=function(s,r){return In/(512*Math.pow(2,s))*Kp(Fc(r))},h.globePoleMatrixForTile=function(s,r,a){const u=ka(new Float64Array(16)),f=1<<s,g=360*(r/f-.5),y=a.point,x=a.worldSize/(a.tileSize*f);return Eu(u,u,[y.x,y.y,-a.worldSize/Math.PI/2]),Ec(u,u,[x,x,x]),lg(u,u,ue(-a._center.lat)),cg(u,u,ue(-a._center.lng+g)),Float32Array.from(u)},h.globeTileLatLngCorners=Wp,h.globeToMercatorTransition=function(s){return re(5,6,s)},h.identity=ka,h.identity$1=pg,h.invert=function(s,r){var a=r[0],u=r[1],f=r[2],g=r[3],y=r[4],x=r[5],E=r[6],D=r[7],I=r[8],A=r[9],k=r[10],F=r[11],V=r[12],Z=r[13],ee=r[14],le=r[15],ve=a*x-u*y,Pe=a*E-f*y,Re=a*D-g*y,Le=u*E-f*x,Fe=u*D-g*x,Ye=f*D-g*E,Qe=I*Z-A*V,at=I*ee-k*V,ft=I*le-F*V,qe=A*ee-k*Z,tt=A*le-F*Z,mt=k*le-F*ee,Tt=ve*mt-Pe*tt+Re*qe+Le*ft-Fe*at+Ye*Qe;return Tt?(s[0]=(x*mt-E*tt+D*qe)*(Tt=1/Tt),s[1]=(f*tt-u*mt-g*qe)*Tt,s[2]=(Z*Ye-ee*Fe+le*Le)*Tt,s[3]=(k*Fe-A*Ye-F*Le)*Tt,s[4]=(E*ft-y*mt-D*at)*Tt,s[5]=(a*mt-f*ft+g*at)*Tt,s[6]=(ee*Re-V*Ye-le*Pe)*Tt,s[7]=(I*Ye-k*Re+F*Pe)*Tt,s[8]=(y*tt-x*ft+D*Qe)*Tt,s[9]=(u*ft-a*tt-g*Qe)*Tt,s[10]=(V*Fe-Z*Re+le*ve)*Tt,s[11]=(A*Re-I*Fe-F*ve)*Tt,s[12]=(x*at-y*qe-E*Qe)*Tt,s[13]=(a*qe-u*at+f*Qe)*Tt,s[14]=(Z*Pe-V*Le-ee*ve)*Tt,s[15]=(I*Le-A*Pe+k*ve)*Tt,s):null},h.isMapAuthenticated=function(s){return Oi.has(s)},h.isMapboxURL=Ki,h.isSafariWithAntialiasingBug=function(s){const r=s.navigator?s.navigator.userAgent:null;return!!Rn(s)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},h.latFromMercatorY=Zi,h.len=Eb,h.length=dg,h.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},h.loadVectorTile=d_,h.makeRequest=oe,h.mercatorXfromLng=qs,h.mercatorYfromLat=bc,h.mercatorZfromAltitude=Pa,h.mul=ug,h.mul$1=dp,h.multiply=function(s,r,a){var u=r[0],f=r[1],g=r[2],y=r[3],x=r[4],E=r[5],D=r[6],I=r[7],A=r[8],k=a[0],F=a[1],V=a[2],Z=a[3],ee=a[4],le=a[5],ve=a[6],Pe=a[7],Re=a[8];return s[0]=k*u+F*y+V*D,s[1]=k*f+F*x+V*I,s[2]=k*g+F*E+V*A,s[3]=Z*u+ee*y+le*D,s[4]=Z*f+ee*x+le*I,s[5]=Z*g+ee*E+le*A,s[6]=ve*u+Pe*y+Re*D,s[7]=ve*f+Pe*x+Re*I,s[8]=ve*g+Pe*E+Re*A,s},h.multiply$1=ag,h.multiply$2=Ph,h.nextPowerOfTwo=Et,h.normalize=Cu,h.normalize$1=function(s,r){var a=r[0],u=r[1],f=r[2],g=r[3],y=a*a+u*u+f*f+g*g;return y>0&&(y=1/Math.sqrt(y)),s[0]=a*y,s[1]=u*y,s[2]=f*y,s[3]=g*y,s},h.number=Pt,h.ortho=function(s,r,a,u,f,g,y){var x=1/(r-a),E=1/(u-f),D=1/(g-y);return s[0]=-2*x,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*E,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*D,s[11]=0,s[12]=(r+a)*x,s[13]=(f+u)*E,s[14]=(y+g)*D,s[15]=1,s},h.pbf=jh,h.perspective=function(s,r,a,u,f){var g,y=1/Math.tan(r/2);return s[0]=y/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=y,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,null!=f&&f!==1/0?(s[10]=(f+u)*(g=1/(u-f)),s[14]=2*f*u*g):(s[10]=-1,s[14]=-2*u),s},h.pick=function(s,r){const a={};for(let u=0;u<r.length;u++){const f=r[u];f in s&&(a[f]=s[f])}return a},h.plugin=fo,h.pointGeometry=$,h.polygonIntersectsBox=cp,h.polygonIntersectsPolygon=rg,h.polygonizeBounds=function(s,r,a=0,u=!0){const f=new $(a,a),g=s.sub(f),y=r.add(f),x=[g,new $(y.x,g.y),y,new $(g.x,y.y)];return u&&x.push(g),x},h.posAttributes=Wh,h.postMapLoadEvent=Ys,h.postTurnstileEvent=hs,h.potpack=Lp,h.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},h.radToDeg=Ce,h.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],h.registerForPluginStateChange=function(s){return s({pluginStatus:Co,pluginURL:qi}),xh.on("pluginStateChange",s),s},h.removeAuthState=function(s){Oi.delete(s)},h.renderColorRamp=_p,h.rotateX=lg,h.rotateX$1=mg,h.rotateY=cg,h.rotateZ=function(s,r,a){var u=Math.sin(a),f=Math.cos(a),g=r[0],y=r[1],x=r[2],E=r[3],D=r[4],I=r[5],A=r[6],k=r[7];return r!==s&&(s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=g*f+D*u,s[1]=y*f+I*u,s[2]=x*f+A*u,s[3]=E*f+k*u,s[4]=D*f-g*u,s[5]=I*f-y*u,s[6]=A*f-x*u,s[7]=k*f-E*u,s},h.rotateZ$1=function(s,r,a){a*=.5;var u=r[0],f=r[1],g=r[2],y=r[3],x=Math.sin(a),E=Math.cos(a);return s[0]=u*E+f*x,s[1]=f*E-u*x,s[2]=g*E+y*x,s[3]=y*E-g*x,s},h.scale=Ec,h.scale$1=function(s,r,a){return s[0]=r[0]*a,s[1]=r[1]*a,s[2]=r[2]*a,s[3]=r[3]*a,s},h.scale$2=dl,h.scaleAndAdd=Hd,h.setCacheLimits=function(s,r){Qn=s,ao=r},h.setColumn=function(s,r,a){s[4*r+0]=a[0],s[4*r+1]=a[1],s[4*r+2]=a[2],s[4*r+3]=a[3]},h.setRTLTextPlugin=function(s,r,a=!1){if(Co===yh||Co===es||Co===il)throw new Error("setRTLTextPlugin cannot be called multiple times.");qi=dr.resolveURL(s),Co=yh,vh=r,sl(),a||yc()},h.smoothstep=re,h.spec=$e,h.storeAuthState=function(s,r){r?Oi.add(s):Oi.delete(s)},h.sub=Hl,h.subtract=fg,h.symbolSize=ef,h.tileAABB=function(s,r,a,u,f,g,y,x,E){if("globe"===E.name)return function Qg(s,r,a){const u=r/s.worldSize,f=(tt,mt)=>{dl(tt,tt,u),dl(mt,mt,u)},g=Number.MAX_VALUE,y=[-g,-g,-g],x=[g,g,g],E=n_(s);if(a.z<=1){const tt=Fc(a).getCorners();for(let mt=0;mt<tt.length;mt++)Du(tt[mt],tt[mt],E),Gd(x,x,tt[mt]),Ws(y,y,tt[mt]);return f(x,y),new vs(x,y)}const[D,I]=Wp(a),A=new Hs;A.setSouthWest([D[1],I[0]]),A.setNorthEast([I[1],D[0]]);const k=[gl(A.getSouth(),A.getWest()),gl(A.getSouth(),A.getEast()),gl(A.getNorth(),A.getEast()),gl(A.getNorth(),A.getWest())];for(let tt=0;tt<k.length;tt++)Du(k[tt],k[tt],E),Gd(x,x,k[tt]),Ws(y,y,k[tt]);if(A.contains(s.center))return y[2]=0,f(x,y),new vs(x,y);const F=[E[12],E[13],E[14]],V=s.center.lng,Z=J(s.center.lat,-85.051129,ys),ee=[qs(V),bc(Z)],le=A.getCenter().lng,ve=J(A.getCenter().lat,-85.051129,ys),Pe=[qs(le),bc(ve)];let Re=new Array(3),Le=0;const Fe=ee[0]-Pe[0],Ye=ee[1]-Pe[1];if(Math.abs(Fe)>Math.abs(Ye))Le=Fe>=0?1:3,Re=F;else{Le=Ye>=0?0:2;const tt=[E[4],E[5],E[6]];let mt;mt=Ye>=0?-Math.sin(ue(A.getSouth()))*ju:-Math.sin(ue(A.getNorth()))*ju,Re=Hd(Re,F,tt,mt)}const Qe=k[Le],at=k[(Le+1)%4],ft=new Rb(Qe,at,Re),qe=[Zp(ft,0)||Qe[0],Zp(ft,1)||Qe[1],Zp(ft,2)||Qe[2]];return x[2]=Math.min(Qe[2],at[2]),Gd(x,x,qe),Ws(y,y,qe),f(x,y),new vs(x,y)}(s,r,new $u(a,u,f));const D=Xl({z:a,x:u,y:f},E);return new vs([(g+D.x/D.scale)*r,r*(D.y/D.scale),y],[(g+D.x2/D.scale)*r,r*(D.y2/D.scale),x])},h.tileTransform=Xl,h.transformMat3=function(s,r,a){var u=r[0],f=r[1],g=r[2];return s[0]=u*a[0]+f*a[3]+g*a[6],s[1]=u*a[1]+f*a[4]+g*a[7],s[2]=u*a[2]+f*a[5]+g*a[8],s},h.transformMat4=Du,h.transformMat4$1=kh,h.transformQuat=Zy,h.translate=Eu,h.transpose=function(s,r){if(s===r){var a=r[1],u=r[2],f=r[5];s[1]=r[3],s[2]=r[6],s[3]=a,s[5]=r[7],s[6]=u,s[7]=f}else s[0]=r[0],s[1]=r[3],s[2]=r[6],s[3]=r[1],s[4]=r[4],s[5]=r[7],s[6]=r[2],s[7]=r[5],s[8]=r[8];return s},h.triggerPluginCompletionEvent=ol,h.uniqueId=kt,h.validateCustomStyleLayer=function(s){const r=[],a=s.id;return void 0===a&&r.push({message:`layers.${a}: missing required property "id"`}),void 0===s.render&&r.push({message:`layers.${a}: missing required method "render"`}),s.renderingMode&&"2d"!==s.renderingMode&&"3d"!==s.renderingMode&&r.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),r},h.validateFilter=s=>js(ra(s)),h.validateFog=s=>js(ah(s)),h.validateLayer=s=>js(hu(s)),h.validateLight=s=>js(Pd(s)),h.validateSource=s=>js(Ad(s)),h.validateStyle=or,h.validateTerrain=s=>js(kd(s)),h.values=He,h.vectorTile=ql,h.version=U,h.warnOnce=hn,h.window=W,h.wrap=Ie}),we(0,function(h){function U(ne){if("number"==typeof ne||"boolean"==typeof ne||"string"==typeof ne||null==ne)return JSON.stringify(ne);if(Array.isArray(ne)){let j="[";for(const oe of ne)j+=`${U(oe)},`;return`${j}]`}let N="{";for(const j of Object.keys(ne).sort())N+=`${j}:${U(ne[j])},`;return`${N}}`}function Y(ne){let N="";for(const j of h.refProperties)N+=`/${U(ne[j])}`;return N}class ie{constructor(N){this.keyCache={},N&&this.replace(N)}replace(N){this._layerConfigs={},this._layers={},this.update(N,[])}update(N,j){for(const se of N)this._layerConfigs[se.id]=se,(this._layers[se.id]=h.createStyleLayer(se)).compileFilter(),this.keyCache[se.id]&&delete this.keyCache[se.id];for(const se of j)delete this.keyCache[se],delete this._layerConfigs[se],delete this._layers[se];this.familiesBySource={};const oe=function(se,De){const Me={};for(let ke=0;ke<se.length;ke++){const je=De&&De[se[ke].id]||Y(se[ke]);De&&(De[se[ke].id]=je);let st=Me[je];st||(st=Me[je]=[]),st.push(se[ke])}const Oe=[];for(const ke in Me)Oe.push(Me[ke]);return Oe}(h.values(this._layerConfigs),this.keyCache);for(const se of oe){const De=se.map(It=>this._layers[It.id]),Me=De[0];if("none"===Me.visibility)continue;const Oe=Me.source||"";let ke=this.familiesBySource[Oe];ke||(ke=this.familiesBySource[Oe]={});const je=Me.sourceLayer||"_geojsonTileLayer";let st=ke[je];st||(st=ke[je]=[]),st.push(De)}}}class ${loadTile(N,j){const{uid:oe,encoding:se,rawImageData:De,padding:Me,buildQuadTree:Oe}=N,ke=h.window.ImageBitmap&&De instanceof h.window.ImageBitmap?this.getImageData(De,Me):De;j(null,new h.DEMData(oe,ke,se,Me<1,Oe))}getImageData(N,j){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(N.width,N.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=N.width,this.offscreenCanvas.height=N.height,this.offscreenCanvasContext.drawImage(N,0,0,N.width,N.height);const oe=this.offscreenCanvasContext.getImageData(-j,-j,N.width+2*j,N.height+2*j);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),oe}}var K=function ne(N,j){var oe,se=N&&N.type;if("FeatureCollection"===se)for(oe=0;oe<N.features.length;oe++)ne(N.features[oe],j);else if("GeometryCollection"===se)for(oe=0;oe<N.geometries.length;oe++)ne(N.geometries[oe],j);else if("Feature"===se)ne(N.geometry,j);else if("Polygon"===se)W(N.coordinates,j);else if("MultiPolygon"===se)for(oe=0;oe<N.coordinates.length;oe++)W(N.coordinates[oe],j);return N};function W(ne,N){if(0!==ne.length){ge(ne[0],N);for(var j=1;j<ne.length;j++)ge(ne[j],!N)}}function ge(ne,N){for(var j=0,oe=0,se=0,De=ne.length,Me=De-1;se<De;Me=se++){var Oe=(ne[se][0]-ne[Me][0])*(ne[Me][1]+ne[se][1]),ke=j+Oe;oe+=Math.abs(j)>=Math.abs(Oe)?j-ke+Oe:Oe-ke+j,j=ke}j+oe>=0!=!!N&&ne.reverse()}const ce=h.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ue{constructor(N){this._feature=N,this.extent=h.EXTENT,this.type=N.type,this.properties=N.tags,"id"in N&&!isNaN(N.id)&&(this.id=parseInt(N.id,10))}loadGeometry(){if(1===this._feature.type){const N=[];for(const j of this._feature.geometry)N.push([new h.pointGeometry(j[0],j[1])]);return N}{const N=[];for(const j of this._feature.geometry){const oe=[];for(const se of j)oe.push(new h.pointGeometry(se[0],se[1]));N.push(oe)}return N}}toGeoJSON(N,j,oe){return ce.call(this,N,j,oe)}}class Ce{constructor(N){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=h.EXTENT,this.length=N.length,this._features=N}feature(N){return new ue(this._features[N])}}var ze=h.vectorTile.VectorTileFeature,Q=Ee;function Ee(ne,N){this.options=N||{},this.features=ne,this.length=ne.length}function Ae(ne,N){this.id="number"==typeof ne.id?ne.id:void 0,this.type=ne.type,this.rawGeometry=1===ne.type?[ne.geometry]:ne.geometry,this.properties=ne.tags,this.extent=N||4096}Ee.prototype.feature=function(ne){return new Ae(this.features[ne],this.options.extent)},Ae.prototype.loadGeometry=function(){var ne=this.rawGeometry;this.geometry=[];for(var N=0;N<ne.length;N++){for(var j=ne[N],oe=[],se=0;se<j.length;se++)oe.push(new h.pointGeometry(j[se][0],j[se][1]));this.geometry.push(oe)}return this.geometry},Ae.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ne=this.geometry,N=1/0,j=-1/0,oe=1/0,se=-1/0,De=0;De<ne.length;De++)for(var Me=ne[De],Oe=0;Oe<Me.length;Oe++){var ke=Me[Oe];N=Math.min(N,ke.x),j=Math.max(j,ke.x),oe=Math.min(oe,ke.y),se=Math.max(se,ke.y)}return[N,oe,j,se]},Ae.prototype.toGeoJSON=ze.prototype.toGeoJSON;var J=Ie,re=Q;function Ie(ne){var N=new h.pbf;return function(j,oe){for(var se in j.layers)oe.writeMessage(3,Be,j.layers[se])}(ne,N),N.finish()}function Be(ne,N){var j;N.writeVarintField(15,ne.version||1),N.writeStringField(1,ne.name||""),N.writeVarintField(5,ne.extent||4096);var oe={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<ne.length;j++)oe.feature=ne.feature(j),N.writeMessage(2,He,oe);var se=oe.keys;for(j=0;j<se.length;j++)N.writeStringField(3,se[j]);var De=oe.values;for(j=0;j<De.length;j++)N.writeMessage(4,Et,De[j])}function He(ne,N){var j=ne.feature;void 0!==j.id&&N.writeVarintField(1,j.id),N.writeMessage(2,it,ne),N.writeVarintField(3,j.type),N.writeMessage(4,_t,j)}function it(ne,N){var j=ne.feature,oe=ne.keys,se=ne.values,De=ne.keycache,Me=ne.valuecache;for(var Oe in j.properties){var ke=j.properties[Oe],je=De[Oe];if(null!==ke){void 0===je&&(oe.push(Oe),De[Oe]=je=oe.length-1),N.writeVarint(je);var st=typeof ke;"string"!==st&&"boolean"!==st&&"number"!==st&&(ke=JSON.stringify(ke));var It=st+":"+ke,ot=Me[It];void 0===ot&&(se.push(ke),Me[It]=ot=se.length-1),N.writeVarint(ot)}}}function gt(ne,N){return(N<<3)+(7&ne)}function kt(ne){return ne<<1^ne>>31}function _t(ne,N){for(var j=ne.loadGeometry(),oe=ne.type,se=0,De=0,Me=j.length,Oe=0;Oe<Me;Oe++){var ke=j[Oe],je=1;1===oe&&(je=ke.length),N.writeVarint(gt(1,je));for(var st=3===oe?ke.length-1:ke.length,It=0;It<st;It++){1===It&&1!==oe&&N.writeVarint(gt(2,st-1));var ot=ke[It].x-se,on=ke[It].y-De;N.writeVarint(kt(ot)),N.writeVarint(kt(on)),se+=ot,De+=on}3===oe&&N.writeVarint(gt(7,1))}}function Et(ne,N){var j=typeof ne;"string"===j?N.writeStringField(1,ne):"boolean"===j?N.writeBooleanField(7,ne):"number"===j&&(ne%1!=0?N.writeDoubleField(3,ne):ne<0?N.writeSVarintField(6,ne):N.writeVarintField(5,ne))}function Lt(ne,N,j,oe,se,De){if(se-oe<=j)return;const Me=oe+se>>1;ut(ne,N,Me,oe,se,De%2),Lt(ne,N,j,oe,Me-1,De+1),Lt(ne,N,j,Me+1,se,De+1)}function ut(ne,N,j,oe,se,De){for(;se>oe;){if(se-oe>600){const je=se-oe+1,st=j-oe+1,It=Math.log(je),ot=.5*Math.exp(2*It/3),on=.5*Math.sqrt(It*ot*(je-ot)/je)*(st-je/2<0?-1:1);ut(ne,N,j,Math.max(oe,Math.floor(j-st*ot/je+on)),Math.min(se,Math.floor(j+(je-st)*ot/je+on)),De)}const Me=N[2*j+De];let Oe=oe,ke=se;for(rt(ne,N,oe,j),N[2*se+De]>Me&&rt(ne,N,oe,se);Oe<ke;){for(rt(ne,N,Oe,ke),Oe++,ke--;N[2*Oe+De]<Me;)Oe++;for(;N[2*ke+De]>Me;)ke--}N[2*oe+De]===Me?rt(ne,N,oe,ke):(ke++,rt(ne,N,ke,se)),ke<=j&&(oe=ke+1),j<=ke&&(se=ke-1)}}function rt(ne,N,j,oe){un(ne,j,oe),un(N,2*j,2*oe),un(N,2*j+1,2*oe+1)}function un(ne,N,j){const oe=ne[N];ne[N]=ne[j],ne[j]=oe}function Cn(ne,N,j,oe){const se=ne-j,De=N-oe;return se*se+De*De}J.fromVectorTileJs=Ie,J.fromGeojsonVt=function(ne,N){N=N||{};var j={};for(var oe in ne)j[oe]=new Q(ne[oe].features,N),j[oe].name=oe,j[oe].version=N.version,j[oe].extent=N.extent;return Ie({layers:j})},J.GeoJSONWrapper=re;const an=ne=>ne[0],Ln=ne=>ne[1];class hn{constructor(N,j=an,oe=Ln,se=64,De=Float64Array){this.nodeSize=se,this.points=N;const Me=N.length<65536?Uint16Array:Uint32Array,Oe=this.ids=new Me(N.length),ke=this.coords=new De(2*N.length);for(let je=0;je<N.length;je++)Oe[je]=je,ke[2*je]=j(N[je]),ke[2*je+1]=oe(N[je]);Lt(Oe,ke,se,0,Oe.length-1,0)}range(N,j,oe,se){return function(De,Me,Oe,ke,je,st,It){const ot=[0,De.length-1,0],on=[];let Kt,Yt;for(;ot.length;){const rn=ot.pop(),$e=ot.pop(),rr=ot.pop();if($e-rr<=It){for(let Fn=rr;Fn<=$e;Fn++)Kt=Me[2*Fn],Yt=Me[2*Fn+1],Kt>=Oe&&Kt<=je&&Yt>=ke&&Yt<=st&&on.push(De[Fn]);continue}const Ht=Math.floor((rr+$e)/2);Kt=Me[2*Ht],Yt=Me[2*Ht+1],Kt>=Oe&&Kt<=je&&Yt>=ke&&Yt<=st&&on.push(De[Ht]);const Kn=(rn+1)%2;(0===rn?Oe<=Kt:ke<=Yt)&&(ot.push(rr),ot.push(Ht-1),ot.push(Kn)),(0===rn?je>=Kt:st>=Yt)&&(ot.push(Ht+1),ot.push($e),ot.push(Kn))}return on}(this.ids,this.coords,N,j,oe,se,this.nodeSize)}within(N,j,oe){return function(se,De,Me,Oe,ke,je){const st=[0,se.length-1,0],It=[],ot=ke*ke;for(;st.length;){const on=st.pop(),Kt=st.pop(),Yt=st.pop();if(Kt-Yt<=je){for(let Kn=Yt;Kn<=Kt;Kn++)Cn(De[2*Kn],De[2*Kn+1],Me,Oe)<=ot&&It.push(se[Kn]);continue}const rn=Math.floor((Yt+Kt)/2),$e=De[2*rn],rr=De[2*rn+1];Cn($e,rr,Me,Oe)<=ot&&It.push(se[rn]);const Ht=(on+1)%2;(0===on?Me-ke<=$e:Oe-ke<=rr)&&(st.push(Yt),st.push(rn-1),st.push(Ht)),(0===on?Me+ke>=$e:Oe+ke>=rr)&&(st.push(rn+1),st.push(Kt),st.push(Ht))}return It}(this.ids,this.coords,N,j,oe,this.nodeSize)}}const Bn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ne=>ne},sr=Math.fround||(Rt=new Float32Array(1),ne=>(Rt[0]=+ne,Rt[0]));var Rt;class kn{constructor(N){this.options=dr(Object.create(Bn),N),this.trees=new Array(this.options.maxZoom+1)}load(N){const{log:j,minZoom:oe,maxZoom:se,nodeSize:De}=this.options;j&&console.time("total time");const Me=`prepare ${N.length} points`;j&&console.time(Me),this.points=N;let Oe=[];for(let ke=0;ke<N.length;ke++)N[ke].geometry&&Oe.push(Ct(N[ke],ke));this.trees[se+1]=new hn(Oe,tr,xn,De,Float32Array),j&&console.timeEnd(Me);for(let ke=se;ke>=oe;ke--){const je=+Date.now();Oe=this._cluster(Oe,ke),this.trees[ke]=new hn(Oe,tr,xn,De,Float32Array),j&&console.log("z%d: %d clusters in %dms",ke,Oe.length,+Date.now()-je)}return j&&console.timeEnd("total time"),this}getClusters(N,j){let oe=((N[0]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,N[1]));let De=180===N[2]?180:((N[2]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)oe=-180,De=180;else if(oe>De){const st=this.getClusters([oe,se,180,Me],j),It=this.getClusters([-180,se,De,Me],j);return st.concat(It)}const Oe=this.trees[this._limitZoom(j)],ke=Oe.range(bt(oe),Rn(Me),bt(De),Rn(se)),je=[];for(const st of ke){const It=Oe.points[st];je.push(It.numPoints?Gt(It):this.points[It.index])}return je}getChildren(N){const j=this._getOriginId(N),oe=this._getOriginZoom(N),se="No cluster with the specified id.",De=this.trees[oe];if(!De)throw new Error(se);const Me=De.points[j];if(!Me)throw new Error(se);const Oe=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),ke=De.within(Me.x,Me.y,Oe),je=[];for(const st of ke){const It=De.points[st];It.parentId===N&&je.push(It.numPoints?Gt(It):this.points[It.index])}if(0===je.length)throw new Error(se);return je}getLeaves(N,j,oe){const se=[];return this._appendLeaves(se,N,j=j||10,oe=oe||0,0),se}getTile(N,j,oe){const se=this.trees[this._limitZoom(N)],De=Math.pow(2,N),{extent:Me,radius:Oe}=this.options,ke=Oe/Me,je=(oe-ke)/De,st=(oe+1+ke)/De,It={features:[]};return this._addTileFeatures(se.range((j-ke)/De,je,(j+1+ke)/De,st),se.points,j,oe,De,It),0===j&&this._addTileFeatures(se.range(1-ke/De,je,1,st),se.points,De,oe,De,It),j===De-1&&this._addTileFeatures(se.range(0,je,ke/De,st),se.points,-1,oe,De,It),It.features.length?It:null}getClusterExpansionZoom(N){let j=this._getOriginZoom(N)-1;for(;j<=this.options.maxZoom;){const oe=this.getChildren(N);if(j++,1!==oe.length)break;N=oe[0].properties.cluster_id}return j}_appendLeaves(N,j,oe,se,De){const Me=this.getChildren(j);for(const Oe of Me){const ke=Oe.properties;if(ke&&ke.cluster?De+ke.point_count<=se?De+=ke.point_count:De=this._appendLeaves(N,ke.cluster_id,oe,se,De):De<se?De++:N.push(Oe),N.length===oe)break}return De}_addTileFeatures(N,j,oe,se,De,Me){for(const Oe of N){const ke=j[Oe],je=ke.numPoints;let st,It,ot;if(je)st=pn(ke),It=ke.x,ot=ke.y;else{const Yt=this.points[ke.index];st=Yt.properties,It=bt(Yt.geometry.coordinates[0]),ot=Rn(Yt.geometry.coordinates[1])}const on={type:1,geometry:[[Math.round(this.options.extent*(It*De-oe)),Math.round(this.options.extent*(ot*De-se))]],tags:st};let Kt;je?Kt=ke.id:this.options.generateId?Kt=ke.index:this.points[ke.index].id&&(Kt=this.points[ke.index].id),void 0!==Kt&&(on.id=Kt),Me.features.push(on)}}_limitZoom(N){return Math.max(this.options.minZoom,Math.min(+N,this.options.maxZoom+1))}_cluster(N,j){const oe=[],{radius:se,extent:De,reduce:Me,minPoints:Oe}=this.options,ke=se/(De*Math.pow(2,j));for(let je=0;je<N.length;je++){const st=N[je];if(st.zoom<=j)continue;st.zoom=j;const It=this.trees[j+1],ot=It.within(st.x,st.y,ke),on=st.numPoints||1;let Kt=on;for(const Yt of ot){const rn=It.points[Yt];rn.zoom>j&&(Kt+=rn.numPoints||1)}if(Kt>on&&Kt>=Oe){let Yt=st.x*on,rn=st.y*on,$e=Me&&on>1?this._map(st,!0):null;const rr=(je<<5)+(j+1)+this.points.length;for(const Ht of ot){const Kn=It.points[Ht];if(Kn.zoom<=j)continue;Kn.zoom=j;const Fn=Kn.numPoints||1;Yt+=Kn.x*Fn,rn+=Kn.y*Fn,Kn.parentId=rr,Me&&($e||($e=this._map(st,!0)),Me($e,this._map(Kn)))}st.parentId=rr,oe.push(nt(Yt/Kt,rn/Kt,rr,Kt,$e))}else if(oe.push(st),Kt>1)for(const Yt of ot){const rn=It.points[Yt];rn.zoom<=j||(rn.zoom=j,oe.push(rn))}}return oe}_getOriginId(N){return N-this.points.length>>5}_getOriginZoom(N){return(N-this.points.length)%32}_map(N,j){if(N.numPoints)return j?dr({},N.properties):N.properties;const oe=this.points[N.index].properties,se=this.options.map(oe);return j&&se===oe?dr({},se):se}}function nt(ne,N,j,oe,se){return{x:sr(ne),y:sr(N),zoom:1/0,id:j,parentId:-1,numPoints:oe,properties:se}}function Ct(ne,N){const[j,oe]=ne.geometry.coordinates;return{x:sr(bt(j)),y:sr(Rn(oe)),zoom:1/0,index:N,parentId:-1}}function Gt(ne){return{type:"Feature",id:ne.id,properties:pn(ne),geometry:{type:"Point",coordinates:[(N=ne.x,360*(N-.5)),Hr(ne.y)]}};var N}function pn(ne){const N=ne.numPoints,j=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N;return dr(dr({},ne.properties),{cluster:!0,cluster_id:ne.id,point_count:N,point_count_abbreviated:j})}function bt(ne){return ne/360+.5}function Rn(ne){const N=Math.sin(ne*Math.PI/180),j=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return j<0?0:j>1?1:j}function Hr(ne){const N=(180-360*ne)*Math.PI/180;return 360*Math.atan(Math.exp(N))/Math.PI-90}function dr(ne,N){for(const j in N)ne[j]=N[j];return ne}function tr(ne){return ne.x}function xn(ne){return ne.y}function ar(ne,N,j,oe){for(var se,De=oe,Me=j-N>>1,Oe=j-N,ke=ne[N],je=ne[N+1],st=ne[j],It=ne[j+1],ot=N+3;ot<j;ot+=3){var on=Un(ne[ot],ne[ot+1],ke,je,st,It);if(on>De)se=ot,De=on;else if(on===De){var Kt=Math.abs(ot-Me);Kt<Oe&&(se=ot,Oe=Kt)}}De>oe&&(se-N>3&&ar(ne,N,se,oe),ne[se+2]=De,j-se>3&&ar(ne,se,j,oe))}function Un(ne,N,j,oe,se,De){var Me=se-j,Oe=De-oe;if(0!==Me||0!==Oe){var ke=((ne-j)*Me+(N-oe)*Oe)/(Me*Me+Oe*Oe);ke>1?(j=se,oe=De):ke>0&&(j+=Me*ke,oe+=Oe*ke)}return(Me=ne-j)*Me+(Oe=N-oe)*Oe}function ki(ne,N,j,oe){var se={id:void 0===ne?null:ne,type:N,geometry:j,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(De){var Me=De.geometry,Oe=De.type;if("Point"===Oe||"MultiPoint"===Oe||"LineString"===Oe)Wr(De,Me);else if("Polygon"===Oe||"MultiLineString"===Oe)for(var ke=0;ke<Me.length;ke++)Wr(De,Me[ke]);else if("MultiPolygon"===Oe)for(ke=0;ke<Me.length;ke++)for(var je=0;je<Me[ke].length;je++)Wr(De,Me[ke][je])}(se),se}function Wr(ne,N){for(var j=0;j<N.length;j+=3)ne.minX=Math.min(ne.minX,N[j]),ne.minY=Math.min(ne.minY,N[j+1]),ne.maxX=Math.max(ne.maxX,N[j]),ne.maxY=Math.max(ne.maxY,N[j+1])}function Vi(ne,N,j,oe){if(N.geometry){var se=N.geometry.coordinates,De=N.geometry.type,Me=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2),Oe=[],ke=N.id;if(j.promoteId?ke=N.properties[j.promoteId]:j.generateId&&(ke=oe||0),"Point"===De)ko(se,Oe);else if("MultiPoint"===De)for(var je=0;je<se.length;je++)ko(se[je],Oe);else if("LineString"===De)Br(se,Oe,Me,!1);else if("MultiLineString"===De){if(j.lineMetrics){for(je=0;je<se.length;je++)Br(se[je],Oe=[],Me,!1),ne.push(ki(ke,"LineString",Oe,N.properties));return}oo(se,Oe,Me,!1)}else if("Polygon"===De)oo(se,Oe,Me,!0);else{if("MultiPolygon"!==De){if("GeometryCollection"===De){for(je=0;je<N.geometry.geometries.length;je++)Vi(ne,{id:ke,geometry:N.geometry.geometries[je],properties:N.properties},j,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(je=0;je<se.length;je++){var st=[];oo(se[je],st,Me,!0),Oe.push(st)}}ne.push(ki(ke,De,Oe,N.properties))}}function ko(ne,N){N.push(Ki(ne[0])),N.push(Zo(ne[1])),N.push(0)}function Br(ne,N,j,oe){for(var se,De,Me=0,Oe=0;Oe<ne.length;Oe++){var ke=Ki(ne[Oe][0]),je=Zo(ne[Oe][1]);N.push(ke),N.push(je),N.push(0),Oe>0&&(Me+=oe?(se*je-ke*De)/2:Math.sqrt(Math.pow(ke-se,2)+Math.pow(je-De,2))),se=ke,De=je}var st=N.length-3;N[2]=1,ar(N,0,st,j),N[st+2]=1,N.size=Math.abs(Me),N.start=0,N.end=N.size}function oo(ne,N,j,oe){for(var se=0;se<ne.length;se++){var De=[];Br(ne[se],De,j,oe),N.push(De)}}function Ki(ne){return ne/360+.5}function Zo(ne){var N=Math.sin(ne*Math.PI/180),j=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return j<0?0:j>1?1:j}function mi(ne,N,j,oe,se,De,Me,Oe){if(oe/=N,De>=(j/=N)&&Me<oe)return ne;if(Me<j||De>=oe)return null;for(var ke=[],je=0;je<ne.length;je++){var st=ne[je],It=st.geometry,ot=st.type,on=0===se?st.minX:st.minY,Kt=0===se?st.maxX:st.maxY;if(on>=j&&Kt<oe)ke.push(st);else if(!(Kt<j||on>=oe)){var Yt=[];if("Point"===ot||"MultiPoint"===ot)Ri(It,Yt,j,oe,se);else if("LineString"===ot)so(It,Yt,j,oe,se,!1,Oe.lineMetrics);else if("MultiLineString"===ot)us(It,Yt,j,oe,se,!1);else if("Polygon"===ot)us(It,Yt,j,oe,se,!0);else if("MultiPolygon"===ot)for(var rn=0;rn<It.length;rn++){var $e=[];us(It[rn],$e,j,oe,se,!0),$e.length&&Yt.push($e)}if(Yt.length){if(Oe.lineMetrics&&"LineString"===ot){for(rn=0;rn<Yt.length;rn++)ke.push(ki(st.id,ot,Yt[rn],st.tags));continue}"LineString"!==ot&&"MultiLineString"!==ot||(1===Yt.length?(ot="LineString",Yt=Yt[0]):ot="MultiLineString"),"Point"!==ot&&"MultiPoint"!==ot||(ot=3===Yt.length?"Point":"MultiPoint"),ke.push(ki(st.id,ot,Yt,st.tags))}}}return ke.length?ke:null}function Ri(ne,N,j,oe,se){for(var De=0;De<ne.length;De+=3){var Me=ne[De+se];Me>=j&&Me<=oe&&(N.push(ne[De]),N.push(ne[De+1]),N.push(ne[De+2]))}}function so(ne,N,j,oe,se,De,Me){for(var Oe,ke,je=Wo(ne),st=0===se?hs:Rs,It=ne.start,ot=0;ot<ne.length-3;ot+=3){var on=ne[ot],Kt=ne[ot+1],Yt=ne[ot+2],rn=ne[ot+3],$e=ne[ot+4],rr=0===se?on:Kt,Ht=0===se?rn:$e,Kn=!1;Me&&(Oe=Math.sqrt(Math.pow(on-rn,2)+Math.pow(Kt-$e,2))),rr<j?Ht>j&&(ke=st(je,on,Kt,rn,$e,j),Me&&(je.start=It+Oe*ke)):rr>oe?Ht<oe&&(ke=st(je,on,Kt,rn,$e,oe),Me&&(je.start=It+Oe*ke)):ks(je,on,Kt,Yt),Ht<j&&rr>=j&&(ke=st(je,on,Kt,rn,$e,j),Kn=!0),Ht>oe&&rr<=oe&&(ke=st(je,on,Kt,rn,$e,oe),Kn=!0),!De&&Kn&&(Me&&(je.end=It+Oe*ke),N.push(je),je=Wo(ne)),Me&&(It+=Oe)}var Fn=ne.length-3;on=ne[Fn],Kt=ne[Fn+1],Yt=ne[Fn+2],(rr=0===se?on:Kt)>=j&&rr<=oe&&ks(je,on,Kt,Yt),Fn=je.length-3,De&&Fn>=3&&(je[Fn]!==je[0]||je[Fn+1]!==je[1])&&ks(je,je[0],je[1],je[2]),je.length&&N.push(je)}function Wo(ne){var N=[];return N.size=ne.size,N.start=ne.start,N.end=ne.end,N}function us(ne,N,j,oe,se,De){for(var Me=0;Me<ne.length;Me++)so(ne[Me],N,j,oe,se,De,!1)}function ks(ne,N,j,oe){ne.push(N),ne.push(j),ne.push(oe)}function hs(ne,N,j,oe,se,De){var Me=(De-N)/(oe-N);return ne.push(De),ne.push(j+(se-j)*Me),ne.push(1),Me}function Rs(ne,N,j,oe,se,De){var Me=(De-j)/(se-j);return ne.push(N+(oe-N)*Me),ne.push(De),ne.push(1),Me}function Ys(ne,N){for(var j=[],oe=0;oe<ne.length;oe++){var se,De=ne[oe],Me=De.type;if("Point"===Me||"MultiPoint"===Me||"LineString"===Me)se=wi(De.geometry,N);else if("MultiLineString"===Me||"Polygon"===Me){se=[];for(var Oe=0;Oe<De.geometry.length;Oe++)se.push(wi(De.geometry[Oe],N))}else if("MultiPolygon"===Me)for(se=[],Oe=0;Oe<De.geometry.length;Oe++){for(var ke=[],je=0;je<De.geometry[Oe].length;je++)ke.push(wi(De.geometry[Oe][je],N));se.push(ke)}j.push(ki(De.id,Me,se,De.tags))}return j}function wi(ne,N){var j=[];j.size=ne.size,void 0!==ne.start&&(j.start=ne.start,j.end=ne.end);for(var oe=0;oe<ne.length;oe+=3)j.push(ne[oe]+N,ne[oe+1],ne[oe+2]);return j}function Js(ne,N){if(ne.transformed)return ne;var j,oe,se,De=1<<ne.z,Me=ne.x,Oe=ne.y;for(j=0;j<ne.features.length;j++){var ke=ne.features[j],je=ke.geometry,st=ke.type;if(ke.geometry=[],1===st)for(oe=0;oe<je.length;oe+=2)ke.geometry.push(Oi(je[oe],je[oe+1],N,De,Me,Oe));else for(oe=0;oe<je.length;oe++){var It=[];for(se=0;se<je[oe].length;se+=2)It.push(Oi(je[oe][se],je[oe][se+1],N,De,Me,Oe));ke.geometry.push(It)}}return ne.transformed=!0,ne}function Oi(ne,N,j,oe,se,De){return[Math.round(j*(ne*oe-se)),Math.round(j*(N*oe-De))]}function Os(ne,N,j,oe,se){for(var De=N===se.maxZoom?0:se.tolerance/((1<<N)*se.extent),Me={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:j,y:oe,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Oe=0;Oe<ne.length;Oe++){Me.numFeatures++,Ei(Me,ne[Oe],De,se);var ke=ne[Oe].minX,je=ne[Oe].minY,st=ne[Oe].maxX,It=ne[Oe].maxY;ke<Me.minX&&(Me.minX=ke),je<Me.minY&&(Me.minY=je),st>Me.maxX&&(Me.maxX=st),It>Me.maxY&&(Me.maxY=It)}return Me}function Ei(ne,N,j,oe){var se=N.geometry,De=N.type,Me=[];if("Point"===De||"MultiPoint"===De)for(var Oe=0;Oe<se.length;Oe+=3)Me.push(se[Oe]),Me.push(se[Oe+1]),ne.numPoints++,ne.numSimplified++;else if("LineString"===De)Xr(Me,se,ne,j,!1,!1);else if("MultiLineString"===De||"Polygon"===De)for(Oe=0;Oe<se.length;Oe++)Xr(Me,se[Oe],ne,j,"Polygon"===De,0===Oe);else if("MultiPolygon"===De)for(var ke=0;ke<se.length;ke++){var je=se[ke];for(Oe=0;Oe<je.length;Oe++)Xr(Me,je[Oe],ne,j,!0,0===Oe)}if(Me.length){var st=N.tags||null;if("LineString"===De&&oe.lineMetrics){for(var It in st={},N.tags)st[It]=N.tags[It];st.mapbox_clip_start=se.start/se.size,st.mapbox_clip_end=se.end/se.size}var ot={geometry:Me,type:"Polygon"===De||"MultiPolygon"===De?3:"LineString"===De||"MultiLineString"===De?2:1,tags:st};null!==N.id&&(ot.id=N.id),ne.features.push(ot)}}function Xr(ne,N,j,oe,se,De){var Me=oe*oe;if(oe>0&&N.size<(se?Me:oe))j.numPoints+=N.length/3;else{for(var Oe=[],ke=0;ke<N.length;ke+=3)(0===oe||N[ke+2]>Me)&&(j.numSimplified++,Oe.push(N[ke]),Oe.push(N[ke+1])),j.numPoints++;se&&function(je,st){for(var It=0,ot=0,on=je.length,Kt=on-2;ot<on;Kt=ot,ot+=2)It+=(je[ot]-je[Kt])*(je[ot+1]+je[Kt+1]);if(It>0===st)for(ot=0,on=je.length;ot<on/2;ot+=2){var Yt=je[ot],rn=je[ot+1];je[ot]=je[on-2-ot],je[ot+1]=je[on-1-ot],je[on-2-ot]=Yt,je[on-1-ot]=rn}}(Oe,De),ne.push(Oe)}}function Qn(ne,N){var j=(N=this.options=function(se,De){for(var Me in De)se[Me]=De[Me];return se}(Object.create(this.options),N)).debug;if(j&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");var se,De,Me,Oe,ke,je,oe=function(se,De){var Me=[];if("FeatureCollection"===se.type)for(var Oe=0;Oe<se.features.length;Oe++)Vi(Me,se.features[Oe],De,Oe);else Vi(Me,"Feature"===se.type?se:{geometry:se},De);return Me}(ne,N);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(se=oe,De=N,Me=De.buffer/De.extent,Oe=se,ke=mi(se,1,-1-Me,Me,0,-1,2,De),je=mi(se,1,1-Me,2+Me,0,-1,2,De),(ke||je)&&(Oe=mi(se,1,-Me,1+Me,0,-1,2,De)||[],ke&&(Oe=Ys(ke,1).concat(Oe)),je&&(Oe=Oe.concat(Ys(je,-1)))),oe=Oe).length&&this.splitTile(oe,0,0,0),j&&(oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ao(ne,N,j){return 32*((1<<ne)*j+N)+ne}function nr(ne,N){const j=ne.tileID.canonical;if(!this._geoJSONIndex)return N(null,null);const oe=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!oe)return N(null,null);const se=new Ce(oe.features);let De=J(se);0===De.byteOffset&&De.byteLength===De.buffer.byteLength||(De=new Uint8Array(De)),N(null,{vectorTile:se,rawData:De.buffer})}Qn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Qn.prototype.splitTile=function(ne,N,j,oe,se,De,Me){for(var Oe=[ne,N,j,oe],ke=this.options,je=ke.debug;Oe.length;){oe=Oe.pop(),j=Oe.pop(),N=Oe.pop(),ne=Oe.pop();var st=1<<N,It=ao(N,j,oe),ot=this.tiles[It];if(!ot&&(je>1&&console.time("creation"),ot=this.tiles[It]=Os(ne,N,j,oe,ke),this.tileCoords.push({z:N,x:j,y:oe}),je)){je>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,j,oe,ot.numFeatures,ot.numPoints,ot.numSimplified),console.timeEnd("creation"));var on="z"+N;this.stats[on]=(this.stats[on]||0)+1,this.total++}if(ot.source=ne,se){if(N===ke.maxZoom||N===se)continue;var Kt=1<<se-N;if(j!==Math.floor(De/Kt)||oe!==Math.floor(Me/Kt))continue}else if(N===ke.indexMaxZoom||ot.numPoints<=ke.indexMaxPoints)continue;if(ot.source=null,0!==ne.length){je>1&&console.time("clipping");var Yt,rn,$e,rr,Ht,Kn,Fn=.5*ke.buffer/ke.extent,ds=.5-Fn,Ro=.5+Fn,At=1+Fn;Yt=rn=$e=rr=null,Ht=mi(ne,st,j-Fn,j+Ro,0,ot.minX,ot.maxX,ke),Kn=mi(ne,st,j+ds,j+At,0,ot.minX,ot.maxX,ke),ne=null,Ht&&(Yt=mi(Ht,st,oe-Fn,oe+Ro,1,ot.minY,ot.maxY,ke),rn=mi(Ht,st,oe+ds,oe+At,1,ot.minY,ot.maxY,ke),Ht=null),Kn&&($e=mi(Kn,st,oe-Fn,oe+Ro,1,ot.minY,ot.maxY,ke),rr=mi(Kn,st,oe+ds,oe+At,1,ot.minY,ot.maxY,ke),Kn=null),je>1&&console.timeEnd("clipping"),Oe.push(Yt||[],N+1,2*j,2*oe),Oe.push(rn||[],N+1,2*j,2*oe+1),Oe.push($e||[],N+1,2*j+1,2*oe),Oe.push(rr||[],N+1,2*j+1,2*oe+1)}}},Qn.prototype.getTile=function(ne,N,j){var oe=this.options,se=oe.extent,De=oe.debug;if(ne<0||ne>24)return null;var Me=1<<ne,Oe=ao(ne,N=(N%Me+Me)%Me,j);if(this.tiles[Oe])return Js(this.tiles[Oe],se);De>1&&console.log("drilling down to z%d-%d-%d",ne,N,j);for(var ke,je=ne,st=N,It=j;!ke&&je>0;)je--,st=Math.floor(st/2),It=Math.floor(It/2),ke=this.tiles[ao(je,st,It)];return ke&&ke.source?(De>1&&console.log("found parent tile z%d-%d-%d",je,st,It),De>1&&console.time("drilling down"),this.splitTile(ke.source,je,st,It,ne,N,j),De>1&&console.timeEnd("drilling down"),this.tiles[Oe]?Js(this.tiles[Oe],se):null):null};class Ui extends h.VectorTileWorkerSource{constructor(N,j,oe,se,De){super(N,j,oe,se,nr),De&&(this.loadGeoJSON=De)}loadData(N,j){const oe=N&&N.request,se=oe&&oe.collectResourceTiming;this.loadGeoJSON(N,(De,Me)=>{if(De||!Me)return j(De);if("object"!=typeof Me)return j(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));{K(Me,!0);try{if(N.filter){const ke=h.createExpression(N.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ke.result)throw new Error(ke.value.map(st=>`${st.key}: ${st.message}`).join(", "));const je=Me.features.filter(st=>ke.value.evaluate({zoom:0},st));Me={type:"FeatureCollection",features:je}}this._geoJSONIndex=N.cluster?new kn(function({superclusterOptions:ke,clusterProperties:je}){if(!je||!ke)return ke;const st={},It={},ot={accumulated:null,zoom:0},on={properties:null},Kt=Object.keys(je);for(const Yt of Kt){const[rn,$e]=je[Yt],rr=h.createExpression($e),Ht=h.createExpression("string"==typeof rn?[rn,["accumulated"],["get",Yt]]:rn);st[Yt]=rr.value,It[Yt]=Ht.value}return ke.map=Yt=>{on.properties=Yt;const rn={};for(const $e of Kt)rn[$e]=st[$e].evaluate(ot,on);return rn},ke.reduce=(Yt,rn)=>{on.properties=rn;for(const $e of Kt)ot.accumulated=Yt[$e],Yt[$e]=It[$e].evaluate(ot,on)},ke}(N)).load(Me.features):new Qn(ke=Me,N.geojsonVtOptions)}catch(ke){return j(ke)}this.loaded={};const Oe={};if(se){const ke=h.getPerformanceMeasurement(oe);ke&&(Oe.resourceTiming={},Oe.resourceTiming[N.source]=JSON.parse(JSON.stringify(ke)))}j(null,Oe)}var ke})}reloadTile(N,j){const oe=this.loaded;return oe&&oe[N.uid]?super.reloadTile(N,j):this.loadTile(N,j)}loadGeoJSON(N,j){if(N.request)h.getJSON(N.request,j);else{if("string"!=typeof N.data)return j(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));try{return j(null,JSON.parse(N.data))}catch(oe){return j(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(N,j){try{j(null,this._geoJSONIndex.getClusterExpansionZoom(N.clusterId))}catch(oe){j(oe)}}getClusterChildren(N,j){try{j(null,this._geoJSONIndex.getChildren(N.clusterId))}catch(oe){j(oe)}}getClusterLeaves(N,j){try{j(null,this._geoJSONIndex.getLeaves(N.clusterId,N.limit,N.offset))}catch(oe){j(oe)}}}class Xo{constructor(N){this.self=N,this.actor=new h.Actor(N,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=h.getProjection({name:"mercator"}),this.workerSourceTypes={vector:h.VectorTileWorkerSource,geojson:Ui},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(j,oe)=>{if(this.workerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.workerSourceTypes[j]=oe},this.self.registerRTLTextPlugin=j=>{if(h.plugin.isParsed())throw new Error("RTL text plugin already registered.");h.plugin.applyArabicShaping=j.applyArabicShaping,h.plugin.processBidirectionalText=j.processBidirectionalText,h.plugin.processStyledBidirectionalText=j.processStyledBidirectionalText}}clearCaches(N,j,oe){delete this.layerIndexes[N],delete this.availableImages[N],delete this.workerSources[N],delete this.demWorkerSources[N],oe()}checkIfReady(N,j,oe){oe()}setReferrer(N,j){this.referrer=j}spriteLoaded(N,j){this.isSpriteLoaded[N]=j;for(const oe in this.workerSources[N]){const se=this.workerSources[N][oe];for(const De in se)se[De]instanceof h.VectorTileWorkerSource&&(se[De].isSpriteLoaded=j,se[De].fire(new h.Event("isSpriteLoaded")))}}setImages(N,j,oe){this.availableImages[N]=j;for(const se in this.workerSources[N]){const De=this.workerSources[N][se];for(const Me in De)De[Me].availableImages=j}oe()}enableTerrain(N,j,oe){this.terrain=j,oe()}setProjection(N,j){this.projections[N]=h.getProjection(j)}setLayers(N,j,oe){this.getLayerIndex(N).replace(j),oe()}updateLayers(N,j,oe){this.getLayerIndex(N).update(j.layers,j.removedIds),oe()}loadTile(N,j,oe){const se=this.enableTerrain?h.extend({enableTerrain:this.terrain},j):j;se.projection=this.projections[N]||this.defaultProjection,this.getWorkerSource(N,j.type,j.source).loadTile(se,oe)}loadDEMTile(N,j,oe){const se=this.enableTerrain?h.extend({buildQuadTree:this.terrain},j):j;this.getDEMWorkerSource(N,j.source).loadTile(se,oe)}reloadTile(N,j,oe){const se=this.enableTerrain?h.extend({enableTerrain:this.terrain},j):j;se.projection=this.projections[N]||this.defaultProjection,this.getWorkerSource(N,j.type,j.source).reloadTile(se,oe)}abortTile(N,j,oe){this.getWorkerSource(N,j.type,j.source).abortTile(j,oe)}removeTile(N,j,oe){this.getWorkerSource(N,j.type,j.source).removeTile(j,oe)}removeSource(N,j,oe){if(!this.workerSources[N]||!this.workerSources[N][j.type]||!this.workerSources[N][j.type][j.source])return;const se=this.workerSources[N][j.type][j.source];delete this.workerSources[N][j.type][j.source],void 0!==se.removeSource?se.removeSource(j,oe):oe()}loadWorkerSource(N,j,oe){try{this.self.importScripts(j.url),oe()}catch(se){oe(se.toString())}}syncRTLPluginState(N,j,oe){try{h.plugin.setState(j);const se=h.plugin.getPluginURL();if(h.plugin.isLoaded()&&!h.plugin.isParsed()&&null!=se){this.self.importScripts(se);const De=h.plugin.isParsed();oe(De?void 0:new Error(`RTL Text Plugin failed to import scripts from ${se}`),De)}}catch(se){oe(se.toString())}}getAvailableImages(N){let j=this.availableImages[N];return j||(j=[]),j}getLayerIndex(N){let j=this.layerIndexes[N];return j||(j=this.layerIndexes[N]=new ie),j}getWorkerSource(N,j,oe){return this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][j]||(this.workerSources[N][j]={}),this.workerSources[N][j][oe]||(this.workerSources[N][j][oe]=new this.workerSourceTypes[j]({send:(se,De,Me,Oe,ke,je)=>{this.actor.send(se,De,Me,N,ke,je)},scheduler:this.actor.scheduler},this.getLayerIndex(N),this.getAvailableImages(N),this.isSpriteLoaded[N])),this.workerSources[N][j][oe]}getDEMWorkerSource(N,j){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][j]||(this.demWorkerSources[N][j]=new $),this.demWorkerSources[N][j]}enforceCacheSizeLimit(N,j){h.enforceCacheSizeLimit(j)}getWorkerPerformanceMetrics(N,j,oe){oe(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Xo(self)),Xo}),we(0,function(h){var U=Y;function Y(m){return o=m,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,b,w=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(w);try{b=new Worker(T),_=!0}catch(M){_=!1}return b&&b.terminate(),URL.revokeObjectURL(T),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var b=_.getContext("2d");if(!b)return!1;var w=b.getImageData(0,0,1,1);return w&&w.width===_.width}()||(void 0===ie[d=o&&o.failIfMajorPerformanceCaveat]&&(ie[d]=function(_){var b,T,M,P,w=(T=_,M=document.createElement("canvas"),(P=Object.create(Y.webGLContextAttributes)).failIfMajorPerformanceCaveat=T,M.getContext("webgl",P)||M.getContext("experimental-webgl",P));if(!w)return!1;try{b=w.createShader(w.VERTEX_SHADER)}catch(T){return!1}return!(!b||w.isContextLost())&&(w.shaderSource(b,"void main() {}"),w.compileShader(b),!0===w.getShaderParameter(b,w.COMPILE_STATUS))}(d)),!ie[d]||document.documentMode));var o,d}var ie={};function $(m,o){if(Array.isArray(m)){if(!Array.isArray(o)||m.length!==o.length)return!1;for(let d=0;d<m.length;d++)if(!$(m[d],o[d]))return!1;return!0}if("object"==typeof m&&null!==m&&null!==o){if("object"!=typeof o||Object.keys(m).length!==Object.keys(o).length)return!1;for(const d in m)if(!$(m[d],o[d]))return!1;return!0}return m===o}function K(m,o,d){const _=h.window.document.createElement(m);return void 0!==o&&(_.className=o),d&&d.appendChild(_),_}function W(m,o,d){const _=h.window.document.createElementNS("http://www.w3.org/2000/svg",m);for(const b of Object.keys(o))_.setAttributeNS(null,b,o[b]);return d&&d.appendChild(_),_}Y.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ge=h.window.document&&h.window.document.documentElement.style,ce=ge&&void 0!==ge.userSelect?"userSelect":"WebkitUserSelect";let ue;function Ce(){ge&&ce&&(ue=ge[ce],ge[ce]="none")}function ze(){ge&&ce&&(ge[ce]=ue)}function Q(m){m.preventDefault(),m.stopPropagation(),h.window.removeEventListener("click",Q,!0)}function Ee(){h.window.addEventListener("click",Q,!0),h.window.setTimeout(()=>{h.window.removeEventListener("click",Q,!0)},0)}function Ae(m,o){const d=m.getBoundingClientRect();return Ie(m,d,o)}function J(m,o){const d=m.getBoundingClientRect(),_=[];for(let b=0;b<o.length;b++)_.push(Ie(m,d,o[b]));return _}function re(m){return void 0!==h.window.InstallTrigger&&2===m.button&&m.ctrlKey&&h.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function Ie(m,o,d){const _=m.offsetWidth===o.width?1:m.offsetWidth/o.width;return new h.pointGeometry((d.clientX-o.left)*_,(d.clientY-o.top)*_)}function Be(m,o){var d=o[0],_=o[1],b=o[2],w=o[3],T=d*w-b*_;return T?(m[0]=w*(T=1/T),m[1]=-_*T,m[2]=-b*T,m[3]=d*T,m):null}function He(m){const{userImage:o}=m;return!!(o&&o.render&&o.render())&&(m.data.replace(new Uint8Array(o.data.buffer)),!0)}class it extends h.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:d,callback:_}of this.requestors)this._notify(d,_);this.requestors=[]}}hasImage(o){return!!this.getImage(o)}getImage(o){return this.images[o]}addImage(o,d){this._validate(o,d)&&(this.images[o]=d)}_validate(o,d){let _=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new h.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),_=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new h.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),_=!1),this._validateContent(d.content,d)||(this.fire(new h.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),_=!1),_}_validateStretch(o,d){if(!o)return!0;let _=0;for(const b of o){if(b[0]<_||b[1]<b[0]||d<b[1])return!1;_=b[1]}return!0}_validateContent(o,d){return!(o&&(4!==o.length||o[0]<0||d.data.width<o[0]||o[1]<0||d.data.height<o[1]||o[2]<0||d.data.width<o[2]||o[3]<0||d.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,d){d.version=this.images[o].version+1,this.images[o]=d,this.updatedImages[o]=!0}removeImage(o){const d=this.images[o];delete this.images[o],delete this.patterns[o],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,d){let _=!0;if(!this.isLoaded())for(const b of o)this.images[b]||(_=!1);this.isLoaded()||_?this._notify(o,d):this.requestors.push({ids:o,callback:d})}_notify(o,d){const _={};for(const b of o){this.images[b]||this.fire(new h.Event("styleimagemissing",{id:b}));const w=this.images[b];w?_[b]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:Boolean(w.userImage&&w.userImage.render)}:h.warnOnce(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,_)}getPixelSize(){const{width:o,height:d}=this.atlasImage;return{width:o,height:d}}getPattern(o){const d=this.patterns[o],_=this.getImage(o);if(!_)return null;if(d&&d.position.version===_.version)return d.position;if(d)d.position.version=_.version;else{const b={w:_.data.width+2,h:_.data.height+2,x:0,y:0},w=new h.ImagePosition(b,_);this.patterns[o]={bin:b,position:w}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const d=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new h.Texture(o,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const w in this.patterns)o.push(this.patterns[w].bin);const{w:d,h:_}=h.potpack(o),b=this.atlasImage;b.resize({width:d||1,height:_||1});for(const w in this.patterns){const{bin:T}=this.patterns[w],M=T.x+1,P=T.y+1,O=this.images[w].data,L=O.width,B=O.height;h.RGBAImage.copy(O,b,{x:0,y:0},{x:M,y:P},{width:L,height:B}),h.RGBAImage.copy(O,b,{x:0,y:B-1},{x:M,y:P-1},{width:L,height:1}),h.RGBAImage.copy(O,b,{x:0,y:0},{x:M,y:P+B},{width:L,height:1}),h.RGBAImage.copy(O,b,{x:L-1,y:0},{x:M-1,y:P},{width:1,height:B}),h.RGBAImage.copy(O,b,{x:0,y:0},{x:M+L,y:P},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const d of o){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const _=this.images[d];He(_)&&this.updateImage(d,_)}}}const gt=new h.Properties({anchor:new h.DataConstantProperty(h.spec.light.anchor),position:new class{constructor(){this.specification=h.spec.light.position}possiblyEvaluate(m,o){return function([d,_,b]){const w=h.degToRad(_+90),T=h.degToRad(b);return{x:d*Math.cos(w)*Math.sin(T),y:d*Math.sin(w)*Math.sin(T),z:d*Math.cos(T),azimuthal:_,polar:b}}(m.expression.evaluate(o))}interpolate(m,o,d){return{x:h.number(m.x,o.x,d),y:h.number(m.y,o.y,d),z:h.number(m.z,o.z,d),azimuthal:h.number(m.azimuthal,o.azimuthal,d),polar:h.number(m.polar,o.polar,d)}}},color:new h.DataConstantProperty(h.spec.light.color),intensity:new h.DataConstantProperty(h.spec.light.intensity)}),kt="-transition";class _t extends h.Evented{constructor(o){super(),this._transitionable=new h.Transitionable(gt),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,d={}){if(!this._validate(h.validateLight,o,d))for(const _ in o){const b=o[_];h.endsWith(_,kt)?this._transitionable.setTransition(_.slice(0,-kt.length),b):this._transitionable.setValue(_,b)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,_){return(!_||!1!==_.validate)&&h.emitValidationErrors(this,o.call(h.validateStyle,h.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:h.spec})))}}const Et=new h.Properties({source:new h.DataConstantProperty(h.spec.terrain.source),exaggeration:new h.DataConstantProperty(h.spec.terrain.exaggeration)}),Lt="-transition";class ut extends h.Evented{constructor(o,d){super(),this._transitionable=new h.Transitionable(Et),this.set(o),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=d}get(){return this._transitionable.serialize()}set(o){for(const d in o){const _=o[d];h.endsWith(d,Lt)?this._transitionable.setTransition(d.slice(0,-Lt.length),_):this._transitionable.setValue(d,_)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}}function rt(m,o,d,_){const b=h.smoothstep(45,65,d),[w,T]=un(m,_),M=h.length(o);let P=1-Math.min(1,Math.exp((M-w)/(T-w)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*b*m.alpha}function un(m,o){const d=.5/Math.tan(.5*o);return[m.range[0]+d,m.range[1]+d]}const Cn=new h.Properties({range:new h.DataConstantProperty(h.spec.fog.range),color:new h.DataConstantProperty(h.spec.fog.color),"horizon-blend":new h.DataConstantProperty(h.spec.fog["horizon-blend"])}),an="-transition";class Ln extends h.Evented{constructor(o,d){super(),this._transitionable=new h.Transitionable(Cn),this.set(o),this._transitioning=this._transitionable.untransitioned(),this._transform=d}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,d={}){if(!this._validate(h.validateFog,o,d))for(const _ in o){const b=o[_];h.endsWith(_,an)?this._transitionable.setTransition(_.slice(0,-an.length),b):this._transitionable.setValue(_,b)}}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return h.smoothstep(45,65,o)*d.a}getOpacityAtLatLng(o,d){return this._transform.projection.supportsFog?function(_,b,w){const T=h.MercatorCoordinate.fromLngLat(b),M=w.elevation?w.elevation.getAtPointOrZero(T):0,P=[T.x,T.y,M];return h.transformMat4(P,P,w.mercatorFogMatrix),rt(_,P,w.pitch,w._fov)}(this.state,o,d):0}getFovAdjustedRange(o){return this._transform.projection.supportsFog?un(this.state,o):[0,1]}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,_){return(!_||!1!==_.validate)&&h.emitValidationErrors(this,o.call(h.validateStyle,h.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:h.spec})))}}class hn{constructor(o,d){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=h.uniqueId();const _=this.workerPool.acquire(this.id);for(let b=0;b<_.length;b++){const w=new hn.Actor(_[b],d,this.id);w.name=`Worker ${b}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,d,_){h.asyncAll(this.actors,(b,w)=>{b.send(o,d,w)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Bn(m,o,d){return o*(h.EXTENT/(m.tileSize*Math.pow(2,d-m.tileID.overscaledZ)))}hn.Actor=h.Actor;class sr{constructor(o,d,_,b){this.screenBounds=o,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(w=>b.pointCoordinate3D(w)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(o,d){let _,b;if(o instanceof h.pointGeometry||"number"==typeof o[0]){const w=h.pointGeometry.convert(o);_=[h.pointGeometry.convert(o)],b=d.isPointAboveHorizon(w)}else{const w=h.pointGeometry.convert(o[0]),T=h.pointGeometry.convert(o[1]);_=[w,T],b=h.polygonizeBounds(w,T).every(M=>d.isPointAboveHorizon(M))}return new sr(_,d.getCameraPoint(),b,d)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(o){return h.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const d=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new h.pointGeometry(1,1)):this.screenBounds[1],b=h.polygonizeBounds(d,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<_.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?b[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(b[3]=this.cameraPoint)),h.bufferConvexPolygon(b,o)}containsTile(o,d,_){const b=o.queryPadding+1,w=o.tileID.wrap,T=_?this._bufferedCameraMercator(b,d).map(X=>h.getTilePoint(o.tileTransform,X,w)):this._bufferedScreenMercator(b,d).map(X=>h.getTilePoint(o.tileTransform,X,w)),M=this.screenGeometryMercator.map(X=>h.getTileVec3(o.tileTransform,X,w)),P=M.map(X=>new h.pointGeometry(X[0],X[1])),O=d.getFreeCameraOptions().position||new h.MercatorCoordinate(0,0,0),L=h.getTileVec3(o.tileTransform,O,w),B=M.map(X=>{const G=h.sub(X,X,L);return h.normalize(G,G),new h.Ray(L,G)}),H=Bn(o,1,d.zoom);if(h.polygonIntersectsBox(T,0,0,h.EXTENT,h.EXTENT))return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:B,bufferedTilespaceGeometry:T,bufferedTilespaceBounds:(te=h.getBounds(T),te.min.x=h.clamp(te.min.x,0,h.EXTENT),te.min.y=h.clamp(te.min.y,0,h.EXTENT),te.max.x=h.clamp(te.max.x,0,h.EXTENT),te.max.y=h.clamp(te.max.y,0,h.EXTENT),te),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:H};var te}_bufferedScreenMercator(o,d){const _=Rt(o);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{const b=this.bufferedScreenGeometry(o).map(w=>d.pointCoordinate3D(w));return this._screenRaycastCache[_]=b,b}}_bufferedCameraMercator(o,d){const _=Rt(o);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{const b=this.bufferedCameraGeometry(o).map(w=>d.pointCoordinate3D(w));return this._cameraRaycastCache[_]=b,b}}}function Rt(m){return 100*m|0}function kn(m,o,d){const _=function(b,w){if(b)return d(b);if(w){const T=h.pick(h.extend(w,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(T.vectorLayers=w.vector_layers,T.vectorLayerIds=T.vectorLayers.map(M=>M.id)),T.tiles=o.canonicalizeTileset(T,m.url),d(null,T)}};return m.url?h.getJSON(o.transformRequest(o.normalizeSourceURL(m.url),h.ResourceType.Source),_):h.exported.frame(()=>_(null,m))}class nt{constructor(o,d,_){this.bounds=h.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=d||0,this.maxzoom=_||24}validateBounds(o){return Array.isArray(o)&&4===o.length?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const d=Math.pow(2,o.z),_=Math.floor(h.mercatorXfromLng(this.bounds.getWest())*d),b=Math.floor(h.mercatorYfromLat(this.bounds.getNorth())*d),w=Math.ceil(h.mercatorXfromLng(this.bounds.getEast())*d),T=Math.ceil(h.mercatorYfromLat(this.bounds.getSouth())*d);return o.x>=_&&o.x<w&&o.y>=b&&o.y<T}}class Ct{constructor(o,d,_){this.context=o;const b=o.gl;this.buffer=b.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Gt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class pn{constructor(o,d,_,b){this.length=d.length,this.attributes=_,this.itemSize=d.bytesPerElement,this.dynamicDraw=b,this.context=o;const w=o.gl;this.buffer=w.createBuffer(),o.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,d){for(let _=0;_<this.attributes.length;_++){const b=d.attributes[this.attributes[_].name];void 0!==b&&o.enableVertexAttribArray(b)}}setVertexAttribPointers(o,d,_){for(let b=0;b<this.attributes.length;b++){const w=this.attributes[b],T=d.attributes[w.name];void 0!==T&&o.vertexAttribPointer(T,w.components,o[Gt[w.type]],!1,this.itemSize,w.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class bt{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Rn extends bt{getDefault(){return h.Color.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Hr extends bt{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class dr extends bt{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class tr extends bt{getDefault(){return[!0,!0,!0,!0]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class xn extends bt{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class ar extends bt{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Un extends bt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const d=this.current;(o.func!==d.func||o.ref!==d.ref||o.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class ki extends bt{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Wr extends bt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=o,this.dirty=!1}}class Vi extends bt{getDefault(){return[0,1]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class ko extends bt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=o,this.dirty=!1}}class Br extends bt{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class oo extends bt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.BLEND):d.disable(d.BLEND),this.current=o,this.dirty=!1}}class Ki extends bt{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Zo extends bt{getDefault(){return h.Color.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class mi extends bt{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Ri extends bt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=o,this.dirty=!1}}class so extends bt{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Wo extends bt{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class us extends bt{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class ks extends bt{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class hs extends bt{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Rs extends bt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Ys extends bt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class wi extends bt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Js extends bt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Oi extends bt{getDefault(){return null}set(o){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Os extends bt{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class Ei extends bt{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Xr extends bt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Qn extends bt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class ao extends bt{constructor(o,d){super(o),this.context=o,this.parent=d}getDefault(){return null}}class nr extends ao{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Ui extends ao{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Xo extends Ui{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ne{constructor(o,d,_,b){this.context=o,this.width=d,this.height=_;const w=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new nr(o,w),b&&(this.depthAttachment=new Ui(o,w))}destroy(){const o=this.context.gl,d=this.colorAttachment.get();if(d&&o.deleteTexture(d),this.depthAttachment){const _=this.depthAttachment.get();_&&o.deleteRenderbuffer(_)}o.deleteFramebuffer(this.framebuffer)}}class N{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Rn(this),this.clearDepth=new Hr(this),this.clearStencil=new dr(this),this.colorMask=new tr(this),this.depthMask=new xn(this),this.stencilMask=new ar(this),this.stencilFunc=new Un(this),this.stencilOp=new ki(this),this.stencilTest=new Wr(this),this.depthRange=new Vi(this),this.depthTest=new ko(this),this.depthFunc=new Br(this),this.blend=new oo(this),this.blendFunc=new Ki(this),this.blendColor=new Zo(this),this.blendEquation=new mi(this),this.cullFace=new Ri(this),this.cullFaceSide=new so(this),this.frontFace=new Wo(this),this.program=new us(this),this.activeTexture=new ks(this),this.viewport=new hs(this),this.bindFramebuffer=new Rs(this),this.bindRenderbuffer=new Ys(this),this.bindTexture=new wi(this),this.bindVertexBuffer=new Js(this),this.bindElementBuffer=new Oi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Os(this),this.pixelStoreUnpack=new Ei(this),this.pixelStoreUnpackPremultiplyAlpha=new Xr(this),this.pixelStoreUnpackFlipY=new Qn(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,d){return new Ct(this,o,d)}createVertexBuffer(o,d,_){return new pn(this,o,d,_)}createRenderbuffer(o,d,_){const b=this.gl,w=b.createRenderbuffer();return this.bindRenderbuffer.set(w),b.renderbufferStorage(b.RENDERBUFFER,o,d,_),this.bindRenderbuffer.set(null),w}createFramebuffer(o,d,_){return new ne(this,o,d,_)}clear({color:o,depth:d,stencil:_}){const b=this.gl;let w=0;o&&(w|=b.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),void 0!==d&&(w|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),void 0!==_&&(w|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),b.clear(w)}setCullFace(o){!1===o.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){$(o.blendFunction,h.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class j extends h.Evented{constructor(o,d,_,b){super(),this.id=o,this.dispatcher=_,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.extend({type:"raster"},d),h.extend(this,h.pick(d,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=kn(this._options,this.map._requestManager,(o,d)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new h.ErrorEvent(o)):d&&(h.extend(this,d),d.bounds&&(this.tileBounds=new nt(d.bounds,this.minzoom,this.maxzoom)),h.postTurnstileEvent(d.tiles),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return h.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,d){const _=h.exported.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);o.request=h.getImage(this.map._requestManager.transformRequest(b,h.ResourceType.Tile),(w,T,M,P)=>(delete o.request,o.aborted?(o.state="unloaded",d(null)):w?(o.state="errored",d(w)):T?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:M,expires:P}),o.setTexture(T,this.map.painter),o.state="loaded",h.cacheEntryPossiblyAdded(this.dispatcher),void d(null)):d(null)))}static loadTileData(o,d,_){o.setTexture(d,_)}static unloadTileData(o,d){o.texture&&d.saveTileTexture(o.texture)}abortTile(o,d){o.request&&(o.request.cancel(),delete o.request),d()}unloadTile(o,d){o.texture&&this.map.painter.saveTileTexture(o.texture),d()}hasTransition(){return!1}}let oe;function se(m,o,d,_,b,w,T,M){const P=[m,d,b,o,_,w,1,1,1],O=[T,M,1],L=h.adjoint([],P),[B,H,te]=h.transformMat3(O,O,h.transpose(L,L));return h.multiply(P,[B,0,0,0,H,0,0,0,te],P)}class De extends h.Evented{constructor(o,d,_,b){super(),this.id=o,this.dispatcher=_,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=d}load(o){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this.url=this.options.url,h.getImage(this.map._requestManager.transformRequest(this.url,h.ResourceType.Image),(d,_)=>{if(this._loaded=!0,d)this.fire(new h.ErrorEvent(d));else if(_){const{HTMLImageElement:b}=h.window;this.image=_ instanceof b?h.exported.getImageData(_):_,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading()}})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(o){this.coordinates=o,this._boundsArray=void 0;const d=o.map(h.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let b=1/0,w=1/0,T=-1/0,M=-1/0;for(const B of _)b=Math.min(b,B.x),w=Math.min(w,B.y),T=Math.max(T,B.x),M=Math.max(M,B.y);const P=Math.max(T-b,M-w),O=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),L=Math.pow(2,O);return new h.CanonicalTileID(O,Math.floor((b+T)/2*L),Math.floor((w+M)/2*L))}(d),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(o){for(const P in this.tiles){const O=this.tiles[P];"loaded"!==O.state&&(O.state="loaded",O.texture=this.texture)}if(this._boundsArray)return;const d=h.tileTransform(this.tileID,this.map.transform.projection),[_,b,w,T]=this.coordinates.map(P=>{const O=d.projection.project(P[0],P[1]);return h.getTilePoint(d,O)._round()});this.perspectiveTransform=function(P,O,L,B,H,te,X,G,_e,ae){const fe=se(0,0,P,0,0,O,P,O),ye=se(L,B,H,te,X,G,_e,ae);return h.multiply(ye,h.adjoint(fe,fe),ye),[ye[6]/ye[8]*P/h.EXTENT,ye[7]/ye[8]*O/h.EXTENT]}(this.width,this.height,_.x,_.y,b.x,b.y,T.x,T.y,w.x,w.y);const M=this._boundsArray=new h.StructArrayLayout4i8;M.emplaceBack(_.x,_.y,0,0),M.emplaceBack(b.x,b.y,h.EXTENT,0),M.emplaceBack(T.x,T.y,0,h.EXTENT),M.emplaceBack(w.x,w.y,h.EXTENT,h.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=o.createVertexBuffer(M,h.boundsAttributes.members),this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const o=this.map.painter.context,d=o.gl;this.texture?this.texture.update(this.image):(this.texture=new h.Texture(o,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._prepareData(o)}loadTile(o,d){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},d(null)):(o.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Me={vector:class extends h.Evented{constructor(m,o,d,_){if(super(),this.id=m,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.extend(this,h.pick(o,["url","scheme","tileSize","promoteId"])),this._options=h.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new h.DedupedRequest}load(){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=kn(this._options,this.map._requestManager,(m,o)=>{this._tileJSONRequest=null,this._loaded=!0,m?this.fire(new h.ErrorEvent(m)):o&&(h.extend(this,o),o.bounds&&(this.tileBounds=new nt(o.bounds,this.minzoom,this.maxzoom)),h.postTurnstileEvent(o.tiles,this.map._requestManager._customAccessToken),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}onAdd(m){this.map=m,this.load()}setSourceProperty(m){this._tileJSONRequest&&this._tileJSONRequest.cancel(),m();const o=this.map.style._getSourceCaches(this.id);for(const d of o)d.clearTiles();this.load()}setTiles(m){return this.setSourceProperty(()=>{this._options.tiles=m}),this}setUrl(m){return this.setSourceProperty(()=>{this.url=m,this._options.url=m}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return h.extend({},this._options)}loadTile(m,o){const d=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(d,h.ResourceType.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:h.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:m.isSymbolTile};if(_.request.collectResourceTiming=this._collectResourceTiming,m.actor&&"expired"!==m.state)"loading"===m.state?m.reloadCallback=o:m.request=m.actor.send("reloadTile",_,b.bind(this));else if(m.actor=this._tileWorkers[d]=this._tileWorkers[d]||this.dispatcher.getActor(),this.dispatcher.ready)m.request=m.actor.send("loadTile",_,b.bind(this),void 0,!0);else{const w=h.loadVectorTile.call({deduped:this._deduped},_,(T,M)=>{T||!M?b.call(this,T):(_.data={cacheControl:M.cacheControl,expires:M.expires,rawData:M.rawData.slice(0)},m.actor&&m.actor.send("loadTile",_,b.bind(this),void 0,!0))},!0);m.request={cancel:w}}function b(w,T){return delete m.request,m.aborted?o(null):w&&404!==w.status?o(w):(T&&T.resourceTiming&&(m.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&m.setExpiryData(T),m.loadVectorData(T,this.map.painter),h.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(m.reloadCallback&&(this.loadTile(m,m.reloadCallback),m.reloadCallback=null)))}}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.actor&&m.actor.send("abortTile",{uid:m.uid,type:this.type,source:this.id})}unloadTile(m){m.unloadVectorData(),m.actor&&m.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:j,"raster-dem":class extends j{constructor(m,o,d,_){super(m,o,d,_),this.type="raster-dem",this.maxzoom=22,this._options=h.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(m,o){const d=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(b,w){b&&(m.state="errored",o(b)),w&&(m.dem=w,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",o(null))}m.request=h.getImage(this.map._requestManager.transformRequest(d,h.ResourceType.Tile),function(b,w,T,M){if(delete m.request,m.aborted)m.state="unloaded",o(null);else if(b)m.state="errored",o(b);else if(w){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:T,expires:M});const P=h.window.ImageBitmap&&w instanceof h.window.ImageBitmap&&(null==oe&&(oe=h.window.OffscreenCanvas&&new h.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof h.window.createImageBitmap),oe),O=1-(w.width-h.prevPowerOfTwo(w.width))/2;O<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const L=P?w:h.exported.getImageData(w,O),B={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:O};m.actor&&"expired"!==m.state||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",B,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const o=m.canonical,d=Math.pow(2,o.z),_=(o.x-1+d)%d,b=0===o.x?m.wrap-1:m.wrap,w=(o.x+1+d)%d,T=o.x+1===d?m.wrap+1:m.wrap,M={};return M[new h.OverscaledTileID(m.overscaledZ,b,o.z,_,o.y).key]={backfilled:!1},M[new h.OverscaledTileID(m.overscaledZ,T,o.z,w,o.y).key]={backfilled:!1},o.y>0&&(M[new h.OverscaledTileID(m.overscaledZ,b,o.z,_,o.y-1).key]={backfilled:!1},M[new h.OverscaledTileID(m.overscaledZ,m.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},M[new h.OverscaledTileID(m.overscaledZ,T,o.z,w,o.y-1).key]={backfilled:!1}),o.y+1<d&&(M[new h.OverscaledTileID(m.overscaledZ,b,o.z,_,o.y+1).key]={backfilled:!1},M[new h.OverscaledTileID(m.overscaledZ,m.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},M[new h.OverscaledTileID(m.overscaledZ,T,o.z,w,o.y+1).key]={backfilled:!1}),M}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded"}},geojson:class extends h.Evented{constructor(m,o,d,_){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(_),this._data=o.data,this._options=h.extend({},o),this._collectResourceTiming=o.collectResourceTiming,void 0!==o.maxzoom&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const b=h.EXTENT/this.tileSize;this.workerOptions=h.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(void 0!==o.buffer?o.buffer:128)*b,tolerance:(void 0!==o.tolerance?o.tolerance:.375)*b,extent:h.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:void 0!==o.clusterMaxZoom?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:h.EXTENT,radius:(void 0!==o.clusterRadius?o.clusterRadius:50)*b,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},o),this}getClusterChildren(m,o){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},o),this}getClusterLeaves(m,o,d,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:o,offset:d},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new h.Event("dataloading",{dataType:"source"})),this._loaded=!1;const m=h.extend({},this.workerOptions),o=this._data;"string"==typeof o?(m.request=this.map._requestManager.transformRequest(h.exported.resolveURL(o),h.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(d,_)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new h.ErrorEvent(d));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(b.resourceTiming=_.resourceTiming[this.id]),this.fire(new h.Event("data",b)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,o){const d=m.actor?"reloadTile":"loadTile";m.actor=this.actor,m.request=this.actor.send(d,{type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:h.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,b)=>(delete m.request,m.unloadVectorData(),m.aborted?o(null):_?o(_):(m.loadVectorData(b,this.map.painter,"reloadTile"===d),o(null))),void 0,"loadTile"===d)}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return h.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends De{constructor(m,o,d,_){super(m,o,d,_),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const o of m.urls)this.urls.push(this.map._requestManager.transformRequest(o,h.ResourceType.Source).url);h.getVideo(this.urls,(o,d)=>{this._loaded=!0,o?this.fire(new h.ErrorEvent(o)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const o=this.video.seekable;m<o.start(0)||m>o.end(0)?this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const m=this.map.painter.context,o=m.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new h.Texture(m,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:De,canvas:class extends De{constructor(m,o,d,_){super(m,o,d,_),o.coordinates?Array.isArray(o.coordinates)&&4===o.coordinates.length&&!o.coordinates.some(b=>!Array.isArray(b)||2!==b.length||b.some(w=>"number"!=typeof w))||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),o.animate&&"boolean"!=typeof o.animate&&this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),o.canvas?"string"==typeof o.canvas||o.canvas instanceof h.window.HTMLCanvasElement||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=o,this.animate=void 0===o.animate||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof h.window.HTMLCanvasElement?this.options.canvas:h.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const o=this.map.painter.context;this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new h.Texture(o,this.canvas,o.gl.RGBA,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends h.Evented{constructor(m,o,d,_){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=o,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new h.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new h.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new nt(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.coveringTiles=this._coveringTiles.bind(this),h.extend(this,h.pick(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return h.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:o,y:d,z:_}=m.canonical;return this._implementation.hasTile({x:o,y:d,z:_})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,o){const{x:d,y:_,z:b}=m.tileID.canonical,w=new h.window.AbortController,T=this._implementation.loadTile({x:d,y:_,z:b},{signal:w.signal});if(!T)return this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",o(null);T.cancel=()=>w.abort(),m.request=T.then(function(M){return delete m.request,m.aborted?(m.state="unloaded",o(null)):M?(P=M)instanceof h.window.ImageData||P instanceof h.window.ImageBitmap||P instanceof h.window.HTMLCanvasElement?(this.loadTileData(m,M),m.state="loaded",void o(null)):(m.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",o(null));var P}.bind(this)).catch(M=>{20!==M.code&&(m.state="errored",o(M))})}loadTileData(m,o){j.loadTileData(m,o,this._map.painter)}unloadTileData(m){j.unloadTileData(m,this._map.painter)}prepareTile(m){if(!this._implementation.prepareTile)return null;const{x:o,y:d,z:_}=m.tileID.canonical,b=this._implementation.prepareTile({x:o,y:d,z:_});return b?(this.loadTileData(m,b),m.state="loaded",b):null}unloadTile(m,o){if(this.unloadTileData(m),this._implementation.unloadTile){const{x:d,y:_,z:b}=m.tileID.canonical;this._implementation.unloadTile({x:d,y:_,z:b})}o()}abortTile(m,o){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),o()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_update(){this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Oe=function(m,o,d,_){const b=new Me[o.type](m,o,d,_);if(b.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${b.id}`);return h.bindAll(["load","abort","unload","serialize","prepare"],b),b};function ke(m,o){const d=h.identity([]);return h.scale(d,d,[.5*m.width,.5*-m.height,1]),h.translate(d,d,[1,-1,0]),h.multiply$1(d,d,m.calculateProjMatrix(o.toUnwrapped())),Float32Array.from(d)}function je(m,o,d,_,b,w,T,M=!1){const P=m.tilesIn(_,T,M);P.sort(It);const O=[];for(const B of P)O.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(o,d,m._state,B,b,w,ke(m.transform,B.tile.tileID),M)});const L=function(B){const H={},te={};for(const X of B){const G=X.queryResults,_e=X.wrappedTileID,ae=te[_e]=te[_e]||{};for(const fe in G){const ye=G[fe],xe=ae[fe]=ae[fe]||{},he=H[fe]=H[fe]||[];for(const Te of ye)xe[Te.featureIndex]||(xe[Te.featureIndex]=!0,he.push(Te))}}return H}(O);for(const B in L)L[B].forEach(H=>{const te=H.feature,X=te.layer;X&&"background"!==X.type&&"sky"!==X.type&&(te.source=X.source,X["source-layer"]&&(te.sourceLayer=X["source-layer"]),te.state=void 0!==te.id?m.getFeatureState(X["source-layer"],te.id):{})});return L}function st(m,o){const d=m.getRenderableIds().map(w=>m.getTileByID(w)),_=[],b={};for(let w=0;w<d.length;w++){const T=d[w],M=T.tileID.canonical.key;b[M]||(b[M]=!0,T.querySourceFeatures(_,o))}return _}function It(m,o){const d=m.tileID,_=o.tileID;return d.overscaledZ-_.overscaledZ||d.canonical.y-_.canonical.y||d.wrap-_.wrap||d.canonical.x-_.canonical.x}function ot(){return null!=aa.workerClass?new aa.workerClass:new h.window.Worker(aa.workerUrl)}const on="mapboxgl_preloaded_worker_pool";class Kt{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Kt.workerCount;)this.workers.push(new ot);return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],0===this.numActive()&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[on]}numActive(){return Object.keys(this.active).length}}let Yt;function rn(){return Yt||(Yt=new Kt),Yt}function $e(m,o){const d={};for(const _ in m)"ref"!==_&&(d[_]=m[_]);return h.refProperties.forEach(_=>{_ in o&&(d[_]=o[_])}),d}function rr(m){m=m.slice();const o=Object.create(null);for(let d=0;d<m.length;d++)o[m[d].id]=m[d];for(let d=0;d<m.length;d++)"ref"in m[d]&&(m[d]=$e(m[d],o[m[d].ref]));return m}Kt.workerCount=2;const Ht={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Kn(m,o,d){d.push({command:Ht.addSource,args:[m,o[m]]})}function Fn(m,o,d){o.push({command:Ht.removeSource,args:[m]}),d[m]=!0}function ds(m,o,d,_){Fn(m,d,_),Kn(m,o,d)}function Ro(m,o,d){let _;for(_ in m[d])if(m[d].hasOwnProperty(_)&&"data"!==_&&!$(m[d][_],o[d][_]))return!1;for(_ in o[d])if(o[d].hasOwnProperty(_)&&"data"!==_&&!$(m[d][_],o[d][_]))return!1;return!0}function At(m,o,d,_,b,w){let T;for(T in o=o||{},m=m||{})m.hasOwnProperty(T)&&($(m[T],o[T])||d.push({command:w,args:[_,T,o[T],b]}));for(T in o)o.hasOwnProperty(T)&&!m.hasOwnProperty(T)&&($(m[T],o[T])||d.push({command:w,args:[_,T,o[T],b]}))}function mn(m){return m.id}function nn(m,o){return m[o.id]=o,m}class Ci{constructor(o,d){this.reset(o,d)}reset(o,d){this.points=o||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(1===this.points.length)return this.points[0];o=h.clamp(o,0,1);let d=1,_=this._distances[d];const b=o*this.paddedLength+this.padding;for(;_<b&&d<this._distances.length;)_=this._distances[++d];const w=d-1,T=this._distances[w],M=_-T,P=M>0?(b-T)/M:0;return this.points[w].mult(1-P).add(this.points[d].mult(P))}}class fs{constructor(o,d,_){const b=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(o/_),this.yCellCount=Math.ceil(d/_);for(let T=0;T<this.xCellCount*this.yCellCount;T++)b.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=d,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,d,_,b,w){this._forEachCell(d,_,b,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(b),this.bboxes.push(w)}insertCircle(o,d,_,b){this._forEachCell(d-b,_-b,d+b,_+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(d),this.circles.push(_),this.circles.push(b)}_insertBoxCell(o,d,_,b,w,T){this.boxCells[w].push(T)}_insertCircleCell(o,d,_,b,w,T){this.circleCells[w].push(T)}_query(o,d,_,b,w,T){if(_<0||o>this.width||b<0||d>this.height)return!w&&[];const M=[];if(o<=0&&d<=0&&this.width<=_&&this.height<=b){if(w)return!0;for(let P=0;P<this.boxKeys.length;P++)M.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const O=this.circles[3*P],L=this.circles[3*P+1],B=this.circles[3*P+2];M.push({key:this.circleKeys[P],x1:O-B,y1:L-B,x2:O+B,y2:L+B})}return T?M.filter(T):M}return this._forEachCell(o,d,_,b,this._queryCell,M,{hitTest:w,seenUids:{box:{},circle:{}}},T),w?M.length>0:M}_queryCircle(o,d,_,b,w){const T=o-_,M=o+_,P=d-_,O=d+_;if(M<0||T>this.width||O<0||P>this.height)return!b&&[];const L=[];return this._forEachCell(T,P,M,O,this._queryCellCircle,L,{hitTest:b,circle:{x:o,y:d,radius:_},seenUids:{box:{},circle:{}}},w),b?L.length>0:L}query(o,d,_,b,w){return this._query(o,d,_,b,!1,w)}hitTest(o,d,_,b,w){return this._query(o,d,_,b,!0,w)}hitTestCircle(o,d,_,b){return this._queryCircle(o,d,_,!0,b)}_queryCell(o,d,_,b,w,T,M,P){const O=M.seenUids,L=this.boxCells[w];if(null!==L){const H=this.bboxes;for(const te of L)if(!O.box[te]){O.box[te]=!0;const X=4*te;if(o<=H[X+2]&&d<=H[X+3]&&_>=H[X+0]&&b>=H[X+1]&&(!P||P(this.boxKeys[te]))){if(M.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[te],x1:H[X],y1:H[X+1],x2:H[X+2],y2:H[X+3]})}}}const B=this.circleCells[w];if(null!==B){const H=this.circles;for(const te of B)if(!O.circle[te]){O.circle[te]=!0;const X=3*te;if(this._circleAndRectCollide(H[X],H[X+1],H[X+2],o,d,_,b)&&(!P||P(this.circleKeys[te]))){if(M.hitTest)return T.push(!0),!0;{const G=H[X],_e=H[X+1],ae=H[X+2];T.push({key:this.circleKeys[te],x1:G-ae,y1:_e-ae,x2:G+ae,y2:_e+ae})}}}}}_queryCellCircle(o,d,_,b,w,T,M,P){const O=M.circle,L=M.seenUids,B=this.boxCells[w];if(null!==B){const te=this.bboxes;for(const X of B)if(!L.box[X]){L.box[X]=!0;const G=4*X;if(this._circleAndRectCollide(O.x,O.y,O.radius,te[G+0],te[G+1],te[G+2],te[G+3])&&(!P||P(this.boxKeys[X])))return T.push(!0),!0}}const H=this.circleCells[w];if(null!==H){const te=this.circles;for(const X of H)if(!L.circle[X]){L.circle[X]=!0;const G=3*X;if(this._circlesCollide(te[G],te[G+1],te[G+2],O.x,O.y,O.radius)&&(!P||P(this.circleKeys[X])))return T.push(!0),!0}}}_forEachCell(o,d,_,b,w,T,M,P){const O=this._convertToXCellCoord(o),L=this._convertToYCellCoord(d),B=this._convertToXCellCoord(_),H=this._convertToYCellCoord(b);for(let te=O;te<=B;te++)for(let X=L;X<=H;X++)if(w.call(this,o,d,_,b,this.xCellCount*X+te,T,M,P))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,d,_,b,w,T){const M=b-o,P=w-d,O=_+T;return O*O>M*M+P*P}_circleAndRectCollide(o,d,_,b,w,T,M){const P=(T-b)/2,O=Math.abs(o-(b+P));if(O>P+_)return!1;const L=(M-w)/2,B=Math.abs(d-(w+L));if(B>L+_)return!1;if(O<=P||B<=L)return!0;const H=O-P,te=B-L;return H*H+te*te<=_*_}}const Vn=Math.tan(85*Math.PI/180);function gn(m,o,d,_,b,w){const T=h.create();if(d){if("globe"===b.projection.name)h.multiply$1(T,T,h.calculateGlobeLabelMatrix(b,o));else{const M=Be([],w);T[0]=M[0],T[1]=M[1],T[4]=M[2],T[5]=M[3]}_||h.rotateZ(T,T,b.angle)}else h.multiply$1(T,b.labelPlaneMatrix,m);return T}function ps(m,o,d,_,b,w){if(d){if("globe"===b.projection.name){const T=gn(m,o,d,_,b,w);return h.invert(T,T),h.multiply$1(T,m,T),T}{const T=h.clone(m),M=h.identity([]);return M[0]=w[0],M[1]=w[1],M[4]=w[2],M[5]=w[3],h.multiply$1(T,T,M),_||h.rotateZ(T,T,-b.angle),T}}return b.glCoordMatrix}function mr(m,o,d=0){const _=[m.x,m.y,d,1];d?h.transformMat4$1(_,_,o):Pr(_,_,o);const b=_[3];return{point:new h.pointGeometry(_[0]/b,_[1]/b),signedDistanceFromCamera:b}}function hi(m,o){const d=[m[0],m[1],m[2],1];h.transformMat4$1(d,d,o);const _=d[3];return{point:new h.pointGeometry(d[0]/_,d[1]/_),signedDistanceFromCamera:_}}function Sr(m,o){return Math.min(.5+m/o*.5,1.5)}function oc(m,o){const d=m[0]/m[3],_=m[1]/m[3];return d>=-o[0]&&d<=o[0]&&_>=-o[1]&&_<=o[1]}function Yi(m,o,d,_,b,w,T,M,P,O){const L=d.transform,B=_?m.textSizeData:m.iconSizeData,H=h.evaluateSizeForZoom(B,d.transform.zoom),te=[256/d.width*2+1,256/d.height*2+1],X=_?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;X.clear();const G=m.lineVertexArray,_e=_?m.text.placedSymbolArray:m.icon.placedSymbolArray,ae=d.transform.width/d.transform.height;let fe=!1;for(let ye=0;ye<_e.length;ye++){const xe=_e.get(ye);if(xe.writingMode!==h.WritingMode.vertical||fe||0!==ye&&_e.get(ye-1).writingMode===h.WritingMode.horizontal||(fe=!0),(xe.hidden||xe.writingMode===h.WritingMode.vertical)&&!fe){Kr(xe.numGlyphs,X);continue}fe=!1;const he=new h.pointGeometry(xe.tileAnchorX,xe.tileAnchorY),Te=P?P(he):[0,0,0],Ue=L.projection.projectTilePoint(he.x,he.y,O.canonical),We=[Ue.x+Te[0],Ue.y+Te[1],Ue.z+Te[2]],et=[...We,1];if(h.transformMat4$1(et,et,o),!oc(et,te)){Kr(xe.numGlyphs,X);continue}const Je=Sr(d.transform.cameraToCenterDistance,et[3]),Dt=h.evaluateSizeForFeature(B,H,xe),Ve=T?Dt/Je:Dt*Je,vt=mr(new h.pointGeometry(We[0],We[1]),b,We[2]);if(vt.signedDistanceFromCamera<=0){Kr(xe.numGlyphs,X);continue}let ht={};const qt=T?null:P,Ke=Ls(xe,Ve,!1,M,o,b,w,m.glyphOffsetArray,G,X,vt.point,he,ht,ae,qt,L.projection,O);fe=Ke.useVertical,qt&&Ke.needsFlipping&&(ht={}),(Ke.notEnoughRoom||fe||Ke.needsFlipping&&Ls(xe,Ve,!0,M,o,b,w,m.glyphOffsetArray,G,X,vt.point,he,ht,ae,qt,L.projection,O).notEnoughRoom)&&Kr(xe.numGlyphs,X)}_?m.text.dynamicLayoutVertexBuffer.updateData(X):m.icon.dynamicLayoutVertexBuffer.updateData(X)}function Qs(m,o,d,_,b,w,T,M,P,O,L,B,H,te,X){const G=M.glyphStartIndex+M.numGlyphs,_e=M.lineStartIndex,ae=M.lineStartIndex+M.lineLength,fe=o.getoffsetX(M.glyphStartIndex),ye=o.getoffsetX(G-1),xe=wn(m*fe,d,_,b,w,T,M.segment,_e,ae,P,O,L,B,H,!0,te,X);if(!xe)return null;const he=wn(m*ye,d,_,b,w,T,M.segment,_e,ae,P,O,L,B,H,!0,te,X);return he?{first:xe,last:he}:null}function lo(m,o,d,_){return m.writingMode===h.WritingMode.horizontal&&Math.abs(d.y-o.y)>Math.abs(d.x-o.x)*_?{useVertical:!0}:m.writingMode===h.WritingMode.vertical?o.y<d.y?{needsFlipping:!0}:null:0!==m.flipState&&function(b,w,T){const M=(w.x-b.x)*T;return 0===M||Math.abs((w.y-b.y)/M)>Vn}(o,d,_)?1===m.flipState?{needsFlipping:!0}:null:o.x>d.x?{needsFlipping:!0}:null}function Ls(m,o,d,_,b,w,T,M,P,O,L,B,H,te,X,G,_e){const ae=o/24,fe=m.lineOffsetX*ae,ye=m.lineOffsetY*ae;let xe;if(m.numGlyphs>1){const he=m.glyphStartIndex+m.numGlyphs,Te=m.lineStartIndex,Ue=m.lineStartIndex+m.lineLength,We=Qs(ae,M,fe,ye,d,L,B,m,P,w,H,X,!1,G,_e);if(!We)return{notEnoughRoom:!0};const et=mr(We.first.point,T).point,Je=mr(We.last.point,T).point;if(_&&!d){const Dt=lo(m,et,Je,te);if(m.flipState=Dt&&Dt.needsFlipping?1:2,Dt)return Dt}xe=[We.first];for(let Dt=m.glyphStartIndex+1;Dt<he-1;Dt++)xe.push(wn(ae*M.getoffsetX(Dt),fe,ye,d,L,B,m.segment,Te,Ue,P,w,H,X,!1,!1,G,_e));xe.push(We.last)}else{if(_&&!d){const Te=mr(B,b).point,Ue=m.lineStartIndex+m.segment+1,We=new h.pointGeometry(P.getx(Ue),P.gety(Ue)),et=mr(We,b),Je=lo(m,Te,et.signedDistanceFromCamera>0?et.point:Wn(B,We,Te,1,b,void 0,G,_e.canonical),te);if(m.flipState=Je&&Je.needsFlipping?1:2,Je)return Je}const he=wn(ae*M.getoffsetX(m.glyphStartIndex),fe,ye,d,L,B,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,P,w,H,X,!1,!1,G,_e);if(!he)return{notEnoughRoom:!0};xe=[he]}for(const he of xe)h.addDynamicAttributes(O,he.point,he.angle);return{}}function ea(m,o,d,_,b){const w=_.projectTilePoint(m.x,m.y,o);if(!b)return mr(w,d,w.z);const T=b(m);return mr(new h.pointGeometry(w.x+T[0],w.y+T[1]),d,w.z+T[2])}function Wn(m,o,d,_,b,w,T,M){const P=ea(m.add(m.sub(o)._unit()),M,b,T,w).point,O=d.sub(P);return d.add(O._mult(_/O.mag()))}function wn(m,o,d,_,b,w,T,M,P,O,L,B,H,te,X,G,_e){const ae=_?m-o:m+o;let fe=ae>0?1:-1,ye=0;_&&(fe*=-1,ye=Math.PI),fe<0&&(ye+=Math.PI);let xe=fe>0?M+T:M+T+1,he=b,Te=b,Ue=0,We=0;const et=Math.abs(ae),Je=[],Dt=[];let Ve=w;const vt=()=>{const Ut=xe-fe;return 0===Ue?w:new h.pointGeometry(O.getx(Ut),O.gety(Ut))},ht=()=>Wn(vt(),Ve,Te,et-Ue+1,L,H,G,_e.canonical);for(;Ue+We<=et;){if(xe+=fe,xe<M||xe>=P)return null;if(Te=he,Je.push(he),te&&Dt.push(Ve||vt()),he=B[xe],void 0===he){Ve=new h.pointGeometry(O.getx(xe),O.gety(xe));const Ut=ea(Ve,_e.canonical,L,G,H);he=Ut.signedDistanceFromCamera>0?B[xe]=Ut.point:ht()}else Ve=null;Ue+=We,We=Te.dist(he)}X&&H&&(Ve=Ve||new h.pointGeometry(O.getx(xe),O.gety(xe)),B[xe]=he=void 0===B[xe]?he:ht(),We=Te.dist(he));const qt=(et-Ue)/We,Ke=he.sub(Te),Jt=Ke.mult(qt)._add(Te);d&&Jt._add(Ke._unit()._perp()._mult(d*fe));const en=ye+Math.atan2(he.y-Te.y,he.x-Te.x);return Je.push(Jt),te&&(Ve=Ve||new h.pointGeometry(O.getx(xe),O.gety(xe)),Dt.push(function(Ut,Zt,ln){const Tn=1-ln;return new h.pointGeometry(Ut.x*Tn+Zt.x*ln,Ut.y*Tn+Zt.y*ln)}(Dt.length>0?Dt[Dt.length-1]:Ve,Ve,qt))),{point:Jt,angle:en,path:Je,tilePath:Dt}}const Oo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Kr(m,o){for(let d=0;d<m;d++){const _=o.length;o.resize(_+4),o.float32.set(Oo,3*_)}}function Pr(m,o,d){const _=o[0],b=o[1];return m[0]=d[0]*_+d[4]*b+d[12],m[1]=d[1]*_+d[5]*b+d[13],m[3]=d[3]*_+d[7]*b+d[15],m}const gi=100;class Lo{constructor(o,d,_=new fs(o.width+200,o.height+200,25),b=new fs(o.width+200,o.height+200,25)){this.transform=o,this.grid=_,this.ignoredGrid=b,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+gi,this.screenBottomBoundary=o.height+gi,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=d}placeCollisionBox(o,d,_,b,w,T,M){let P=d.projectedAnchorX,O=d.projectedAnchorY,L=d.projectedAnchorZ;const B=d.elevation,H=d.tileID;if(B&&H){const xe=this.transform.projection.upVector(H.canonical,d.tileAnchorX,d.tileAnchorY),he=this.transform.projection.upVectorScale(H.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=xe[0]*B*he,O+=xe[1]*B*he,L+=xe[2]*B*he}const te=this.projectAndGetPerspectiveRatio(T,[P,O,L],d.tileID,"globe"===this.transform.projection.name||!!B||this.transform.pitch>0),X=w*te.perspectiveRatio,G=(d.x1*o+_.x-d.padding)*X+te.point.x,_e=(d.y1*o+_.y-d.padding)*X+te.point.y,ae=(d.x2*o+_.x+d.padding)*X+te.point.x,fe=(d.y2*o+_.y+d.padding)*X+te.point.y,ye=te.perspectiveRatio<=.55||te.occluded;return!this.isInsideGrid(G,_e,ae,fe)||!b&&this.grid.hitTest(G,_e,ae,fe,M)||ye?{box:[],offscreen:!1,occluded:te.occluded}:{box:[G,_e,ae,fe],offscreen:this.isOffscreen(G,_e,ae,fe),occluded:!1}}placeCollisionCircles(o,d,_,b,w,T,M,P,O,L,B,H,te,X){const G=[],_e=this.transform.elevation,ae=_e?_e.getAtTileOffsetFunc(X,this.transform.center.lat,this.transform.worldSize,this.transform.projection):ht=>[0,0,0],fe=new h.pointGeometry(d.tileAnchorX,d.tileAnchorY),ye=this.transform.projection.projectTilePoint(d.tileAnchorX,d.tileAnchorY,X.canonical),xe=ae(fe),he=[ye.x+xe[0],ye.y+xe[1],ye.z+xe[2]],Te=this.projectAndGetPerspectiveRatio(T,[he[0],he[1],he[2]],X,"globe"===this.transform.projection.name||!!_e||this.transform.pitch>0),{perspectiveRatio:Ue}=Te,We=(L?w/Ue:w*Ue)/h.ONE_EM,et=mr(new h.pointGeometry(he[0],he[1]),M,he[2]).point,Je=Te.signedDistanceFromCamera>0?Qs(We,b,d.lineOffsetX*We,d.lineOffsetY*We,!1,et,fe,d,_,M,{},_e&&!L?ae:null,L&&!!_e,this.transform.projection,X):null;let Dt=!1,Ve=!1,vt=!0;if(Je&&!Te.occluded){const ht=.5*H*Ue+te,qt=new h.pointGeometry(-100,-100),Ke=new h.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Jt=new Ci,en=Je.first,Ut=Je.last;let Zt=[];for(let tn=en.path.length-1;tn>=1;tn--)Zt.push(en.path[tn]);for(let tn=1;tn<Ut.path.length;tn++)Zt.push(Ut.path[tn]);const ln=2.5*ht;if(P){const tn=Zt.map(_e?(bn,Xt)=>{const ii=ae(Xt<en.path.length-1?en.tilePath[en.path.length-1-Xt]:Ut.tilePath[Xt-en.path.length+2]);return mr(bn,P,ii[2])}:bn=>mr(bn,P));Zt=tn.some(bn=>bn.signedDistanceFromCamera<=0)?[]:tn.map(bn=>bn.point)}let Tn=[];if(Zt.length>0){const tn=Zt[0].clone(),bn=Zt[0].clone();for(let Xt=1;Xt<Zt.length;Xt++)tn.x=Math.min(tn.x,Zt[Xt].x),tn.y=Math.min(tn.y,Zt[Xt].y),bn.x=Math.max(bn.x,Zt[Xt].x),bn.y=Math.max(bn.y,Zt[Xt].y);Tn=tn.x>=qt.x&&bn.x<=Ke.x&&tn.y>=qt.y&&bn.y<=Ke.y?[Zt]:bn.x<qt.x||tn.x>Ke.x||bn.y<qt.y||tn.y>Ke.y?[]:h.clipLine([Zt],qt.x,qt.y,Ke.x,Ke.y)}for(const tn of Tn){Jt.reset(tn,.25*ht);let bn=0;bn=Jt.length<=.5*ht?1:Math.ceil(Jt.paddedLength/ln)+1;for(let Xt=0;Xt<bn;Xt++){const ii=Xt/Math.max(bn-1,1),po=Jt.lerp(ii),mo=po.x+gi,ts=po.y+gi;G.push(mo,ts,ht,0);const $s=mo-ht,Ia=ts-ht,ll=mo+ht,zo=ts+ht;if(vt=vt&&this.isOffscreen($s,Ia,ll,zo),Ve=Ve||this.isInsideGrid($s,Ia,ll,zo),!o&&this.grid.hitTestCircle(mo,ts,ht,B)&&(Dt=!0,!O))return{circles:[],offscreen:!1,collisionDetected:Dt,occluded:!1}}}}return{circles:!O&&Dt||!Ve?[]:G,offscreen:vt,collisionDetected:Dt,occluded:Te.occluded}}queryRenderedSymbols(o){if(0===o.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const d=[];let _=1/0,b=1/0,w=-1/0,T=-1/0;for(const L of o){const B=new h.pointGeometry(L.x+gi,L.y+gi);_=Math.min(_,B.x),b=Math.min(b,B.y),w=Math.max(w,B.x),T=Math.max(T,B.y),d.push(B)}const M=this.grid.query(_,b,w,T).concat(this.ignoredGrid.query(_,b,w,T)),P={},O={};for(const L of M){const B=L.key;if(void 0===P[B.bucketInstanceId]&&(P[B.bucketInstanceId]={}),P[B.bucketInstanceId][B.featureIndex])continue;const H=[new h.pointGeometry(L.x1,L.y1),new h.pointGeometry(L.x2,L.y1),new h.pointGeometry(L.x2,L.y2),new h.pointGeometry(L.x1,L.y2)];h.polygonIntersectsPolygon(d,H)&&(P[B.bucketInstanceId][B.featureIndex]=!0,void 0===O[B.bucketInstanceId]&&(O[B.bucketInstanceId]=[]),O[B.bucketInstanceId].push(B.featureIndex))}return O}insertCollisionBox(o,d,_,b,w){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:b,collisionGroupID:w},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,d,_,b,w){const T=d?this.ignoredGrid:this.grid,M={bucketInstanceId:_,featureIndex:b,collisionGroupID:w};for(let P=0;P<o.length;P+=4)T.insertCircle(M,o[P],o[P+1],o[P+2])}projectAndGetPerspectiveRatio(o,d,_,b){const w=[d[0],d[1],d[2],1];let T=!1;return d[2]||this.transform.pitch>0?(h.transformMat4$1(w,w,o),this.fogState&&_&&(T=function(M,P,O,L,B,H){const te=H.calculateFogTileMatrix(B),X=[P,O,L];return h.transformMat4(X,X,te),rt(M,X,H.pitch,H._fov)}(this.fogState,d[0],d[1],d[2],_.toUnwrapped(),this.transform)>.9)):Pr(w,w,o),{point:new h.pointGeometry((w[0]/w[3]+1)/2*this.transform.width+gi,(-w[1]/w[3]+1)/2*this.transform.height+gi),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/w[3]*.5,1.5),signedDistanceFromCamera:w[3],occluded:b&&w[2]>w[3]||T}}isOffscreen(o,d,_,b){return _<gi||o>=this.screenRightBoundary||b<gi||d>this.screenBottomBoundary}isInsideGrid(o,d,_,b){return _>=0&&o<this.gridRightBoundary&&b>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const o=h.identity([]);return h.translate(o,o,[-100,-100,0]),o}}class wr{constructor(o,d,_,b){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?d:-d))):b&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class oi{constructor(o,d,_,b,w,T=!1){this.text=new wr(o?o.text:null,d,_,w),this.icon=new wr(o?o.icon:null,d,b,w),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ko{constructor(o,d,_,b=!1){this.text=o,this.icon=d,this.skipFade=_,this.clipped=b}}class _i{constructor(){this.invProjMatrix=h.create(),this.viewportMatrix=h.create(),this.circles=[]}}class Li{constructor(o,d,_,b,w){this.bucketInstanceId=o,this.featureIndex=d,this.sourceLayerIndex=_,this.bucketIndex=b,this.tileID=w}}class co{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const d=++this.maxGroupID;this.collisionGroups[o]={ID:d,predicate:_=>_.collisionGroupID===d}}return this.collisionGroups[o]}}function Fs(m,o,d,_,b){const{horizontalAlign:w,verticalAlign:T}=h.getAnchorAlignment(m),M=-(w-.5)*o,P=-(T-.5)*d,O=h.evaluateVariableOffset(m,_);return new h.pointGeometry(M+O[0]*b,P+O[1]*b)}function ms(m,o,d,_,b){const w=new h.pointGeometry(m,o);return d&&w._rotate(_?b:-b),w}class Ha{constructor(o,d,_,b,w){this.transform=o.clone(),this.collisionIndex=new Lo(this.transform,w),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new co(_),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,d,_,b){const w=_.getBucket(d),T=_.latestFeatureIndex;if(!w||!T||d.id!==w.layerIds[0])return;const M=w.layers[0].layout,P=_.collisionBoxArray,O=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),L=_.tileSize/h.EXTENT,B=_.tileID.toUnwrapped(),H=this.transform.calculateProjMatrix(B),te="map"===M.get("text-pitch-alignment"),X="map"===M.get("text-rotation-alignment");d.compileFilter();const G=d.dynamicFilter(),_e=d.dynamicFilterNeedsFeature(),ae=this.transform.calculatePixelsToTileUnitsMatrix(_),fe=gn(H,_.tileID.canonical,te,X,this.transform,ae);let ye=null;if(te){const Te=ps(H,_.tileID.canonical,te,X,this.transform,ae);ye=h.multiply$1([],this.transform.labelPlaneMatrix,Te)}let xe=null;G&&_.latestFeatureIndex&&(xe={unwrappedTileID:B,dynamicFilter:G,dynamicFilterNeedsFeature:_e,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[w.bucketInstanceId]=new Li(w.bucketInstanceId,T,w.sourceLayerIndex,w.index,_.tileID);const he={bucket:w,layout:M,posMatrix:H,textLabelPlaneMatrix:fe,labelToScreenMatrix:ye,clippingData:xe,scale:O,textPixelRatio:L,holdingForFade:_.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:h.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:h.evaluateSizeForZoom(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(b)for(const Te of w.sortKeyRanges){const{sortKey:Ue,symbolInstanceStart:We,symbolInstanceEnd:et}=Te;o.push({sortKey:Ue,symbolInstanceStart:We,symbolInstanceEnd:et,parameters:he})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:he})}attemptAnchorPlacement(o,d,_,b,w,T,M,P,O,L,B,H,te,X,G,_e,ae,fe){const ye=[H.textOffset0,H.textOffset1],xe=Fs(o,_,b,ye,w),he=this.collisionIndex.placeCollisionBox(w,d,ms(xe.x,xe.y,T,M,this.transform.angle),B,P,O,L.predicate);if((!_e||0!==this.collisionIndex.placeCollisionBox(X.getSymbolInstanceIconSize(fe,this.transform.zoom,te),_e,ms(xe.x,xe.y,T,M,this.transform.angle),B,P,O,L.predicate).box.length)&&he.box.length>0){let Te;return this.prevPlacement&&this.prevPlacement.variableOffsets[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID].text&&(Te=this.prevPlacement.variableOffsets[H.crossTileID].anchor),this.variableOffsets[H.crossTileID]={textOffset:ye,width:_,height:b,anchor:o,textScale:w,prevAnchor:Te},this.markUsedJustification(X,o,H,G),X.allowVerticalPlacement&&(this.markUsedOrientation(X,G,H),this.placedOrientations[H.crossTileID]=G),{shift:xe,placedGlyphBoxes:he}}}placeLayerBucketPart(o,d,_,b){const{bucket:w,layout:T,posMatrix:M,textLabelPlaneMatrix:P,labelToScreenMatrix:O,clippingData:L,textPixelRatio:B,holdingForFade:H,collisionBoxArray:te,partiallyEvaluatedTextSize:X,partiallyEvaluatedIconSize:G,collisionGroup:_e}=o.parameters,ae=T.get("text-optional"),fe=T.get("icon-optional"),ye=T.get("text-allow-overlap"),xe=T.get("icon-allow-overlap"),he="map"===T.get("text-rotation-alignment"),Te="map"===T.get("text-pitch-alignment"),Ue="none"!==T.get("icon-text-fit"),We="viewport-y"===T.get("symbol-z-order");let et=ye&&(xe||!w.hasIconData()||fe),Je=xe&&(ye||!w.hasTextData()||ae);!w.collisionArrays&&te&&w.deserializeCollisionBoxes(te),_&&b&&w.updateCollisionDebugBuffers(this.transform.zoom,te);const Dt=(Ve,vt,ht)=>{if(L){const si={zoom:this.transform.zoom,pitch:this.transform.pitch};let Xn=null;if(L.dynamicFilterNeedsFeature){const cr=this.retainedQueryData[w.bucketInstanceId];Xn=L.featureIndex.loadFeature({featureIndex:Ve.featureIndex,bucketIndex:cr.bucketIndex,sourceLayerIndex:cr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(si,Xn,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new h.pointGeometry(Ve.tileAnchorX,Ve.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[Ve.crossTileID]=new Ko(!1,!1,!1,!0),void(d[Ve.crossTileID]=!0)}if(d[Ve.crossTileID])return;if(H)return void(this.placements[Ve.crossTileID]=new Ko(!1,!1,!1));let qt=!1,Ke=!1,Jt=!0,en=!1,Ut=!1,Zt=null,ln={box:null,offscreen:null,occluded:null},Tn={box:null,offscreen:null,occluded:null},tn=null,bn=null,Xt=null,ii=0,po=0,mo=0;ht.textFeatureIndex?ii=ht.textFeatureIndex:Ve.useRuntimeCollisionCircles&&(ii=Ve.featureIndex),ht.verticalTextFeatureIndex&&(po=ht.verticalTextFeatureIndex);const ts=si=>{si.tileID=this.retainedQueryData[w.bucketInstanceId].tileID,(this.transform.elevation||si.elevation)&&(si.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[w.bucketInstanceId].tileID,si.tileAnchorX,si.tileAnchorY):0)},$s=ht.textBox;if($s){ts($s);const si=cr=>{let Jr=h.WritingMode.horizontal;if(w.allowVerticalPlacement&&!cr&&this.prevPlacement){const ns=this.prevPlacement.placedOrientations[Ve.crossTileID];ns&&(this.placedOrientations[Ve.crossTileID]=ns,Jr=ns,this.markUsedOrientation(w,Jr,Ve))}return Jr},Xn=(cr,Jr)=>{if(w.allowVerticalPlacement&&Ve.numVerticalGlyphVertices>0&&ht.verticalTextBox){for(const ns of w.writingModes)if(ns===h.WritingMode.vertical?(ln=Jr(),Tn=ln):ln=cr(),ln&&ln.box&&ln.box.length)break}else ln=cr()};if(T.get("text-variable-anchor")){let cr=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ve.crossTileID]){const Qr=this.prevPlacement.variableOffsets[Ve.crossTileID];cr.indexOf(Qr.anchor)>0&&(cr=cr.filter(ai=>ai!==Qr.anchor),cr.unshift(Qr.anchor))}const Jr=(Qr,ai,To)=>{const Do=w.getSymbolInstanceTextSize(X,Ve,this.transform.zoom,vt),Gs=(Qr.x2-Qr.x1)*Do+2*Qr.padding,Fl=(Qr.y2-Qr.y1)*Do+2*Qr.padding,yu=Ue&&!xe?ai:null;yu&&ts(yu);let Nl={box:[],offscreen:!1,occluded:!1};const np=ye?2*cr.length:cr.length;for(let cl=0;cl<np;++cl){const Vd=this.attemptAnchorPlacement(cr[cl%cr.length],Qr,Gs,Fl,Do,he,Te,B,M,_e,cl>=cr.length,Ve,vt,w,To,yu,X,G);if(Vd&&(Nl=Vd.placedGlyphBoxes,Nl&&Nl.box&&Nl.box.length)){qt=!0,Zt=Vd.shift;break}}return Nl};Xn(()=>Jr($s,ht.iconBox,h.WritingMode.horizontal),()=>{const Qr=ht.verticalTextBox;return Qr&&ts(Qr),w.allowVerticalPlacement&&!(ln&&ln.box&&ln.box.length)&&Ve.numVerticalGlyphVertices>0&&Qr?Jr(Qr,ht.verticalIconBox,h.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),ln&&(qt=ln.box,Jt=ln.offscreen,en=ln.occluded);const ns=si(ln&&ln.box);if(!qt&&this.prevPlacement){const Qr=this.prevPlacement.variableOffsets[Ve.crossTileID];Qr&&(this.variableOffsets[Ve.crossTileID]=Qr,this.markUsedJustification(w,Qr.anchor,Ve,ns))}}else{const cr=(Jr,ns)=>{const Qr=w.getSymbolInstanceTextSize(X,Ve,this.transform.zoom,vt),ai=this.collisionIndex.placeCollisionBox(Qr,Jr,new h.pointGeometry(0,0),ye,B,M,_e.predicate);return ai&&ai.box&&ai.box.length&&(this.markUsedOrientation(w,ns,Ve),this.placedOrientations[Ve.crossTileID]=ns),ai};Xn(()=>cr($s,h.WritingMode.horizontal),()=>{const Jr=ht.verticalTextBox;return w.allowVerticalPlacement&&Ve.numVerticalGlyphVertices>0&&Jr?(ts(Jr),cr(Jr,h.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),si(ln&&ln.box&&ln.box.length)}}if(tn=ln,qt=tn&&tn.box&&tn.box.length>0,Jt=tn&&tn.offscreen,en=tn&&tn.occluded,Ve.useRuntimeCollisionCircles){const si=w.text.placedSymbolArray.get(Ve.centerJustifiedTextSymbolIndex>=0?Ve.centerJustifiedTextSymbolIndex:Ve.verticalPlacedTextSymbolIndex),Xn=h.evaluateSizeForFeature(w.textSizeData,X,si),cr=T.get("text-padding");bn=this.collisionIndex.placeCollisionCircles(ye,si,w.lineVertexArray,w.glyphOffsetArray,Xn,M,P,O,_,Te,_e.predicate,Ve.collisionCircleDiameter*Xn/h.ONE_EM,cr,this.retainedQueryData[w.bucketInstanceId].tileID),qt=ye||bn.circles.length>0&&!bn.collisionDetected,Jt=Jt&&bn.offscreen,en=bn.occluded}if(ht.iconFeatureIndex&&(mo=ht.iconFeatureIndex),ht.iconBox){const si=Xn=>{ts(Xn);const cr=Ue&&Zt?ms(Zt.x,Zt.y,he,Te,this.transform.angle):new h.pointGeometry(0,0),Jr=w.getSymbolInstanceIconSize(G,this.transform.zoom,vt);return this.collisionIndex.placeCollisionBox(Jr,Xn,cr,xe,B,M,_e.predicate)};Tn&&Tn.box&&Tn.box.length&&ht.verticalIconBox?(Xt=si(ht.verticalIconBox),Ke=Xt.box.length>0):(Xt=si(ht.iconBox),Ke=Xt.box.length>0),Jt=Jt&&Xt.offscreen,Ut=Xt.occluded}const Ia=ae||0===Ve.numHorizontalGlyphVertices&&0===Ve.numVerticalGlyphVertices,ll=fe||0===Ve.numIconVertices;if(Ia||ll?ll?Ia||(Ke=Ke&&qt):qt=Ke&&qt:Ke=qt=Ke&&qt,qt&&tn&&tn.box&&this.collisionIndex.insertCollisionBox(tn.box,T.get("text-ignore-placement"),w.bucketInstanceId,Tn&&Tn.box&&po?po:ii,_e.ID),Ke&&Xt&&this.collisionIndex.insertCollisionBox(Xt.box,T.get("icon-ignore-placement"),w.bucketInstanceId,mo,_e.ID),bn&&(qt&&this.collisionIndex.insertCollisionCircles(bn.circles,T.get("text-ignore-placement"),w.bucketInstanceId,ii,_e.ID),_)){const si=w.bucketInstanceId;let Xn=this.collisionCircleArrays[si];void 0===Xn&&(Xn=this.collisionCircleArrays[si]=new _i);for(let cr=0;cr<bn.circles.length;cr+=4)Xn.circles.push(bn.circles[cr+0]),Xn.circles.push(bn.circles[cr+1]),Xn.circles.push(bn.circles[cr+2]),Xn.circles.push(bn.collisionDetected?1:0)}const zo="globe"!==this.transform.projection.name;et=et&&(zo||!en),Je=Je&&(zo||!Ut),this.placements[Ve.crossTileID]=new Ko(qt||et,Ke||Je,Jt||w.justReloaded),d[Ve.crossTileID]=!0};if(We){const Ve=w.getSortedSymbolIndexes(this.transform.angle);for(let vt=Ve.length-1;vt>=0;--vt){const ht=Ve[vt];Dt(w.symbolInstances.get(ht),ht,w.collisionArrays[ht])}}else for(let Ve=o.symbolInstanceStart;Ve<o.symbolInstanceEnd;Ve++)Dt(w.symbolInstances.get(Ve),Ve,w.collisionArrays[Ve]);if(_&&w.bucketInstanceId in this.collisionCircleArrays){const Ve=this.collisionCircleArrays[w.bucketInstanceId];h.invert(Ve.invProjMatrix,M),Ve.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(o,d,_,b){let w;w=b===h.WritingMode.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[h.getAnchorJustification(d)];const T=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const M of T)M>=0&&(o.text.placedSymbolArray.get(M).crossTileID=w>=0&&M!==w?0:_.crossTileID)}markUsedOrientation(o,d,_){const b=d===h.WritingMode.horizontal||d===h.WritingMode.horizontalOnly?d:0,w=d===h.WritingMode.vertical?d:0,T=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const M of T)o.text.placedSymbolArray.get(M).placedOrientation=b;_.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let _=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const b=d?d.symbolFadeChange(o):1,w=d?d.opacities:{},T=d?d.variableOffsets:{},M=d?d.placedOrientations:{};for(const P in this.placements){const O=this.placements[P],L=w[P];L?(this.opacities[P]=new oi(L,b,O.text,O.icon,null,O.clipped),_=_||O.text!==L.text.placed||O.icon!==L.icon.placed):(this.opacities[P]=new oi(null,b,O.text,O.icon,O.skipFade,O.clipped),_=_||O.text||O.icon)}for(const P in w){const O=w[P];if(!this.opacities[P]){const L=new oi(O,b,!1,!1);L.isHidden()||(this.opacities[P]=L,_=_||O.text.placed||O.icon.placed)}}for(const P in T)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=T[P]);for(const P in M)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=M[P]);_?this.lastPlacementChangeTime=o:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:o)}updateLayerOpacities(o,d){const _={};for(const b of d){const w=b.getBucket(o);w&&b.latestFeatureIndex&&o.id===w.layerIds[0]&&this.updateBucketOpacities(w,_,b.collisionBoxArray)}}updateBucketOpacities(o,d,_){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const b=o.layers[0].layout,w=!!o.layers[0].dynamicFilter(),T=new oi(null,0,!1,!1,!0),M=b.get("text-allow-overlap"),P=b.get("icon-allow-overlap"),O=b.get("text-variable-anchor"),L="map"===b.get("text-rotation-alignment"),B="map"===b.get("text-pitch-alignment"),H="none"!==b.get("icon-text-fit"),te=new oi(null,0,M&&(P||!o.hasIconData()||b.get("icon-optional")),P&&(M||!o.hasTextData()||b.get("text-optional")),!0);!o.collisionArrays&&_&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(_);const X=(_e,ae,fe)=>{for(let ye=0;ye<ae/4;ye++)_e.opacityVertexArray.emplaceBack(fe)};let G=0;for(let _e=0;_e<o.symbolInstances.length;_e++){const ae=o.symbolInstances.get(_e),{numHorizontalGlyphVertices:fe,numVerticalGlyphVertices:ye,crossTileID:xe}=ae;let he=this.opacities[xe];d[xe]?he=T:he||(he=te,this.opacities[xe]=he),d[xe]=!0;const Te=fe>0||ye>0,Ue=ae.numIconVertices>0,We=this.placedOrientations[ae.crossTileID],et=We===h.WritingMode.vertical,Je=We===h.WritingMode.horizontal||We===h.WritingMode.horizontalOnly;if(!Te&&!Ue||he.isHidden()||G++,Te){const Dt=Yr(he.text);X(o.text,fe,et?yr:Dt),X(o.text,ye,Je?yr:Dt);const Ve=he.text.isHidden();[ae.rightJustifiedTextSymbolIndex,ae.centerJustifiedTextSymbolIndex,ae.leftJustifiedTextSymbolIndex].forEach(qt=>{qt>=0&&(o.text.placedSymbolArray.get(qt).hidden=Ve||et?1:0)}),ae.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(ae.verticalPlacedTextSymbolIndex).hidden=Ve||Je?1:0);const vt=this.variableOffsets[ae.crossTileID];vt&&this.markUsedJustification(o,vt.anchor,ae,We);const ht=this.placedOrientations[ae.crossTileID];ht&&(this.markUsedJustification(o,"left",ae,ht),this.markUsedOrientation(o,ht,ae))}if(Ue){const Dt=Yr(he.icon);ae.placedIconSymbolIndex>=0&&(X(o.icon,ae.numIconVertices,et?yr:Dt),o.icon.placedSymbolArray.get(ae.placedIconSymbolIndex).hidden=he.icon.isHidden()),ae.verticalPlacedIconSymbolIndex>=0&&(X(o.icon,ae.numVerticalIconVertices,Je?yr:Dt),o.icon.placedSymbolArray.get(ae.verticalPlacedIconSymbolIndex).hidden=he.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Dt=o.collisionArrays[_e];if(Dt){let Ve=new h.pointGeometry(0,0),vt=!0;if(Dt.textBox||Dt.verticalTextBox){if(O){const qt=this.variableOffsets[xe];qt?(Ve=Fs(qt.anchor,qt.width,qt.height,qt.textOffset,qt.textScale),L&&Ve._rotate(B?this.transform.angle:-this.transform.angle)):vt=!1}w&&(vt=!he.clipped),Dt.textBox&&Nn(o.textCollisionBox.collisionVertexArray,he.text.placed,!vt||et,Ve.x,Ve.y),Dt.verticalTextBox&&Nn(o.textCollisionBox.collisionVertexArray,he.text.placed,!vt||Je,Ve.x,Ve.y)}const ht=vt&&Boolean(!Je&&Dt.verticalIconBox);Dt.iconBox&&Nn(o.iconCollisionBox.collisionVertexArray,he.icon.placed,ht,H?Ve.x:0,H?Ve.y:0),Dt.verticalIconBox&&Nn(o.iconCollisionBox.collisionVertexArray,he.icon.placed,!ht,H?Ve.x:0,H?Ve.y:0)}}}if(o.fullyClipped=0===G,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=_e.invProjMatrix,o.placementViewportMatrix=_e.viewportMatrix,o.collisionCircleArray=_e.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return 0===this.fadeDuration?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,d){const _=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*_>o}setStale(){this.stale=!0}}function Nn(m,o,d,_,b){m.emplaceBack(o?1:0,d?1:0,_||0,b||0),m.emplaceBack(o?1:0,d?1:0,_||0,b||0),m.emplaceBack(o?1:0,d?1:0,_||0,b||0),m.emplaceBack(o?1:0,d?1:0,_||0,b||0)}const sc=Math.pow(2,25),ac=Math.pow(2,24),Se=Math.pow(2,17),Ze=Math.pow(2,16),yt=Math.pow(2,9),Pn=Math.pow(2,8),Yn=Math.pow(2,1);function Yr(m){if(0===m.opacity&&!m.placed)return 0;if(1===m.opacity&&m.placed)return 4294967295;const o=m.placed?1:0,d=Math.floor(127*m.opacity);return d*sc+o*ac+d*Se+o*Ze+d*yt+o*Pn+d*Yn+o}const yr=0;class Cr{constructor(o){this._sortAcrossTiles="viewport-y"!==o.layout.get("symbol-z-order")&&void 0!==o.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,d,_,b,w){const T=this._bucketParts;for(;this._currentTileIndex<o.length;)if(d.getBucketParts(T,b,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((M,P)=>M.sortKey-P.sortKey));this._currentPartIndex<T.length;){const M=T[this._currentPartIndex];if(d.placeLayerBucketPart(M,this._seenCrossTileIDs,_,0===M.symbolInstanceStart),this._currentPartIndex++,w())return!0}return!1}}class bo{constructor(o,d,_,b,w,T,M,P){this.placement=new Ha(o,w,T,M,P),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(o,d,_){const b=h.exported.now(),w=()=>{const T=h.exported.now()-b;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=d[o[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if("symbol"===T.type&&(!T.minzoom||T.minzoom<=M)&&(!T.maxzoom||T.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Cr(T)),this._inProgressLayer.continuePlacement(_[T.source],this.placement,this._showCollisionBoxes,T,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Mr=512/h.EXTENT/2;class Sl{constructor(o,d,_){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(let b=0;b<d.length;b++){const w=d.get(b),T=w.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:w.crossTileID,coord:this.getScaledCoordinates(w,o)})}}getScaledCoordinates(o,d){const _=Mr/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*h.EXTENT+o.tileAnchorX)*_),y:Math.floor((d.canonical.y*h.EXTENT+o.tileAnchorY)*_)}}findMatches(o,d,_){const b=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let w=0;w<o.length;w++){const T=o.get(w);if(T.crossTileID)continue;const M=this.indexedSymbolInstances[T.key];if(!M)continue;const P=this.getScaledCoordinates(T,d);for(const O of M)if(Math.abs(O.coord.x-P.x)<=b&&Math.abs(O.coord.y-P.y)<=b&&!_[O.crossTileID]){_[O.crossTileID]=!0,T.crossTileID=O.crossTileID;break}}}}class ci{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ml{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const d=Math.round((o-this.lng)/360);if(0!==d)for(const _ in this.indexes){const b=this.indexes[_],w={};for(const T in b){const M=b[T];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+d),w[M.tileID.key]=M}this.indexes[_]=w}this.lng=o}addBucket(o,d,_){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let w=0;w<d.symbolInstances.length;w++)d.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const b=this.usedCrossTileIDs[o.overscaledZ];for(const w in this.indexes){const T=this.indexes[w];if(Number(w)>o.overscaledZ)for(const M in T){const P=T[M];P.tileID.isChildOf(o)&&P.findMatches(d.symbolInstances,o,b)}else{const M=T[o.scaledTo(Number(w)).key];M&&M.findMatches(d.symbolInstances,o,b)}}for(let w=0;w<d.symbolInstances.length;w++){const T=d.symbolInstances.get(w);T.crossTileID||(T.crossTileID=_.generate(),b[T.crossTileID]=!0)}return void 0===this.indexes[o.overscaledZ]&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Sl(o,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(o,d){for(const _ in d.indexedSymbolInstances)for(const b of d.indexedSymbolInstances[_])delete this.usedCrossTileIDs[o][b.crossTileID]}removeStaleBuckets(o){let d=!1;for(const _ in this.indexes){const b=this.indexes[_];for(const w in b)o[b[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,b[w]),delete b[w],d=!0)}return d}}class Ns{constructor(){this.layerIndexes={},this.crossTileIDs=new ci,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,d,_,b){let w=this.layerIndexes[o.id];void 0===w&&(w=this.layerIndexes[o.id]=new Ml);let T=!1;const M={};"globe"!==b.name&&w.handleWrapJump(_);for(const P of d){const O=P.getBucket(o);O&&o.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(P.tileID,O,this.crossTileIDs)&&(T=!0),M[O.bucketInstanceId]=!0)}return w.removeStaleBuckets(M)&&(T=!0),T}pruneUnusedLayers(o){const d={};o.forEach(_=>{d[_]=!0});for(const _ in this.layerIndexes)d[_]||delete this.layerIndexes[_]}}const qr=(m,o)=>h.emitValidationErrors(m,o&&o.filter(d=>"source.canvas"!==d.identifier)),zs=h.pick(Ht,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Yo=h.pick(Ht,["setCenter","setZoom","setBearing","setPitch"]),yn={version:8,layers:[],sources:{}},Vr={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class vr extends h.Evented{constructor(o,d={}){super(),this.map=o,this.dispatcher=new hn(rn(),this),this.imageManager=new it,this.imageManager.setEventedParent(this),this.glyphManager=new h.GlyphManager(o._requestManager,d.localFontFamily?h.LocalGlyphMode.all:d.localIdeographFontFamily?h.LocalGlyphMode.ideographs:h.LocalGlyphMode.none,d.localFontFamily||d.localIdeographFontFamily),this.lineAtlas=new h.LineAtlas(256,512),this.crossTileSymbolIndex=new Ns,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new h.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",h.getReferrer());const _=this;this._rtlTextPluginCallback=vr.registerForPluginStateChange(b=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(w,T)=>{if(h.triggerPluginCompletionEvent(w),T&&T.every(M=>M))for(const M in _._sourceCaches){const P=_._sourceCaches[M],O=P.getSource().type;"vector"!==O&&"geojson"!==O||P.reload()}})}),this.on("data",b=>{if("source"!==b.dataType||"metadata"!==b.sourceDataType)return;const w=this.getSource(b.sourceId);if(w&&w.vectorLayerIds)for(const T in this._layers){const M=this._layers[T];M.source===w.id&&this._validateLayer(M)}})}loadURL(o,d={}){this.fire(new h.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof d.validate?d.validate:!h.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,d.accessToken);const b=this.map._requestManager.transformRequest(o,h.ResourceType.Style);this._request=h.getJSON(b,(w,T)=>{this._request=null,w?this.fire(new h.ErrorEvent(w)):T&&this._load(T,_)})}loadJSON(o,d={}){this.fire(new h.Event("dataloading",{dataType:"style"})),this._request=h.exported.frame(()=>{this._request=null,this._load(o,!1!==d.validate)})}loadEmpty(){this.fire(new h.Event("dataloading",{dataType:"style"})),this._load(yn,!1)}_updateLayerCount(o,d){const _=d?1:-1;o.is3D()&&(this._num3DLayers+=_),"circle"===o.type&&(this._numCircleLayers+=_),"symbol"===o.type&&(this._numSymbolLayers+=_)}_load(o,d){if(d&&qr(this,h.validateStyle(o)))return;this._loaded=!0,this.stylesheet=o,this._updateMapProjection();for(const b in o.sources)this.addSource(b,o.sources[b],{validate:!1});this._changed=!1,o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(o.glyphs);const _=rr(this.stylesheet.layers);this._order=_.map(b=>b.id),this._layers={},this._serializedLayers={};for(let b of _)b=h.createStyleLayer(b),b.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=b,this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new _t(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new h.Event("data",{dataType:"style"})),this.fire(new h.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(o){this._spriteRequest=function(d,_,b){let w,T,M;const P=h.exported.devicePixelRatio>1?"@2x":"";let O=h.getJSON(_.transformRequest(_.normalizeSpriteURL(d,P,".json"),h.ResourceType.SpriteJSON),(H,te)=>{O=null,M||(M=H,w=te,B())}),L=h.getImage(_.transformRequest(_.normalizeSpriteURL(d,P,".png"),h.ResourceType.SpriteImage),(H,te)=>{L=null,M||(M=H,T=te,B())});function B(){if(M)b(M);else if(w&&T){const H=h.exported.getImageData(T),te={};for(const X in w){const{width:G,height:_e,x:ae,y:fe,sdf:ye,pixelRatio:xe,stretchX:he,stretchY:Te,content:Ue}=w[X],We=new h.RGBAImage({width:G,height:_e});h.RGBAImage.copy(H,We,{x:ae,y:fe},{x:0,y:0},{width:G,height:_e}),te[X]={data:We,pixelRatio:xe,sdf:ye,stretchX:he,stretchY:Te,content:Ue}}b(null,te)}}return{cancel(){O&&(O.cancel(),O=null),L&&(L.cancel(),L=null)}}}(o,this.map._requestManager,(d,_)=>{if(this._spriteRequest=null,d)this.fire(new h.ErrorEvent(d));else if(_)for(const b in _)this.imageManager.addImage(b,_[b]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new h.Event("data",{dataType:"style"}))})}_validateLayer(o){const d=this.getSource(o.source);if(!d)return;const _=o.sourceLayer;_&&("geojson"===d.type||d.vectorLayerIds&&-1===d.vectorLayerIds.indexOf(_))&&this.fire(new h.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${d.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const d=[];for(const _ of o){const b=this._layers[_];"custom"!==b.type&&d.push(b.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(o){return!!this.terrain&&Vr[o.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(o){if(!this._loaded)return;const d=this._changed;if(this._changed){const b=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(b.length||w.length)&&this._updateWorkerLayers(b,w);for(const T in this._updatedSources){const M=this._updatedSources[T];"reload"===M?this._reloadSource(T):"clear"===M&&this._clearSource(T)}this._updateTilesForChangedImages();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(o);this.light.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._resetUpdates()}const _={};for(const b in this._sourceCaches){const w=this._sourceCaches[b];_[b]=w.used,w.used=!1}for(const b of this._order){const w=this._layers[b];if(w.recalculate(o,this._availableImages),!w.isHidden(o.zoom)){const M=this._getLayerSourceCache(w);M&&(M.used=!0)}const T=this.map.painter;if(T){const M=w.getProgramIds();if(!M)continue;const P=w.getProgramConfiguration(o.zoom);for(const O of M)T.useProgram(O,P)}}for(const b in _){const w=this._sourceCaches[b];_[b]!==w.used&&w.getSource().fire(new h.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:w.getSource().id}))}this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new h.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),qr(this,h.validateStyle(o)))return!1;(o=h.clone$1(o)).layers=rr(o.layers);const d=function(b,w){if(!b)return[{command:Ht.setStyle,args:[w]}];let T=[];try{if(!$(b.version,w.version))return[{command:Ht.setStyle,args:[w]}];$(b.center,w.center)||T.push({command:Ht.setCenter,args:[w.center]}),$(b.zoom,w.zoom)||T.push({command:Ht.setZoom,args:[w.zoom]}),$(b.bearing,w.bearing)||T.push({command:Ht.setBearing,args:[w.bearing]}),$(b.pitch,w.pitch)||T.push({command:Ht.setPitch,args:[w.pitch]}),$(b.sprite,w.sprite)||T.push({command:Ht.setSprite,args:[w.sprite]}),$(b.glyphs,w.glyphs)||T.push({command:Ht.setGlyphs,args:[w.glyphs]}),$(b.transition,w.transition)||T.push({command:Ht.setTransition,args:[w.transition]}),$(b.light,w.light)||T.push({command:Ht.setLight,args:[w.light]}),$(b.fog,w.fog)||T.push({command:Ht.setFog,args:[w.fog]}),$(b.projection,w.projection)||T.push({command:Ht.setProjection,args:[w.projection]});const M={},P=[];!function(B,H,te,X){let G;for(G in H=H||{},B=B||{})B.hasOwnProperty(G)&&(H.hasOwnProperty(G)||Fn(G,te,X));for(G in H)H.hasOwnProperty(G)&&(B.hasOwnProperty(G)?$(B[G],H[G])||("geojson"===B[G].type&&"geojson"===H[G].type&&Ro(B,H,G)?te.push({command:Ht.setGeoJSONSourceData,args:[G,H[G].data]}):ds(G,H,te,X)):Kn(G,H,te))}(b.sources,w.sources,P,M);const O=[];b.layers&&b.layers.forEach(B=>{B.source&&M[B.source]?T.push({command:Ht.removeLayer,args:[B.id]}):O.push(B)});let L=b.terrain;L&&M[L.source]&&(T.push({command:Ht.setTerrain,args:[void 0]}),L=void 0),T=T.concat(P),$(L,w.terrain)||T.push({command:Ht.setTerrain,args:[w.terrain]}),function(B,H,te){H=H||[];const X=(B=B||[]).map(mn),G=H.map(mn),_e=B.reduce(nn,{}),ae=H.reduce(nn,{}),fe=X.slice(),ye=Object.create(null);let xe,he,Te,Ue,We,et,Je;for(xe=0,he=0;xe<X.length;xe++)Te=X[xe],ae.hasOwnProperty(Te)?he++:(te.push({command:Ht.removeLayer,args:[Te]}),fe.splice(fe.indexOf(Te,he),1));for(xe=0,he=0;xe<G.length;xe++)Te=G[G.length-1-xe],fe[fe.length-1-xe]!==Te&&(_e.hasOwnProperty(Te)?(te.push({command:Ht.removeLayer,args:[Te]}),fe.splice(fe.lastIndexOf(Te,fe.length-he),1)):he++,et=fe[fe.length-xe],te.push({command:Ht.addLayer,args:[ae[Te],et]}),fe.splice(fe.length-xe,0,Te),ye[Te]=!0);for(xe=0;xe<G.length;xe++)if(Te=G[xe],Ue=_e[Te],We=ae[Te],!ye[Te]&&!$(Ue,We))if($(Ue.source,We.source)&&$(Ue["source-layer"],We["source-layer"])&&$(Ue.type,We.type)){for(Je in At(Ue.layout,We.layout,te,Te,null,Ht.setLayoutProperty),At(Ue.paint,We.paint,te,Te,null,Ht.setPaintProperty),$(Ue.filter,We.filter)||te.push({command:Ht.setFilter,args:[Te,We.filter]}),$(Ue.minzoom,We.minzoom)&&$(Ue.maxzoom,We.maxzoom)||te.push({command:Ht.setLayerZoomRange,args:[Te,We.minzoom,We.maxzoom]}),Ue)Ue.hasOwnProperty(Je)&&"layout"!==Je&&"paint"!==Je&&"filter"!==Je&&"metadata"!==Je&&"minzoom"!==Je&&"maxzoom"!==Je&&(0===Je.indexOf("paint.")?At(Ue[Je],We[Je],te,Te,Je.slice(6),Ht.setPaintProperty):$(Ue[Je],We[Je])||te.push({command:Ht.setLayerProperty,args:[Te,Je,We[Je]]}));for(Je in We)We.hasOwnProperty(Je)&&!Ue.hasOwnProperty(Je)&&"layout"!==Je&&"paint"!==Je&&"filter"!==Je&&"metadata"!==Je&&"minzoom"!==Je&&"maxzoom"!==Je&&(0===Je.indexOf("paint.")?At(Ue[Je],We[Je],te,Te,Je.slice(6),Ht.setPaintProperty):$(Ue[Je],We[Je])||te.push({command:Ht.setLayerProperty,args:[Te,Je,We[Je]]}))}else te.push({command:Ht.removeLayer,args:[Te]}),et=fe[fe.lastIndexOf(Te)+1],te.push({command:Ht.addLayer,args:[We,et]})}(O,w.layers,T)}catch(M){console.warn("Unable to compute style diff:",M),T=[{command:Ht.setStyle,args:[w]}]}return T}(this.serialize(),o).filter(b=>!(b.command in Yo));if(0===d.length)return!1;const _=d.filter(b=>!(b.command in zs));if(_.length>0)throw new Error(`Unimplemented: ${_.map(b=>b.command).join(", ")}.`);return d.forEach(b=>{"setTransition"!==b.command&&this[b.command].apply(this,b.args)}),this.stylesheet=o,this._updateMapProjection(),!0}addImage(o,d){return this.getImage(o)?this.fire(new h.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(o,d),this._afterImageUpdated(o),this)}updateImage(o,d){this.imageManager.updateImage(o,d)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o),this._afterImageUpdated(o),this):this.fire(new h.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(o,d,_={}){if(this._checkLoaded(),void 0!==this.getSource(o))throw new Error("There is already a source with this ID");if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(h.validateSource,`sources.${o}`,d,null,_))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const b=Oe(o,d,this.dispatcher,this);b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(o),source:b.serialize(),sourceId:o}));const w=T=>{const M=(T?"symbol:":"other:")+o,P=this._sourceCaches[M]=new h.SourceCache(M,b,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[o]=P,P.style=this,P.onAdd(this.map)};w(!1),"vector"!==d.type&&"geojson"!==d.type||w(!0),b.onAdd&&b.onAdd(this.map),this._changed=!0}removeSource(o){this._checkLoaded();const d=this.getSource(o);if(!d)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===o)return this.fire(new h.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.get().source===o)return this.fire(new h.ErrorEvent(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(o);for(const b of _)delete this._sourceCaches[b.id],delete this._updatedSources[b.id],b.fire(new h.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles();return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(o,d){this._checkLoaded(),this.getSource(o).setData(d),this._changed=!0}getSource(o){const d=this._getSourceCache(o);return d&&d.getSource()}addLayer(o,d,_={}){this._checkLoaded();const b=o.id;if(this.getLayer(b))return void this.fire(new h.ErrorEvent(new Error(`Layer with id "${b}" already exists on this map`)));let w;if("custom"===o.type){if(qr(this,h.validateCustomStyleLayer(o)))return;w=h.createStyleLayer(o)}else{if("object"==typeof o.source&&(this.addSource(b,o.source),o=h.clone$1(o),o=h.extend(o,{source:b})),this._validate(h.validateLayer,`layers.${b}`,o,{arrayIndex:-1},_))return;w=h.createStyleLayer(o),this._validateLayer(w),w.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[w.id]=w.serialize(),this._updateLayerCount(w,!0)}const T=d?this._order.indexOf(d):this._order.length;if(d&&-1===T)return void this.fire(new h.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`)));this._order.splice(T,0,b),this._layerOrderChanged=!0,this._layers[b]=w;const M=this._getLayerSourceCache(w);if(this._removedLayers[b]&&w.source&&M&&"custom"!==w.type){const P=this._removedLayers[b];delete this._removedLayers[b],P.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",M.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(o,d){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new h.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===d)return;const _=this._order.indexOf(o);this._order.splice(_,1);const b=d?this._order.indexOf(d):this._order.length;d&&-1===b?this.fire(new h.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`))):(this._order.splice(b,0,o),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(o){this._checkLoaded();const d=this._layers[o];if(!d)return void this.fire(new h.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be removed.`)));d.setEventedParent(null),this._updateLayerCount(d,!1);const _=this._order.indexOf(o);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=d,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],d.onRemove&&d.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}hasLayerType(o){for(const d in this._layers)if(this._layers[d].type===o)return!0;return!1}setLayerZoomRange(o,d,_){this._checkLoaded();const b=this.getLayer(o);b?b.minzoom===d&&b.maxzoom===_||(null!=d&&(b.minzoom=d),null!=_&&(b.maxzoom=_),this._updateLayer(b)):this.fire(new h.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(o,d,_={}){this._checkLoaded();const b=this.getLayer(o);if(b){if(!$(b.filter,d))return null==d?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(h.validateFilter,`layers.${b.id}.filter`,d,{layerType:b.type},_)||(b.filter=h.clone$1(d),this._updateLayer(b)))}else this.fire(new h.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be filtered.`)))}getFilter(o){const d=this.getLayer(o);return d&&h.clone$1(d.filter)}setLayoutProperty(o,d,_,b={}){this._checkLoaded();const w=this.getLayer(o);w?$(w.getLayoutProperty(d),_)||(w.setLayoutProperty(d,_,b),this._updateLayer(w)):this.fire(new h.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(o,d){const _=this.getLayer(o);if(_)return _.getLayoutProperty(d);this.fire(new h.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style.`)))}setPaintProperty(o,d,_,b={}){this._checkLoaded();const w=this.getLayer(o);w?$(w.getPaintProperty(d),_)||(w.setPaintProperty(d,_,b)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new h.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(o,d){const _=this.getLayer(o);return _&&_.getPaintProperty(d)}setFeatureState(o,d){this._checkLoaded();const _=o.source,b=o.sourceLayer,w=this.getSource(_);if(!w)return void this.fire(new h.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const T=w.type;if("geojson"===T&&b)return void this.fire(new h.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===T&&!b)return void this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===o.id&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided.")));const M=this._getSourceCaches(_);for(const P of M)P.setFeatureState(b,o.id,d)}removeFeatureState(o,d){this._checkLoaded();const _=o.source,b=this.getSource(_);if(!b)return void this.fire(new h.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const w=b.type,T="vector"===w?o.sourceLayer:void 0;if("vector"===w&&!T)return void this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&"string"!=typeof o.id&&"number"!=typeof o.id)return void this.fire(new h.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const M=this._getSourceCaches(_);for(const P of M)P.removeFeatureState(T,o.id,d)}getFeatureState(o){this._checkLoaded();const d=o.source,_=o.sourceLayer,b=this.getSource(d);if(b){if("vector"!==b.type||_)return void 0===o.id&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(d)[0].getFeatureState(_,o.id);this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new h.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return h.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const o={};for(const d in this._sourceCaches){const _=this._sourceCaches[d].getSource();o[_.id]||(o[_.id]=_.serialize())}return h.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:o,layers:this._serializeLayers(this._order)},d=>void 0!==d)}_updateLayer(o){this._updatedLayers[o.id]=!0;const d=this._getLayerSourceCache(o);o.source&&!this._updatedSources[o.source]&&d&&"raster"!==d.getSource().type&&(this._updatedSources[o.source]="reload",d.pause()),this._changed=!0,o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const d=T=>"fill-extrusion"===this._layers[T].type,_={},b=[];for(let T=this._order.length-1;T>=0;T--){const M=this._order[T];if(d(M)){_[M]=T;for(const P of o){const O=P[M];if(O)for(const L of O)b.push(L)}}}b.sort((T,M)=>M.intersectionZ-T.intersectionZ);const w=[];for(let T=this._order.length-1;T>=0;T--){const M=this._order[T];if(d(M))for(let P=b.length-1;P>=0;P--){const O=b[P].feature;if(_[O.layer.id]<T)break;w.push(O),b.pop()}else for(const P of o){const O=P[M];if(O)for(const L of O)w.push(L.feature)}}return w}queryRenderedFeatures(o,d,_){d&&d.filter&&this._validate(h.validateFilter,"queryRenderedFeatures.filter",d.filter,null,d);const b={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new h.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of d.layers){const O=this._layers[P];if(!O)return this.fire(new h.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];b[O.source]=!0}}const w=[];d.availableImages=this._availableImages;const T=d&&d.layers?d.layers.some(P=>{const O=this.getLayer(P);return O&&O.is3D()}):this.has3DLayers(),M=sr.createFromScreenPoints(o,_);for(const P in this._sourceCaches){const O=this._sourceCaches[P].getSource().id;d.layers&&!b[O]||w.push(je(this._sourceCaches[P],this._layers,this._serializedLayers,M,d,_,T,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(P,O,L,B,H,te,X){const G={},_e=te.queryRenderedSymbols(B),ae=[];for(const fe of Object.keys(_e).map(Number))ae.push(X[fe]);ae.sort(It);for(const fe of ae){const ye=fe.featureIndex.lookupSymbolFeatures(_e[fe.bucketInstanceId],O,fe.bucketIndex,fe.sourceLayerIndex,H.filter,H.layers,H.availableImages,P);for(const xe in ye){const he=G[xe]=G[xe]||[],Te=ye[xe];Te.sort((Ue,We)=>{const et=fe.featureSortOrder;if(et){const Je=et.indexOf(Ue.featureIndex);return et.indexOf(We.featureIndex)-Je}return We.featureIndex-Ue.featureIndex});for(const Ue of Te)he.push(Ue)}}for(const fe in G)G[fe].forEach(ye=>{const xe=ye.feature,he=L(P[fe]).getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=he});return G}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),M.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(o,d){d&&d.filter&&this._validate(h.validateFilter,"querySourceFeatures.filter",d.filter,null,d);const _=this._getSourceCaches(o);let b=[];for(const w of _)b=b.concat(st(w,d));return b}addSourceType(o,d,_){return vr.getSourceType(o)?_(new Error(`A source type called "${o}" already exists.`)):(vr.setSourceType(o,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:d.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(o,d={}){this._checkLoaded();const _=this.light.getLight();let b=!1;for(const T in o)if(!$(o[T],_[T])){b=!0;break}if(!b)return;const w={now:h.exported.now(),transition:h.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,d),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(o,d=1){if(this._checkLoaded(),!o)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===d){if("object"==typeof o.source){const _="terrain-dem-src";this.addSource(_,o.source),o=h.clone$1(o),o=h.extend(o,{source:_})}if(this._validate(h.validateTerrain,"terrain",o))return}if(!this.terrain||this.terrain&&d!==this.terrain.drapeRenderMode)this._createTerrain(o,d);else{const _=this.terrain,b=_.get();for(const w in o)if(!$(o[w],b[w])){_.set(o),this.stylesheet.terrain=o;const T={now:h.exported.now(),transition:h.extend({duration:0},this.stylesheet.transition)};_.updateTransitions(T);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const d=this.fog=new Ln(o,this.map.transform);this.stylesheet.fog=o;const _={now:h.exported.now(),transition:h.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog,_=d.get();for(const b in o)if(!$(o[b],_[b])){d.set(o),this.stylesheet.fog=o;const w={now:h.exported.now(),transition:h.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(w);break}}else this._createFog(o);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const o=this._order.filter(_=>this.isLayerDraped(this._layers[_])),d=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...d)}_createTerrain(o,d){const _=this.terrain=new ut(o,d);this.stylesheet.terrain=o,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const b={now:h.exported.now(),transition:h.extend({duration:0},this.stylesheet.transition)};_.updateTransitions(b)}_force3DLayerUpdate(){for(const o in this._layers){const d=this._layers[o];"fill-extrusion"===d.type&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const d=this._layers[o];"symbol"===d.type&&this._updateLayer(d)}}_validate(o,d,_,b,w={}){return(!w||!1!==w.validate)&&qr(this,o.call(h.validateStyle,h.extend({key:d,style:this.serialize(),value:_,styleSpec:h.spec},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),h.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this._sourceCaches)this._sourceCaches[o].clearTiles(),this._sourceCaches[o].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){const d=this._getSourceCaches(o);for(const _ of d)_.clearTiles()}_reloadSource(o){const d=this._getSourceCaches(o);for(const _ of d)_.resume(),_.reload()}_updateSources(o){for(const d in this._sourceCaches)this._sourceCaches[d].update(o)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const d=this._sourceCaches[o];d.resume(),d.reload()}}_updatePlacement(o,d,_,b,w=!1){let T=!1,M=!1;const P={};for(const O of this._order){const L=this._layers[O];if("symbol"!==L.type)continue;if(!P[L.source]){const H=this._getLayerSourceCache(L);if(!H)continue;P[L.source]=H.getRenderableIds(!0).map(te=>H.getTileByID(te)).sort((te,X)=>X.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(X.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(L,P[L.source],o.center.lng,o.projection);T=T||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),w=w||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new h.Event("neworder")),(w||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(h.exported.now(),o.zoom))&&(this.pauseablePlacement=new bo(o,this._order,w,d,_,b,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(h.exported.now()),M=!0),T&&this.pauseablePlacement.placement.setStale()),M||T)for(const O of this._order){const L=this._layers[O];"symbol"===L.type&&this.placement.updateLayerOpacities(L,P[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(h.exported.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,d,_){this.imageManager.getImages(d.icons,_),this._updateTilesForChangedImages();const b=w=>{w&&w.setDependencies(d.tileID.key,d.type,d.icons)};b(this._otherSourceCaches[d.source]),b(this._symbolSourceCaches[d.source])}getGlyphs(o,d,_){this.glyphManager.getGlyphs(d.stacks,_)}getResource(o,d,_){return h.makeRequest(d,_)}_getSourceCache(o){return this._otherSourceCaches[o]}_getLayerSourceCache(o){return"symbol"===o.type?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}_getSourceCaches(o){const d=[];return this._otherSourceCaches[o]&&d.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&d.push(this._symbolSourceCaches[o]),d}_isSourceCacheLoaded(o){const d=this._getSourceCaches(o);return 0===d.length?(this.fire(new h.ErrorEvent(new Error(`There is no source with ID '${o}'`))),!1):d.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}vr.getSourceType=function(m){return Me[m]},vr.setSourceType=function(m,o){Me[m]=o},vr.registerForPluginStateChange=h.registerForPluginStateChange;var ji="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",pe="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Ne={},dt={};Ne=Pt("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),dt=Pt("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Qt=Pt("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),fr=ji;var An={background:Pt("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Pt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Pt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Pt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Pt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Pt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Pt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Pt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Pt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Pt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Pt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Pt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Pt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Pt("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Pt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Pt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Pt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Pt("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Pt("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Pt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Pt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Pt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Pt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Pt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Pt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Pt("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",pe),skyboxGradient:Pt("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",pe),skyboxCapture:Pt("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Pt("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:Pt("uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;varying highp vec3 v_ray_dir;void main() {highp vec3 dir=normalize(v_ray_dir);highp vec3 closest_point=abs(dot(u_globe_pos,dir))*dir;float norm_dist_from_center=length(closest_point-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 1.0)\ndiscard;float t=clamp(1.0-sqrt(norm_dist_from_center-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;varying highp vec3 v_ray_dir;void main() {v_ray_dir=mix(mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);gl_Position=vec4(a_pos,1.0);}")};function Pt(m,o,d){const _=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,b=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,w=o.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),T=m.match(b),M=o.match(b),P=ji.match(b);let O=M?M.concat(T):T;d||(Ne.staticUniforms&&(O=Ne.staticUniforms.concat(O)),dt.staticUniforms&&(O=dt.staticUniforms.concat(O))),O&&(O=O.concat(P));const L={};return{fragmentSource:m=m.replace(_,(B,H,te,X,G)=>(L[G]=!0,"define"===H?`\n#ifndef HAS_UNIFORM_u_${G}\nvarying ${te} ${X} ${G};\n#else\nuniform ${te} ${X} u_${G};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${G}\n    ${te} ${X} ${G} = u_${G};\n#endif\n`)),vertexSource:o=o.replace(_,(B,H,te,X,G)=>{const _e="float"===X?"vec2":"vec4",ae=G.match(/color/)?"color":_e;return L[G]?"define"===H?`\n#ifndef HAS_UNIFORM_u_${G}\nuniform lowp float u_${G}_t;\nattribute ${te} ${_e} a_${G};\nvarying ${te} ${X} ${G};\n#else\nuniform ${te} ${X} u_${G};\n#endif\n`:"vec4"===ae?`\n#ifndef HAS_UNIFORM_u_${G}\n    ${G} = a_${G};\n#else\n    ${te} ${X} ${G} = u_${G};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${G}\n    ${G} = unpack_mix_${ae}(a_${G}, u_${G}_t);\n#else\n    ${te} ${X} ${G} = u_${G};\n#endif\n`:"define"===H?`\n#ifndef HAS_UNIFORM_u_${G}\nuniform lowp float u_${G}_t;\nattribute ${te} ${_e} a_${G};\n#else\nuniform ${te} ${X} u_${G};\n#endif\n`:"vec4"===ae?`\n#ifndef HAS_UNIFORM_u_${G}\n    ${te} ${X} ${G} = a_${G};\n#else\n    ${te} ${X} ${G} = u_${G};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${G}\n    ${te} ${X} ${G} = unpack_mix_${ae}(a_${G}, u_${G}_t);\n#else\n    ${te} ${X} ${G} = u_${G};\n#endif\n`}),staticAttributes:w,staticUniforms:O}}class ir{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,d,_,b,w,T,M,P){this.context=o;let O=this.boundPaintVertexBuffers.length!==b.length;for(let L=0;!O&&L<b.length;L++)this.boundPaintVertexBuffers[L]!==b[L]&&(O=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===_&&!O&&this.boundIndexBuffer===w&&this.boundVertexOffset===T&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===P?(o.bindVertexArrayOES.set(this.vao),M&&M.bind(),w&&w.dynamicDraw&&w.bind(),P&&P.bind()):this.freshBind(d,_,b,w,T,M,P)}freshBind(o,d,_,b,w,T,M){let P;const O=o.numAttributes,L=this.context,B=L.gl;if(L.extVertexArrayObject)this.vao&&this.destroy(),this.vao=L.extVertexArrayObject.createVertexArrayOES(),L.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=o,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=b,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=M;else{P=L.currentNumAttributes||0;for(let H=O;H<P;H++)B.disableVertexAttribArray(H)}d.enableAttributes(B,o);for(const H of _)H.enableAttributes(B,o);T&&T.enableAttributes(B,o),M&&M.enableAttributes(B,o),d.bind(),d.setVertexAttribPointers(B,o,w);for(const H of _)H.bind(),H.setVertexAttribPointers(B,o,w);T&&(T.bind(),T.setVertexAttribPointers(B,o,w)),b&&b.bind(),M&&(M.bind(),M.setVertexAttribPointers(B,o,w)),L.currentNumAttributes=O}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function yi(m,o){const d=Math.pow(2,o.canonical.z),_=o.canonical.y;return[new h.MercatorCoordinate(0,_/d).toLngLat().lat,new h.MercatorCoordinate(0,(_+1)/d).toLngLat().lat]}function lr(m,o,d,_,b,w,T){const M=m.context,P=M.gl,O=d.fbo;if(!O)return;m.prepareDrawTile();const L=m.useProgram("hillshade");M.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,O.colorAttachment.get());const B=((G,_e,ae,fe)=>{const ye=ae.paint.get("hillshade-shadow-color"),xe=ae.paint.get("hillshade-highlight-color"),he=ae.paint.get("hillshade-accent-color");let Te=ae.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===ae.paint.get("hillshade-illumination-anchor")&&(Te-=G.transform.angle);const Ue=!G.options.moving;return{u_matrix:fe||G.transform.calculateProjMatrix(_e.tileID.toUnwrapped(),Ue),u_image:0,u_latrange:yi(0,_e.tileID),u_light:[ae.paint.get("hillshade-exaggeration"),Te],u_shadow:ye,u_highlight:xe,u_accent:he}})(m,d,_,m.terrain?o.projMatrix:null);m.prepareDrawProgram(M,L,o.toUnwrapped());const{tileBoundsBuffer:H,tileBoundsIndexBuffer:te,tileBoundsSegments:X}=m.getTileBoundsBuffers(d);L.draw(M,P.TRIANGLES,b,w,T,h.CullFaceMode.disabled,B,_.id,H,te,X)}function Ft(m,o,d){if(!o.needsDEMTextureUpload)return;const _=m.context,b=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||m.getTileTexture(d.stride);const w=d.getPixels();o.demTexture?o.demTexture.update(w,{premultiply:!1}):o.demTexture=new h.Texture(_,w,b.RGBA,{premultiply:!1}),o.needsDEMTextureUpload=!1}function Dn(m,o,d,_,b,w){const T=m.context,M=T.gl;if(!o.dem)return;const P=o.dem;if(T.activeTexture.set(M.TEXTURE1),Ft(m,o,P),!o.demTexture)return;o.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);const O=P.dim;T.activeTexture.set(M.TEXTURE0);let L=o.fbo;if(!L){const X=new h.Texture(T,{width:O,height:O,data:null},M.RGBA);X.bind(M.LINEAR,M.CLAMP_TO_EDGE),L=o.fbo=T.createFramebuffer(O,O,!0),L.colorAttachment.set(X.texture)}T.bindFramebuffer.set(L.framebuffer),T.viewport.set([0,0,O,O]);const{tileBoundsBuffer:B,tileBoundsIndexBuffer:H,tileBoundsSegments:te}=m.getMercatorTileBoundsBuffers();m.useProgram("hillshadePrepare").draw(T,M.TRIANGLES,_,b,w,h.CullFaceMode.disabled,((X,G)=>{const _e=G.stride,ae=h.create();return h.ortho(ae,0,h.EXTENT,-h.EXTENT,0,0,1),h.translate(ae,ae,[0,-h.EXTENT,0]),{u_matrix:ae,u_image:1,u_dimension:[_e,_e],u_zoom:X.overscaledZ,u_unpack:G.unpackVector}})(o.tileID,P),d.id,B,H,te),o.needsHillshadePrepare=!1}const qn=(m,o)=>({u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_image0:new h.Uniform1i(m,o.u_image0),u_skirt_height:new h.Uniform1f(m,o.u_skirt_height)}),Ur=(m,o)=>({u_matrix:m,u_image0:0,u_skirt_height:o}),di=(m,o,d,_,b,w)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:o,u_merc_matrix:d,u_zoom_transition:_,u_merc_center:b,u_image0:0,u_grid_matrix:w?Float32Array.from(w):new Float32Array(9)});function Ir(m,o){return null!=m&&null!=o&&!(!m.hasData()||!o.hasData())&&null!=m.demTexture&&null!=o.demTexture&&m.tileID.key!==o.tileID.key}const ri=new class{constructor(){this.operations={}}newMorphing(m,o,d,_,b){if(m in this.operations){const w=this.operations[m];w.to.tileID.key!==d.tileID.key&&(w.queued=d)}else this.operations[m]={startTime:_,phase:0,duration:b,from:o,to:d,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const o=this.operations[m];return{from:o.from,to:o.to,phase:o.phase}}update(m){for(const o in this.operations){const d=this.operations[o];for(d.phase=(m-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,m)){delete this.operations[o];break}}}_nextOp(m,o){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=o,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},gr={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Bs(m,o){const d=1<<m.z;return!o&&(0===m.x||m.x===d-1)||0===m.y||m.y===d-1}const wo=m=>({u_matrix:m});function On(m,o,d,_,b){if(b>0){const w=h.exported.now(),T=(w-m.timeAdded)/b,M=o?(w-o.timeAdded)/b:-1,P=d.getSource(),O=_.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),L=!o||Math.abs(o.tileID.overscaledZ-O)>Math.abs(m.tileID.overscaledZ-O),B=L&&m.refreshedUponExpiration?1:h.clamp(L?T:1-M,0,1);return m.refreshedUponExpiration&&T>=1&&(m.refreshedUponExpiration=!1),o?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}const tu=2*h.mercatorZfromAltitude(1,0)*h.GLOBE_RADIUS*Math.PI;class Vs extends h.SourceCache{constructor(o){const d={type:"raster-dem",maxzoom:o.transform.maxZoom},_=new hn(rn(),null),b=Oe("mock-dem",d,_,o.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,d){o.state="loaded",d(null)}}class qa extends h.SourceCache{constructor(o){const d=Oe("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new hn(rn(),null),o.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,d,_){if(o.freezeTileCoverage)return;this.transform=o;const b=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,T)=>{if(w[T.key]="",!this._tiles[T.key]){const M=new h.Tile(T,this._source.tileSize*T.overscaleFactor(),o.tileZoom);M.state="loaded",this._tiles[T.key]=M}return w},{});for(const w in this._tiles)w in b||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(o){const d=this.proxyCachedFBO[o];if(void 0!==d){const _=Object.values(d);this.renderCachePool.push(..._),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ca extends h.OverscaledTileID{constructor(o,d,_){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=d,this.projMatrix=_}}class Zr extends h.Elevation{constructor(o,d){super(),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,b,w]=function(P){const O=new h.StructArrayLayout4i8,L=new h.StructArrayLayout3ui6,B=131;O.reserve(17161),L.reserve(33800);const H=h.EXTENT/128,te=h.EXTENT+H/2,X=te+H;for(let _e=-H;_e<X;_e+=H)for(let ae=-H;ae<X;ae+=H){const fe=ae<0||ae>te||_e<0||_e>te?24575:0,ye=h.clamp(Math.round(ae),0,h.EXTENT),xe=h.clamp(Math.round(_e),0,h.EXTENT);O.emplaceBack(ye+fe,xe,ye,xe)}const G=(_e,ae)=>{const fe=ae*B+_e;L.emplaceBack(fe+1,fe,fe+B),L.emplaceBack(fe+B,fe+B+1,fe+1)};for(let _e=1;_e<129;_e++)for(let ae=1;ae<129;ae++)G(ae,_e);return[0,129].forEach(_e=>{for(let ae=0;ae<130;ae++)G(ae,_e),G(_e,ae)}),[O,L,32768]}(),T=o.context;this.gridBuffer=T.createVertexBuffer(_,h.boundsAttributes.members),this.gridIndexBuffer=T.createIndexBuffer(b),this.gridSegments=h.SegmentVector.simpleSegment(0,0,_.length,b.length),this.gridNoSkirtSegments=h.SegmentVector.simpleSegment(0,0,_.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new qa(d.map),this.orthoMatrix=h.create(),h.ortho(this.orthoMatrix,0,h.EXTENT,0,h.EXTENT,0,1);const M=T.gl;this._overlapStencilMode=new h.StencilMode({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Vs(d.map)}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),o.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=o,this._checkRenderCacheEfficiency()}update(o,d,_){if(o&&o.terrain){this._style!==o&&(this.style=o),this.enabled=!0;const b=o.terrain.properties;this.sourceCache=0===o.terrain.drapeRenderMode?this._mockSourceCache:o._getSourceCache(b.get("source")),this._exaggeration=b.get("exaggeration");const w=()=>{this.sourceCache.used&&h.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const T=this.getScaledDemTileSize();this.sourceCache.update(d,T,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,w(),this._initializing=!0),w(),d.updateElevation(!_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const o=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==o.efficiency&&h.warnOnce(`Terrain render cache efficiency is not optimal (${o.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${o.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(o){o.coord&&"source"===o.dataType?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):"style"===o.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._sourceCaches)this._style._sourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(h.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=d.getIds().map(P=>{const O=d.getTileByID(P).tileID;return O.projMatrix=_.calculateProjMatrix(O.toUnwrapped()),O});(function(P,O){const L=O.transform.pointCoordinate(O.transform.getCameraPoint()),B=new h.pointGeometry(L.x,L.y);P.sort((H,te)=>{if(te.overscaledZ-H.overscaledZ)return te.overscaledZ-H.overscaledZ;const X=new h.pointGeometry(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),G=new h.pointGeometry(te.canonical.x+(1<<te.canonical.z)*te.wrap,te.canonical.y),_e=B.mult(1<<H.canonical.z);return _e.x-=.5,_e.y-=.5,_e.distSqr(X)-_e.distSqr(G)})})(b,this.painter),this._previousZoom=_.zoom;const w=this.proxyToSource||{};this.proxyToSource={},b.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const T=this._style._sourceCaches;for(const P in T){const O=T[P];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,o[P],w),O.usedForTerrain))continue;const L=o[P];O.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[d.id]=b.map(P=>new Ca(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1,this._updateTimestamp=h.exported.now();const M={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const O=this.terrainTileForTile[P.key];if(!O)continue;const L=O.tileID.key;L in M||(this._visibleDemTiles.push(O),M[L]=L)}}_assignTerrainTiles(o){this._initializing||o.forEach(d=>{if(this.terrainTileForTile[d.key])return;const _=this._findTileCoveringTileID(d,this.sourceCache);_&&(this.terrainTileForTile[d.key]=_)})}_prepareDEMTextures(){const o=this.painter.context,d=o.gl;for(const _ in this.terrainTileForTile){const b=this.terrainTileForTile[_],w=b.dem;!w||b.demTexture&&!b.needsDEMTextureUpload||(o.activeTexture.set(d.TEXTURE1),Ft(this.painter,b,w))}}_prepareDemTileUniforms(o,d,_,b){if(!d||null==d.demTexture)return!1;const w=o.tileID.canonical,T=Math.pow(2,d.tileID.canonical.z-w.z),M=b||"";return _[`u_dem_tl${M}`]=[w.x*T%1,w.y*T%1],_[`u_dem_scale${M}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const o=this.painter.context,d=o.gl;if(!this._emptyDepthBufferTexture){const _=new h.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new h.Texture(o,_,d.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let o=0;const d=this._visibleDemTiles.reduce((_,b)=>{if(!b.dem)return _;const w=b.dem.tree.minimums[0];return w>0&&o++,_+w},0);return o?d/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,d=o.gl;o.activeTexture.set(d.TEXTURE2);const _=this._getLoadedAreaMinimum(),b=new h.RGBAImage({width:1,height:1},new Uint8Array(h.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(b,{premultiply:!1}):w=this._emptyDEMTexture=new h.Texture(o,b,d.RGBA,{premultiply:!1}),w}setupElevationDraw(o,d,_){const b=this.painter.context,w=b.gl,T=(M=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:h.DEMData.getUnpackVector(M),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var M;T.u_dem_size=this.sourceCache.getSource().tileSize,T.u_exaggeration=this.exaggeration();const P=this.painter.transform,O=P.projection,L=o.tileID.canonical;T.u_tile_tl_up=O.upVector(L,0,0),T.u_tile_tr_up=O.upVector(L,h.EXTENT,0),T.u_tile_br_up=O.upVector(L,h.EXTENT,h.EXTENT),T.u_tile_bl_up=O.upVector(L,0,h.EXTENT),T.u_tile_up_scale=_&&_.useDenormalizedUpVectorScale?tu:O.upVectorScale(L,P.center.lat,P.worldSize).metersToTile;let B=null,H=null,te=1;if(_&&_.morphing&&this._useVertexMorphing){const X=_.morphing.srcDemTile,G=_.morphing.dstDemTile;te=_.morphing.phase,X&&G&&(this._prepareDemTileUniforms(o,X,T,"_prev")&&(H=X),this._prepareDemTileUniforms(o,G,T)&&(B=G))}if(H&&B?(b.activeTexture.set(w.TEXTURE2),B.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),b.activeTexture.set(w.TEXTURE4),H.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),T.u_dem_lerp=te):(B=this.terrainTileForTile[o.tileID.key],b.activeTexture.set(w.TEXTURE2),(this._prepareDemTileUniforms(o,B,T)?B.demTexture:this.emptyDEMTexture).bind(w.NEAREST,w.CLAMP_TO_EDGE)),b.activeTexture.set(w.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),this._depthFBO&&(T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&B){const X=(1<<B.tileID.canonical.z)*h.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=X}_&&_.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),d.setTerrainUniformValues(b,T)}renderToBackBuffer(o){const d=this.painter,_=this.painter.context;0!==o.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),this.renderingToTexture=!1,function(b,w,T,M,P){if("globe"===b.transform.projection.name)!function(O,L,B,H,te){const X=O.context,G=X.gl;let _e,ae;const fe=O.options.showTerrainWireframe?2:0,ye=(Je,Dt)=>{if(ae===Je)return;const Ve=[gr[Je],"PROJECTION_GLOBE_VIEW"];Dt&&Ve.push(gr[fe]),_e=O.useProgram("globeRaster",null,Ve),ae=Je},xe=O.colorModeForRenderPass(),he=new h.DepthMode(G.LEQUAL,h.DepthMode.ReadWrite,O.depthRangeFor3D);ri.update(te);const Te=O.transform,Ue=h.calculateGlobeMercatorMatrix(Te),We=[h.mercatorXfromLng(Te.center.lng),h.mercatorYfromLat(Te.center.lat)],et=O.globeSharedBuffers;if((fe?[!1,!0]:[!1]).forEach(Je=>{ae=-1;const Dt=Je?G.LINES:G.TRIANGLES;for(const Ve of H){const vt=B.getTile(Ve),ht=h.StencilMode.disabled,qt=L.prevTerrainTileForTile[Ve.key],Ke=L.terrainTileForTile[Ve.key];Ir(qt,Ke)&&ri.newMorphing(Ve.key,qt,Ke,te,250),X.activeTexture.set(G.TEXTURE0),vt.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const Jt=ri.getMorphValuesForProxy(Ve.key),en=Jt?1:0,Ut={useDenormalizedUpVectorScale:!0};Jt&&h.extend$1(Ut,{morphing:{srcDemTile:Jt.from,dstDemTile:Jt.to,phase:h.easeCubicInOut(Jt.phase)}});const Zt=Float32Array.from(Te.globeMatrix),ln=h.globeTileLatLngCorners(Ve.canonical),Tn=h.getGridMatrix(Ve.canonical,ln),tn=di(Te.projMatrix,Zt,Ue,h.globeToMercatorTransition(Te.zoom),We,Tn);if(ye(en,Je),L.setupElevationDraw(vt,_e,Ut),O.prepareDrawProgram(X,_e,Ve.toUnwrapped()),et){const[bn,Xt,ii]=Je?et.getWirefameBuffers(O.context):et.getGridBuffers();_e.draw(X,Dt,he,ht,xe,h.CullFaceMode.backCCW,tn,"globe_raster",bn,Xt,ii)}}}),et){_e=O.useProgram("globeRaster",null,["GLOBE_POLES","PROJECTION_GLOBE_VIEW"]);for(const Je of H){const{x:Dt,y:Ve,z:vt}=Je.canonical,ht=0===Ve,qt=Ve===(1<<vt)-1,[Ke,Jt,en,Ut]=et.getPoleBuffers(vt);if(Ut&&(ht||qt)){const Zt=B.getTile(Je);X.activeTexture.set(G.TEXTURE0),Zt.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let ln=h.globePoleMatrixForTile(vt,Dt,Te);const Tn=(tn,bn)=>tn.draw(X,G.TRIANGLES,he,h.StencilMode.disabled,xe,h.CullFaceMode.disabled,di(Te.projMatrix,ln,ln,0,We),"globe_pole_raster",bn,en,Ut);L.setupElevationDraw(Zt,_e,{}),O.prepareDrawProgram(X,_e,Je.toUnwrapped()),ht&&Tn(_e,Ke),qt&&(ln=h.scale(h.create(),ln,[1,-1,1]),Tn(_e,Jt))}}}}(b,w,T,M,P);else{const O=b.context,L=O.gl;let B,H;const te=b.options.showTerrainWireframe?2:0,X=(ye,xe)=>{if(H===ye)return;const he=[gr[ye]];xe&&he.push(gr[te]),B=b.useProgram("terrainRaster",null,he),H=ye},G=b.colorModeForRenderPass(),_e=new h.DepthMode(L.LEQUAL,h.DepthMode.ReadWrite,b.depthRangeFor3D);ri.update(P);const ae=b.transform,fe=6*Math.pow(1.5,22-ae.zoom)*w.exaggeration();(te?[!1,!0]:[!1]).forEach(ye=>{H=-1;const xe=ye?L.LINES:L.TRIANGLES,[he,Te]=ye?w.getWirefameBuffer():[w.gridIndexBuffer,w.gridSegments];for(const Ue of M){const We=T.getTile(Ue),et=h.StencilMode.disabled,Je=w.prevTerrainTileForTile[Ue.key],Dt=w.terrainTileForTile[Ue.key];Ir(Je,Dt)&&ri.newMorphing(Ue.key,Je,Dt,P,250),O.activeTexture.set(L.TEXTURE0),We.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const Ve=ri.getMorphValuesForProxy(Ue.key),vt=Ve?1:0;let ht;Ve&&(ht={morphing:{srcDemTile:Ve.from,dstDemTile:Ve.to,phase:h.easeCubicInOut(Ve.phase)}});const qt=Ur(Ue.projMatrix,Bs(Ue.canonical,ae.renderWorldCopies)?fe/10:fe);X(vt,ye),w.setupElevationDraw(We,B,ht),b.prepareDrawProgram(O,B,Ue.toUnwrapped()),B.draw(O,xe,_e,et,G,h.CullFaceMode.backCCW,qt,"terrain_raster",w.gridBuffer,he,Te)}})}}(d,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,o.splice(0,o.length))}renderBatch(o){if(0===this._drapedRenderBatches.length)return o+1;this.renderingToTexture=!0;const d=this.painter,_=this.painter.context,b=this.proxySourceCache,w=this.proxiedCoords[b.id],T=this._drapedRenderBatches.shift(),M=[],P=d.style.order;let O=0;for(const L of w){const B=b.getTileByID(L.proxyTileKey),H=b.proxyCachedFBO[L.key]?b.proxyCachedFBO[L.key][o]:void 0,te=void 0!==H?b.renderCache[H]:this.pool[O++],X=void 0!==H;if(B.texture=te.tex,X&&!te.dirty){M.push(B.tileID);continue}let G;_.bindFramebuffer.set(te.fb.framebuffer),this.renderedToTile=!1,te.dirty&&(_.clear({color:h.Color.transparent,stencil:0}),te.dirty=!1);for(let _e=T.start;_e<=T.end;++_e){const ae=d.style._layers[P[_e]];if(ae.isHidden(d.transform.zoom))continue;const fe=d.style._getLayerSourceCache(ae),ye=fe?this.proxyToSource[L.key][fe.id]:[L];if(!ye)continue;const xe=ye;_.viewport.set([0,0,te.fb.width,te.fb.height]),G!==(fe?fe.id:null)&&(this._setupStencil(te,ye,ae,fe),G=fe?fe.id:null),d.renderLayer(d,fe,ae,xe)}this.renderedToTile?(te.dirty=!0,M.push(B.tileID)):X||--O,5===O&&(O=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),T.end+1}postRender(){}renderCacheEfficiency(o){const d=o.order.length;if(0===d)return{efficiency:100};let _,b=0,w=0,T=!1;for(let M=0;M<d;++M){const P=o._layers[o.order[M]];this._style.isLayerDraped(P)?(T&&++b,++w):T||(T=!0,_=P.id)}return 0===w?{efficiency:100}:{efficiency:100*(1-b/w),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{o=Math.min(o,d.dem.tree.minimums[0])}),0===o?o:(o-30)*this._exaggeration}raycast(o,d,_){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const T=w.tileID,M=Math.pow(2,T.overscaledZ),{x:P,y:O}=T.canonical,L=P/M,B=(P+1)/M,H=O/M,te=(O+1)/M;return{minx:L,miny:H,maxx:B,maxy:te,t:w.dem.tree.raycastRoot(L,H,B,te,o,d,_),tile:w}});b.sort((w,T)=>(null!==w.t?w.t:Number.MAX_VALUE)-(null!==T.t?T.t:Number.MAX_VALUE));for(const w of b){if(null==w.t)return null;const T=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,o,d,_);if(null!=T)return T}return null}_createFBO(){const o=this.painter.context,d=o.gl,_=this.drapeBufferSize;o.activeTexture.set(d.TEXTURE0);const b=new h.Texture(o,{width:_[0],height:_[1],data:null},d.RGBA);b.bind(d.LINEAR,d.CLAMP_TO_EDGE);const w=o.createFramebuffer(_[0],_[1],!1);return w.colorAttachment.set(b.texture),w.depthAttachment=new Xo(o,w.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&!o.extTextureFilterAnisotropicForceOff&&d.texParameterf(d.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:w,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const d=this._style._layers[o],_=d.isHidden(this.painter.transform.zoom),b=d.getCrossfadeParameters(),w=!!b&&1!==b.t,T=d.hasTransition();return"custom"!==d.type&&!_&&(w||T)})}_clearRasterFadeFromRenderCache(){let o=!1;for(const d in this._style._sourceCaches)if(this._style._sourceCaches[d]._source instanceof j){o=!0;break}if(o)for(let d=0;d<this._style.order.length;++d){const _=this._style._layers[this._style.order[d]],b=_.isHidden(this.painter.transform.zoom),w=this._style._getLayerSourceCache(_);if("raster"!==_.type||b||!w)continue;const T=_.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const P=this.proxyToSource[M.key][w.id];if(P)for(const O of P){const L=On(w.getTile(O),w.findLoadedParent(O,0),w,this.painter.transform,T);(1!==L.opacity||0!==L.mix)&&this._clearRenderCacheForTile(w.id,O)}}}}_setupDrapedRenderBatches(){const o=this._style.order,d=o.length;if(0===d)return;const _=[];let b,w=0,T=this._style._layers[o[w]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++w<d;)T=this._style._layers[o[w]];for(;w<d;++w){const M=this._style._layers[o[w]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?void 0===b&&(b=w):void 0!==b&&(_.push({start:b,end:w-1}),b=void 0))}void 0!==b&&_.push({start:b,end:w-1}),this._drapedRenderBatches=_}_setupRenderCache(o){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const T=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let M=0;M<T.length;++M){const P=Object.values(T[M]);d.renderCachePool.push(...P)}}return}this._clearRasterFadeFromRenderCache();const _=this.proxyCoords,b=this._tilesDirty;for(let T=_.length-1;T>=0;T--){const M=_[T];if(d.getTileByID(M.key),void 0!==d.proxyCachedFBO[M.key]){const P=o[M.key],O=this.proxyToSource[M.key];let L=0;for(const B in O){const H=O[B],te=P[B];if(!te||te.length!==H.length||H.some((X,G)=>X!==te[G]||b[B]&&b[B].hasOwnProperty(X.key))){L=-1;break}++L}for(const B in d.proxyCachedFBO[M.key])d.renderCache[d.proxyCachedFBO[M.key][B]].dirty=L<0||L!==Object.values(P).length}}const w=[...this._drapedRenderBatches];w.sort((T,M)=>M.end-M.start-(T.end-T.start));for(const T of w)for(const M of _){if(d.proxyCachedFBO[M.key])continue;let P=d.renderCachePool.pop();void 0===P&&d.renderCache.length<50&&(P=d.renderCache.length,d.renderCache.push(this._createFBO())),void 0!==P&&(d.proxyCachedFBO[M.key]={},d.proxyCachedFBO[M.key][T.start]=P,d.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(o,d,_,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,T=w.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let M;if(_.isTileClipped())M=d.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs.get(o.key)||0),this._overlapStencilMode):h.StencilMode.disabled}_renderTileClippingMasks(o,d){const _=this.painter,b=this.painter.context,w=b.gl;_._tileClippingMaskIDs.clear(),b.setColorMode(h.ColorMode.disabled),b.setDepthMode(h.DepthMode.disabled);const T=_.useProgram("clippingMask");for(const M of o){const P=--d;_._tileClippingMaskIDs.set(M.key,P),T.draw(b,w.TRIANGLES,h.DepthMode.disabled,new h.StencilMode({func:w.ALWAYS,mask:0},P,255,w.KEEP,w.KEEP,w.REPLACE),h.ColorMode.disabled,h.CullFaceMode.disabled,wo(M.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(o){const d=this.painter.transform;if(o.x<0||o.x>d.width||o.y<0||o.y>d.height)return null;const _=[o.x,o.y,1,1];h.transformMat4$1(_,_,d.pixelMatrixInverse),h.scale$1(_,_,1/_[3]),_[0]/=d.worldSize,_[1]/=d.worldSize;const b=d._camera.position,w=h.mercatorZfromAltitude(1,d.center.lat),T=[b[0],b[1],b[2]/w,0],M=h.subtract([],_.slice(0,3),T);h.normalize(M,M);const P=this.raycast(T,M,this._exaggeration);return null!==P&&P?(h.scaleAndAdd(T,T,M,P),T[3]=T[2],T[2]*=w,T):null}drawDepth(){const o=this.painter,d=o.context,_=this.proxySourceCache,b=Math.ceil(o.width),w=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===b&&this._depthFBO.height===w||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const T=d.gl,M=d.createFramebuffer(b,w,!0);d.activeTexture.set(T.TEXTURE0);const P=new h.Texture(d,{width:b,height:w,data:null},T.RGBA);P.bind(T.NEAREST,T.CLAMP_TO_EDGE),M.colorAttachment.set(P.texture);const O=d.createRenderbuffer(d.gl.DEPTH_COMPONENT16,b,w);M.depthAttachment.set(O),this._depthFBO=M,this._depthTexture=P}d.bindFramebuffer.set(this._depthFBO.framebuffer),d.viewport.set([0,0,b,w]),function(T,M,P,O){if("globe"===T.transform.projection.name)return;const L=T.context,B=L.gl;L.clear({depth:1});const H=T.useProgram("terrainDepth"),te=new h.DepthMode(B.LESS,h.DepthMode.ReadWrite,T.depthRangeFor3D);for(const X of O){const G=P.getTile(X),_e=Ur(X.projMatrix,0);M.setupElevationDraw(G,H),H.draw(L,B.TRIANGLES,te,h.StencilMode.disabled,h.ColorMode.unblended,h.CullFaceMode.backCCW,_e,"terrain_depth",M.gridBuffer,M.gridIndexBuffer,M.gridNoSkirtSegments)}}(o,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,d,_){if(o.getSource()instanceof De)return this._setupProxiedCoordsForImageSource(o,d,_);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const b=this.proxiedCoords[o.id]=[],w=this.proxyCoords;for(let M=0;M<w.length;M++){const P=w[M],O=this._findTileCoveringTileID(P,o);if(O){const L=this._createProxiedId(P,O,_[P.key]&&_[P.key][o.id]);b.push(L),this.proxyToSource[P.key][o.id]=[L]}}let T=!1;for(let M=0;M<d.length;M++){const P=o.getTile(d[M]);if(!P||!P.hasData())continue;const O=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==P.tileID.canonical.z){const L=this.proxyToSource[O.tileID.key][o.id],B=this._createProxiedId(O.tileID,P,_[O.tileID.key]&&_[O.tileID.key][o.id]);L?L.splice(L.length-1,0,B):this.proxyToSource[O.tileID.key][o.id]=[B],b.push(B),T=!0}}this._sourceTilesOverlap[o.id]=T}_setupProxiedCoordsForImageSource(o,d,_){if(!o.getSource().loaded())return;const b=this.proxiedCoords[o.id]=[],w=this.proxyCoords,T=o.getSource(),M=new h.pointGeometry(T.tileID.x,T.tileID.y)._div(1<<T.tileID.z),P=T.coordinates.map(h.MercatorCoordinate.fromLngLat).reduce((L,B)=>(L.min.x=Math.min(L.min.x,B.x-M.x),L.min.y=Math.min(L.min.y,B.y-M.y),L.max.x=Math.max(L.max.x,B.x-M.x),L.max.y=Math.max(L.max.y,B.y-M.y),L),{min:new h.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new h.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(L,B)=>{const H=L.wrap+L.canonical.x/(1<<L.canonical.z),te=L.canonical.y/(1<<L.canonical.z),X=h.EXTENT/(1<<L.canonical.z),G=B.wrap+B.canonical.x/(1<<B.canonical.z),_e=B.canonical.y/(1<<B.canonical.z);return H+X<G+P.min.x||H>G+P.max.x||te+X<_e+P.min.y||te>_e+P.max.y};for(let L=0;L<w.length;L++){const B=w[L];for(let H=0;H<d.length;H++){const te=o.getTile(d[H]);if(!te||!te.hasData()||O(B,te.tileID))continue;const X=this._createProxiedId(B,te,_[B.key]&&_[B.key][o.id]),G=this.proxyToSource[B.key][o.id];G?G.push(X):this.proxyToSource[B.key][o.id]=[X],b.push(X)}}}_createProxiedId(o,d,_){let b=this.orthoMatrix;if(_){const w=_.find(T=>T.key===d.tileID.key);if(w)return w}if(d.tileID.key!==o.key){const w=o.canonical.z-d.tileID.canonical.z;let T,M,P;b=h.create();const O=d.tileID.wrap-o.wrap<<o.overscaledZ;w>0?(T=h.EXTENT>>w,M=T*((d.tileID.canonical.x<<w)-o.canonical.x+O),P=T*((d.tileID.canonical.y<<w)-o.canonical.y)):(T=h.EXTENT<<-w,M=h.EXTENT*(d.tileID.canonical.x-(o.canonical.x+O<<-w)),P=h.EXTENT*(d.tileID.canonical.y-(o.canonical.y<<-w))),h.ortho(b,0,T,0,T,0,1),h.translate(b,b,[M,P,0])}return new Ca(d.tileID,o.key,b)}_findTileCoveringTileID(o,d){let _=d.getTile(o);if(_&&_.hasData())return _;const b=this._findCoveringTileCache[d.id],w=b[o.key];if(_=w?d.getTileByID(w):null,_&&_.hasData()||null===w)return _;let T=_?_.tileID:o,M=T.overscaledZ;const P=d.getSource().minzoom,O=[];if(!w){const B=d.getSource().maxzoom;if(o.canonical.z>=B){const H=o.canonical.z-B;d.getSource().reparseOverscaled?(M=Math.max(o.canonical.z+2,d.transform.tileZoom),T=new h.OverscaledTileID(M,o.wrap,B,o.canonical.x>>H,o.canonical.y>>H)):0!==H&&(M=B,T=new h.OverscaledTileID(M,o.wrap,B,o.canonical.x>>H,o.canonical.y>>H))}T.key!==o.key&&(O.push(T.key),_=d.getTile(T))}const L=B=>{O.forEach(H=>{b[H]=B}),O.length=0};for(M-=1;M>=P&&(!_||!_.hasData());M--){_&&L(_.tileID.key);const B=T.calculateScaledKey(M);if(_=d.getTileByID(B),_&&_.hasData())break;const H=b[B];if(null===H)break;void 0===H?O.push(B):_=d.getTileByID(H)}return L(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,d){let _=this._tilesDirty[o];_||(_=this._tilesDirty[o]={}),_[d.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const o=function(d){let _=0;const b=new h.StructArrayLayout2ui4,w=131;for(let T=1;T<129;T++){for(let M=1;M<129;M++)_=T*w+M,b.emplaceBack(_,_+1),b.emplaceBack(_,_+w),b.emplaceBack(_+1,_+w),128===T&&b.emplaceBack(_+w,_+w+1);b.emplaceBack(_+1,_+1+w)}return b}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(o),this.wireframeSegments=h.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,o.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Ta(m){const o=[];for(let d=0;d<m.length;d++){if(null===m[d])continue;const _=m[d].split(" ");o.push(_.pop())}return o}class Us{static cacheKey(o,d,_){let b=`${o}${_?_.cacheKey:""}`;for(const w of d)b+=`/${w}`;return b}constructor(o,d,_,b,w,T){const M=o.gl;this.program=M.createProgram();const P=Ta(_.staticAttributes),O=b?b.getBinderAttributes():[],L=P.concat(O),B=_.staticUniforms?Ta(_.staticUniforms):[],H=b?b.getBinderUniforms():[],te=B.concat(H),X=[];for(const he of te)X.indexOf(he)<0&&X.push(he);let G=b?b.defines():[];G=G.concat(T.map(he=>`#define ${he}`));const _e=G.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",fr,Qt.fragmentSource,dt.fragmentSource,_.fragmentSource).join("\n"),ae=G.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",fr,Qt.vertexSource,dt.vertexSource,Ne.vertexSource,_.vertexSource).join("\n"),fe=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(fe,_e),M.compileShader(fe),M.attachShader(this.program,fe);const ye=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(ye,ae),M.compileShader(ye),M.attachShader(this.program,ye),this.attributes={};const xe={};this.numAttributes=L.length;for(let he=0;he<this.numAttributes;he++)L[he]&&(M.bindAttribLocation(this.program,he,L[he]),this.attributes[L[he]]=he);M.linkProgram(this.program),M.deleteShader(ye),M.deleteShader(fe);for(let he=0;he<X.length;he++){const Te=X[he];if(Te&&!xe[Te]){const Ue=M.getUniformLocation(this.program,Te);Ue&&(xe[Te]=Ue)}}var he,Te;this.fixedUniforms=w(o,xe),this.binderUniforms=b?b.getUniforms(o,xe):[],-1!==T.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new h.Uniform1i(he=o,(Te=xe).u_dem),u_dem_prev:new h.Uniform1i(he,Te.u_dem_prev),u_dem_unpack:new h.Uniform4f(he,Te.u_dem_unpack),u_dem_tl:new h.Uniform2f(he,Te.u_dem_tl),u_dem_scale:new h.Uniform1f(he,Te.u_dem_scale),u_dem_tl_prev:new h.Uniform2f(he,Te.u_dem_tl_prev),u_dem_scale_prev:new h.Uniform1f(he,Te.u_dem_scale_prev),u_dem_size:new h.Uniform1f(he,Te.u_dem_size),u_dem_lerp:new h.Uniform1f(he,Te.u_dem_lerp),u_exaggeration:new h.Uniform1f(he,Te.u_exaggeration),u_depth:new h.Uniform1i(he,Te.u_depth),u_depth_size_inv:new h.Uniform2f(he,Te.u_depth_size_inv),u_meter_to_dem:new h.Uniform1f(he,Te.u_meter_to_dem),u_label_plane_matrix_inv:new h.UniformMatrix4f(he,Te.u_label_plane_matrix_inv),u_tile_tl_up:new h.Uniform3f(he,Te.u_tile_tl_up),u_tile_tr_up:new h.Uniform3f(he,Te.u_tile_tr_up),u_tile_br_up:new h.Uniform3f(he,Te.u_tile_br_up),u_tile_bl_up:new h.Uniform3f(he,Te.u_tile_bl_up),u_tile_up_scale:new h.Uniform1f(he,Te.u_tile_up_scale)}),-1!==T.indexOf("FOG")&&(this.fogUniforms=((he,Te)=>({u_fog_matrix:new h.UniformMatrix4f(he,Te.u_fog_matrix),u_fog_range:new h.Uniform2f(he,Te.u_fog_range),u_fog_color:new h.Uniform4f(he,Te.u_fog_color),u_fog_horizon_blend:new h.Uniform1f(he,Te.u_fog_horizon_blend),u_fog_temporal_offset:new h.Uniform1f(he,Te.u_fog_temporal_offset)}))(o,xe))}setTerrainUniformValues(o,d){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const b in d)_[b].set(d[b])}}setFogUniformValues(o,d){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const b in d)_[b].location&&_[b].set(d[b])}}draw(o,d,_,b,w,T,M,P,O,L,B,H,te,X,G,_e){const ae=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(_),o.setStencilMode(b),o.setColorMode(w),o.setCullFace(T);for(const ye of Object.keys(this.fixedUniforms))this.fixedUniforms[ye].set(M[ye]);X&&X.setUniforms(o,this.binderUniforms,H,{zoom:te});const fe={[ae.LINES]:2,[ae.TRIANGLES]:3,[ae.LINE_STRIP]:1}[d];for(const ye of B.get()){const xe=ye.vaos||(ye.vaos={});(xe[P]||(xe[P]=new ir)).bind(o,this,O,X?X.getPaintVertexBuffers():[],L,ye.vertexOffset,G,_e),ae.drawElements(d,ye.primitiveLength*fe,ae.UNSIGNED_SHORT,ye.primitiveOffset*fe*2)}}}function uo(m,o,d){const _=1/Bn(d,1,o.transform.tileZoom),b=Math.pow(2,d.tileID.overscaledZ),w=d.tileSize*Math.pow(2,o.transform.tileZoom)/b,T=w*(d.tileID.canonical.x+d.tileID.wrap*b),M=w*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[_,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[T>>16,M>>16],u_pixel_coord_lower:[65535&T,65535&M]}}const Fr=h.create(),nu=(m,o,d,_,b,w,T,M,P)=>{const O=o.style.light,L=O.properties.get("position"),B=[L.x,L.y,L.z],H=h.create$1();"viewport"===O.properties.get("anchor")&&(h.fromRotation(H,-o.transform.angle),h.transformMat3(B,B,H));const te=O.properties.get("color"),X=o.transform,G={u_matrix:m,u_lightpos:B,u_lightintensity:O.properties.get("intensity"),u_lightcolor:[te.r,te.g,te.b],u_vertical_gradient:+d,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Fr,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return"globe"===X.projection.name&&(G.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],G.u_zoom_transition=T,G.u_inv_rot_matrix=P,G.u_merc_center=M,G.u_up_dir=X.projection.upVector(new h.CanonicalTileID(0,0,0),M[0]*h.EXTENT,M[1]*h.EXTENT),G.u_height_lift=w),G},ru=(m,o,d,_,b,w,T,M,P,O,L)=>{const B=nu(m,o,d,_,b,M,P,O,L),H={u_height_factor:-Math.pow(2,b.overscaledZ)/T.tileSize/8};return h.extend(B,uo(w,o,T),H)},Fo=m=>({u_matrix:m}),Eo=(m,o,d,_)=>h.extend(Fo(m),uo(d,o,_)),Il=(m,o)=>({u_matrix:m,u_world:o}),lc=(m,o,d,_,b)=>h.extend(Eo(m,o,d,_),{u_world:b}),cc=h.create(),Ji=(m,o,d,_,b,w)=>{const T=m.transform,M="globe"===T.projection.name;let P;if("map"===w.paint.get("circle-pitch-alignment"))if(M){const L=h.globePixelsToTileUnits(T.zoom,o.canonical);P=Float32Array.from([L,0,0,L])}else P=T.calculatePixelsToTileUnitsMatrix(d);else P=new Float32Array([T.pixelsToGLUnits[0],0,0,T.pixelsToGLUnits[1]]);const O={u_camera_to_center_distance:T.cameraToCenterDistance,u_matrix:m.translatePosMatrix(o.projMatrix,d,w.paint.get("circle-translate"),w.paint.get("circle-translate-anchor")),u_device_pixel_ratio:h.exported.devicePixelRatio,u_extrude_scale:P,u_inv_rot_matrix:cc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return M&&(O.u_inv_rot_matrix=_,O.u_merc_center=b,O.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],O.u_zoom_transition=h.globeToMercatorTransition(T.zoom),O.u_up_dir=T.projection.upVector(o.canonical,b[0],b[1])),O},Wf=m=>{const o=[];return"map"===m.paint.get("circle-pitch-alignment")&&o.push("PITCH_WITH_MAP"),"map"===m.paint.get("circle-pitch-scale")&&o.push("SCALE_WITH_MAP"),o},Xm=(m,o,d)=>{const _=h.EXTENT/d.tileSize;return{u_matrix:m,u_camera_to_center_distance:o.cameraToCenterDistance,u_extrude_scale:[o.pixelsToGLUnits[0]/_,o.pixelsToGLUnits[1]/_]}},yd=(m,o,d=1)=>({u_matrix:m,u_color:o,u_overlay:0,u_overlay_scale:d}),Xf=h.create(),Km=(m,o,d,_,b,w,T)=>{const M=m.transform,P="globe"===M.projection.name,O=P?h.globePixelsToTileUnits(M.zoom,o.canonical):Bn(d,1,w),L={u_matrix:o.projMatrix,u_extrude_scale:O,u_intensity:T,u_inv_rot_matrix:Xf,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return P&&(L.u_inv_rot_matrix=_,L.u_merc_center=b,L.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],L.u_zoom_transition=h.globeToMercatorTransition(M.zoom),L.u_up_dir=M.projection.upVector(o.canonical,b[0],b[1])),L},Ym=(m,o,d,_,b,w,T)=>{const M=m.transform,P=M.calculatePixelsToTileUnitsMatrix(o),O={u_matrix:Al(m,o,d,b),u_pixels_to_tile_units:P,u_device_pixel_ratio:T,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:w,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(xd(d)){const L=rh(o,m.transform);O.u_texsize=o.lineAtlasTexture.size,O.u_scale=[L,_.fromScale,_.toScale],O.u_mix=_.t}return O},vd=(m,o,d,_,b,w)=>{const T=m.transform,M=rh(o,T);return{u_matrix:Al(m,o,d,b),u_texsize:o.imageAtlasTexture.size,u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:w,u_image:0,u_scale:[M,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function rh(m,o){return 1/Bn(m,1,o.tileZoom)}function Al(m,o,d,_){return m.translatePosMatrix(_||o.tileID.projMatrix,o,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}function xd(m){const o=m.paint.get("line-dasharray").value;return o.value||"constant"!==o.kind}const Kf=(m,o,d,_,b,w)=>{return{u_matrix:m,u_tl_parent:o,u_scale_parent:d,u_fade_t:_.mix,u_opacity:_.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(M=b.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(T=b.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:bd(b.paint.get("raster-hue-rotate")),u_perspective_transform:w};var T,M};function bd(m){m*=Math.PI/180;const o=Math.sin(m),d=Math.cos(m);return[(2*d+1)/3,(-Math.sqrt(3)*o-d+1)/3,(Math.sqrt(3)*o-d+1)/3]}const Za=h.create(),wd=(m,o,d,_,b,w,T,M,P,O,L,B,H,te)=>{const X=b.transform,G={u_is_size_zoom_constant:+("constant"===m||"source"===m),u_is_size_feature_constant:+("constant"===m||"camera"===m),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:X.cameraToCenterDistance,u_rotate_symbol:+d,u_aspect_ratio:X.width/X.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:T,u_coord_matrix:M,u_is_text:+P,u_pitch_with_map:+_,u_texsize:O,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Za,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Za};return"globe"===X.projection.name&&(G.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],G.u_zoom_transition=B,G.u_inv_rot_matrix=te,G.u_merc_center=H,G.u_camera_forward=X._camera.forward(),G.u_ecef_origin=h.globeECEFOrigin(X.globeMatrix,L.toUnwrapped()),G.u_tile_matrix=Float32Array.from(X.globeMatrix)),G},Pl=(m,o,d,_,b,w,T,M,P,O,L,B,H,te,X)=>{const{cameraToCenterDistance:G,_pitch:_e}=b.transform;return h.extend(wd(m,o,d,_,b,w,T,M,P,O,B,H,te,X),{u_gamma_scale:_?G*Math.cos(b.terrain?0:_e):1,u_device_pixel_ratio:h.exported.devicePixelRatio,u_is_halo:+L})},uc=(m,o,d,_,b,w,T,M,P,O,L,B,H,te)=>h.extend(Pl(m,o,d,_,b,w,T,M,!0,P,!0,L,B,H,te),{u_texsize_icon:O,u_texture_icon:1}),Yf=(m,o,d)=>({u_matrix:m,u_opacity:o,u_color:d}),Ed=(m,o,d,_,b,w)=>h.extend(function(T,M,P,O){const L=P.imageManager.getPattern(T.from.toString()),B=P.imageManager.getPattern(T.to.toString()),{width:H,height:te}=P.imageManager.getPixelSize(),X=Math.pow(2,O.tileID.overscaledZ),G=O.tileSize*Math.pow(2,P.transform.tileZoom)/X,_e=G*(O.tileID.canonical.x+O.tileID.wrap*X),ae=G*O.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[H,te],u_mix:M.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/Bn(O,1,P.transform.tileZoom),u_pixel_coord_upper:[_e>>16,ae>>16],u_pixel_coord_lower:[65535&_e,65535&ae]}}(_,w,d,b),{u_matrix:m,u_opacity:o}),pr={fillExtrusion:(m,o)=>({u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_lightpos:new h.Uniform3f(m,o.u_lightpos),u_lightintensity:new h.Uniform1f(m,o.u_lightintensity),u_lightcolor:new h.Uniform3f(m,o.u_lightcolor),u_vertical_gradient:new h.Uniform1f(m,o.u_vertical_gradient),u_opacity:new h.Uniform1f(m,o.u_opacity),u_tile_id:new h.Uniform3f(m,o.u_tile_id),u_zoom_transition:new h.Uniform1f(m,o.u_zoom_transition),u_inv_rot_matrix:new h.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new h.Uniform2f(m,o.u_merc_center),u_up_dir:new h.Uniform3f(m,o.u_up_dir),u_height_lift:new h.Uniform1f(m,o.u_height_lift)}),fillExtrusionPattern:(m,o)=>({u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_lightpos:new h.Uniform3f(m,o.u_lightpos),u_lightintensity:new h.Uniform1f(m,o.u_lightintensity),u_lightcolor:new h.Uniform3f(m,o.u_lightcolor),u_vertical_gradient:new h.Uniform1f(m,o.u_vertical_gradient),u_height_factor:new h.Uniform1f(m,o.u_height_factor),u_tile_id:new h.Uniform3f(m,o.u_tile_id),u_zoom_transition:new h.Uniform1f(m,o.u_zoom_transition),u_inv_rot_matrix:new h.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new h.Uniform2f(m,o.u_merc_center),u_up_dir:new h.Uniform3f(m,o.u_up_dir),u_height_lift:new h.Uniform1f(m,o.u_height_lift),u_image:new h.Uniform1i(m,o.u_image),u_texsize:new h.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new h.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new h.Uniform3f(m,o.u_scale),u_fade:new h.Uniform1f(m,o.u_fade),u_opacity:new h.Uniform1f(m,o.u_opacity)}),fill:(m,o)=>({u_matrix:new h.UniformMatrix4f(m,o.u_matrix)}),fillPattern:(m,o)=>({u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_image:new h.Uniform1i(m,o.u_image),u_texsize:new h.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new h.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new h.Uniform3f(m,o.u_scale),u_fade:new h.Uniform1f(m,o.u_fade)}),fillOutline:(m,o)=>({u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_world:new h.Uniform2f(m,o.u_world)}),fillOutlinePattern:(m,o)=>({u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_world:new h.Uniform2f(m,o.u_world),u_image:new h.Uniform1i(m,o.u_image),u_texsize:new h.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new h.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new h.Uniform3f(m,o.u_scale),u_fade:new h.Uniform1f(m,o.u_fade)}),circle:(m,o)=>({u_camera_to_center_distance:new h.Uniform1f(m,o.u_camera_to_center_distance),u_extrude_scale:new h.UniformMatrix2f(m,o.u_extrude_scale),u_device_pixel_ratio:new h.Uniform1f(m,o.u_device_pixel_ratio),u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_inv_rot_matrix:new h.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new h.Uniform2f(m,o.u_merc_center),u_tile_id:new h.Uniform3f(m,o.u_tile_id),u_zoom_transition:new h.Uniform1f(m,o.u_zoom_transition),u_up_dir:new h.Uniform3f(m,o.u_up_dir)}),collisionBox:(m,o)=>({u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_camera_to_center_distance:new h.Uniform1f(m,o.u_camera_to_center_distance),u_extrude_scale:new h.Uniform2f(m,o.u_extrude_scale)}),collisionCircle:(m,o)=>({u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_inv_matrix:new h.UniformMatrix4f(m,o.u_inv_matrix),u_camera_to_center_distance:new h.Uniform1f(m,o.u_camera_to_center_distance),u_viewport_size:new h.Uniform2f(m,o.u_viewport_size)}),debug:(m,o)=>({u_color:new h.UniformColor(m,o.u_color),u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_overlay:new h.Uniform1i(m,o.u_overlay),u_overlay_scale:new h.Uniform1f(m,o.u_overlay_scale)}),clippingMask:(m,o)=>({u_matrix:new h.UniformMatrix4f(m,o.u_matrix)}),heatmap:(m,o)=>({u_extrude_scale:new h.Uniform1f(m,o.u_extrude_scale),u_intensity:new h.Uniform1f(m,o.u_intensity),u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_inv_rot_matrix:new h.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new h.Uniform2f(m,o.u_merc_center),u_tile_id:new h.Uniform3f(m,o.u_tile_id),u_zoom_transition:new h.Uniform1f(m,o.u_zoom_transition),u_up_dir:new h.Uniform3f(m,o.u_up_dir)}),heatmapTexture:(m,o)=>({u_image:new h.Uniform1i(m,o.u_image),u_color_ramp:new h.Uniform1i(m,o.u_color_ramp),u_opacity:new h.Uniform1f(m,o.u_opacity)}),hillshade:(m,o)=>({u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_image:new h.Uniform1i(m,o.u_image),u_latrange:new h.Uniform2f(m,o.u_latrange),u_light:new h.Uniform2f(m,o.u_light),u_shadow:new h.UniformColor(m,o.u_shadow),u_highlight:new h.UniformColor(m,o.u_highlight),u_accent:new h.UniformColor(m,o.u_accent)}),hillshadePrepare:(m,o)=>({u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_image:new h.Uniform1i(m,o.u_image),u_dimension:new h.Uniform2f(m,o.u_dimension),u_zoom:new h.Uniform1f(m,o.u_zoom),u_unpack:new h.Uniform4f(m,o.u_unpack)}),line:(m,o)=>({u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_pixels_to_tile_units:new h.UniformMatrix2f(m,o.u_pixels_to_tile_units),u_device_pixel_ratio:new h.Uniform1f(m,o.u_device_pixel_ratio),u_units_to_pixels:new h.Uniform2f(m,o.u_units_to_pixels),u_dash_image:new h.Uniform1i(m,o.u_dash_image),u_gradient_image:new h.Uniform1i(m,o.u_gradient_image),u_image_height:new h.Uniform1f(m,o.u_image_height),u_texsize:new h.Uniform2f(m,o.u_texsize),u_scale:new h.Uniform3f(m,o.u_scale),u_mix:new h.Uniform1f(m,o.u_mix),u_alpha_discard_threshold:new h.Uniform1f(m,o.u_alpha_discard_threshold)}),linePattern:(m,o)=>({u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_texsize:new h.Uniform2f(m,o.u_texsize),u_pixels_to_tile_units:new h.UniformMatrix2f(m,o.u_pixels_to_tile_units),u_device_pixel_ratio:new h.Uniform1f(m,o.u_device_pixel_ratio),u_image:new h.Uniform1i(m,o.u_image),u_units_to_pixels:new h.Uniform2f(m,o.u_units_to_pixels),u_scale:new h.Uniform3f(m,o.u_scale),u_fade:new h.Uniform1f(m,o.u_fade),u_alpha_discard_threshold:new h.Uniform1f(m,o.u_alpha_discard_threshold)}),raster:(m,o)=>({u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_tl_parent:new h.Uniform2f(m,o.u_tl_parent),u_scale_parent:new h.Uniform1f(m,o.u_scale_parent),u_fade_t:new h.Uniform1f(m,o.u_fade_t),u_opacity:new h.Uniform1f(m,o.u_opacity),u_image0:new h.Uniform1i(m,o.u_image0),u_image1:new h.Uniform1i(m,o.u_image1),u_brightness_low:new h.Uniform1f(m,o.u_brightness_low),u_brightness_high:new h.Uniform1f(m,o.u_brightness_high),u_saturation_factor:new h.Uniform1f(m,o.u_saturation_factor),u_contrast_factor:new h.Uniform1f(m,o.u_contrast_factor),u_spin_weights:new h.Uniform3f(m,o.u_spin_weights),u_perspective_transform:new h.Uniform2f(m,o.u_perspective_transform)}),symbolIcon:(m,o)=>({u_is_size_zoom_constant:new h.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new h.Uniform1f(m,o.u_size_t),u_size:new h.Uniform1f(m,o.u_size),u_camera_to_center_distance:new h.Uniform1f(m,o.u_camera_to_center_distance),u_rotate_symbol:new h.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new h.Uniform1f(m,o.u_fade_change),u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new h.Uniform1i(m,o.u_is_text),u_pitch_with_map:new h.Uniform1i(m,o.u_pitch_with_map),u_texsize:new h.Uniform2f(m,o.u_texsize),u_tile_id:new h.Uniform3f(m,o.u_tile_id),u_zoom_transition:new h.Uniform1f(m,o.u_zoom_transition),u_inv_rot_matrix:new h.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new h.Uniform2f(m,o.u_merc_center),u_camera_forward:new h.Uniform3f(m,o.u_camera_forward),u_tile_matrix:new h.UniformMatrix4f(m,o.u_tile_matrix),u_ecef_origin:new h.Uniform3f(m,o.u_ecef_origin),u_texture:new h.Uniform1i(m,o.u_texture)}),symbolSDF:(m,o)=>({u_is_size_zoom_constant:new h.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new h.Uniform1f(m,o.u_size_t),u_size:new h.Uniform1f(m,o.u_size),u_camera_to_center_distance:new h.Uniform1f(m,o.u_camera_to_center_distance),u_rotate_symbol:new h.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new h.Uniform1f(m,o.u_fade_change),u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new h.Uniform1i(m,o.u_is_text),u_pitch_with_map:new h.Uniform1i(m,o.u_pitch_with_map),u_texsize:new h.Uniform2f(m,o.u_texsize),u_texture:new h.Uniform1i(m,o.u_texture),u_gamma_scale:new h.Uniform1f(m,o.u_gamma_scale),u_device_pixel_ratio:new h.Uniform1f(m,o.u_device_pixel_ratio),u_tile_id:new h.Uniform3f(m,o.u_tile_id),u_zoom_transition:new h.Uniform1f(m,o.u_zoom_transition),u_inv_rot_matrix:new h.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new h.Uniform2f(m,o.u_merc_center),u_camera_forward:new h.Uniform3f(m,o.u_camera_forward),u_tile_matrix:new h.UniformMatrix4f(m,o.u_tile_matrix),u_ecef_origin:new h.Uniform3f(m,o.u_ecef_origin),u_is_halo:new h.Uniform1i(m,o.u_is_halo)}),symbolTextAndIcon:(m,o)=>({u_is_size_zoom_constant:new h.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new h.Uniform1f(m,o.u_size_t),u_size:new h.Uniform1f(m,o.u_size),u_camera_to_center_distance:new h.Uniform1f(m,o.u_camera_to_center_distance),u_rotate_symbol:new h.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new h.Uniform1f(m,o.u_fade_change),u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new h.Uniform1i(m,o.u_is_text),u_pitch_with_map:new h.Uniform1i(m,o.u_pitch_with_map),u_texsize:new h.Uniform2f(m,o.u_texsize),u_texsize_icon:new h.Uniform2f(m,o.u_texsize_icon),u_texture:new h.Uniform1i(m,o.u_texture),u_texture_icon:new h.Uniform1i(m,o.u_texture_icon),u_gamma_scale:new h.Uniform1f(m,o.u_gamma_scale),u_device_pixel_ratio:new h.Uniform1f(m,o.u_device_pixel_ratio),u_is_halo:new h.Uniform1i(m,o.u_is_halo)}),background:(m,o)=>({u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_opacity:new h.Uniform1f(m,o.u_opacity),u_color:new h.UniformColor(m,o.u_color)}),backgroundPattern:(m,o)=>({u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_opacity:new h.Uniform1f(m,o.u_opacity),u_image:new h.Uniform1i(m,o.u_image),u_pattern_tl_a:new h.Uniform2f(m,o.u_pattern_tl_a),u_pattern_br_a:new h.Uniform2f(m,o.u_pattern_br_a),u_pattern_tl_b:new h.Uniform2f(m,o.u_pattern_tl_b),u_pattern_br_b:new h.Uniform2f(m,o.u_pattern_br_b),u_texsize:new h.Uniform2f(m,o.u_texsize),u_mix:new h.Uniform1f(m,o.u_mix),u_pattern_size_a:new h.Uniform2f(m,o.u_pattern_size_a),u_pattern_size_b:new h.Uniform2f(m,o.u_pattern_size_b),u_scale_a:new h.Uniform1f(m,o.u_scale_a),u_scale_b:new h.Uniform1f(m,o.u_scale_b),u_pixel_coord_upper:new h.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(m,o.u_pixel_coord_lower),u_tile_units_to_pixels:new h.Uniform1f(m,o.u_tile_units_to_pixels)}),terrainRaster:qn,terrainDepth:qn,skybox:(m,o)=>({u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_sun_direction:new h.Uniform3f(m,o.u_sun_direction),u_cubemap:new h.Uniform1i(m,o.u_cubemap),u_opacity:new h.Uniform1f(m,o.u_opacity),u_temporal_offset:new h.Uniform1f(m,o.u_temporal_offset)}),skyboxGradient:(m,o)=>({u_matrix:new h.UniformMatrix4f(m,o.u_matrix),u_color_ramp:new h.Uniform1i(m,o.u_color_ramp),u_center_direction:new h.Uniform3f(m,o.u_center_direction),u_radius:new h.Uniform1f(m,o.u_radius),u_opacity:new h.Uniform1f(m,o.u_opacity),u_temporal_offset:new h.Uniform1f(m,o.u_temporal_offset)}),skyboxCapture:(m,o)=>({u_matrix_3f:new h.UniformMatrix3f(m,o.u_matrix_3f),u_sun_direction:new h.Uniform3f(m,o.u_sun_direction),u_sun_intensity:new h.Uniform1f(m,o.u_sun_intensity),u_color_tint_r:new h.Uniform4f(m,o.u_color_tint_r),u_color_tint_m:new h.Uniform4f(m,o.u_color_tint_m),u_luminance:new h.Uniform1f(m,o.u_luminance)}),globeRaster:(m,o)=>({u_proj_matrix:new h.UniformMatrix4f(m,o.u_proj_matrix),u_globe_matrix:new h.UniformMatrix4f(m,o.u_globe_matrix),u_merc_matrix:new h.UniformMatrix4f(m,o.u_merc_matrix),u_zoom_transition:new h.Uniform1f(m,o.u_zoom_transition),u_merc_center:new h.Uniform2f(m,o.u_merc_center),u_image0:new h.Uniform1i(m,o.u_image0),u_grid_matrix:new h.UniformMatrix3f(m,o.u_grid_matrix)}),globeAtmosphere:(m,o)=>({u_frustum_tl:new h.Uniform3f(m,o.u_frustum_tl),u_frustum_tr:new h.Uniform3f(m,o.u_frustum_tr),u_frustum_br:new h.Uniform3f(m,o.u_frustum_br),u_frustum_bl:new h.Uniform3f(m,o.u_frustum_bl),u_globe_pos:new h.Uniform3f(m,o.u_globe_pos),u_globe_radius:new h.Uniform1f(m,o.u_globe_radius),u_opacity:new h.Uniform1f(m,o.u_opacity),u_fadeout_range:new h.Uniform1f(m,o.u_fadeout_range),u_start_color:new h.Uniform3f(m,o.u_start_color),u_end_color:new h.Uniform3f(m,o.u_end_color)})};let ta;function Jf(m,o,d,_,b,w,T){const M=m.context,P=M.gl,O=m.useProgram("collisionBox"),L=[];let B=0,H=0;for(let ye=0;ye<_.length;ye++){const xe=_[ye],he=o.getTile(xe),Te=he.getBucket(d);if(!Te)continue;let Ue=xe.projMatrix;0===b[0]&&0===b[1]||(Ue=m.translatePosMatrix(xe.projMatrix,he,b,w));const We=T?Te.textCollisionBox:Te.iconCollisionBox,et=Te.collisionCircleArray;if(et.length>0){const Je=h.create(),Dt=Ue;h.mul(Je,Te.placementInvProjMatrix,m.transform.glCoordMatrix),h.mul(Je,Je,Te.placementViewportMatrix),L.push({circleArray:et,circleOffset:H,transform:Dt,invTransform:Je}),B+=et.length/4,H=B}We&&(m.terrain&&m.terrain.setupElevationDraw(he,O),O.draw(M,P.LINES,h.DepthMode.disabled,h.StencilMode.disabled,m.colorModeForRenderPass(),h.CullFaceMode.disabled,Xm(Ue,m.transform,he),d.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,null,m.transform.zoom,null,We.collisionVertexBuffer,We.collisionVertexBufferExt))}if(!T||!L.length)return;const te=m.useProgram("collisionCircle"),X=new h.StructArrayLayout2f1f2i16;X.resize(4*B),X._trim();let G=0;for(const ye of L)for(let xe=0;xe<ye.circleArray.length/4;xe++){const he=4*xe,Te=ye.circleArray[he+0],Ue=ye.circleArray[he+1],We=ye.circleArray[he+2],et=ye.circleArray[he+3];X.emplace(G++,Te,Ue,We,et,0),X.emplace(G++,Te,Ue,We,et,1),X.emplace(G++,Te,Ue,We,et,2),X.emplace(G++,Te,Ue,We,et,3)}(!ta||ta.length<2*B)&&(ta=function(ye){const xe=2*ye,he=new h.StructArrayLayout3ui6;he.resize(xe),he._trim();for(let Te=0;Te<xe;Te++){const Ue=6*Te;he.uint16[Ue+0]=4*Te+0,he.uint16[Ue+1]=4*Te+1,he.uint16[Ue+2]=4*Te+2,he.uint16[Ue+3]=4*Te+2,he.uint16[Ue+4]=4*Te+3,he.uint16[Ue+5]=4*Te+0}return he}(B));const _e=M.createIndexBuffer(ta,!0),ae=M.createVertexBuffer(X,h.collisionCircleLayout.members,!0);for(const ye of L){const xe={u_matrix:ye.transform,u_inv_matrix:ye.invTransform,u_camera_to_center_distance:(fe=m.transform).cameraToCenterDistance,u_viewport_size:[fe.width,fe.height]};te.draw(M,P.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,m.colorModeForRenderPass(),h.CullFaceMode.disabled,xe,d.id,ae,_e,h.SegmentVector.simpleSegment(0,2*ye.circleOffset,ye.circleArray.length,ye.circleArray.length/2),null,m.transform.zoom,null,null,null)}var fe;ae.destroy(),_e.destroy()}const Cd=h.create();function iu(m,o,d,_,b,w){const{horizontalAlign:T,verticalAlign:M}=h.getAnchorAlignment(m),P=-(T-.5)*o,O=-(M-.5)*d,L=h.evaluateVariableOffset(m,_);return new h.pointGeometry((P/b+L[0])*w,(O/b+L[1])*w)}function Wa(m,o,d,_,b,w,T,M,P,O,L,B){const H=m.text.placedSymbolArray,te=m.text.dynamicLayoutVertexArray,X=m.icon.dynamicLayoutVertexArray,G={},_e=M.projMatrix,ae=w.elevation,fe=B.upVectorScale(M.canonical,w.center.lat,w.worldSize);te.clear();for(let ye=0;ye<H.length;ye++){const xe=H.get(ye),he=m.allowVerticalPlacement&&!xe.placedOrientation,Te=xe.hidden||!xe.crossTileID||he?null:_[xe.crossTileID];if(Te){const Ue=new h.pointGeometry(xe.tileAnchorX,xe.tileAnchorY),We=B.upVector(M.canonical,Ue.x,Ue.y),et=ae?ae.getAtTileOffset(M,Ue.x,Ue.y):0,Je=hi([xe.projectedAnchorX+et*We[0]*fe.metersToTile,xe.projectedAnchorY+et*We[1]*fe.metersToTile,xe.projectedAnchorZ+et*We[2]*fe.metersToTile],d?_e:T),Dt=Sr(w.cameraToCenterDistance,Je.signedDistanceFromCamera);let Ve=b.evaluateSizeForFeature(m.textSizeData,O,xe)*Dt/h.ONE_EM;d&&(Ve*=m.tilePixelRatio/P);const{width:vt,height:ht,anchor:qt,textOffset:Ke,textScale:Jt}=Te,en=iu(qt,vt,ht,Ke,Jt,Ve),Ut=d?mr(Ue.add(en),T,et*fe.metersToLabelSpace).point:Je.point.add(o?en.rotate(-w.angle):en),Zt=m.allowVerticalPlacement&&xe.placedOrientation===h.WritingMode.vertical?Math.PI/2:0;for(let ln=0;ln<xe.numGlyphs;ln++)h.addDynamicAttributes(te,Ut,Zt);L&&xe.associatedIconIndex>=0&&(G[xe.associatedIconIndex]={shiftedAnchor:Ut,angle:Zt})}else Kr(xe.numGlyphs,te)}if(L){X.clear();const ye=m.icon.placedSymbolArray;for(let xe=0;xe<ye.length;xe++){const he=ye.get(xe);if(he.hidden)Kr(he.numGlyphs,X);else{const Te=G[xe];if(Te)for(let Ue=0;Ue<he.numGlyphs;Ue++)h.addDynamicAttributes(X,Te.shiftedAnchor,Te.angle);else Kr(he.numGlyphs,X)}}m.icon.dynamicLayoutVertexBuffer.updateData(X)}m.text.dynamicLayoutVertexBuffer.updateData(te)}function Qf(m,o,d){return d.iconsInText&&o?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Qi(m,o,d,_,b,w,T,M,P,O,L,B){const H=m.context,te=H.gl,X=m.transform,G="map"===M,_e="map"===P,ae=G&&"point"!==d.layout.get("symbol-placement"),fe=G&&!_e&&!ae,ye=void 0!==d.layout.get("symbol-sort-key").constantOr(1);let xe=!1;const he=m.depthModeForSublayer(0,h.DepthMode.ReadOnly),Te=[h.mercatorXfromLng(X.center.lng),h.mercatorYfromLat(X.center.lat)],Ue=d.layout.get("text-variable-anchor"),We="globe"===X.projection.name,et=We?h.globeToMercatorTransition(X.zoom):0,Je=[],Dt=[];m.terrain&&_e&&Dt.push("PITCH_WITH_MAP_TERRAIN"),We&&Dt.push("PROJECTION_GLOBE_VIEW");for(const Ve of _){const vt=o.getTile(Ve),ht=vt.getBucket(d);if(!ht||ht.projection!==X.projection.name)continue;const qt=b?ht.text:ht.icon;if(!qt||ht.fullyClipped||!qt.segments.get().length)continue;const Ke=qt.programConfigurations.get(d.id),Jt=b||ht.sdfIcons,en=b?ht.textSizeData:ht.iconSizeData,Ut=_e||0!==X.pitch,Zt=h.evaluateSizeForZoom(en,X.zoom);let ln,Tn,tn,bn,Xt=[0,0],ii=null;if(b){if(Tn=vt.glyphAtlasTexture,tn=te.LINEAR,ln=vt.glyphAtlasTexture.size,ht.iconsInText){Xt=vt.imageAtlasTexture.size,ii=vt.imageAtlasTexture;const Do="composite"===en.kind||"camera"===en.kind;bn=Ut||m.options.rotating||m.options.zooming||Do?te.LINEAR:te.NEAREST}}else{const Do=1!==d.layout.get("icon-size").constantOr(0)||ht.iconsNeedLinear;Tn=vt.imageAtlasTexture,tn=Jt||m.options.rotating||m.options.zooming||Do||Ut?te.LINEAR:te.NEAREST,ln=vt.imageAtlasTexture.size}const po=m.transform.calculatePixelsToTileUnitsMatrix(vt),mo=gn(Ve.projMatrix,vt.tileID.canonical,_e,G,m.transform,po),ts=m.terrain&&_e&&ae?h.invert(h.create(),mo):Cd,$s=ps(Ve.projMatrix,vt.tileID.canonical,_e,G,m.transform,po),Ia=Ue&&ht.hasTextData(),ll="none"!==d.layout.get("icon-text-fit")&&Ia&&ht.hasIconData();if(ae){const Do=X.elevation,Gs=Do?Do.getAtTileOffsetFunc(Ve,X.center.lat,X.worldSize,X.projection):Fl=>[0,0,0];Yi(ht,Ve.projMatrix,m,b,mo,$s,_e,O,Gs,Ve)}const zo=ae||b&&Ue||ll,si=m.translatePosMatrix(Ve.projMatrix,vt,w,T),Xn=zo?Cd:mo,cr=m.translatePosMatrix($s,vt,w,T,!0),Jr=X.projection.createInversionMatrix(X,Ve.canonical),ns=zo?Dt.concat(["PROJECTED_POS_ON_VIEWPORT"]):Dt,Qr=Jt&&0!==d.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1);let ai;ai=Jt?ht.iconsInText?uc(en.kind,Zt,fe,_e,m,si,Xn,cr,ln,Xt,Ve,et,Te,Jr):Pl(en.kind,Zt,fe,_e,m,si,Xn,cr,b,ln,!0,Ve,et,Te,Jr):wd(en.kind,Zt,fe,_e,m,si,Xn,cr,b,ln,Ve,et,Te,Jr);const To={program:m.useProgram(Qf(Jt,b,ht),Ke,ns),buffers:qt,uniformValues:ai,atlasTexture:Tn,atlasTextureIcon:ii,atlasInterpolation:tn,atlasInterpolationIcon:bn,isSDF:Jt,hasHalo:Qr,tile:vt,labelPlaneMatrixInv:ts};if(ye&&ht.canOverlap){xe=!0;const Do=qt.segments.get();for(const Gs of Do)Je.push({segments:new h.SegmentVector([Gs]),sortKey:Gs.sortKey,state:To})}else Je.push({segments:qt.segments,sortKey:0,state:To})}xe&&Je.sort((Ve,vt)=>Ve.sortKey-vt.sortKey);for(const Ve of Je){const vt=Ve.state;if(m.terrain&&m.terrain.setupElevationDraw(vt.tile,vt.program,{useDepthForOcclusion:!We,labelPlaneMatrixInv:vt.labelPlaneMatrixInv}),H.activeTexture.set(te.TEXTURE0),vt.atlasTexture.bind(vt.atlasInterpolation,te.CLAMP_TO_EDGE),vt.atlasTextureIcon&&(H.activeTexture.set(te.TEXTURE1),vt.atlasTextureIcon&&vt.atlasTextureIcon.bind(vt.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),vt.isSDF){const ht=vt.uniformValues;vt.hasHalo&&(ht.u_is_halo=1,ih(vt.buffers,Ve.segments,d,m,vt.program,he,L,B,ht)),ht.u_is_halo=0}ih(vt.buffers,Ve.segments,d,m,vt.program,he,L,B,vt.uniformValues)}}function ih(m,o,d,_,b,w,T,M,P){const O=_.context;b.draw(O,O.gl.TRIANGLES,w,T,M,h.CullFaceMode.disabled,P,d.id,m.layoutVertexBuffer,m.indexBuffer,o,d.paint,_.transform.zoom,m.programConfigurations.get(d.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function ou(m,o,d,_,b,w,T){const M=m.context.gl,P=d.paint.get("fill-pattern"),O=P&&P.constantOr(1),L=d.getCrossfadeParameters();let B,H,te,X,G;T?(H=O&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=M.LINES):(H=O?"fillPattern":"fill",B=M.TRIANGLES);for(const _e of _){const ae=o.getTile(_e);if(O&&!ae.patternsLoaded())continue;const fe=ae.getBucket(d);if(!fe)continue;m.prepareDrawTile();const ye=fe.programConfigurations.get(d.id),xe=m.useProgram(H,ye);O&&(m.context.activeTexture.set(M.TEXTURE0),ae.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),ye.updatePaintBuffers(L));const he=P.constantOr(null);if(he&&ae.imageAtlas){const Ue=ae.imageAtlas,We=Ue.patternPositions[he.to.toString()],et=Ue.patternPositions[he.from.toString()];We&&et&&ye.setConstantPatternPositions(We,et)}const Te=m.translatePosMatrix(_e.projMatrix,ae,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(T){X=fe.indexBuffer2,G=fe.segments2;const Ue=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];te="fillOutlinePattern"===H&&O?lc(Te,m,L,ae,Ue):Il(Te,Ue)}else X=fe.indexBuffer,G=fe.segments,te=O?Eo(Te,m,L,ae):Fo(Te);m.prepareDrawProgram(m.context,xe,_e.toUnwrapped()),xe.draw(m.context,B,b,m.stencilModeForClipping(_e),w,h.CullFaceMode.disabled,te,d.id,fe.layoutVertexBuffer,X,G,d.paint,m.transform.zoom,ye)}}function kl(m,o,d,_,b,w,T){const M=m.context,P=M.gl,O=m.transform,L=d.paint.get("fill-extrusion-pattern"),B=L.constantOr(1),H=d.getCrossfadeParameters(),te=d.paint.get("fill-extrusion-opacity"),X=function(ye){if("globe"!==ye.projection.name)return 0;const xe=Math.PI/32,he=Math.tan(xe),Te=h.earthRadius;return Te*Math.sqrt(1+2*he*he)-Te}(O),G="globe"===O.projection.name,_e=G?h.globeToMercatorTransition(O.zoom):0,ae=[h.mercatorXfromLng(O.center.lng),h.mercatorYfromLat(O.center.lat)],fe=[];G&&fe.push("PROJECTION_GLOBE_VIEW");for(const ye of _){const xe=o.getTile(ye),he=xe.getBucket(d);if(!he||he.projection!==O.projection.name)continue;const Te=he.programConfigurations.get(d.id),Ue=m.useProgram(B?"fillExtrusionPattern":"fillExtrusion",Te,fe);if(m.terrain){const vt=m.terrain;if(m.style.terrainSetForDrapingOnly())vt.setupElevationDraw(xe,Ue,{useMeterToDem:!0});else{if(!he.enableTerrain)continue;if(vt.setupElevationDraw(xe,Ue,{useMeterToDem:!0}),Rl(M,o,ye,he,d,vt),!he.centroidVertexBuffer){const ht=Ue.attributes.a_centroid_pos;void 0!==ht&&P.vertexAttrib2f(ht,0,0)}}}B&&(m.context.activeTexture.set(P.TEXTURE0),xe.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Te.updatePaintBuffers(H));const We=L.constantOr(null);if(We&&xe.imageAtlas){const vt=xe.imageAtlas,ht=vt.patternPositions[We.to.toString()],qt=vt.patternPositions[We.from.toString()];ht&&qt&&Te.setConstantPatternPositions(ht,qt)}const et=m.translatePosMatrix(ye.projMatrix,xe,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Je=O.projection.createInversionMatrix(O,ye.canonical),Dt=d.paint.get("fill-extrusion-vertical-gradient"),Ve=B?ru(et,m,Dt,te,ye,H,xe,X,_e,ae,Je):nu(et,m,Dt,te,ye,X,_e,ae,Je);m.prepareDrawProgram(M,Ue,ye.toUnwrapped()),Ue.draw(M,M.gl.TRIANGLES,b,w,T,h.CullFaceMode.backCCW,Ve,d.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,d.paint,m.transform.zoom,Te,m.terrain?he.centroidVertexBuffer:null,G?he.layoutVertexExtBuffer:null)}}function Rl(m,o,d,_,b,w){const T=[ae=>{let fe=ae.canonical.x-1,ye=ae.wrap;return fe<0&&(fe=(1<<ae.canonical.z)-1,ye--),new h.OverscaledTileID(ae.overscaledZ,ye,ae.canonical.z,fe,ae.canonical.y)},ae=>{let fe=ae.canonical.x+1,ye=ae.wrap;return fe===1<<ae.canonical.z&&(fe=0,ye++),new h.OverscaledTileID(ae.overscaledZ,ye,ae.canonical.z,fe,ae.canonical.y)},ae=>new h.OverscaledTileID(ae.overscaledZ,ae.wrap,ae.canonical.z,ae.canonical.x,(0===ae.canonical.y?1<<ae.canonical.z:ae.canonical.y)-1),ae=>new h.OverscaledTileID(ae.overscaledZ,ae.wrap,ae.canonical.z,ae.canonical.x,ae.canonical.y===(1<<ae.canonical.z)-1?0:ae.canonical.y+1)],M=ae=>{const fe=o.getSource().minzoom,ye=he=>{const Te=o.getTileByID(he);if(Te&&Te.hasData())return Te.getBucket(b)},xe=[0,-1,1];for(const he of xe){if(ae.overscaledZ+he<fe)continue;const Te=ye(ae.calculateScaledKey(ae.overscaledZ+he));if(Te)return Te}},P=[0,0,0],O=(ae,fe)=>(P[0]=Math.min(ae.min.y,fe.min.y),P[1]=Math.max(ae.max.y,fe.max.y),P[2]=h.EXTENT-fe.min.x>ae.max.x?fe.min.x-h.EXTENT:ae.max.x,P),L=(ae,fe)=>(P[0]=Math.min(ae.min.x,fe.min.x),P[1]=Math.max(ae.max.x,fe.max.x),P[2]=h.EXTENT-fe.min.y>ae.max.y?fe.min.y-h.EXTENT:ae.max.y,P),B=[(ae,fe)=>O(ae,fe),(ae,fe)=>O(fe,ae),(ae,fe)=>L(ae,fe),(ae,fe)=>L(fe,ae)],H=new h.pointGeometry(0,0);let te,X,G;const _e=(ae,fe,ye,xe,he)=>{const Te=[[xe?ye:ae,xe?ae:ye,0],[xe?ye:fe,xe?fe:ye,0]],Ue=he<0?h.EXTENT+he:he,We=[xe?Ue:(ae+fe)/2,xe?(ae+fe)/2:Ue,0];return 0===ye&&he<0||0!==ye&&he>0?w.getForTilePoints(G,[We],!0,X):Te.push(We),w.getForTilePoints(d,Te,!0,te),Math.max(Te[0][2],Te[1][2],We[2])/w.exaggeration()};for(let ae=0;ae<4;ae++){const fe=(ae<2?1:5)-ae,ye=_.borders[ae];if(0===ye.length)continue;const xe=G=T[ae](d),he=M(xe);if(!(he&&he instanceof h.FillExtrusionBucket&&he.enableTerrain)||_.borderDoneWithNeighborZ[ae]===he.canonical.z&&he.borderDoneWithNeighborZ[fe]===_.canonical.z||(X=w.findDEMTileFor(xe),!X||!X.dem))continue;if(!te){const et=w.findDEMTileFor(d);if(!et||!et.dem)return;te=et}const Te=he.borders[fe];let Ue=0;const We=he.borderDoneWithNeighborZ[fe]!==_.canonical.z;if(_.canonical.z===he.canonical.z){for(let et=0;et<ye.length;et++){const Je=_.featuresOnBorder[ye[et]],Dt=Je.borders[ae];let Ve;for(;Ue<Te.length&&(Ve=he.featuresOnBorder[Te[Ue]],!(Ve.borders[fe][1]>Dt[0]+3));)We&&he.encodeCentroid(void 0,Ve,!1),Ue++;if(Ve&&Ue<Te.length){const vt=Ue;let ht=0;for(;!(Ve.borders[fe][0]>Dt[1]-3)&&(ht++,++Ue!==Te.length);)Ve=he.featuresOnBorder[Te[Ue]];if(Ve=he.featuresOnBorder[Te[vt]],Je.intersectsCount()>1||Ve.intersectsCount()>1||1!==ht){1!==ht&&(Ue=vt),_.encodeCentroid(void 0,Je,!1),We&&he.encodeCentroid(void 0,Ve,!1);continue}const qt=B[ae](Je,Ve),Ke=ae%2?h.EXTENT-1:0;H.x=_e(qt[0],Math.min(h.EXTENT-1,qt[1]),Ke,ae<2,qt[2]),H.y=0,_.encodeCentroid(H,Je,!1),We&&he.encodeCentroid(H,Ve,!1)}else _.encodeCentroid(void 0,Je,!1)}_.borderDoneWithNeighborZ[ae]=he.canonical.z,_.needsCentroidUpdate=!0,We&&(he.borderDoneWithNeighborZ[fe]=_.canonical.z,he.needsCentroidUpdate=!0)}else{for(const et of ye)_.encodeCentroid(void 0,_.featuresOnBorder[et],!1);if(We){for(const et of Te)he.encodeCentroid(void 0,he.featuresOnBorder[et],!1);he.borderDoneWithNeighborZ[fe]=_.canonical.z,he.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[ae]=he.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(m)}const su=new h.Color(1,0,0,1),oh=new h.Color(0,1,0,1),au=new h.Color(0,0,1,1),lu=new h.Color(1,0,1,1),ho=new h.Color(0,1,1,1);function Nt(m,o,d,_){Xa(m,0,o+d/2,m.transform.width,d,_)}function Jo(m,o,d,_){Xa(m,o-d/2,0,d,m.transform.height,_)}function Xa(m,o,d,_,b,w){const T=m.context,M=T.gl;M.enable(M.SCISSOR_TEST),M.scissor(o*h.exported.devicePixelRatio,d*h.exported.devicePixelRatio,_*h.exported.devicePixelRatio,b*h.exported.devicePixelRatio),T.clear({color:w}),M.disable(M.SCISSOR_TEST)}function Td(m,o,d){const _=m.context,b=_.gl,w="globe"===m.transform.projection.name,T=d.projMatrix,M=m.useProgram("debug",null,w?["PROJECTION_GLOBE_VIEW"]:null),P=o.getTileByID(d.key);m.terrain&&m.terrain.setupElevationDraw(P,M);const O=h.DepthMode.disabled,L=h.StencilMode.disabled,B=m.colorModeForRenderPass(),H="$debug";_.activeTexture.set(b.TEXTURE0),m.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),w?P._makeGlobeTileDebugBuffers(m.context,m.transform.projection):P._makeDebugTileBoundsBuffers(m.context,m.transform.projection);const te=P._tileDebugBuffer||m.debugBuffer,X=P._tileDebugIndexBuffer||m.debugIndexBuffer,G=P._tileDebugSegments||m.debugSegments;M.draw(_,b.LINE_STRIP,O,L,B,h.CullFaceMode.disabled,yd(T,h.Color.red),H,te,X,G,null,null,null,P._globeTileDebugBorderBuffer);const _e=P.latestRawTileData,ae=Math.floor((_e&&_e.byteLength||0)/1024),fe=o.getTile(d).tileSize,ye=512/Math.min(fe,512)*(d.overscaledZ/m.transform.zoom)*.5;let xe=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(xe+=` => ${d.overscaledZ}`),function(We,et){We.initDebugOverlayCanvas();const Je=We.debugOverlayCanvas,Dt=We.context.gl,Ve=We.debugOverlayCanvas.getContext("2d");Ve.clearRect(0,0,Je.width,Je.height),Ve.shadowColor="white",Ve.shadowBlur=2,Ve.lineWidth=1.5,Ve.strokeStyle="white",Ve.textBaseline="top",Ve.font="bold 36px Open Sans, sans-serif",Ve.fillText(et,5,5),Ve.strokeText(et,5,5),We.debugOverlayTexture.update(Je),We.debugOverlayTexture.bind(Dt.LINEAR,Dt.CLAMP_TO_EDGE)}(m,`${xe} ${ae}kb`);const he=P._tileDebugTextBuffer||m.debugBuffer,Te=P._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Ue=P._tileDebugTextSegments||m.debugSegments;M.draw(_,b.TRIANGLES,O,L,h.ColorMode.alphaBlended,h.CullFaceMode.disabled,yd(T,h.Color.transparent,ye),H,he,Te,Ue,null,null,null,P._globeTileDebugTextBuffer)}const Dd=h.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Da}=Dd;function na(m,o,d,_){m.emplaceBack(o,d,_)}class Ka{constructor(o){this.vertexArray=new h.StructArrayLayout3f12,this.indices=new h.StructArrayLayout3ui6,na(this.vertexArray,-1,-1,1),na(this.vertexArray,1,-1,1),na(this.vertexArray,-1,1,1),na(this.vertexArray,1,1,1),na(this.vertexArray,-1,-1,-1),na(this.vertexArray,1,-1,-1),na(this.vertexArray,-1,1,-1),na(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Da),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=h.SegmentVector.simpleSegment(0,0,36,12)}}function Ya(m,o,d,_,b,w){const T=m.gl,M=o.paint.get("sky-atmosphere-color"),P=o.paint.get("sky-atmosphere-halo-color"),O=o.paint.get("sky-atmosphere-sun-intensity"),L={u_matrix_3f:h.fromMat4(h.create$1(),_),u_sun_direction:b,u_sun_intensity:O,u_color_tint_r:[(X=M).r,X.g,X.b,X.a],u_color_tint_m:[(G=P).r,G.g,G.b,G.a],u_luminance:5e-5};var X,G;T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+w,o.skyboxTexture,0),d.draw(m,T.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,h.ColorMode.unblended,h.CullFaceMode.frontCW,L,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}function kr(m,o){return h.transformMat4(m,m,o)}const cu={symbol:function(m,o,d,_,b){if("translucent"!==m.renderPass)return;const w=h.StencilMode.disabled,T=m.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(M,P,O,L,B,H,te){const X=P.transform,G="map"===B,_e="map"===H;for(const ae of M){const fe=L.getTile(ae),ye=fe.getBucket(O);if(!ye||ye.projection!==X.projection.name||!ye.text||!ye.text.segments.get().length)continue;const xe=h.evaluateSizeForZoom(ye.textSizeData,X.zoom),he=P.transform.calculatePixelsToTileUnitsMatrix(fe),Te=gn(ae.projMatrix,fe.tileID.canonical,_e,G,P.transform,he),Ue="none"!==O.layout.get("icon-text-fit")&&ye.hasIconData();if(xe){const We=Math.pow(2,X.zoom-fe.tileID.overscaledZ);Wa(ye,G,_e,te,h.symbolSize,X,Te,ae,We,xe,Ue,X.projection)}}}(_,m,d,o,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),b),0!==d.paint.get("icon-opacity").constantOr(1)&&Qi(m,o,d,_,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),w,T),0!==d.paint.get("text-opacity").constantOr(1)&&Qi(m,o,d,_,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),w,T),o.map.showCollisionBoxes&&(Jf(m,o,d,_,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),Jf(m,o,d,_,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(m,o,d,_){if("translucent"!==m.renderPass)return;const b=d.paint.get("circle-opacity"),w=d.paint.get("circle-stroke-width"),T=d.paint.get("circle-stroke-opacity"),M=void 0!==d.layout.get("circle-sort-key").constantOr(1);if(0===b.constantOr(1)&&(0===w.constantOr(1)||0===T.constantOr(1)))return;const P=m.context,O=P.gl,L=m.transform,B=m.depthModeForSublayer(0,h.DepthMode.ReadOnly),H=h.StencilMode.disabled,te=m.colorModeForRenderPass(),X="globe"===L.projection.name,G=[h.mercatorXfromLng(L.center.lng),h.mercatorYfromLat(L.center.lat)],_e=[];for(let fe=0;fe<_.length;fe++){const ye=_[fe],xe=o.getTile(ye),he=xe.getBucket(d);if(!he)continue;const Te=he.programConfigurations.get(d.id),Ue=Wf(d);X&&Ue.push("PROJECTION_GLOBE_VIEW");const We=m.useProgram("circle",Te,Ue),et=he.layoutVertexBuffer,Je=he.globeExtVertexBuffer,Dt=he.indexBuffer,Ve=L.projection.createInversionMatrix(L,ye.canonical),vt={programConfiguration:Te,program:We,layoutVertexBuffer:et,globeExtVertexBuffer:Je,indexBuffer:Dt,uniformValues:Ji(m,ye,xe,Ve,G,d),tile:xe};if(M){const ht=he.segments.get();for(const qt of ht)_e.push({segments:new h.SegmentVector([qt]),sortKey:qt.sortKey,state:vt})}else _e.push({segments:he.segments,sortKey:0,state:vt})}M&&_e.sort((fe,ye)=>fe.sortKey-ye.sortKey);const ae={useDepthForOcclusion:!X};for(const fe of _e){const{programConfiguration:ye,program:xe,layoutVertexBuffer:he,globeExtVertexBuffer:Te,indexBuffer:Ue,uniformValues:We,tile:et}=fe.state,Je=fe.segments;m.terrain&&m.terrain.setupElevationDraw(et,xe,ae),m.prepareDrawProgram(P,xe,et.tileID.toUnwrapped()),xe.draw(P,O.TRIANGLES,B,H,te,h.CullFaceMode.disabled,We,d.id,he,Ue,Je,d.paint,L.zoom,ye,X?Te:null)}},heatmap:function(m,o,d,_){if(0!==d.paint.get("heatmap-opacity"))if("offscreen"===m.renderPass){const b=m.context,w=b.gl,T=h.StencilMode.disabled,M=new h.ColorMode([w.ONE,w.ONE],h.Color.transparent,[!0,!0,!0,!0]);(function(H,te,X){const G=H.gl;H.activeTexture.set(G.TEXTURE1),H.viewport.set([0,0,te.width/4,te.height/4]);let _e=X.heatmapFbo;if(_e)G.bindTexture(G.TEXTURE_2D,_e.colorAttachment.get()),H.bindFramebuffer.set(_e.framebuffer);else{const ae=G.createTexture();G.bindTexture(G.TEXTURE_2D,ae),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),_e=X.heatmapFbo=H.createFramebuffer(te.width/4,te.height/4,!1),function(fe,ye,xe,he){const Te=fe.gl;Te.texImage2D(Te.TEXTURE_2D,0,Te.RGBA,ye.width/4,ye.height/4,0,Te.RGBA,fe.extRenderToTextureHalfFloat?fe.extTextureHalfFloat.HALF_FLOAT_OES:Te.UNSIGNED_BYTE,null),he.colorAttachment.set(xe)}(H,te,ae,_e)}})(b,m,d),b.clear({color:h.Color.transparent});const P=m.transform,O="globe"===P.projection.name,L=O?["PROJECTION_GLOBE_VIEW"]:null,B=[h.mercatorXfromLng(P.center.lng),h.mercatorYfromLat(P.center.lat)];for(let H=0;H<_.length;H++){const te=_[H];if(o.hasRenderableParent(te))continue;const X=o.getTile(te),G=X.getBucket(d);if(!G)continue;const _e=G.programConfigurations.get(d.id),ae=m.useProgram("heatmap",_e,L),{zoom:fe}=m.transform;m.terrain&&m.terrain.setupElevationDraw(X,ae),m.prepareDrawProgram(b,ae,te.toUnwrapped());const ye=P.projection.createInversionMatrix(P,te.canonical);ae.draw(b,w.TRIANGLES,h.DepthMode.disabled,T,M,h.CullFaceMode.disabled,Km(m,te,X,ye,B,fe,d.paint.get("heatmap-intensity")),d.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,d.paint,m.transform.zoom,_e,O?G.globeExtVertexBuffer:null)}b.viewport.set([0,0,m.width,m.height])}else"translucent"===m.renderPass&&(m.context.setColorMode(m.colorModeForRenderPass()),function(b,w){const T=b.context,M=T.gl,P=w.heatmapFbo;if(!P)return;T.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,P.colorAttachment.get()),T.activeTexture.set(M.TEXTURE1);let O=w.colorRampTexture;O||(O=w.colorRampTexture=new h.Texture(T,w.colorRamp,M.RGBA)),O.bind(M.LINEAR,M.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(T,M.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,b.colorModeForRenderPass(),h.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:w.paint.get("heatmap-opacity")},w.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,w.paint,b.transform.zoom)}(m,d))},line:function(m,o,d,_){if("translucent"!==m.renderPass)return;const b=d.paint.get("line-opacity"),w=d.paint.get("line-width");if(0===b.constantOr(1)||0===w.constantOr(1))return;const T=m.depthModeForSublayer(0,h.DepthMode.ReadOnly),M=m.colorModeForRenderPass(),P=m.terrain&&m.terrain.renderingToTexture?1:h.exported.devicePixelRatio,O=d.paint.get("line-dasharray"),L=O.constantOr(1),B=d.layout.get("line-cap"),H=d.paint.get("line-pattern"),te=H.constantOr(1),X=d.paint.get("line-gradient"),G=d.getCrossfadeParameters(),_e=te?"linePattern":"line",ae=m.context,fe=ae.gl,ye=(he=>{const Te=[];xd(he)&&Te.push("RENDER_LINE_DASH"),he.paint.get("line-gradient")&&Te.push("RENDER_LINE_GRADIENT");const Ue=he.paint.get("line-pattern").constantOr(1),We=1!==he.paint.get("line-opacity").constantOr(1);return!Ue&&We&&Te.push("RENDER_LINE_ALPHA_DISCARD"),Te})(d);let xe=ye.includes("RENDER_LINE_ALPHA_DISCARD");m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(xe=!1);for(const he of _){const Te=o.getTile(he);if(te&&!Te.patternsLoaded())continue;const Ue=Te.getBucket(d);if(!Ue)continue;m.prepareDrawTile();const We=Ue.programConfigurations.get(d.id),et=m.useProgram(_e,We,ye),Je=H.constantOr(null);if(Je&&Te.imageAtlas){const Ke=Te.imageAtlas,Jt=Ke.patternPositions[Je.to.toString()],en=Ke.patternPositions[Je.from.toString()];Jt&&en&&We.setConstantPatternPositions(Jt,en)}const Dt=O.constantOr(null),Ve=B.constantOr(null);if(!te&&Dt&&Ve&&Te.lineAtlas){const Ke=Te.lineAtlas,Jt=Ke.getDash(Dt.to,Ve),en=Ke.getDash(Dt.from,Ve);Jt&&en&&We.setConstantPatternPositions(Jt,en)}const vt=m.terrain?he.projMatrix:null,ht=te?vd(m,Te,d,G,vt,P):Ym(m,Te,d,G,vt,Ue.lineClipsArray.length,P);if(X){const Ke=Ue.gradients[d.id];let Jt=Ke.texture;if(d.gradientVersion!==Ke.version){let en=256;if(d.stepInterpolant){const Ut=o.getSource().maxzoom,Zt=he.canonical.z===Ut?Math.ceil(1<<m.transform.maxZoom-he.canonical.z):1;en=h.clamp(h.nextPowerOfTwo(Ue.maxLineLength/h.EXTENT*1024*Zt),256,ae.maxTextureSize)}Ke.gradient=h.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:en,image:Ke.gradient||void 0,clips:Ue.lineClipsArray}),Ke.texture?Ke.texture.update(Ke.gradient):Ke.texture=new h.Texture(ae,Ke.gradient,fe.RGBA),Ke.version=d.gradientVersion,Jt=Ke.texture}ae.activeTexture.set(fe.TEXTURE1),Jt.bind(d.stepInterpolant?fe.NEAREST:fe.LINEAR,fe.CLAMP_TO_EDGE)}L&&(ae.activeTexture.set(fe.TEXTURE0),Te.lineAtlasTexture.bind(fe.LINEAR,fe.REPEAT),We.updatePaintBuffers(G)),te&&(ae.activeTexture.set(fe.TEXTURE0),Te.imageAtlasTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),We.updatePaintBuffers(G)),m.prepareDrawProgram(ae,et,he.toUnwrapped());const qt=Ke=>{et.draw(ae,fe.TRIANGLES,T,Ke,M,h.CullFaceMode.disabled,ht,d.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Ue.segments,d.paint,m.transform.zoom,We,Ue.layoutVertexBuffer2)};if(xe){const Ke=m.stencilModeForClipping(he).ref;0===Ke&&m.terrain&&ae.clear({stencil:0});const Jt={func:fe.EQUAL,mask:255};ht.u_alpha_discard_threshold=.8,qt(new h.StencilMode(Jt,Ke,255,fe.KEEP,fe.KEEP,fe.INVERT)),ht.u_alpha_discard_threshold=0,qt(new h.StencilMode(Jt,Ke,255,fe.KEEP,fe.KEEP,fe.KEEP))}else qt(m.stencilModeForClipping(he))}xe&&(m.resetStencilClippingMasks(),m.terrain&&ae.clear({stencil:0}))},fill:function(m,o,d,_){const b=d.paint.get("fill-color"),w=d.paint.get("fill-opacity");if(0===w.constantOr(1))return;const T=m.colorModeForRenderPass(),M=d.paint.get("fill-pattern"),P=m.opaquePassEnabledForLayer()&&!M.constantOr(1)&&1===b.constantOr(h.Color.transparent).a&&1===w.constantOr(0)?"opaque":"translucent";if(m.renderPass===P){const O=m.depthModeForSublayer(1,"opaque"===m.renderPass?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly);ou(m,o,d,_,O,T,!1)}if("translucent"===m.renderPass&&d.paint.get("fill-antialias")){const O=m.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,h.DepthMode.ReadOnly);ou(m,o,d,_,O,T,!0)}},"fill-extrusion":function(m,o,d,_){const b=d.paint.get("fill-extrusion-opacity");if(0!==b&&"translucent"===m.renderPass){const w=new h.DepthMode(m.context.gl.LEQUAL,h.DepthMode.ReadWrite,m.depthRangeFor3D);if(1!==b||d.paint.get("fill-extrusion-pattern").constantOr(1))kl(m,o,d,_,w,h.StencilMode.disabled,h.ColorMode.disabled),kl(m,o,d,_,w,m.stencilModeFor3D(),m.colorModeForRenderPass()),m.resetStencilClippingMasks();else{const T=m.colorModeForRenderPass();kl(m,o,d,_,w,h.StencilMode.disabled,T)}}},hillshade:function(m,o,d,_){if("offscreen"!==m.renderPass&&"translucent"!==m.renderPass)return;const b=m.context,w=m.depthModeForSublayer(0,h.DepthMode.ReadOnly),T=m.colorModeForRenderPass(),M=m.terrain&&m.terrain.renderingToTexture,[P,O]="translucent"!==m.renderPass||M?[{},_]:m.stencilConfigForOverlap(_);for(const L of O){const B=o.getTile(L);if(B.needsHillshadePrepare&&"offscreen"===m.renderPass)Dn(m,B,d,w,h.StencilMode.disabled,T);else if("translucent"===m.renderPass){const H=M&&m.terrain?m.terrain.stencilModeForRTTOverlap(L):P[L.overscaledZ];lr(m,L,B,d,w,H,T)}}b.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,o,d,_,b,w){if("translucent"!==m.renderPass||0===d.paint.get("raster-opacity")||!_.length)return;const T=m.context,M=T.gl,P=o.getSource(),O=m.useProgram("raster"),L=m.colorModeForRenderPass(),B=m.terrain&&m.terrain.renderingToTexture,[H,te]=P instanceof De||B?[{},_]:m.stencilConfigForOverlap(_),X=te[te.length-1].overscaledZ,G=!m.options.moving;for(const _e of te){const ae=B?h.DepthMode.disabled:m.depthModeForSublayer(_e.overscaledZ-X,1===d.paint.get("raster-opacity")?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly,M.LESS),fe=_e.toUnwrapped(),ye=o.getTile(_e);if(B&&(!ye||!ye.hasData()))continue;const xe=B?_e.projMatrix:m.transform.calculateProjMatrix(fe,G),he=m.terrain&&B?m.terrain.stencilModeForRTTOverlap(_e):H[_e.overscaledZ],Te=w?0:d.paint.get("raster-fade-duration");ye.registerFadeDuration(Te);const Ue=o.findLoadedParent(_e,0),We=On(ye,Ue,o,m.transform,Te);let et,Je;m.terrain&&m.terrain.prepareDrawTile();const Dt="nearest"===d.paint.get("raster-resampling")?M.NEAREST:M.LINEAR;T.activeTexture.set(M.TEXTURE0),ye.texture.bind(Dt,M.CLAMP_TO_EDGE),T.activeTexture.set(M.TEXTURE1),Ue?(Ue.texture.bind(Dt,M.CLAMP_TO_EDGE),et=Math.pow(2,Ue.tileID.overscaledZ-ye.tileID.overscaledZ),Je=[ye.tileID.canonical.x*et%1,ye.tileID.canonical.y*et%1]):ye.texture.bind(Dt,M.CLAMP_TO_EDGE);const Ve=Kf(xe,Je||[0,0],et||1,We,d,P instanceof De?P.perspectiveTransform:[0,0]);if(m.prepareDrawProgram(T,O,fe),P instanceof De)P.boundsBuffer&&P.boundsSegments&&O.draw(T,M.TRIANGLES,ae,h.StencilMode.disabled,L,h.CullFaceMode.disabled,Ve,d.id,P.boundsBuffer,m.quadTriangleIndexBuffer,P.boundsSegments);else{const{tileBoundsBuffer:vt,tileBoundsIndexBuffer:ht,tileBoundsSegments:qt}=m.getTileBoundsBuffers(ye);O.draw(T,M.TRIANGLES,ae,he,L,h.CullFaceMode.disabled,Ve,d.id,vt,ht,qt)}}m.resetStencilClippingMasks()},background:function(m,o,d,_){const b=d.paint.get("background-color"),w=d.paint.get("background-opacity");if(0===w)return;const T=m.context,M=T.gl,P=m.transform,O=P.tileSize,L=d.paint.get("background-pattern");if(m.isPatternMissing(L))return;const B=!L&&1===b.a&&1===w&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==B)return;const H=h.StencilMode.disabled,te=m.depthModeForSublayer(0,"opaque"===B?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly),X=m.colorModeForRenderPass(),G=m.useProgram(L?"backgroundPattern":"background");let _e,ae=_;ae||(_e=m.getBackgroundTiles(),ae=Object.values(_e).map(ye=>ye.tileID)),L&&(T.activeTexture.set(M.TEXTURE0),m.imageManager.bind(m.context));const fe=d.getCrossfadeParameters();for(const ye of ae){const xe=ye.toUnwrapped(),he=_?ye.projMatrix:m.transform.calculateProjMatrix(xe);m.prepareDrawTile();const Te=o?o.getTile(ye):_e?_e[ye.key]:new h.Tile(ye,O,P.zoom,m),Ue=L?Ed(he,w,m,L,{tileID:ye,tileSize:O},fe):Yf(he,w,b);m.prepareDrawProgram(T,G,xe);const{tileBoundsBuffer:We,tileBoundsIndexBuffer:et,tileBoundsSegments:Je}=m.getTileBoundsBuffers(Te);G.draw(T,M.TRIANGLES,te,H,X,h.CullFaceMode.disabled,Ue,d.id,We,et,Je)}},sky:function(m,o,d){const _=m.transform,b="mercator"===_.projection.name||"globe"===_.projection.name?1:h.smoothstep(7,8,_.zoom),w=d.paint.get("sky-opacity")*b;if(0===w)return;const T=m.context,M=d.paint.get("sky-type"),P=new h.DepthMode(T.gl.LEQUAL,h.DepthMode.ReadOnly,[0,1]),O=m.frameCounter/1e3%1;"atmosphere"===M?"offscreen"===m.renderPass?d.needsSkyboxCapture(m)&&(function(L,B,H,te){const X=L.context,G=X.gl;let _e=B.skyboxFbo;if(!_e){_e=B.skyboxFbo=X.createFramebuffer(32,32,!1),B.skyboxGeometry=new Ka(X),B.skyboxTexture=X.gl.createTexture(),G.bindTexture(G.TEXTURE_CUBE_MAP,B.skyboxTexture),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MAG_FILTER,G.LINEAR);for(let xe=0;xe<6;++xe)G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+xe,0,G.RGBA,32,32,0,G.RGBA,G.UNSIGNED_BYTE,null)}X.bindFramebuffer.set(_e.framebuffer),X.viewport.set([0,0,32,32]);const ae=B.getCenter(L,!0),fe=L.useProgram("skyboxCapture"),ye=new Float64Array(16);h.identity(ye),h.rotateY(ye,ye,.5*-Math.PI),Ya(X,B,fe,ye,ae,0),h.identity(ye),h.rotateY(ye,ye,.5*Math.PI),Ya(X,B,fe,ye,ae,1),h.identity(ye),h.rotateX(ye,ye,.5*-Math.PI),Ya(X,B,fe,ye,ae,2),h.identity(ye),h.rotateX(ye,ye,.5*Math.PI),Ya(X,B,fe,ye,ae,3),h.identity(ye),Ya(X,B,fe,ye,ae,4),h.identity(ye),h.rotateY(ye,ye,Math.PI),Ya(X,B,fe,ye,ae,5),X.viewport.set([0,0,L.width,L.height])}(m,d),d.markSkyboxValid(m)):"sky"===m.renderPass&&function(L,B,H,te,X){const G=L.context,_e=G.gl,ae=L.transform,fe=L.useProgram("skybox");G.activeTexture.set(_e.TEXTURE0),_e.bindTexture(_e.TEXTURE_CUBE_MAP,B.skyboxTexture);const ye={u_matrix:ae.skyboxMatrix,u_sun_direction:B.getCenter(L,!1),u_cubemap:0,u_opacity:te,u_temporal_offset:X};L.prepareDrawProgram(G,fe),fe.draw(G,_e.TRIANGLES,H,h.StencilMode.disabled,L.colorModeForRenderPass(),h.CullFaceMode.backCW,ye,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(m,d,P,w,O):"gradient"===M&&"sky"===m.renderPass&&function(L,B,H,te,X){const G=L.context,_e=G.gl,ae=L.transform,fe=L.useProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new Ka(G)),G.activeTexture.set(_e.TEXTURE0);let ye=B.colorRampTexture;ye||(ye=B.colorRampTexture=new h.Texture(G,B.colorRamp,_e.RGBA)),ye.bind(_e.LINEAR,_e.CLAMP_TO_EDGE);const xe=(he=ae.skyboxMatrix,Te=B.getCenter(L,!1),Ue=B.paint.get("sky-gradient-radius"),We=te,et=X,{u_matrix:he,u_color_ramp:0,u_center_direction:Te,u_radius:h.degToRad(Ue),u_opacity:We,u_temporal_offset:et});var he,Te,Ue,We,et;L.prepareDrawProgram(G,fe),fe.draw(G,_e.TRIANGLES,H,h.StencilMode.disabled,L.colorModeForRenderPass(),h.CullFaceMode.backCW,xe,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(m,d,P,w,O)},debug:function(m,o,d){for(let _=0;_<d.length;_++)Td(m,o,d[_])},custom:function(m,o,d){const _=m.context,b=d.implementation;if(m.transform.projection.unsupportedLayers&&m.transform.projection.unsupportedLayers.includes("custom"))h.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===m.renderPass){const w=b.prerender;w&&(m.setCustomLayerDefaults(),_.setColorMode(m.colorModeForRenderPass()),w.call(b,_.gl,m.transform.customLayerMatrix()),_.setDirty(),m.setBaseState())}else if("translucent"===m.renderPass){m.setCustomLayerDefaults(),_.setColorMode(m.colorModeForRenderPass()),_.setStencilMode(h.StencilMode.disabled);const w="3d"===b.renderingMode?new h.DepthMode(m.context.gl.LEQUAL,h.DepthMode.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,h.DepthMode.ReadOnly);_.setDepthMode(w),b.render(_.gl,m.transform.customLayerMatrix()),_.setDirty(),m.setBaseState(),_.bindFramebuffer.set(null)}}};class Sd{constructor(o,d){this.context=new N(o),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=h.SourceCache.maxUnderzooming+h.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ns,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this._tileClippingMaskIDs=new Map,this._skippedStencilTileIDs=new Set}updateTerrain(o,d){const _=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Zr(this,o));const b=this._terrain;this.transform.elevation=_?b:null,b.update(o,this.transform,d)}_updateFog(o){const d=o.fog;if(!d||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,b]=d.getFovAdjustedRange(this.transform._fov);if(_>b)return void(this.transform.fogCullDistSq=null);const w=_+.78*(b-_);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(o,d){if(this.width=o*h.exported.devicePixelRatio,this.height=d*h.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const o=this.context,d=new h.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(h.EXTENT,0),d.emplaceBack(0,h.EXTENT),d.emplaceBack(h.EXTENT,h.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(d,h.posAttributes.members),this.tileExtentSegments=h.SegmentVector.simpleSegment(0,0,4,2);const _=new h.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(h.EXTENT,0),_.emplaceBack(0,h.EXTENT),_.emplaceBack(h.EXTENT,h.EXTENT),this.debugBuffer=o.createVertexBuffer(_,h.posAttributes.members),this.debugSegments=h.SegmentVector.simpleSegment(0,0,4,5);const b=new h.StructArrayLayout2i4;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(b,h.posAttributes.members),this.viewportSegments=h.SegmentVector.simpleSegment(0,0,4,2);const w=new h.StructArrayLayout4i8;w.emplaceBack(0,0,0,0),w.emplaceBack(h.EXTENT,0,h.EXTENT,0),w.emplaceBack(0,h.EXTENT,0,h.EXTENT),w.emplaceBack(h.EXTENT,h.EXTENT,h.EXTENT,h.EXTENT),this.mercatorBoundsBuffer=o.createVertexBuffer(w,h.boundsAttributes.members),this.mercatorBoundsSegments=h.SegmentVector.simpleSegment(0,0,4,2);const T=new h.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(T);const M=new h.StructArrayLayout1ui2;for(const O of[0,1,3,2,0])M.emplaceBack(O);this.debugIndexBuffer=o.createIndexBuffer(M),this.emptyTexture=new h.Texture(o,new h.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA),this.identityMat=h.create();const P=this.context.gl;this.stencilClearMode=new h.StencilMode({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(h.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context,d=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear(),this.useProgram("clippingMask").draw(o,d.TRIANGLES,h.DepthMode.disabled,this.stencilClearMode,h.ColorMode.disabled,h.CullFaceMode.disabled,wo(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear())}_renderTileClippingMasks(o,d,_){if(!d||this.currentStencilSource===d.id||!o.isTileClipped()||!_||0===_.length)return;const b=[];let w=!1;if(this._tileClippingMaskIDs&&!this.terrain){for(const L of _)if(this._tileClippingMaskIDs.has(L.key)||(w=!0),this._skippedStencilTileIDs.has(L.key)){if(!d.getTile(L).getBucket(o))continue;this._skippedStencilTileIDs.delete(L.key),b.push(L)}if(!w&&0===b.length)return}const T=this.context,M=T.gl;T.setColorMode(h.ColorMode.disabled),T.setDepthMode(h.DepthMode.disabled);const P=this.useProgram("clippingMask"),O=L=>{const B=d.getTile(L),{tileBoundsBuffer:H,tileBoundsIndexBuffer:te,tileBoundsSegments:X}=this.getTileBoundsBuffers(B);P.draw(T,M.TRIANGLES,h.DepthMode.disabled,new h.StencilMode({func:M.GREATER,mask:255},this._tileClippingMaskIDs.get(L.key)||0,255,M.KEEP,M.KEEP,M.REPLACE),h.ColorMode.disabled,h.CullFaceMode.disabled,wo(L.projMatrix),"$clipping",H,te,X)};if(!w&&b.length>0)for(const L of b)O(L);else{(0===this._tileClippingMaskIDs.size||this.nextStencilID+_.length>256)&&this.clearStencil(),this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear();for(const L of _)this._tileClippingMaskIDs.set(L.key,this.nextStencilID++),d.getTile(L).getBucket(o)?O(L):this._skippedStencilTileIDs.add(L.key)}0===this._skippedStencilTileIDs.size&&(this.currentStencilSource=d.id)}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,d=this.context.gl;return new h.StencilMode({func:d.NOTEQUAL,mask:255},o,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const d=this.context.gl;return new h.StencilMode({func:d.EQUAL,mask:255},this._tileClippingMaskIDs.get(o.key)||0,0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(o){const d=this.context.gl,_=o.sort((T,M)=>M.overscaledZ-T.overscaledZ),b=_[_.length-1].overscaledZ,w=_[0].overscaledZ-b+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const T={};for(let M=0;M<w;M++)T[M+b]=new h.StencilMode({func:d.GEQUAL,mask:255},M+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=w,[T,_]}return[{[b]:h.StencilMode.disabled},_]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new h.ColorMode([o.CONSTANT_COLOR,o.ONE],new h.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?h.ColorMode.unblended:h.ColorMode.alphaBlended}depthModeForSublayer(o,d,_){if(!this.opaquePassEnabledForLayer())return h.DepthMode.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new h.DepthMode(_||this.context.gl.LEQUAL,d,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,d){this.style=o,this.options=d,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(h.exported.now()),this.imageManager.beginFrame();const _=this.style.order,b=this.style._sourceCaches;for(const O in b){const L=b[O];L.used&&L.prepare(this.context)}const w={},T={},M={};for(const O in b){const L=b[O];w[O]=L.getVisibleCoordinates(),T[O]=w[O].slice().reverse(),M[O]=L.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let O=0;O<_.length;O++)if(this.style._layers[_[O]].is3D()){this.opaquePassCutoff=O;break}if(this.terrain&&(this.terrain.updateTileBinding(M),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new h.GlobeSharedBuffers(this.context)),!h.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const O of _){const L=this.style._layers[O],B=o._getLayerSourceCache(L);if(!L.hasOffscreenPass()||L.isHidden(this.transform.zoom))continue;const H=B?T[B.id]:void 0;("custom"===L.type||L.isSky()||H&&H.length)&&this.renderLayer(this,B,L,H)}this.depthRangeFor3D=[0,1-(o.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let P=h.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(P=this.style.fog.properties.get("color")),this.context.clear({color:d.showOverdrawInspector?h.Color.black:P,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const O=this.style._layers[_[this.currentLayer]],L=o._getLayerSourceCache(O);if(O.isSky())continue;const B=L?T[L.id]:void 0;this._renderTileClippingMasks(O,L,B),this.renderLayer(this,L,O,B)}if(this.renderPass="sky",(h.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const O=this.style._layers[_[this.currentLayer]],L=o._getLayerSourceCache(O);O.isSky()&&this.renderLayer(this,L,O,L?T[L.id]:void 0)}for("globe"===this.transform.projection.name&&function(O){const L=O.context,B=L.gl,H=O.transform,te=new h.DepthMode(B.LEQUAL,h.DepthMode.ReadOnly,[0,1]),X=O.useProgram("globeAtmosphere"),G=H.centerOffset,_e=H._camera.getCameraToClipPerspective(H._fov,H.width/H.height,H._nearZ,H._farZ);_e[8]=2*-G.x/H.width,_e[9]=2*G.y/H.height;const ae=h.invert([],_e),fe=h.mul([],ae,H.projMatrix),ye={u_frustum_tl:kr([-1,1,1],ae),u_frustum_tr:kr([1,1,1],ae),u_frustum_br:kr([1,-1,1],ae),u_frustum_bl:kr([-1,-1,1],ae),u_globe_pos:kr([H.globeMatrix[12],H.globeMatrix[13],H.globeMatrix[14]],fe),u_globe_radius:H.worldSize/2/Math.PI-1,u_opacity:1-h.globeToMercatorTransition(H.zoom),u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};O.prepareDrawProgram(L,X);const xe=O.globeSharedBuffers;xe&&X.draw(L,B.TRIANGLES,te,h.StencilMode.disabled,h.ColorMode.alphaBlended,h.CullFaceMode.backCW,ye,"skybox",xe.atmosphereVertexBuffer,xe.atmosphereIndexBuffer,xe.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const O=this.style._layers[_[this.currentLayer]],L=o._getLayerSourceCache(O);if(O.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(O)){if(O.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const B=L?("symbol"===O.type?M:T)[L.id]:void 0;this._renderTileClippingMasks(O,L,L?w[L.id]:void 0),this.renderLayer(this,L,O,B),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let O=null;h.values(this.style._layers).forEach(L=>{const B=o._getLayerSourceCache(L);B&&!L.isHidden(this.transform.zoom)&&(!O||O.getSource().maxzoom<B.getSource().maxzoom)&&(O=B)}),O&&this.options.showTileBoundaries&&cu.debug(this,O,O.getVisibleCoordinates())}this.options.showPadding&&function(O){const L=O.transform.padding;Nt(O,O.transform.height-(L.top||0),3,su),Nt(O,L.bottom||0,3,oh),Jo(O,L.left||0,3,au),Jo(O,O.transform.width-(L.right||0),3,lu);const B=O.transform.centerPoint;var H,te,X,G;Xa(H=O,(te=B.x)-1,(X=O.transform.height-B.y)-10,2,20,G=ho),Xa(H,te-10,X-1,20,2,G)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(h.window.performance.now()),this.saveCanvasCopy())}renderLayer(o,d,_,b){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||b&&b.length)&&(this.id=_.id,this.gpuTimingStart(_),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(_.type)||cu[_.type](o,d,_,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery;let _=this.gpuTimers[o.id];_||(_=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),_.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,_.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}queryGpuTimers(o){const d={};for(const _ in o){const b=o[_],w=this.context.extTimerQuery,T=w.getQueryObjectEXT(b.query,w.QUERY_RESULT_EXT)/1e6;w.deleteQueryEXT(b.query),d[_]=T}return d}translatePosMatrix(o,d,_,b,w){if(!_[0]&&!_[1])return o;const T=w?"map"===b?this.transform.angle:0:"viewport"===b?-this.transform.angle:0;if(T){const O=Math.sin(T),L=Math.cos(T);_=[_[0]*L-_[1]*O,_[0]*O+_[1]*L]}const M=[w?_[0]:Bn(d,_[0],this.transform.zoom),w?_[1]:Bn(d,_[1],this.transform.zoom),0],P=new Float32Array(16);return h.translate(P,o,M),P}saveTileTexture(o){const d=this._tileTextures[o.size[0]];d?d.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const d=this._tileTextures[o];return d&&d.length>0?d.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const d=this.imageManager.getPattern(o.from.toString()),_=this.imageManager.getPattern(o.to.toString());return!d||!_}currentGlobalDefines(){const o=this.terrain&&this.terrain.renderingToTexture,d=this.style&&this.style.fog,_=[];return this.terrain&&!this.terrain.renderingToTexture&&_.push("TERRAIN"),d&&!o&&0!==d.getOpacity(this.transform.pitch)&&_.push("FOG"),o&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}useProgram(o,d,_){this.cache=this.cache||{};const b=_||[],w=this.currentGlobalDefines().concat(b),T=Us.cacheKey(o,w,d);return this.cache[T]||(this.cache[T]=new Us(this.context,o,An[o],d,pr[o],w)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=h.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new h.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(o,d,_){if(this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const w=b.getOpacity(this.transform.pitch);0!==w&&d.setFogUniformValues(o,((T,M,P,O)=>{const L=M.properties.get("color"),B=T.frameCounter/1e3%1,H=[L.r/L.a,L.g/L.a,L.b/L.a,O];return{u_fog_matrix:P?T.transform.calculateFogTileMatrix(P):T.identityMat,u_fog_range:M.getFovAdjustedRange(T.transform._fov),u_fog_color:H,u_fog_horizon_blend:M.properties.get("horizon-blend"),u_fog_temporal_offset:B}})(this,b,_,w))}}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const o=this.context.gl,d=o.createTexture();return o.bindTexture(o.TEXTURE_2D,d),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&0!==o.getOpacity(this.transform.pitch)}getBackgroundTiles(){const o=this._backgroundTiles,d=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const b of _)d[b.key]=o[b.key]||new h.Tile(b,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}}class jr{constructor(o=0,d=0,_=0,b=0){if(isNaN(o)||o<0||isNaN(d)||d<0||isNaN(_)||_<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=d,this.left=_,this.right=b}interpolate(o,d,_){return null!=d.top&&null!=o.top&&(this.top=h.number(o.top,d.top,_)),null!=d.bottom&&null!=o.bottom&&(this.bottom=h.number(o.bottom,d.bottom,_)),null!=d.left&&null!=o.left&&(this.left=h.number(o.left,d.left,_)),null!=d.right&&null!=o.right&&(this.right=h.number(o.right,d.right,_)),this}getCenter(o,d){const _=h.clamp((this.left+o-this.right)/2,0,o),b=h.clamp((this.top+d-this.bottom)/2,0,d);return new h.pointGeometry(_,b)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new jr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Md(m,o){const d=h.getColumn(m,3);h.fromQuat(m,o),h.setColumn(m,3,d)}function Id(m,o){const d=h.identity$1([]);return h.rotateZ$1(d,d,-o),h.rotateX$1(d,d,-m),d}function Ja(m,o){const d=[m[0],m[1],0],_=[o[0],o[1],0];if(h.length(d)>=1e-15){const T=h.normalize([],d);h.scale$2(_,T,h.dot(_,T)),o[0]=_[0],o[1]=_[1]}const b=h.cross([],o,m);if(h.len(b)<1e-15)return null;const w=Math.atan2(-b[1],b[0]);return Id(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),w)}class eo{constructor(o,d){this.position=o,this.orientation=d}get position(){return this._position}set position(o){if(o){const d=o instanceof h.MercatorCoordinate?o:new h.MercatorCoordinate(o[0],o[1],o[2]);this._renderWorldCopies&&(d.x=h.wrap(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(o,d){if(this.orientation=null,!this.position)return;const _=this._elevation?this._elevation.getAtPointOrZero(h.MercatorCoordinate.fromLngLat(o)):0,b=this.position,w=h.MercatorCoordinate.fromLngLat(o,_),T=[w.x-b.x,w.y-b.y,w.z-b.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=Ja(T,d)}setPitchBearing(o,d){this.orientation=Id(h.degToRad(o),h.degToRad(-d))}}class hc{constructor(o,d){this._transform=h.identity([]),this.orientation=d,this.position=o}get mercatorPosition(){const o=this.position;return new h.MercatorCoordinate(o[0],o[1],o[2])}get position(){const o=h.getColumn(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var d;o&&h.setColumn(this._transform,3,[(d=o)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||h.identity$1([]),o&&Md(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,d){this._orientation=Id(o,d),Md(this._transform,this._orientation)}forward(){const o=h.getColumn(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=h.getColumn(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=h.getColumn(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,d){const _=new Float64Array(16);return h.invert(_,this.getWorldToCamera(o,d)),_}getWorldToCameraPosition(o,d,_){const b=this.position;h.scale$2(b,b,-o);const w=new Float64Array(16);return h.fromScaling(w,[_,_,_]),h.translate(w,w,b),w[10]*=d,w}getWorldToCamera(o,d){const _=new Float64Array(16),b=new Float64Array(4),w=this.position;return h.conjugate(b,this._orientation),h.scale$2(w,w,-o),h.fromQuat(_,b),h.translate(_,_,w),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=d,_[9]*=d,_[10]*=d,_[11]*=d,_}getCameraToClipPerspective(o,d,_,b){const w=new Float64Array(16);return h.perspective(w,o,d,_,b),w}getDistanceToElevation(o){const d=0===o?0:h.mercatorZfromAltitude(o,this.position[1]),_=this.forward();return(d-this.position[2])/_[2]}clone(){return new hc([...this.position],[...this.orientation])}}function dc(m,o){const d=$i(m),_=function(w,T,M,P,O){const L=new h.LngLat(M.lng-180*ra,M.lat),B=new h.LngLat(M.lng+180*ra,M.lat),H=w.project(L.lng,L.lat),te=w.project(B.lng,B.lat),X=-Math.atan2(te.y-H.y,te.x-H.x),G=h.MercatorCoordinate.fromLngLat(M);G.y=h.clamp(G.y,-.999975,.999975);const _e=G.toLngLat(),ae=w.project(_e.lng,_e.lat),fe=h.MercatorCoordinate.fromLngLat(_e);fe.x+=ra;const ye=fe.toLngLat(),xe=w.project(ye.lng,ye.lat),he=sh(xe.x-ae.x,xe.y-ae.y,X),Te=h.MercatorCoordinate.fromLngLat(_e);Te.y+=ra;const Ue=Te.toLngLat(),We=w.project(Ue.lng,Ue.lat),et=sh(We.x-ae.x,We.y-ae.y,X),Je=Math.abs(he.x)/Math.abs(et.y),Dt=h.identity([]);h.rotateZ(Dt,Dt,-X*(1-(O?0:P)));const Ve=h.identity([]);return h.scale(Ve,Ve,[1,1-(1-Je)*P,1]),Ve[4]=-et.x/et.y*P,h.rotateZ(Ve,Ve,X),h.multiply$1(Ve,Dt,Ve),Ve}(m.projection,0,m.center,d,o),b=Sa(m);return h.scale(_,_,[b,b,1]),_}function Sa(m){const o=m.projection,d=$i(m),_=fc(o,m.center),b=fc(o,h.LngLat.convert(o.center));return Math.pow(2,_*d+(1-d)*b)}function $i(m){const o=m.projection.range;if(!o)return 0;const d=Math.max(m.width,m.height),_=Math.log(d/1024)/Math.LN2;return h.smoothstep(o[0]+_,o[1]+_,m.zoom)}const ra=1/4e4;function fc(m,o){const d=h.clamp(o.lat,-h.MAX_MERCATOR_LATITUDE,h.MAX_MERCATOR_LATITUDE),_=new h.LngLat(o.lng-180*ra,d),b=new h.LngLat(o.lng+180*ra,d),w=m.project(_.lng,d),T=m.project(b.lng,d),M=h.MercatorCoordinate.fromLngLat(_),P=h.MercatorCoordinate.fromLngLat(b),O=T.x-w.x,L=T.y-w.y,B=P.x-M.x,H=P.y-M.y,te=Math.sqrt((B*B+H*H)/(O*O+L*L));return Math.log(te)/Math.LN2}function sh(m,o,d){const _=Math.cos(d),b=Math.sin(d);return{x:m*_-o*b,y:m*b+o*_}}class gs{constructor(o,d,_,b,w,T,M){this.tileSize=512,this._renderWorldCopies=void 0===w||w,this._minZoom=o||0,this._maxZoom=d||22,this._minPitch=null==_?0:_,this._maxPitch=null==b?60:b,this.setProjection(T),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new h.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new jr,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new hc,this._centerAltitude=0,this._centerAltitudeValidForExaggeration=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const o=new gs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(o){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||d)&&this._updateCameraOnTerrain(),(o||d)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return h.pick(this.projection,["name","center","parallels"])}setProjection(o){null==o&&(o={name:"mercator"}),this.projectionOptions=o;const d=this.projection?this.getProjection():void 0;this.projection=h.getProjection(o);const _=this.getProjection();return $(d,_)?null:(this._calcMatrices(),_)}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(o){void 0===o?o=!0:null===o&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.pointGeometry(this.width,this.height)}get bearing(){return h.wrap(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const d=-o*Math.PI/180;var _,b,w,T,M,P,O,L,B,H;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(_=new h.ARRAY_TYPE(4),h.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),b=this.rotationMatrix,T=this.angle,M=(w=this.rotationMatrix)[0],P=w[1],O=w[2],L=w[3],B=Math.sin(T),H=Math.cos(T),b[0]=M*H+O*B,b[1]=P*H+L*B,b[2]=M*-B+O*H,b[3]=P*-B+L*H)}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const d=h.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const d=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=0);const o=this._elevation;this._centerAltitude=o.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=o.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let b=0,w=0;for(let T=0;T<d.length;T++){const M=new h.pointGeometry(d[T][0]*this.width,_+d[T][1]*(this.height-_)),P=o.pointCoordinate(M);if(!P)continue;const O=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);b+=P[3]*O,w+=O}return 0===w?NaN:b/w}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const o=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*d,b=this._mercatorZfromZoom(o),w=this._mercatorZfromZoom(this._maxZoom),T=Math.max(b-_,w);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let _;_=o.z<this._camera.position[2]?[d.x,d.y,d.z]:[o.x,o.y,o.z];const b=h.length(h.sub([],this._camera.position,_));return h.clamp(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let d=!1;if(o.orientation&&!h.exactEquals(o.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(o.orientation)),o.position){const _=[o.position.x,o.position.y,o.position.z];h.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,d=new eo;return d.position=new h.MercatorCoordinate(o[0],o[1],o[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(o){if(!h.length$1(o))return!1;h.normalize$1(o,o);const d=h.transformQuat([],[0,0,-1],o),_=h.transformQuat([],[0,-1,0],o);if(_[2]<0)return!1;const b=Ja(d,_);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(o){const d=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;o[2]=h.clamp(o[2],b/_,b/d),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,d,_){this._unmodified=!1,this._edgeInsets.interpolate(o,d,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const d=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(o){const d=[new h.UnwrappedTileID(0,o)];if(this.renderWorldCopies){const _=this.pointCoordinate(new h.pointGeometry(0,0)),b=this.pointCoordinate(new h.pointGeometry(this.width,0)),w=this.pointCoordinate(new h.pointGeometry(this.width,this.height)),T=this.pointCoordinate(new h.pointGeometry(0,this.height)),M=Math.floor(Math.min(_.x,b.x,w.x,T.x)),P=Math.floor(Math.max(_.x,b.x,w.x,T.x)),O=1;for(let L=M-O;L<=P+O;L++)0!==L&&d.push(new h.UnwrappedTileID(L,o))}return d}coveringTiles(o){let d=this.coveringZoomLevel(o);const _=d,b=this.elevation&&!o.isTerrainDEM,w="mercator"===this.projection.name;if(void 0!==o.minzoom&&d<o.minzoom)return[];void 0!==o.maxzoom&&d>o.maxzoom&&(d=o.maxzoom);const T=this.locationCoordinate(this.center),M=this.center.lat,P=1<<d,O=[P*T.x,P*T.y,0],L="globe"===this.projection.name,B=!L,H=h.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,B),te=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=P*h.mercatorZfromAltitude(1,this.center.lat),G=this._camera.position[2]/h.mercatorZfromAltitude(1,this.center.lat),_e=[P*te.x,P*te.y,G*(B?1:X)],ae=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),fe=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?d:0,ye=o.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,xe=o.isTerrainDEM?-ye:this._elevation?this._elevation.getMinElevationBelowMSL():0,he=this.projection.isReprojectedInTileSpace?Sa(this):1,Te=Ke=>{const en=new h.MercatorCoordinate(Ke.x+25e-6,Ke.y,Ke.z),Ut=new h.MercatorCoordinate(Ke.x,Ke.y+25e-6,Ke.z),Zt=Ke.toLngLat(),ln=en.toLngLat(),Tn=Ut.toLngLat(),tn=this.locationCoordinate(Zt),bn=this.locationCoordinate(ln),Xt=this.locationCoordinate(Tn),ii=Math.hypot(bn.x-tn.x,bn.y-tn.y),po=Math.hypot(Xt.x-tn.x,Xt.y-tn.y);return Math.sqrt(ii*po)*he/25e-6},Ue=Ke=>{const Jt=ye,en=xe;return{aabb:h.tileAABB(this,P,0,0,0,Ke,en,Jt,this.projection),zoom:0,x:0,y:0,minZ:en,maxZ:Jt,wrap:Ke,fullyVisible:!1}},We=[];let et=[];const Je=d,Dt=o.reparseOverscaled?_:d,Ve=Ke=>Ke*Ke,vt=Ve((G-this._centerAltitude)*X),ht=Ke=>{if(!this._elevation||!Ke.tileID||!w)return;const Jt=this._elevation.getMinMaxForTile(Ke.tileID),en=Ke.aabb;Jt?(en.min[2]=Jt.min,en.max[2]=Jt.max,en.center[2]=(en.min[2]+en.max[2])/2):(Ke.shouldSplit=qt(Ke),Ke.shouldSplit||(en.min[2]=en.max[2]=en.center[2]=this._centerAltitude))},qt=Ke=>{if(Ke.zoom<fe)return!0;if(Ke.zoom===Je)return!1;if(null!=Ke.shouldSplit)return Ke.shouldSplit;const Jt=Ke.aabb.distanceX(_e),en=Ke.aabb.distanceY(_e);let Ut=vt,Zt=1;if(L){Ut=Ve(Ke.aabb.distanceZ(_e));const Tn=Math.pow(2,Ke.zoom),tn=h.latFromMercatorY((Ke.y+1)/Tn),bn=h.latFromMercatorY(Ke.y/Tn),Xt=Math.min(Math.max(M,tn),bn),ii=h.circumferenceAtLatitude(Xt)/h.circumferenceAtLatitude(M);Zt=Math.min(ii,1)}else if(b&&(Ut=Ve(Ke.aabb.distanceZ(_e)*X)),this.projection.isReprojectedInTileSpace&&_<=5){const Tn=Math.pow(2,Ke.zoom),tn=Te(new h.MercatorCoordinate((Ke.x+.5)/Tn,(Ke.y+.5)/Tn));Zt=tn>.85?1:tn}const ln=Jt*Jt+en*en+Ut;return ln<Ve((1<<Je-Ke.zoom)*ae*Zt*((Tn,tn)=>{if(tn*Ve(.707)<Tn)return 1;const bn=Math.sqrt(tn/Tn);return bn/(1.4144271570014144+(Math.pow(1.1,bn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ut,vt),ln))};if(this.renderWorldCopies)for(let Ke=1;Ke<=3;Ke++)We.push(Ue(-Ke)),We.push(Ue(Ke));for(We.push(Ue(0));We.length>0;){const Ke=We.pop(),Jt=Ke.x,en=Ke.y;let Ut=Ke.fullyVisible;if(!Ut){const Zt=Ke.aabb.intersects(H);if(0===Zt)continue;Ut=2===Zt}if(Ke.zoom!==Je&&qt(Ke))for(let Zt=0;Zt<4;Zt++){const ln=(Jt<<1)+Zt%2,Tn=(en<<1)+(Zt>>1),tn={aabb:w?Ke.aabb.quadrant(Zt):h.tileAABB(this,P,Ke.zoom+1,ln,Tn,Ke.wrap,Ke.minZ,Ke.maxZ,this.projection),zoom:Ke.zoom+1,x:ln,y:Tn,wrap:Ke.wrap,fullyVisible:Ut,tileID:void 0,shouldSplit:void 0,minZ:Ke.minZ,maxZ:Ke.maxZ};b&&!L&&(tn.tileID=new h.OverscaledTileID(Ke.zoom+1===Je?Dt:Ke.zoom+1,Ke.wrap,Ke.zoom+1,ln,Tn),ht(tn)),We.push(tn)}else{const Zt=Ke.zoom===Je?Dt:Ke.zoom;if(o.minzoom&&o.minzoom>Zt)continue;const ln=O[0]-(.5+Jt+(Ke.wrap<<Ke.zoom))*(1<<d-Ke.zoom),Tn=O[1]-.5-en,tn=Ke.tileID?Ke.tileID:new h.OverscaledTileID(Zt,Ke.wrap,Ke.zoom,Jt,en);et.push({tileID:tn,distanceSq:ln*ln+Tn*Tn})}}if(this.fogCullDistSq){const Ke=this.fogCullDistSq,Jt=this.horizonLineFromTop();et=et.filter(en=>{const Ut=[0,0,0,1],Zt=[h.EXTENT,h.EXTENT,0,1],ln=this.calculateFogTileMatrix(en.tileID.toUnwrapped());h.transformMat4$1(Ut,Ut,ln),h.transformMat4$1(Zt,Zt,ln);const Tn=h.getAABBPointSquareDist(Ut,Zt);if(0===Tn)return!0;let tn=!1;const bn=this._elevation;if(bn&&Tn>Ke&&0!==Jt){const Xt=this.calculateProjMatrix(en.tileID.toUnwrapped());let ii;o.isTerrainDEM||(ii=bn.getMinMaxForTile(en.tileID)),ii||(ii={min:xe,max:ye});const po=h.furthestTileCorner(this.rotation),mo=[po[0]*h.EXTENT,po[1]*h.EXTENT,ii.max];h.transformMat4(mo,mo,Xt),tn=(1-mo[1])*this.height*.5<Jt}return Tn<Ke||tn})}return et.sort((Ke,Jt)=>Ke.distanceSq-Jt.distanceSq).map(Ke=>Ke.tileID)}resize(o,d){this.width=o,this.height=d,this.pixelsToGLUnits=[2/o,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const d=h.clamp(o.lat,-h.MAX_MERCATOR_LATITUDE,h.MAX_MERCATOR_LATITUDE),_=this.projection.project(o.lng,d);return new h.pointGeometry(_.x*this.worldSize,_.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(o,d){let _,b;const w=this.centerPoint;if("globe"===this.projection.name){const M=this.worldSize;_=(d.x-w.x)/M,b=(d.y-w.y)/M}else{const M=this.pointCoordinate(d),P=this.pointCoordinate(w);_=M.x-P.x,b=M.y-P.y}const T=this.locationCoordinate(o);this.setLocation(new h.MercatorCoordinate(T.x-_,T.y-b))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this._coordinatePoint(this.locationCoordinate(o),!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,d){const _=d?h.mercatorZfromAltitude(d,o.lat):void 0,b=this.projection.project(o.lng,o.lat);return new h.MercatorCoordinate(b.x,b.y,_)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,d){const _=null!=d?d:this._centerAltitude,b=[o.x,o.y,0,1],w=[o.x,o.y,1,1];h.transformMat4$1(b,b,this.pixelMatrixInverse),h.transformMat4$1(w,w,this.pixelMatrixInverse);const T=w[3];h.scale$1(b,b,1/b[3]),h.scale$1(w,w,1/T);const M=b[2],P=w[2];return{p0:b,p1:w,t:M===P?0:(_-M)/(P-M)}}screenPointToMercatorRay(o){const d=[o.x,o.y,0,1],_=[o.x,o.y,1,1];return h.transformMat4$1(d,d,this.pixelMatrixInverse),h.transformMat4$1(_,_,this.pixelMatrixInverse),h.scale$1(d,d,1/d[3]),h.scale$1(_,_,1/_[3]),d[2]=h.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,_[2]=h.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,h.scale$1(d,d,1/this.worldSize),h.scale$1(_,_,1/this.worldSize),new h.Ray([d[0],d[1],d[2]],h.normalize([],h.sub([],_,d)))}rayIntersectionCoordinate(o){const{p0:d,p1:_,t:b}=o,w=h.mercatorZfromAltitude(d[2],this._center.lat),T=h.mercatorZfromAltitude(_[2],this._center.lat);return new h.MercatorCoordinate(h.number(d[0],_[0],b)/this.worldSize,h.number(d[1],_[1],b)/this.worldSize,h.number(w,T,b))}pointCoordinate(o,d=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,d)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);const d=this.elevation;let _=this.elevation.pointCoordinate(o);if(_)return new h.MercatorCoordinate(_[0],_[1],_[2]);let b=0,w=this.horizonLineFromTop();if(o.y>w)return this.pointCoordinate(o);const T=.02*w,M=o.clone();for(let P=0;P<10&&w-b>T;P++){M.y=h.number(b,w,.66);const O=d.pointCoordinate(M);O?(w=M.y,_=O):b=M.y}return _?new h.MercatorCoordinate(_[0],_[1],_[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){if(this.elevation)return!this.elevation.pointCoordinate(o);{const d=this.horizonLineFromTop();return o.y<d}}_coordinatePoint(o,d){const _=d&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,b=[o.x*this.worldSize,o.y*this.worldSize,_+o.toAltitude(),1];return h.transformMat4$1(b,b,this.pixelMatrix),b[3]>0?new h.pointGeometry(b[0]/b[3],b[1]/b[3]):new h.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(o,d){const _=new h.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),b=new h.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),w=new h.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),T=new h.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let M=this.pointCoordinate(_,o),P=this.pointCoordinate(b,o);const O=this.pointCoordinate(w,d),L=this.pointCoordinate(T,d),B=(H,te)=>(te.y-H.y)/(te.x-H.x);return M.y>1&&P.y>=0?M=new h.MercatorCoordinate((1-L.y)/B(L,M)+L.x,1):M.y<0&&P.y<=1&&(M=new h.MercatorCoordinate(-L.y/B(L,M)+L.x,0)),P.y>1&&M.y>=0?P=new h.MercatorCoordinate((1-O.y)/B(O,P)+O.x,1):P.y<0&&M.y<=1&&(P=new h.MercatorCoordinate(-O.y/B(O,P)+O.x,0)),(new h.LngLatBounds).extend(this.coordinateLocation(M)).extend(this.coordinateLocation(P)).extend(this.coordinateLocation(L)).extend(this.coordinateLocation(O))}_getBounds3D(){const o=this.elevation;if(!o.visibleDemTiles.length)return this._getBounds(0,0);const d=o.visibleDemTiles.reduce((_,b)=>{if(b.dem){const w=b.dem.tree;_.min=Math.min(_.min,w.minimums[0]),_.max=Math.max(_.max,w.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBounds(d.min*o.exaggeration(),d.max*o.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(o=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-d*(1-this._horizonShift);return o?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-h.MAX_MERCATOR_LATITUDE,this.maxLat=h.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=h.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=h.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=h.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=h.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,d){return this.projection.createTileMatrix(this,d,o)}calculateDistanceTileData(o){const d=o.key,_=this._distanceTileDataCache;if(_[d])return _[d];const b=o.canonical,w=1/this.height,T=this.cameraWorldSize/this.zoomScale(b.z),M=(b.x+Math.pow(2,b.z)*o.wrap)*T,P=b.y*T,O=this.point,L=this.angle,B=Math.sin(-L),H=-Math.cos(-L);return _[d]={bearing:[B,H],center:[(O.x-M)*w,(O.y-P)*w],scale:T/h.EXTENT*w},_[d]}calculateFogTileMatrix(o){const d=o.key,_=this._fogTileMatrixCache;if(_[d])return _[d];const b=this.calculatePosMatrix(o,this.cameraWorldSize);return h.multiply$1(b,this.worldToFogMatrix,b),_[d]=new Float32Array(b),_[d]}calculateProjMatrix(o,d=!1){const _=o.key,b=d?this._alignedProjMatrixCache:this._projMatrixCache;if(b[_])return b[_];const w=this.calculatePosMatrix(o,this.worldSize);return h.multiply$1(w,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.alignedProjMatrix:this.projMatrix,w),b[_]=new Float32Array(w),b[_]}calculatePixelsToTileUnitsMatrix(o){const d=o.tileID.key,_=this._pixelsToTileUnitsCache;if(_[d])return _[d];const b=function(w,T){const{scale:M}=w.tileTransform,P=M*h.EXTENT/(w.tileSize*Math.pow(2,T.zoom-w.tileID.overscaledZ+w.tileID.canonical.z));return O=new Float32Array(4),H=(L=T.inverseAdjustmentMatrix)[1],te=L[2],X=L[3],_e=(B=[P,P])[1],O[0]=L[0]*(G=B[0]),O[1]=H*G,O[2]=te*_e,O[3]=X*_e,O;var O,L,B,H,te,X,G,_e}(o,this);return _[d]=b,_[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const d=h.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(d),b=this._camera.forward(),w=h.mercatorZfromAltitude(1,this._center.lat);_[2]/=w,b[2]/=w,h.normalize(b,b);const T=o.raycast(_,b,o.exaggeration());if(T){const M=h.scaleAndAdd([],_,b,T),P=new h.MercatorCoordinate(M[0],M[1],h.mercatorZfromAltitude(M[2],h.latFromMercatorY(M[1]))),O=(P.z+h.length([P.x-_[0],P.y-_[1],P.z-_[2]*w]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const d=h.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(d),b=o.getAtPointOrZero(new h.MercatorCoordinate(..._)),w=this._minimumHeightOverTerrain()*Math.cos(h.degToRad(this._maxPitch)),T=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*b;if(T<w){const M=this.locationCoordinate(this._center,this._centerAltitude),P=[M.x-_[0],M.y-_[1],M.z-_[2]],O=h.length(P);P[2]-=(w-T)/this._projectionScaler;const L=h.length(P);if(0===L)return;h.scale$2(P,P,O/L*this._projectionScaler),this._camera.position=[M.x-P[0],M.y-P[1],M.z*this._projectionScaler-P[2]],this._camera.orientation=Ja(P,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const B=this.center;return B.lat=h.clamp(B.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(B.lng=h.clamp(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const o=this._unmodified,{x:d,y:_}=this.point;let b=0,w=d,T=_;const M=this.width/2,P=this.height/2,O=this.worldMinY*this.scale,L=this.worldMaxY*this.scale;if(_-P<O&&(T=O+P),_+P>L&&(T=L-P),L-O<this.height&&(b=Math.max(b,this.height/(L-O)),T=(L+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,H=this.worldMaxX*this.scale,te=this.worldSize/2-(B+H)/2;w=(d+te+this.worldSize)%this.worldSize-te,w-M<B&&(w=B+M),w+M>H&&(w=H-M),H-B<this.width&&(b=Math.max(b,this.width/(H-B)),w=(H+B)/2)}w===d&&T===_||(this.center=this.unproject(new h.pointGeometry(w,T))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCameraAltitude(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this._fov/2,d=this.centerOffset,_=this.pixelsPerMeter;this._projectionScaler=_/(h.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(o)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?_:1),w=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);w[8]=2*-d.x/this.width,w[9]=2*d.y/this.height;let T=h.mul([],w,b);if(this.projection.isReprojectedInTileSpace){const xe=this.locationCoordinate(this.center),he=h.identity([]);h.translate(he,he,[xe.x*this.worldSize,xe.y*this.worldSize,0]),h.multiply$1(he,he,dc(this)),h.translate(he,he,[-xe.x*this.worldSize,-xe.y*this.worldSize,0]),h.multiply$1(T,T,he),this.inverseAdjustmentMatrix=function(Te){const Ue=dc(Te,!0);return Be([],[Ue[0],Ue[1],Ue[4],Ue[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=h.scale([],T,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=T,this.invProjMatrix=h.invert(new Float64Array(16),this.projMatrix);const M=new Float32Array(16);h.identity(M),h.scale(M,M,[1,-1,1]),h.rotateX(M,M,this._pitch),h.rotateZ(M,M,this.angle);const P=h.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),O=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;P[8]=2*-d.x/this.width,P[9]=2*(d.y+O)/this.height,this.skyboxMatrix=h.multiply$1(M,P,M);const L=this.point,B=L.x,H=L.y,te=this.width%2/2,X=this.height%2/2,G=Math.cos(this.angle),_e=Math.sin(this.angle),ae=B-Math.round(B)+G*te+_e*X,fe=H-Math.round(H)+G*X+_e*te,ye=new Float64Array(T);if(h.translate(ye,ye,[ae>.5?ae-1:ae,fe>.5?fe-1:fe,0]),this.alignedProjMatrix=ye,T=h.create(),h.scale(T,T,[this.width/2,-this.height/2,1]),h.translate(T,T,[1,-1,0]),this.labelPlaneMatrix=T,T=h.create(),h.scale(T,T,[1,-1,1]),h.translate(T,T,[-1,-1,0]),h.scale(T,T,[2/this.width,2/this.height,1]),this.glCoordMatrix=T,this.pixelMatrix=h.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},T=h.invert(new Float64Array(16),this.pixelMatrix),!T)throw new Error("failed to invert matrix");this.pixelMatrixInverse=T,this.globeMatrix="globe"===this.projection.name?h.calculateGlobeMatrix(this):T,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSize,d=this.cameraPixelsPerMeter,_=this._camera.position,b=1/this.height,w=[o,o,d];h.scale$2(w,w,b),h.scale$2(_,_,-1),h.multiply$2(_,_,w);const T=h.create();h.translate(T,T,_),h.scale(T,T,w),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,d,b)}_computeCameraPosition(o){const d=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),b=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-o/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-_[0]*w,b.y/this.worldSize-_[1]*w,o/this.worldSize*this._centerAltitude-_[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=o[2];let b=1;_>0&&(b=Math.min((d-this._camera.position[2])/_,1)),this._camera.position=h.scaleAndAdd([],this._camera.position,o,b),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const o=this._camera.position,d=this._camera.forward(),{pitch:_,bearing:b}=this._camera.getPitchBearing(),w=h.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(h.degToRad(this._maxPitch)),M=Math.max((o[2]-w)/Math.cos(_),T),P=this._zoomFromMercatorZ(M);h.scaleAndAdd(o,o,d,M),this._pitch=h.clamp(_,h.degToRad(this.minPitch),h.degToRad(this.maxPitch)),this.angle=h.wrap(b,-Math.PI,Math.PI),this._setZoom(h.clamp(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new h.MercatorCoordinate(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(h.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(o,d){const _=Math.min(o.x,d.x),b=Math.max(o.x,d.x),w=Math.min(o.y,d.y),T=Math.max(o.y,d.y);if(w<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const M=[new h.pointGeometry(_,w),new h.pointGeometry(b,T),new h.pointGeometry(_,T),new h.pointGeometry(b,w)],P=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const L of M){const B=this.pointRayIntersection(L);if(B.t<0)return!0;const H=this.rayIntersectionCoordinate(B);if(H.x<P||H.y<0||H.x>O||H.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+h.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new h.pointGeometry(0,0),new h.pointGeometry(this.width,this.height))}zoomDeltaToMovement(o,d){const _=h.length(h.sub([],this._camera.position,o)),b=this._zoomFromMercatorZ(_)+d;return _-this._mercatorZfromZoom(b)}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.pointGeometry(0,o))}}function uu(m,o){let d=!1,_=null;const b=()=>{_=null,d&&(m(),_=setTimeout(b,o),d=!1)};return()=>(d=!0,_||b(),_)}class hu{constructor(o){this._hashName=o&&encodeURIComponent(o),h.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=uu(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,h.window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),h.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(o){const d=this._map;if(!d)return"";const _=d.getCenter(),b=Math.round(100*d.getZoom())/100,w=Math.ceil((b*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,w),M=Math.round(_.lng*T)/T,P=Math.round(_.lat*T)/T,O=d.getBearing(),L=d.getPitch();let B="";if(B+=o?`/${M}/${P}/${b}`:`${b}/${P}/${M}`,(O||L)&&(B+="/"+Math.round(10*O)/10),L&&(B+=`/${Math.round(L)}`),this._hashName){const H=this._hashName;let te=!1;const X=h.window.location.hash.slice(1).split("&").map(G=>{const _e=G.split("=")[0];return _e===H?(te=!0,`${_e}=${B}`):G}).filter(G=>G);return te||X.push(`${H}=${B}`),`#${X.join("&")}`}return`#${B}`}_getCurrentHash(){const o=h.window.location.hash.replace("#","");if(this._hashName){let d;return o.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(d=_)}),(d&&d[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(_=>isNaN(_))){const _=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(d[3]||0):o.getBearing();return o.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:_,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=h.window.location.href.replace(/(#.+)?$/,this.getHashString());h.window.history.replaceState(h.window.history.state,null,o)}}const En={linearity:.3,easing:h.bezier(0,0,.3,1)},ep=h.extend({deceleration:2500,maxSpeed:1400},En),Ad=h.extend({deceleration:20,maxSpeed:1400},En),Pd=h.extend({deceleration:1e3,maxSpeed:360},En),kd=h.extend({deceleration:1e3,maxSpeed:90},En);class ah{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:h.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,d=h.exported.now();for(;o.length>0&&d-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new h.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)d.zoom+=w.zoomDelta||0,d.bearing+=w.bearingDelta||0,d.pitch+=w.pitchDelta||0,w.panDelta&&d.pan._add(w.panDelta),w.around&&(d.around=w.around),w.pinchAround&&(d.pinchAround=w.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(d.pan.mag()){const w=Ti(d.pan.mag(),_,h.extend({},ep,o||{}));b.offset=d.pan.mult(w.amount/d.pan.mag()),b.center=this._map.transform.center,pc(b,w)}if(d.zoom){const w=Ti(d.zoom,_,Ad);b.zoom=this._map.transform.zoom+w.amount,pc(b,w)}if(d.bearing){const w=Ti(d.bearing,_,Pd);b.bearing=this._map.transform.bearing+h.clamp(w.amount,-179,179),pc(b,w)}if(d.pitch){const w=Ti(d.pitch,_,kd);b.pitch=this._map.transform.pitch+w.amount,pc(b,w)}if(b.zoom||b.bearing){const w=void 0===d.pinchAround?d.around:d.pinchAround;b.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function pc(m,o){(!m.duration||m.duration<o.duration)&&(m.duration=o.duration,m.easing=o.easing)}function Ti(m,o,d){const{maxSpeed:_,linearity:b,deceleration:w}=d,T=h.clamp(m*b/(o/1e3),-_,_),M=Math.abs(T)/(w*b);return{easing:d.easing,duration:1e3*M,amount:T*(M/2)}}class pt extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,_,b={}){const w=Ae(d.getCanvasContainer(),_),T=d.unproject(w);super(o,h.extend({point:w,lngLat:T,originalEvent:_},b)),this._defaultPrevented=!1,this.target=d}}class or extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,_){const b="touchend"===o?_.changedTouches:_.touches,w=J(d.getCanvasContainer(),b),T=w.map(P=>d.unproject(P)),M=w.reduce((P,O,L,B)=>P.add(O.div(B.length)),new h.pointGeometry(0,0));super(o,{points:w,point:M,lngLats:T,lngLat:d.unproject(M),originalEvent:_}),this._defaultPrevented=!1}}class tp extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,_){super(o,{originalEvent:_}),this._defaultPrevented=!1}}class Di{constructor(o,d){this._map=o,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new tp(o.type,this._map,o))}mousedown(o,d){return this._mousedownPos=d,this._firePreventable(new pt(o.type,this._map,o))}mouseup(o){this._map.fire(new pt(o.type,this._map,o))}preclick(o){const d=h.extend({},o);d.type="preclick",this._map.fire(new pt(d.type,this._map,d))}click(o,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(o),this._map.fire(new pt(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new pt(o.type,this._map,o))}mouseover(o){this._map.fire(new pt(o.type,this._map,o))}mouseout(o){this._map.fire(new pt(o.type,this._map,o))}touchstart(o){return this._firePreventable(new or(o.type,this._map,o))}touchmove(o){this._map.fire(new or(o.type,this._map,o))}touchend(o){this._map.fire(new or(o.type,this._map,o))}touchcancel(o){this._map.fire(new or(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class js{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new pt(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new pt("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new pt(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ol{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,d){this.isEnabled()&&o.shiftKey&&0===o.button&&(Ce(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(o,d){if(!this._active)return;const _=d;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const b=this._startPos;this._lastPos=_,this._box||(this._box=K("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const w=Math.min(b.x,_.x),T=Math.max(b.x,_.x),M=Math.min(b.y,_.y),P=Math.max(b.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${M}px)`,this._box.style.width=T-w+"px",this._box.style.height=P-M+"px")})}mouseupWindow(o,d){if(!this._active||0!==o.button)return;const _=this._startPos,b=d;if(this.reset(),Ee(),_.x!==b.x||_.y!==b.y)return this._map.fire(new h.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:w=>w.fitScreenCoordinates(_,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&27===o.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ze(),delete this._startPos,delete this._lastPos}_fireEvent(o,d){return this._map.fire(new h.Event(o,{originalEvent:d}))}}function Gi(m,o){const d={};for(let _=0;_<m.length;_++)d[m[_].identifier]=o[_];return d}class Qo{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,d,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=o.timeStamp),_.length===this.numTouches&&(this.centroid=function(b){const w=new h.pointGeometry(0,0);for(const T of b)w._add(T);return w.div(b.length)}(d),this.touches=Gi(_,d)))}touchmove(o,d,_){if(this.aborted||!this.centroid)return;const b=Gi(_,d);for(const w in this.touches){const T=this.touches[w],M=b[w];(!M||M.dist(T)>30)&&(this.aborted=!0)}}touchend(o,d,_){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class ia{constructor(o){this.singleTap=new Qo(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,d,_){this.singleTap.touchstart(o,d,_)}touchmove(o,d,_){this.singleTap.touchmove(o,d,_)}touchend(o,d,_){const b=this.singleTap.touchend(o,d,_);if(b){const w=o.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(b)<30;if(w&&T||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class $t{constructor(){this._zoomIn=new ia({numTouches:1,numTaps:2}),this._zoomOut=new ia({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,d,_){this._zoomIn.touchstart(o,d,_),this._zoomOut.touchstart(o,d,_)}touchmove(o,d,_){this._zoomIn.touchmove(o,d,_),this._zoomOut.touchmove(o,d,_)}touchend(o,d,_){const b=this._zoomIn.touchend(o,d,_),w=this._zoomOut.touchend(o,d,_);return b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(b)},{originalEvent:o})}):w?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(w)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Rd={0:1,2:2};class Qa{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,d){return!1}_move(o,d){return{}}mousedown(o,d){if(this._lastPoint)return;const _=re(o);this._correctButton(o,_)&&(this._lastPoint=d,this._eventButton=_)}mousemoveWindow(o,d){const _=this._lastPoint;if(_)if(o.preventDefault(),null!=this._eventButton&&function(b,w){const T=Rd[w];return void 0===b.buttons||(b.buttons&T)!==T}(o,this._eventButton))this.reset();else if(this._moved||!(d.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(_,d)}mouseupWindow(o){this._lastPoint&&re(o)===this._eventButton&&(this._moved&&Ee(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ma extends Qa{mousedown(o,d){super.mousedown(o,d),this._lastPoint&&(this._active=!0)}_correctButton(o,d){return 0===d&&!o.ctrlKey}_move(o,d){return{around:d,panDelta:d.sub(o)}}}class vi extends Qa{_correctButton(o,d){return 0===d&&o.ctrlKey||2===d}_move(o,d){const _=.8*(d.x-o.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(o){o.preventDefault()}}class _s extends Qa{_correctButton(o,d){return 0===d&&o.ctrlKey||2===d}_move(o,d){const _=-.5*(d.y-o.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(o){o.preventDefault()}}class lh{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),h.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new h.pointGeometry(0,0)}touchstart(o,d,_){return this._calculateTransform(o,d,_)}touchmove(o,d,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.preventDefault(),this._calculateTransform(o,d,_)}}touchend(o,d,_){this._calculateTransform(o,d,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,d,_){_.length>0&&(this._active=!0);const b=Gi(_,d),w=new h.pointGeometry(0,0),T=new h.pointGeometry(0,0);let M=0;for(const O in b){const L=b[O],B=this._touches[O];B&&(w._add(L),T._add(L.sub(B)),M++,b[O]=L)}if(this._touches=b,M<this._minTouches||!T.mag())return;const P=T.div(M);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(M),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=K("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class oa{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,d,_){return{}}touchstart(o,d,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([d[0],d[1]]))}touchmove(o,d,_){const b=this._firstTwoTouches;if(!b)return;o.preventDefault();const[w,T]=b,M=No(_,d,w),P=No(_,d,T);if(!M||!P)return;const O=this._aroundCenter?null:M.add(P).div(2);return this._move([M,P],O,o)}touchend(o,d,_){if(!this._firstTwoTouches)return;const[b,w]=this._firstTwoTouches,T=No(_,d,b),M=No(_,d,w);T&&M||(this._active&&Ee(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function No(m,o,d){for(let _=0;_<m.length;_++)if(m[_].identifier===d)return o[_]}function ch(m,o){return Math.log(m/o)/Math.LN2}class uh extends oa{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,d){const _=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(ch(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ch(this._distance,_),pinchAround:d}}}function hh(m,o){return 180*m.angleWith(o)/Math.PI}class du extends oa{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,d){const _=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:hh(this._vector,_),pinchAround:d}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const d=25/(Math.PI*this._minDiameter)*360,_=hh(o,this._startVector);return Math.abs(_)<d}}function el(m){return Math.abs(m.y)>Math.abs(m.x)}class Ll extends oa{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,el(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,d,_){const b=this._lastPoints;if(!b)return;const w=o[0].sub(b[0]),T=o[1].sub(b[1]);return this._map._cooperativeGestures&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(w,T,_.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(w.y+T.y)/2*-.5})}gestureBeginsVertically(o,d,_){if(void 0!==this._valid)return this._valid;const b=o.mag()>=2,w=d.mag()>=2;if(!b&&!w)return;if(!b||!w)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const T=o.y>0==d.y>0;return el(o)&&el(d)&&T}}const dh={panStep:100,bearingStep:15,pitchStep:10};class fu{constructor(){const o=dh;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let d=0,_=0,b=0,w=0,T=0;switch(o.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:o.shiftKey?_=-1:(o.preventDefault(),w=-1);break;case 39:o.shiftKey?_=1:(o.preventDefault(),w=1);break;case 38:o.shiftKey?b=1:(o.preventDefault(),T=-1);break;case 40:o.shiftKey?b=-1:(o.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(_=0,b=0),{cameraAnimation:M=>{const P=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:Od,zoom:d?Math.round(P)+d*(o.shiftKey?2:1):P,bearing:M.getBearing()+_*this._bearingStep,pitch:M.getPitch()+b*this._pitchStep,offset:[-w*this._panStep,-T*this._panStep],center:M.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Od(m){return m*(2-m)}const pu=4.000244140625;class mc{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,h.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=o.deltaMode===h.window.WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const _=h.exported.now(),b=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==d&&d%pu==0?this._type="wheel":0!==d&&Math.abs(d)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(b*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),o.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=o,this._delta-=d,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=Ae(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform,d=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(0!==this._delta){const P="wheel"===this._type&&Math.abs(this._delta)>pu?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&0!==O&&(O=1/O);const L=d(),B=Math.pow(2,L),H="number"==typeof this._targetZoom?o.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(H*O))),"wheel"===this._type&&(this._startZoom=d(),this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:d(),b=this._startZoom,w=this._easing;let T,M=!1;if("wheel"===this._type&&b&&w){const P=Math.min((h.exported.now()-this._lastWheelEventTime)/200,1),O=w(P);T=h.number(b,_,O),P<1?this._frameId||(this._frameId=!0):M=!0}else T=_,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:T-d(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let d=h.ease;if(this._prevEase){const _=this._prevEase,b=(h.exported.now()-_.start)/_.duration,w=_.easing(b+.01)-_.easing(b),T=.27/Math.sqrt(w*w+1e-4)*.01,M=Math.sqrt(.0729-T*T);d=h.bezier(T,M,.25,1)}return this._prevEase={start:h.exported.now(),duration:o,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=K("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(h.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!h.window.document.fullscreenElement||!!h.window.document.webkitFullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class fh{constructor(o,d){this._clickZoom=o,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ph{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,d){return o.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(o.shiftKey?-1:1),around:_.unproject(d)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mu{constructor(){this._tap=new ia({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,d,_){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=d[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(o,d,_))}touchmove(o,d,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const b=d[0],w=b.y-this._swipePoint.y;return this._swipePoint=b,o.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(o,d,_)}touchend(o,d,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(o,d,_)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mh{constructor(o,d,_){this._el=o,this._mousePan=d,this._touchPan=_}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class gc{constructor(o,d,_){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=d,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ld{constructor(o,d,_,b){this._el=o,this._touchZoom=d,this._touchRotate=_,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const _c=m=>m.zoom||m.drag||m.pitch||m.rotate;class Hi extends h.Event{}class sa{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,d){const _=h.sub([],d,o);this.radius=h.length(_[2]<0?h.div([],_,this.constants):[_[0],_[1],0])}projectRay(o){h.div(o,o,this.constants),h.normalize(o,o),h.mul$1(o,o,this.constants);const d=h.scale$2([],o,this.radius);if(d[2]>0){const _=h.scale$2([],[0,0,1],h.dot(d,[0,0,1])),b=h.scale$2([],h.normalize([],[d[0],d[1],0]),this.radius),w=h.add([],d,h.scale$2([],h.sub([],h.add([],b,_),d),2));d[0]=w[0],d[1]=w[1]}return d}}function $r(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Fd{constructor(o,d){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ah(o),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new sa,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),h.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[h.window.document,"mousemove",{capture:!0}],[h.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[h.window,"blur",void 0]];for(const[b,w,T]of this._listeners)b.addEventListener(w,b===h.window.document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[o,d,_]of this._listeners)o.removeEventListener(d,o===h.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(o){const d=this._map,_=d.getCanvasContainer();this._add("mapEvent",new Di(d,o));const b=d.boxZoom=new Ol(d,o);this._add("boxZoom",b);const w=new $t,T=new ph;d.doubleClickZoom=new fh(T,w),this._add("tapZoom",w),this._add("clickZoom",T);const M=new mu;this._add("tapDragZoom",M);const P=d.touchPitch=new Ll(d);this._add("touchPitch",P);const O=new vi(o),L=new _s(o);d.dragRotate=new gc(o,O,L),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const B=new Ma(o),H=new lh(d,o);d.dragPan=new mh(_,B,H),this._add("mousePan",B),this._add("touchPan",H,["touchZoom","touchRotate"]);const te=new du,X=new uh;d.touchZoomRotate=new Ld(_,X,te,M),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),this._add("blockableMapEvent",new js(d));const G=d.scrollZoom=new mc(d,this);this._add("scrollZoom",G,["mousePan"]);const _e=d.keyboard=new fu;this._add("keyboard",_e);for(const ae of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[ae]&&d[ae].enable(o[ae])}_add(o,d,_){this._handlers.push({handlerName:o,handler:d,allowed:_}),this._handlersById[o]=d}stop(o){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!_c(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,d,_){for(const b in o)if(b!==_&&(!d||d.indexOf(b)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const d=[];for(const _ of o)this._el.contains(_.target)&&d.push(_);return d}handleEvent(o,d){this._updatingCamera=!0;const _="renderFrame"===o.type,b=_?void 0:o,w={needsRenderFrame:!1},T={},M={},P=o.touches?this._getMapTouches(o.touches):void 0,O=P?J(this._el,P):_?void 0:Ae(this._el,o);for(const{handlerName:H,handler:te,allowed:X}of this._handlers){if(!te.isEnabled())continue;let G;this._blockedByActive(M,X,H)?te.reset():te[d||o.type]&&(G=te[d||o.type](o,O,P),this.mergeHandlerResult(w,T,G,H,b),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||te.isActive())&&(M[H]=te)}const L={};for(const H in this._previousActiveHandlers)M[H]||(L[H]=b);this._previousActiveHandlers=M,(Object.keys(L).length||$r(w))&&(this._changes.push([w,T,L]),this._triggerRenderFrame()),(Object.keys(M).length||$r(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=w;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(o,d,_,b,w){if(!_)return;h.extend(o,_);const T={handlerName:b,originalEvent:_.originalEvent||w};void 0!==_.zoomDelta&&(d.zoom=T),void 0!==_.panDelta&&(d.drag=T),void 0!==_.pitchDelta&&(d.pitch=T),void 0!==_.bearingDelta&&(d.rotate=T)}_applyChanges(){const o={},d={},_={};for(const[b,w,T]of this._changes)b.panDelta&&(o.panDelta=(o.panDelta||new h.pointGeometry(0,0))._add(b.panDelta)),b.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+b.pitchDelta),void 0!==b.around&&(o.around=b.around),void 0!==b.aroundCoord&&(o.aroundCoord=b.aroundCoord),void 0!==b.pinchAround&&(o.pinchAround=b.pinchAround),b.noInertia&&(o.noInertia=b.noInertia),h.extend(d,w),h.extend(_,T);this._updateMapTransform(o,d,_),this._changes=[]}_updateMapTransform(o,d,_){const b=this._map,w=b.transform,T=fe=>[fe.x,fe.y,fe.z];if((fe=>{const ye=this._eventsInProgress.drag;return ye&&!this._handlersById[ye.handlerName].isActive()})()&&!$r(o)){const fe=w.zoom;w.cameraElevationReference="sea",w.recenterOnTerrain(),w.cameraElevationReference="ground",fe!==w.zoom&&this._map._update(!0)}if(!$r(o))return void this._fireEvents(d,_,!0);let{panDelta:M,zoomDelta:P,bearingDelta:O,pitchDelta:L,around:B,aroundCoord:H,pinchAround:te}=o;void 0!==te&&(B=te),(fe=>d.drag&&!this._eventsInProgress.drag)()&&B&&(this._dragOrigin=T(w.pointCoordinate3D(B)),this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",b._stop(!0),B=B||b.transform.centerPoint,O&&(w.bearing+=O),L&&(w.pitch+=L),w._updateCameraState();const X=[0,0,0];if(M){const fe=w.pointCoordinate(B);if("globe"===w.projection.name){const ye=h.latFromMercatorY(fe.y),xe=w.center.lat,he=Math.min(h.mercatorZfromAltitude(1,ye)/h.mercatorZfromAltitude(1,xe),2);M=M.rotate(-w.angle),X[0]=-M.x/w.worldSize*he,X[1]=-M.y/w.worldSize*he}else{const ye=w.pointCoordinate(B.sub(M));fe&&ye&&(X[0]=ye.x-fe.x,X[1]=ye.y-fe.y)}}const G=w.zoom,_e=[0,0,0];if(P){const fe=T(H||w.pointCoordinate3D(B)),ye={dir:h.normalize([],h.sub([],fe,w._camera.position))};if(ye.dir[2]<0){const xe=w.zoomDeltaToMovement(fe,P);h.scale$2(_e,ye.dir,xe)}}const ae=h.add(X,X,_e);w._translateCameraConstrained(ae),P&&Math.abs(w.zoom-G)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(d,_,!0)}_fireEvents(o,d,_){const b=_c(this._eventsInProgress),w=_c(o),T={};for(const L in o){const{originalEvent:B}=o[L];this._eventsInProgress[L]||(T[`${L}start`]=B),this._eventsInProgress[L]=o[L]}!b&&w&&this._fireEvent("movestart",w.originalEvent);for(const L in T)this._fireEvent(L,T[L]);w&&this._fireEvent("move",w.originalEvent);for(const L in o){const{originalEvent:B}=o[L];this._fireEvent(L,B)}const M={};let P;for(const L in this._eventsInProgress){const{handlerName:B,originalEvent:H}=this._eventsInProgress[L];this._handlersById[B].isActive()||(delete this._eventsInProgress[L],P=d[B]||H,M[`${L}end`]=P)}for(const L in M)this._fireEvent(L,M[L]);const O=_c(this._eventsInProgress);if(_&&(b||w)&&!O){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=H=>0!==H&&-this._bearingSnap<H&&H<this._bearingSnap;L?(B(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:P})):(this._map.fire(new h.Event("moveend",{originalEvent:P})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,d){this._map.fire(new h.Event(o,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new Hi("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const gu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class gh extends h.Evented{constructor(o,d){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=d.bearingSnap,h.bindAll(["_renderFrameCallback"],this)}getCenter(){return new h.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,d){return this.jumpTo({center:o},d)}panBy(o,d,_){return o=h.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,h.extend({offset:o},d),_)}panTo(o,d,_){return this.easeTo(h.extend({center:o},d),_)}getZoom(){return this.transform.zoom}setZoom(o,d){return this.jumpTo({zoom:o},d),this}zoomTo(o,d,_){return this.easeTo(h.extend({zoom:o},d),_)}zoomIn(o,d){return this.zoomTo(this.getZoom()+1,o,d),this}zoomOut(o,d){return this.zoomTo(this.getZoom()-1,o,d),this}getBearing(){return this.transform.bearing}setBearing(o,d){return this.jumpTo({bearing:o},d),this}getPadding(){return this.transform.padding}setPadding(o,d){return this.jumpTo({padding:o},d),this}rotateTo(o,d,_){return this.easeTo(h.extend({bearing:o},d),_)}resetNorth(o,d){return this.rotateTo(0,h.extend({duration:1e3},o),d),this}resetNorthPitch(o,d){return this.easeTo(h.extend({bearing:0,pitch:0,duration:1e3},o),d),this}snapToNorth(o,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,d):this}getPitch(){return this.transform.pitch}setPitch(o,d){return this.jumpTo({pitch:o},d),this}cameraForBounds(o,d){o=h.LngLatBounds.convert(o);const _=d&&d.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),_,d)}_extendCameraOptions(o){const d={top:0,bottom:0,right:0,left:0};if("number"==typeof(o=h.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding){const _=o.padding;o.padding={top:_,bottom:_,right:_,left:_}}return o.padding=h.extend(d,o.padding),o}_cameraForBoxAndBearing(o,d,_,b){const w=this._extendCameraOptions(b),T=this.transform,M=T.padding,P=T.project(h.LngLat.convert(o)),O=T.project(h.LngLat.convert(d)),L=new h.pointGeometry(P.x,O.y),B=new h.pointGeometry(O.x,P.y),H=-h.degToRad(_),te=P.rotate(H),X=O.rotate(H),G=L.rotate(H),_e=B.rotate(H),ae=new h.pointGeometry(Math.max(te.x,X.x,G.x,_e.x),Math.max(te.y,X.y,G.y,_e.y)),fe=new h.pointGeometry(Math.min(te.x,X.x,G.x,_e.x),Math.min(te.y,X.y,G.y,_e.y)),ye=ae.sub(fe),xe=(T.width-((M.left||0)+(M.right||0)+w.padding.left+w.padding.right))/ye.x,he=(T.height-((M.top||0)+(M.bottom||0)+w.padding.top+w.padding.bottom))/ye.y;if(he<0||xe<0)return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Te=Math.min(T.scaleZoom(T.scale*Math.min(xe,he)),w.maxZoom),Ue="number"==typeof w.offset.x&&"number"==typeof w.offset.y?new h.pointGeometry(w.offset.x,w.offset.y):h.pointGeometry.convert(w.offset),We=new h.pointGeometry((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(_*Math.PI/180),et=Ue.add(We).mult(T.scale/T.zoomScale(Te));return{center:T.unproject(P.add(O).div(2).sub(et)),zoom:Te,bearing:_}}_cameraForBox(o,d,_,b,w){const T=this._extendCameraOptions(w);_=_||0,b=b||0,o=h.LngLat.convert(o),d=h.LngLat.convert(d);const M=this.transform.clone();M.padding=T.padding;const P=this.getFreeCameraOptions(),O=new h.LngLat(.5*(o.lng+d.lng),.5*(o.lat+d.lat)),L=.5*(_+b);if(M._camera.position[2]<h.mercatorZfromAltitude(L,O.lat))return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");P.lookAtPoint(O),M.setFreeCameraOptions(P);const B=h.MercatorCoordinate.fromLngLat(o),H=h.MercatorCoordinate.fromLngLat(d),te=M.pointRayIntersection(M.centerPoint,L),X=[(G=M.rayIntersectionCoordinate(te)).x,G.y,G.z];var G;const _e=M.screenPointToMercatorRay(M.centerPoint),ae="globe"!==M.projection.name;let fe,ye=0;do{const xe=Math.floor(M.zoom),he=1<<xe,Te=Math.min(he*B.x,he*H.x),Ue=Math.min(he*B.y,he*H.y),We=Math.max(he*B.x,he*H.x),et=Math.max(he*B.y,he*H.y),Je=new h.Aabb([Te,Ue,_],[We,et,b]),Dt=h.Frustum.fromInvProjectionMatrix(M.invProjMatrix,M.worldSize,xe,ae);if(2!==Je.intersects(Dt)){fe&&(M._camera.position=h.scaleAndAdd([],M._camera.position,_e.dir,-fe),M._updateStateFromCamera());break}const Ve=h.sub([],M._camera.position,X);fe=.5*h.length(Ve),M._camera.position=h.scaleAndAdd([],M._camera.position,_e.dir,fe);try{M._updateStateFromCamera()}catch(vt){return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ye<10);return{center:M.center,zoom:M.zoom,bearing:M.bearing,pitch:M.pitch}}fitBounds(o,d,_){return this._fitInternal(this.cameraForBounds(o,d),d,_)}_raycastElevationBox(o,d){const _=this.transform.elevation;if(!_)return;const b=new h.pointGeometry(o.x,d.y),w=new h.pointGeometry(d.x,o.y),T=_.pointCoordinate(o);if(!T)return;const M=_.pointCoordinate(d);if(!M)return;const P=_.pointCoordinate(b);if(!P)return;const O=_.pointCoordinate(w);if(!O)return;const L=new h.MercatorCoordinate(T[0],T[1]).toLngLat(),B=new h.MercatorCoordinate(M[0],M[1]).toLngLat(),H=new h.MercatorCoordinate(P[0],P[1]).toLngLat(),te=new h.MercatorCoordinate(O[0],O[1]).toLngLat(),X=Math.min(L.lng,Math.min(B.lng,Math.min(H.lng,te.lng))),G=Math.min(L.lat,Math.min(B.lat,Math.min(H.lat,te.lat))),_e=Math.max(L.lng,Math.max(B.lng,Math.max(H.lng,te.lng))),ae=Math.max(L.lat,Math.max(B.lat,Math.max(H.lat,te.lat))),fe=Math.min(T[3],Math.min(M[3],Math.min(P[3],O[3]))),ye=Math.max(T[3],Math.max(M[3],Math.max(P[3],O[3])));return{minLngLat:new h.LngLat(X,G),maxLngLat:new h.LngLat(_e,ae),minAltitude:fe,maxAltitude:ye}}fitScreenCoordinates(o,d,_,b,w){let T,M,P,O;const L=h.pointGeometry.convert(o),B=h.pointGeometry.convert(d),H=this._raycastElevationBox(L,B);if(H)T=H.minLngLat,M=H.maxLngLat,P=H.minAltitude,O=H.maxAltitude;else{if(this.transform.anyCornerOffEdge(L,B))return this;T=this.transform.pointLocation(L),M=this.transform.pointLocation(B)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(h.pointGeometry.convert(o)),this.transform.pointLocation(h.pointGeometry.convert(d)),_,b):this._cameraForBox(T,M,P,O,b),b,w)}_fitInternal(o,d,_){return o?(delete(d=h.extend(o,d)).padding,d.linear?this.easeTo(d,_):this.flyTo(d,_)):this}jumpTo(o,d){this.stop();const _=o.preloadOnly?this.transform.clone():this.transform;let b=!1,w=!1,T=!1;return"zoom"in o&&_.zoom!==+o.zoom&&(b=!0,_.zoom=+o.zoom),void 0!==o.center&&(_.center=h.LngLat.convert(o.center)),"bearing"in o&&_.bearing!==+o.bearing&&(w=!0,_.bearing=+o.bearing),"pitch"in o&&_.pitch!==+o.pitch&&(T=!0,_.pitch=+o.pitch),null==o.padding||_.isPaddingEqual(o.padding)||(_.padding=o.padding),o.preloadOnly?(this._preloadTiles(_),this):(this.fire(new h.Event("movestart",d)).fire(new h.Event("move",d)),b&&this.fire(new h.Event("zoomstart",d)).fire(new h.Event("zoom",d)).fire(new h.Event("zoomend",d)),w&&this.fire(new h.Event("rotatestart",d)).fire(new h.Event("rotate",d)).fire(new h.Event("rotateend",d)),T&&this.fire(new h.Event("pitchstart",d)).fire(new h.Event("pitch",d)).fire(new h.Event("pitchend",d)),this.fire(new h.Event("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||h.warnOnce(gu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,d){const _=this.transform;if(!_.projection.supportsFreeCamera)return h.warnOnce(gu),this;this.stop();const b=_.zoom,w=_.pitch,T=_.bearing;_.setFreeCameraOptions(o);const M=b!==_.zoom,P=w!==_.pitch,O=T!==_.bearing;return this.fire(new h.Event("movestart",d)).fire(new h.Event("move",d)),M&&this.fire(new h.Event("zoomstart",d)).fire(new h.Event("zoom",d)).fire(new h.Event("zoomend",d)),O&&this.fire(new h.Event("rotatestart",d)).fire(new h.Event("rotate",d)).fire(new h.Event("rotateend",d)),P&&this.fire(new h.Event("pitchstart",d)).fire(new h.Event("pitch",d)).fire(new h.Event("pitchend",d)),this.fire(new h.Event("moveend",d)),this}easeTo(o,d){this._stop(!1,o.easeId),(!1===(o=h.extend({offset:[0,0],duration:500,easing:h.ease},o)).animate||!o.essential&&h.exported.prefersReducedMotion)&&(o.duration=0);const _=this.transform,b=this.getZoom(),w=this.getBearing(),T=this.getPitch(),M=this.getPadding(),P="zoom"in o?+o.zoom:b,O="bearing"in o?this._normalizeBearing(o.bearing,w):w,L="pitch"in o?+o.pitch:T,B="padding"in o?o.padding:_.padding,H=h.pointGeometry.convert(o.offset);let te,X,G;if("globe"===_.projection.name){const et=h.MercatorCoordinate.fromLngLat(_.center),Je=H.rotate(-_.angle);et.x+=Je.x/_.worldSize,et.y+=Je.y/_.worldSize;const Dt=et.toLngLat(),Ve=h.LngLat.convert(o.center||Dt);this._normalizeCenter(Ve),te=_.centerPoint.add(Je),X=new h.pointGeometry(et.x,et.y).mult(_.worldSize),G=new h.pointGeometry(h.mercatorXfromLng(Ve.lng),h.mercatorYfromLat(Ve.lat)).mult(_.worldSize).sub(X)}else{te=_.centerPoint.add(H);const et=_.pointLocation(te),Je=h.LngLat.convert(o.center||et);this._normalizeCenter(Je),X=_.project(et),G=_.project(Je).sub(X)}const _e=_.zoomScale(P-b);let ae,fe;o.around&&(ae=h.LngLat.convert(o.around),fe=_.locationPoint(ae));const ye=this._zooming||P!==b,xe=this._rotating||w!==O,he=this._pitching||L!==T,Te=!_.isPaddingEqual(B),Ue=et=>Je=>{if(ye&&(et.zoom=h.number(b,P,Je)),xe&&(et.bearing=h.number(w,O,Je)),he&&(et.pitch=h.number(T,L,Je)),Te&&(et.interpolatePadding(M,B,Je),te=et.centerPoint.add(H)),ae)et.setLocationAtPoint(ae,fe);else{const Dt=et.zoomScale(et.zoom-b),Ve=P>b?Math.min(2,_e):Math.max(.5,_e),vt=Math.pow(Ve,1-Je),ht=et.unproject(X.add(G.mult(Je*vt)).mult(Dt));et.setLocationAtPoint(et.renderWorldCopies?ht.wrap():ht,te)}return o.preloadOnly||this._fireMoveEvents(d),et};if(o.preloadOnly){const et=this._emulate(Ue,o.duration,_);return this._preloadTiles(et),this}const We={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ye,this._rotating=xe,this._pitching=he,this._padding=Te,this._easeId=o.easeId,this._prepareEase(d,o.noMoveStart,We),this._ease(Ue(_),et=>{_.recenterOnTerrain(),this._afterEase(d,et)},o),this}_prepareEase(o,d,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",d||_.moving||this.fire(new h.Event("movestart",o)),this._zooming&&!_.zooming&&this.fire(new h.Event("zoomstart",o)),this._rotating&&!_.rotating&&this.fire(new h.Event("rotatestart",o)),this._pitching&&!_.pitching&&this.fire(new h.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new h.Event("move",o)),this._zooming&&this.fire(new h.Event("zoom",o)),this._rotating&&this.fire(new h.Event("rotate",o)),this._pitching&&this.fire(new h.Event("pitch",o))}_afterEase(o,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,b=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new h.Event("zoomend",o)),b&&this.fire(new h.Event("rotateend",o)),w&&this.fire(new h.Event("pitchend",o)),this.fire(new h.Event("moveend",o))}flyTo(o,d){if(!o.essential&&h.exported.prefersReducedMotion){const Ut=h.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ut,d)}this.stop(),o=h.extend({offset:[0,0],speed:1.2,curve:1.42,easing:h.ease},o);const _=this.transform,b=this.getZoom(),w=this.getBearing(),T=this.getPitch(),M=this.getPadding(),P="zoom"in o?h.clamp(+o.zoom,_.minZoom,_.maxZoom):b,O="bearing"in o?this._normalizeBearing(o.bearing,w):w,L="pitch"in o?+o.pitch:T,B="padding"in o?o.padding:_.padding,H=_.zoomScale(P-b),te=h.pointGeometry.convert(o.offset);let X=_.centerPoint.add(te);const G=_.pointLocation(X),_e=h.LngLat.convert(o.center||G);this._normalizeCenter(_e);const ae=_.project(G),fe=_.project(_e).sub(ae);let ye=o.curve;const xe=Math.max(_.width,_.height),he=xe/H,Te=fe.mag();if("minZoom"in o){const Ut=h.clamp(Math.min(o.minZoom,b,P),_.minZoom,_.maxZoom),Zt=xe/_.zoomScale(Ut-b);ye=Math.sqrt(Zt/Te*2)}const Ue=ye*ye;function We(Ut){const Zt=(he*he-xe*xe+(Ut?-1:1)*Ue*Ue*Te*Te)/(2*(Ut?he:xe)*Ue*Te);return Math.log(Math.sqrt(Zt*Zt+1)-Zt)}function et(Ut){return(Math.exp(Ut)-Math.exp(-Ut))/2}function Je(Ut){return(Math.exp(Ut)+Math.exp(-Ut))/2}const Dt=We(0);let Ve=function(Ut){return Je(Dt)/Je(Dt+ye*Ut)},vt=function(Ut){return xe*((Je(Dt)*(et(Zt=Dt+ye*Ut)/Je(Zt))-et(Dt))/Ue)/Te;var Zt},ht=(We(1)-Dt)/ye;if(Math.abs(Te)<1e-6||!isFinite(ht)){if(Math.abs(xe-he)<1e-6)return this.easeTo(o,d);const Ut=he<xe?-1:1;ht=Math.abs(Math.log(he/xe))/ye,vt=function(){return 0},Ve=function(Zt){return Math.exp(Ut*ye*Zt)}}o.duration="duration"in o?+o.duration:1e3*ht/("screenSpeed"in o?+o.screenSpeed/ye:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const qt=w!==O,Ke=L!==T,Jt=!_.isPaddingEqual(B),en=Ut=>Zt=>{const ln=Zt*ht,Tn=1/Ve(ln);Ut.zoom=1===Zt?P:b+Ut.scaleZoom(Tn),qt&&(Ut.bearing=h.number(w,O,Zt)),Ke&&(Ut.pitch=h.number(T,L,Zt)),Jt&&(Ut.interpolatePadding(M,B,Zt),X=Ut.centerPoint.add(te));const tn=1===Zt?_e:Ut.unproject(ae.add(fe.mult(vt(ln))).mult(Tn));return Ut.setLocationAtPoint(Ut.renderWorldCopies?tn.wrap():tn,X),Ut._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(d),Ut};if(o.preloadOnly){const Ut=this._emulate(en,o.duration,_);return this._preloadTiles(Ut),this}return this._zooming=!0,this._rotating=qt,this._pitching=Ke,this._padding=Jt,this._prepareEase(d,!1),this._ease(en(_),()=>this._afterEase(d),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,d)}if(!o){const _=this.handlers;_&&_.stop(!1)}return this}_ease(o,d,_){!1===_.animate||0===_.duration?(o(1),d()):(this._easeStart=h.exported.now(),this._easeOptions=_,this._onEaseFrame=o,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((h.exported.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,d){o=h.wrap(o,-180,180);const _=Math.abs(o-d);return Math.abs(o-360-d)<_&&(o-=360),Math.abs(o+360-d)<_&&(o+=360),o}_normalizeCenter(o){const d=this.transform;if(!d.renderWorldCopies||d.maxBounds)return;const _=o.lng-d.center.lng;o.lng+=_>180?-360:_<-180?360:0}_emulate(o,d,_){const b=Math.ceil(15*d/1e3),w=[],T=o(_.clone());for(let M=0;M<=b;M++){const P=T(M/b);w.push(P.clone())}return w}}class _u{constructor(o={}){this.options=o,h.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const d=this.options&&this.options.compact;return this._map=o,this._container=K("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=K("button","mapboxgl-ctrl-attrib-button",this._container),K("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=K("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===d&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,d){const _=this._map._getUIString(`AttributionControl.${d}`);o.setAttribute("aria-label",_),o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||h.config.ACCESS_TOKEN}];if(o){const _=d.reduce((b,w,T)=>(w.value&&(b+=`${w.key}=${w.value}${T<d.length-1?"&":""}`),b),"?");o.href=`${h.config.FEEDBACK_URL}/${_}${this._map._hash?this._map._hash.getHashString(!0):""}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||"metadata"!==o.sourceDataType&&"visibility"!==o.sourceDataType&&"style"!==o.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const d=this._map.style._sourceCaches;for(const b in d){const w=d[b];if(w.used){const T=w.getSource();T.attribution&&o.indexOf(T.attribution)<0&&o.push(T.attribution)}}o.sort((b,w)=>b.length-w.length),o=o.filter((b,w)=>{for(let T=w+1;T<o.length;T++)if(o[T].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const _=o.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,o.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Nd{constructor(){h.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=K("div","mapboxgl-ctrl");const d=K("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&"metadata"!==o.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(0===Object.entries(o).length)return!0;for(const d in o){const _=o[d].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const d=o[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class zd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const d=++this._id;return this._queue.push({callback:o,id:d,cancelled:!1}),d}remove(o){const d=this._currentlyRunning,_=d?this._queue.concat(d):this._queue;for(const b of _)if(b.id===o)return void(b.cancelled=!0)}run(o=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const _ of d)if(!_.cancelled&&(_.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function tl(m,o,d){if(m=new h.LngLat(m.lng,m.lat),o){const _=new h.LngLat(m.lng-360,m.lat),b=new h.LngLat(m.lng+360,m.lat),w=360*Math.ceil(Math.abs(m.lng-d.center.lng)/360),T=d.locationPoint(m).distSqr(o),M=o.x<0||o.y<0||o.x>d.width||o.y>d.height;d.locationPoint(_).distSqr(o)<T&&(M||Math.abs(_.lng-d.center.lng)<w)?m=_:d.locationPoint(b).distSqr(o)<T&&(M||Math.abs(b.lng-d.center.lng)<w)&&(m=b)}for(;Math.abs(m.lng-d.center.lng)>180;){const _=d.locationPoint(m);if(_.x>=0&&_.y>=0&&_.x<=d.width&&_.y<=d.height)break;m.lng>d.center.lng?m.lng-=360:m.lng+=360}return m}const nl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class rl extends h.Evented{constructor(o,d){if(super(),(o instanceof h.window.HTMLElement||d)&&(o=h.extend({element:o},d)),h.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&"auto"!==o.pitchAlignment?o.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),o&&o.element)this._element=o.element,this._offset=h.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=K("div");const b=41,w=27,T=W("svg",{display:"block",height:b*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${b}`},this._element),M=W("radialGradient",{id:"shadowGradient"},W("defs",{},T));W("stop",{offset:"10%","stop-opacity":.4},M),W("stop",{offset:"100%","stop-opacity":.05},M),W("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),W("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),W("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),W("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=h.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const _=this._element.classList;for(const b in nl)_.remove(`mapboxgl-marker-anchor-${b}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=h.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(24.6+b)],"bottom-right":[-b,-1*(24.6+b)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const d=o.code,_=o.charCode||o.keyCode;"Space"!==d&&"Enter"!==d&&32!==_&&13!==_||this.togglePopup()}_onMapClick(o){const d=o.originalEvent.target,_=this._element;this._popup&&(d===_||_.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const o=this._map;if(!o)return;const d=this._pos;if(!d||d.x<0||d.x>o.transform.width||d.y<0||d.y>o.transform.height)return void this._clearFadeTimer();const _=o.unproject(d);let b=!1;if(o.transform._terrainEnabled()&&o.getTerrain()){const T=o.getFreeCameraOptions();if(T.position){const M=T.position.toLngLat();b=M.distanceTo(_)<.9*M.distanceTo(this._lngLat)}}const w=(1-o._queryFogOpacity(_))*(b?.2:1);this._element.style.opacity=`${w}`,this._popup&&this._popup._setOpacity(`${w}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o)return;const d=this._offset.mult(this._scale),_=this._calculatePitch(),b=this._calculateRotation();this._element.style.transform=`\n            translate(${o.x}px, ${o.y}px) ${nl[this._anchor]}\n            rotateX(${_}deg) rotateZ(${b}deg)\n            translate(${d.x}px, ${d.y}px)\n        `}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:this._map&&"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:this._map&&"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(o){h.window.cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=tl(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat),!0===o?this._updateFrameId=h.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!d.getTerrain()&&!d.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=h.pointGeometry.convert(o),this._update(),this}_onMove(o){const d=this._map;if(d){if(!this._isDragging){const _=this._clickTolerance||d._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=d.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new h.Event("dragstart"))),this.fire(new h.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new h.Event("dragend")),this._state="inactive"}_addDragHandler(o){const d=this._map;d&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos),this._pointerdownPos=o.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const d=this._map;return d&&(o?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&"auto"!==o?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class _h{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const d=h.easeCubicInOut((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,d,_){this._start=this.getValue(d),this._end=o,this._startTime=d,this._endTime=d+_}}const Bd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},yh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function es(m){m.parentNode&&m.parentNode.removeChild(m)}const il={showCompass:!0,showZoom:!0,visualizePitch:!1};class vh{constructor(o,d,_=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new vi({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,_&&(this.mousePitch=new _s({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),h.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(o,d){this.mouseRotate.mousedown(o,d),this.mousePitch&&this.mousePitch.mousedown(o,d),Ce()}move(o,d){const _=this.map,b=this.mouseRotate.mousemoveWindow(o,d),w=b&&b.bearingDelta;if(w&&_.setBearing(_.getBearing()+w),this.mousePitch){const T=this.mousePitch.mousemoveWindow(o,d),M=T&&T.pitchDelta;M&&_.setPitch(_.getPitch()+M)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ze(),h.window.removeEventListener("mousemove",this.mousemove),h.window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(h.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),Ae(this.element,o)),h.window.addEventListener("mousemove",this.mousemove),h.window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,Ae(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){1!==o.targetTouches.length?this.reset():(this._startPos=this._lastPos=J(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){1!==o.targetTouches.length?this.reset():(this._lastPos=J(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){0===o.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Co={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let qi,ol=0,sl=!1;const xh={maxWidth:100,unit:"metric"};function bh(m,o,d){const _=d&&d.maxWidth||100,b=m._containerHeight/2,w=m._containerWidth/2-_/2,T=m.unproject([w,b]),M=m.unproject([w+_,b]),P=T.distanceTo(M);if(d&&"imperial"===d.unit){const O=3.2808*P;O>5280?yc(o,_,O/5280,m._getUIString("ScaleControl.Miles"),m):yc(o,_,O,m._getUIString("ScaleControl.Feet"),m)}else d&&"nautical"===d.unit?yc(o,_,P/1852,m._getUIString("ScaleControl.NauticalMiles"),m):P>=1e3?yc(o,_,P/1e3,m._getUIString("ScaleControl.Kilometers"),m):yc(o,_,P,m._getUIString("ScaleControl.Meters"),m)}function yc(m,o,d,_,b){const w=function(M){const P=Math.pow(10,`${Math.floor(M)}`.length-1);let O=M/P;return O=O>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:function(L){const B=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*B)/B}(O),P*O}(d),T=w/d;b._requestDomTask(()=>{m.style.width=o*T+"px",m.innerHTML=`${w}&nbsp;${_}`})}const fo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Rr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function al(m=new h.pointGeometry(0,0),o="bottom"){if("number"==typeof m){const d=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(o){case"top":return new h.pointGeometry(0,m);case"top-left":return new h.pointGeometry(d,d);case"top-right":return new h.pointGeometry(-d,d);case"bottom":return new h.pointGeometry(0,-m);case"bottom-left":return new h.pointGeometry(d,-d);case"bottom-right":return new h.pointGeometry(-d,-d);case"left":return new h.pointGeometry(m,0);case"right":return new h.pointGeometry(-m,0)}return new h.pointGeometry(0,0)}return m instanceof h.pointGeometry||Array.isArray(m)?h.pointGeometry.convert(m):h.pointGeometry.convert(m[o]||[0,0])}const aa={version:h.version,supported:U,setRTLTextPlugin:h.setRTLTextPlugin,getRTLTextPluginStatus:h.getRTLTextPluginStatus,Map:class extends gh{constructor(m){if(null!=(m=h.extend({},yh,m)).minZoom&&null!=m.maxZoom&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=m.minPitch&&null!=m.maxPitch&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=m.minPitch&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=m.maxPitch&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&h.isSafariWithAntialiasingBug(h.window)&&(m.antialias=!1,h.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new gs(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._optimizeForTerrain=m.optimizeForTerrain,this._renderTaskQueue=new zd,this._domRenderTaskQueue=new zd,this._controls=[],this._markers=[],this._mapId=h.uniqueId(),this._locale=h.extend({},Bd,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new _h(0),this._explicitProjection=null,this._requestManager=new h.RequestManager(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,"string"==typeof m.container){if(this._container=h.window.document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof h.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&h.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),h.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==h.window&&(h.window.addEventListener("online",this._onWindowOnline,!1),h.window.addEventListener("resize",this._onWindowResize,!1),h.window.addEventListener("orientationchange",this._onWindowResize,!1),h.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Fd(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this._hash=m.hash&&new hu("string"==typeof m.hash&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,h.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),m.attributionControl&&this.addControl(new _u({customAttribution:m.customAttribution})),this._logoControl=new Nd,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update("style"===o.dataType),this.fire(new h.Event(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new h.Event(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(m,o){if(void 0===o&&(o=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=m.onAdd(this);this._controls.push(m);const _=this._controlPositions[o];return-1!==o.indexOf("bottom")?_.insertBefore(d,_.firstChild):_.appendChild(d),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(m);return o>-1&&this._controls.splice(o,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new h.Event("movestart",m)).fire(new h.Event("move",m)),this.fire(new h.Event("resize",m)),o&&this.fire(new h.Event("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(h.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=null==m?-2:m)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new h.Event("zoomstart")).fire(new h.Event("zoom")).fire(new h.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=null==m?22:m)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new h.Event("zoomstart")).fire(new h.Event("zoom")).fire(new h.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=null==m?0:m)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new h.Event("pitchstart")).fire(new h.Event("pitch")).fire(new h.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=null==m?85:m)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new h.Event("pitchstart")).fire(new h.Event("pitch")).fire(new h.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}setProjection(m){return this._lazyInitEmptyStyle(),m?"string"==typeof m&&(m={name:m}):m=null,this._updateProjection(m)}_updateProjection(m){null===m&&(this._explicitProjection=null);const o=m||this.getProjection(),d=this.transform.setProjection(o);if(m&&(this._explicitProjection=this.transform.getProjection()),d){this.painter.clearBackgroundTiles();for(const _ in this.style._sourceCaches)this.style._sourceCaches[_].clearTiles();this.style.applyProjectionUpdate(),this._update(!0)}return this}project(m){return this.transform.locationPoint3D(h.LngLat.convert(m))}unproject(m){return this.transform.pointLocation3D(h.pointGeometry.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(m,o,d){if("mouseenter"===m||"mouseover"===m){let _=!1;const b=T=>{const M=o.filter(O=>this.getLayer(O)),P=M.length?this.queryRenderedFeatures(T.point,{layers:M}):[];P.length?_||(_=!0,d.call(this,new pt(m,this,T.originalEvent,{features:P}))):_=!1},w=()=>{_=!1};return{layers:new Set(o),listener:d,delegates:{mousemove:b,mouseout:w}}}if("mouseleave"===m||"mouseout"===m){let _=!1;const b=T=>{const M=o.filter(P=>this.getLayer(P));(M.length?this.queryRenderedFeatures(T.point,{layers:M}):[]).length?_=!0:_&&(_=!1,d.call(this,new pt(m,this,T.originalEvent)))},w=T=>{_&&(_=!1,d.call(this,new pt(m,this,T.originalEvent)))};return{layers:new Set(o),listener:d,delegates:{mousemove:b,mouseout:w}}}{const _=b=>{const w=o.filter(M=>this.getLayer(M)),T=w.length?this.queryRenderedFeatures(b.point,{layers:w}):[];T.length&&(b.features=T,d.call(this,b),delete b.features)};return{layers:new Set(o),listener:d,delegates:{[m]:_}}}}on(m,o,d){if(void 0===d)return super.on(m,o);Array.isArray(o)||(o=[o]);const _=this._createDelegatedListener(m,o,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(_);for(const b in _.delegates)this.on(b,_.delegates[b]);return this}once(m,o,d){if(void 0===d)return super.once(m,o);Array.isArray(o)||(o=[o]);const _=this._createDelegatedListener(m,o,d);for(const b in _.delegates)this.once(b,_.delegates[b]);return this}off(m,o,d){if(void 0===d)return super.off(m,o);o=new Set(Array.isArray(o)?o:[o]);const _=(w,T)=>{if(w.size!==T.size)return!1;for(const M of w)if(!T.has(M))return!1;return!0},b=this._delegatedListeners?this._delegatedListeners[m]:void 0;return b&&(w=>{for(let T=0;T<w.length;T++){const M=w[T];if(M.listener===d&&_(M.layers,o)){for(const P in M.delegates)this.off(P,M.delegates[P]);return w.splice(T,1),this}}})(b),this}queryRenderedFeatures(m,o){return this.style?(void 0!==o||void 0===m||m instanceof h.pointGeometry||Array.isArray(m)||(o=m,m=void 0),this.style.queryRenderedFeatures(m=m||[[0,0],[this.transform.width,this.transform.height]],o=o||{},this.transform)):[]}querySourceFeatures(m,o){return this.style.querySourceFeatures(m,o)}queryTerrainElevation(m,o){const d=this.transform.elevation;return d?(o=h.extend({},{exaggerated:!0},o),d.getAtPoint(h.MercatorCoordinate.fromLngLat(m),null,o.exaggerated)):null}setStyle(m,o){return!1!==(o=h.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(m,o))}_getUIString(m){const o=this._locale[m];if(null==o)throw new Error(`Missing UI string '${m}'`);return o}_updateStyle(m,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m&&(this.style=new vr(this,o||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof m?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new vr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,o){if("string"==typeof m){const d=this._requestManager.normalizeStyleURL(m),_=this._requestManager.transformRequest(d,h.ResourceType.Style);h.getJSON(_,(b,w)=>{b?this.fire(new h.ErrorEvent(b)):w&&this._updateDiff(w,o)})}else"object"==typeof m&&this._updateDiff(m,o)}_updateDiff(m,o){try{this.style.setState(m)&&this._update(!0)}catch(d){h.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(m,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(h.warnOnce("There is no style added to the map."),!1)}addSource(m,o){return this._lazyInitEmptyStyle(),this.style.addSource(m,o),this._update(!0)}isSourceLoaded(m){return!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){const m=this.style&&this.style._sourceCaches;for(const o in m){const d=m[o]._tiles;for(const _ in d){const b=d[_];if("loaded"!==b.state&&"errored"!==b.state)return!1}}return!0}addSourceType(m,o,d){this._lazyInitEmptyStyle(),this.style.addSourceType(m,o,d)}removeSource(m){return this.style.removeSource(m),this._updateTerrain(),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,o,{pixelRatio:d=1,sdf:_=!1,stretchX:b,stretchY:w,content:T}={}){if(this._lazyInitEmptyStyle(),o instanceof h.window.HTMLImageElement||h.window.ImageBitmap&&o instanceof h.window.ImageBitmap){const{width:M,height:P,data:O}=h.exported.getImageData(o);this.style.addImage(m,{data:new h.RGBAImage({width:M,height:P},O),pixelRatio:d,stretchX:b,stretchY:w,content:T,sdf:_,version:0})}else if(void 0===o.width||void 0===o.height)this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:P}=o,O=o;this.style.addImage(m,{data:new h.RGBAImage({width:M,height:P},new Uint8Array(O.data)),pixelRatio:d,stretchX:b,stretchY:w,content:T,sdf:_,version:0,userImage:O}),O.onAdd&&O.onAdd(this,m)}}updateImage(m,o){const d=this.style.getImage(m);if(!d)return void this.fire(new h.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=o instanceof h.window.HTMLImageElement||h.window.ImageBitmap&&o instanceof h.window.ImageBitmap?h.exported.getImageData(o):o,{width:b,height:w}=_;void 0!==b&&void 0!==w?b===d.data.width&&w===d.data.height?(d.data.replace(_.data,!(o instanceof h.window.HTMLImageElement||h.window.ImageBitmap&&o instanceof h.window.ImageBitmap)),this.style.updateImage(m,d)):this.fire(new h.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new h.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,o){h.getImage(this._requestManager.transformRequest(m,h.ResourceType.Image),(d,_)=>{o(d,_ instanceof h.window.HTMLImageElement?h.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(m,o){return this._lazyInitEmptyStyle(),this.style.addLayer(m,o),this._update(!0)}moveLayer(m,o){return this.style.moveLayer(m,o),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,o,d){return this.style.setLayerZoomRange(m,o,d),this._update(!0)}setFilter(m,o,d={}){return this.style.setFilter(m,o,d),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,o,d,_={}){return this.style.setPaintProperty(m,o,d,_),this._update(!0)}getPaintProperty(m,o){return this.style.getPaintProperty(m,o)}setLayoutProperty(m,o,d,_={}){return this.style.setLayoutProperty(m,o,d,_),this._update(!0)}getLayoutProperty(m,o){return this.style.getLayoutProperty(m,o)}setLight(m,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,o),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(h.LngLat.convert(m),this.transform):0}setFeatureState(m,o){return this.style.setFeatureState(m,o),this._update()}removeFeatureState(m,o){return this.style.removeFeatureState(m,o),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let d,_,b,w=this._container;for(;w&&(!_||!b);){const T=h.window.getComputedStyle(w).transform;T&&"none"!==T&&(d=T.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&"0"!==d[0]&&"1"!==d[0]&&(_=d[0]),d[3]&&"0"!==d[3]&&"1"!==d[3]&&(b=d[3])),w=w.parentElement}this._containerWidth=_?Math.abs(m/_):m,this._containerHeight=b?Math.abs(o/b):o}_detectMissingCSS(){"rgb(250, 128, 114)"!==h.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&h.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=K("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=K("div","mapboxgl-canvas-container",m);this._interactive&&o.classList.add("mapboxgl-interactive"),this._canvas=K("canvas","mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=K("div","mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{_[b]=K("div",`mapboxgl-ctrl-${b}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,o){const d=h.exported.devicePixelRatio||1;this._canvas.width=d*Math.ceil(m),this._canvas.height=d*Math.ceil(o),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${o}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const o=this._markers.indexOf(m);-1!==o&&this._markers.splice(o,1)}_setupPainter(){const m=h.extend({},U.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);o?(h.storeAuthState(o,!0),this.painter=new Sd(o,this.transform),this.on("data",d=>{"source"===d.dataType&&this.painter.setTileLoadedFlag(!0)}),h.exported$1.testSupport(o)):this.fire(new h.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new h.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new h.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let o;const d=this.painter.context.extTimerQuery,_=h.exported.now();if(this.listens("gpu-timing-frame")&&(o=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;let b=!1;const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,O=this.transform.pitch,L=h.exported.now();this.style.zoomHistory.update(P,L);const B=new h.EvaluationParameters(P,{now:L,fadeDuration:w,pitch:O,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),H=B.crossFadingFactor();1===H&&H===this._crossFadingFactor||(b=!0,this._crossFadingFactor=H),this.style.update(B)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerUpdate()):T=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new h.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new h.Event("load"))),this.style&&(this.style.hasTransitions()||b)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const P=h.exported.now()-_;d.endQueryEXT(d.TIME_ELAPSED_EXT,o),setTimeout(()=>{const O=d.getQueryObjectEXT(o,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(o),this.fire(new h.Event("gpu-timing-frame",{cpuTime:P,gpuTime:O}))},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const O=this.painter.queryGpuTimers(P);this.fire(new h.Event("gpu-timing-layer",{layerTimes:O}))},50)}const M=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(M||this._repaint)this.triggerRepaint();else{const P=!this.isMoving()&&this.loaded();if(P&&(T=this._updateAverageElevation(_,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new h.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const O=this._calculateSpeedIndex();this.fire(new h.Event("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const m of this._markers)m._update()}_updateAverageElevation(m,o=!1){const d=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&d(0);if((o||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const _=this.transform.averageElevation;let b=this.transform.sampleAverageElevation(),w=!1;this.transform.elevation&&(w=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=m;const T=Math.abs(_-b);if(T>1){if(this._isInitialLoad||w)return this._averageElevation.jumpTo(b),d(b);this._averageElevation.easeTo(b,m,300)}else if(T>1e-4)return this._averageElevation.jumpTo(b),d(b)}return!!this._averageElevation.isEasing(m)&&d(this._averageElevation.getValue(m))}_authenticate(){h.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===h.AUTH_ERR_MSG||401===m.status)){const o=this.painter.context.gl;h.storeAuthState(o,!1),this._logoControl instanceof Nd&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new h.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),h.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const d=this.painter.context.gl,_=d.createFramebuffer();function b(w){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,w,0);const T=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,T),T}return d.bindFramebuffer(d.FRAMEBUFFER,_),this._canvasPixelComparison(b(m),o.canvasCopies.map(b),o.timeStamps)}_canvasPixelComparison(m,o,d){let _=d[1]-d[0];const b=m.length/4;for(let w=0;w<o.length;w++){const T=o[w];let M=0;for(let P=0;P<T.length;P+=4)T[P]===m[P]&&T[P+1]===m[P+1]&&T[P+2]===m[P+2]&&T[P+3]===m[P+3]&&(M+=1);_+=(d[w+2]-d[w+1])*(1-M/b)}return _}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==h.window&&(h.window.removeEventListener("resize",this._onWindowResize,!1),h.window.removeEventListener("orientationchange",this._onWindowResize,!1),h.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),h.window.removeEventListener("online",this._onWindowOnline,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),es(this._canvasContainer),es(this._controlContainer),es(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),h.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new h.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=h.exported.frame(o=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(o)}))}_preloadTiles(m){const o=this.style?Object.values(this.style._sourceCaches):[];return h.asyncAll(o,(d,_)=>d._preloadTiles(m,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}_setCacheLimits(m,o){h.setCacheLimits(m,o)}get version(){return h.version}},NavigationControl:class{constructor(m){this.options=h.extend({},il,m),this._container=K("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(h.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),K("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),K("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(h.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:o}):d.resetNorth({},{originalEvent:o}))}),this._compassIcon=K("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const o=m.getZoom(),d=o===m.getMaxZoom(),_=o===m.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new vh(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,o){const d=K("button",m,this._container);return d.type="button",d.addEventListener("click",o),d}_setButtonTitle(m,o){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${o}`);m.setAttribute("aria-label",d),m.firstElementChild&&m.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends h.Evented{constructor(m){super(),this.options=h.extend({},Co,m),h.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=uu(this._updateMarkerRotation,20)}onAdd(m){var o;return this._map=m,this._container=K("div","mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,void 0!==qi?o(qi):void 0!==h.window.navigator.permissions?h.window.navigator.permissions.query({name:"geolocation"}).then(d=>{qi="denied"!==d.state,o(qi)}):(qi=!!h.window.navigator.geolocation,o(qi)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(h.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,ol=0,sl=!1}_isOutOfMapMaxBounds(m){const o=this._map.getMaxBounds(),d=m.coords;return!!o&&(d.longitude<o.getWest()||d.longitude>o.getEast()||d.latitude<o.getSouth()||d.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new h.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(m),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new h.Event("geolocate",m)),this._finish()}}_updateCamera(m){const o=new h.LngLat(m.coords.longitude,m.coords.latitude),d=m.coords.accuracy,_=this._map.getBearing(),b=h.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(d),b,{geolocateSource:!0})}_updateMarker(m){if(m){const o=new h.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map._containerHeight/2,o=this._map.unproject([0,m]),d=this._map.unproject([100,m]),_=o.distanceTo(d)/100,b=Math.ceil(2*this._accuracy/_);this._circleElement.style.width=`${b}px`,this._circleElement.style.height=`${b}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(1===m.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===m.code&&sl)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new h.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=K("button","mapboxgl-ctrl-geolocate",this._container),K("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===m){h.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=K("div","mapboxgl-user-location"),this._dotElement.appendChild(K("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(K("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new rl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=K("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new rl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||"ACTIVE_LOCK"!==this._watchState||o.originalEvent&&"resize"===o.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new h.Event("trackuserlocationend")))})}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:!0===m.absolute&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return h.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ol--,sl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new h.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ol++,ol>1?(m={maximumAge:6e5,timeout:0},sl=!0):(m=this.options.positionOptions,sl=!1),this._geolocationWatchID=h.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else h.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{h.window.addEventListener("ondeviceorientationabsolute"in h.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==h.window.DeviceMotionEvent&&"function"==typeof h.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(o=>{"granted"===o&&m()}).catch(console.error):m()}_clearWatch(){h.window.navigator.geolocation.clearWatch(this._geolocationWatchID),h.window.removeEventListener("deviceorientation",this._onDeviceOrientation),h.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:_u,ScaleControl:class{constructor(m){this.options=h.extend({},xh,m),h.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){bh(this._map,this._container,this.options)}onAdd(m){return this._map=m,this._container=K("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(m){this.options.unit=m,bh(this._map,this._container,this.options)}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof h.window.HTMLElement?this._container=m.container:h.warnOnce("Full screen control 'container' must be a DOM element.")),h.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in h.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in h.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=K("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",h.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,h.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!h.window.document.fullscreenEnabled&&!h.window.document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=K("button","mapboxgl-ctrl-fullscreen",this._controlContainer);K("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),h.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(h.window.document.fullscreenElement||h.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?h.window.document.exitFullscreen?h.window.document.exitFullscreen():h.window.document.webkitCancelFullScreen&&h.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends h.Evented{constructor(m){super(),this.options=h.extend(Object.create(fo),m),h.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new h.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new h.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=h.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(h.window.document.createTextNode(m))}setHTML(m){const o=h.window.document.createDocumentFragment(),d=h.window.document.createElement("body");let _;for(d.innerHTML=m;_=d.firstChild,_;)o.appendChild(_);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=K("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(m),this.options.closeButton){const d=this._closeButton=K("button","mapboxgl-popup-close-button",o);d.type="button",d.setAttribute("aria-label","Close popup"),d.setAttribute("aria-hidden","true"),d.innerHTML="&#215;",d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let o;return this._classList.delete(m)?o=!1:(this._classList.add(m),o=!0),this._updateClassList(),o}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const o=this._map,d=this._container,_=this._pos;if(!o||!d||!_)return"bottom";const b=d.offsetWidth,w=d.offsetHeight,T=_.x<b/2,M=_.x>o.transform.width-b/2;if(_.y+m<w)return T?"top-left":M?"top-right":"top";if(_.y>o.transform.height-w){if(T)return"bottom-left";if(M)return"bottom-right"}return T?"left":M?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),m.className=o.join(" ")}_update(m){const o=this._map,d=this._content;if(!o||!this._lngLat&&!this._trackPointer||!d)return;let _=this._container;if(_||(_=this._container=K("div","mapboxgl-popup",o.getContainer()),this._tip=K("div","mapboxgl-popup-tip",_),_.appendChild(d)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=tl(this._lngLat,this._pos,o.transform)),!this._trackPointer||m){const b=this._pos=this._trackPointer&&m?m:o.project(this._lngLat),w=al(this.options.offset),T=this._anchor=this._getAnchor(w.y),M=al(this.options.offset,T),P=b.add(M).round();o._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${nl[T]} translate(${P.x}px,${P.y}px)`)})}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Rr);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._content&&(this._content.style.opacity=m),this._tip&&(this._tip.style.opacity=m)}},Marker:rl,Style:vr,LngLat:h.LngLat,LngLatBounds:h.LngLatBounds,Point:h.pointGeometry,MercatorCoordinate:h.MercatorCoordinate,FreeCameraOptions:eo,Evented:h.Evented,config:h.config,prewarm:function(){rn().acquire(on)},clearPrewarmedResources:function(){const m=Yt;m&&(m.isPreloaded()&&1===m.numActive()?(m.release(on),Yt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return h.config.ACCESS_TOKEN},set accessToken(m){h.config.ACCESS_TOKEN=m},get baseApiUrl(){return h.config.API_URL},set baseApiUrl(m){h.config.API_URL=m},get workerCount(){return Kt.workerCount},set workerCount(m){Kt.workerCount=m},get maxParallelImageRequests(){return h.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){h.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){h.clearTileCache(m)},workerUrl:"",workerClass:null,setNow:h.exported.setNow,restoreNow:h.exported.restoreNow};return aa}),lt}()},775:function(Bt){var lt;lt=function(){var Xe=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function lt(Y){return Y.match(Xe)||[]}function de(Y){return{language:(Y=lt(Y))[1]||"",extlang:Y[2]||"",script:Y[3]||"",region:Y[4]||""}}function h(Y,ie,$){Object.defineProperty(Y,ie,{value:$,enumerable:!0})}function U(Y,ie,$){function K(W){return lt(W)[Y]||""}h(K,"pattern",ie),h(de,$,K)}return U(1,/^[a-zA-Z]{2,3}$/,"language"),U(2,/^[a-zA-Z]{3}$/,"extlang"),U(3,/^[a-zA-Z]{4}$/,"script"),U(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),h(de,"split",function we(Y){return lt(Y).filter(function(ie,$){return ie&&$})}),de},Bt.exports?Bt.exports=lt():this.subtag=lt()},703:Bt=>{Bt.exports=function Xe(){for(var lt={},we=0;we<arguments.length;we++){var de=arguments[we];for(var h in de)Vt.call(de,h)&&(lt[h]=de[h])}return lt};var Vt=Object.prototype.hasOwnProperty},652:(Bt,Vt,Xe)=>{"use strict";Xe.d(Vt,{x0:()=>h});let h=(U=21)=>crypto.getRandomValues(new Uint8Array(U)).reduce((Y,ie)=>Y+((ie&=63)<36?ie.toString(36):ie<62?(ie-26).toString(36).toUpperCase():ie>62?"-":"_"),"")},147:Bt=>{"use strict";Bt.exports={i8:"0.0.23"}}},Bt=>{Bt(Bt.s=779)}]);